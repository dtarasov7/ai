# Промт инжиниринг для улучшения RAG

## Параметры промтов

### Температура (temperature)
- Управляет случайностью вывода модели
- Диапазон: 0-2
- **0** - всегда выбирает наиболее вероятное слово
- **2** - максимальная случайность
- Значение по умолчанию: 1
- Пример: `ChatOpenAI(model_name="gpt-4o-mini", temperature=0)`

### Вероятностное сужение (top-p)
- Управляет частью вероятностного распределения
- Значение по умолчанию: 1
- Пример: top-p=0.7 учитывает только первые 70% вероятностей
- Передается через `model_kwargs`
- ⚠️ Не рекомендуется использовать одновременно с temperature

### Зерно случайности (seed)
- Обеспечивает повторяемость результатов
- Любое целое число
- Работает с `system_fingerprint`
- Передается через `model_kwargs`
- Пример: `model_kwargs={"seed": 42}`

## Концепция примеров (Shot concept)

### No-shot
- 0 примеров

### Single-shot
- 1 пример
- Помогает понять формат ответа

### Few-shot / Multi-shot
- Несколько примеров
- Направляет LLM на аналогичную манеру ответа

## Терминология

### Промтинг (Prompting)
- Процесс отправки запроса в LLM

### Проектирование промтов (Prompt design)
- Стратегия разработки промта
- Множество стратегий для разных сценариев

### Инженерия промтов (Prompt engineering)
- Технический процесс оптимизации
- Разбиение сложных запросов
- Гидратация промта
- Более широкое понятие

## Техники проектирования промтов

### Shot design (Проектирование примеров)
- Отправная точка
- Тщательная проработка начального промта
- Использование примеров

### Chain-of-thought prompting
- Разбиение на этапы
- Промежуточные рассуждения
- Пошаговый логический процесс

### Personas (Персоны)
- Создание вымышленного персонажа
- Адаптация под целевую аудиторию
- Имя, профессия, демография, история

### Chain of density (Цепочка плотности)
- Контроль качества суммаризации
- Оценка плотности сущностей
- Включение ключевой информации

### Tree of thoughts (Дерево мыслей)
- Генерация нескольких вариантов рассуждений
- Поэтапный отбор лучших
- Глубокое исследование идей

### Graph prompting (Графовый промтинг)
- Работа с графовыми структурами
- Анализ связей между объектами

### Knowledge augmentation
- Обогащение промтов информацией
- Реализация через RAG
- Включение внешних знаний

### Show Me vs Tell Me
- **Show Me** - примеры и демонстрации
- **Tell Me** - текстовые инструкции
- Использование обоих подходов

## Основы проектирования промтов

### Краткость и точность
- Четко определить задачу
- Только необходимая информация
- Избегать расплывчатых формулировок

### Одна задача за раз
- Разбивать сложные задачи
- Управляемые части
- Последовательные промты

### Преобразование в классификацию
- Открытые запросы → формат классификации
- Ограниченное число вариантов
- Пример: "положительная/отрицательная/нейтральная"

### Использование примеров
- Single-shot и few-shot подходы
- Примеры как ориентир
- Формат: вопрос-контекст-ответ

### Постепенное уточнение
- Начинать с простых промтов
- Итеративное улучшение
- Добавление элементов постепенно

### Инструкции в начале
- Четкие инструкции вначале
- Использование разделителей (###)
- Структурированный формат

## Адаптация для разных LLM

### OpenAI
- Стандартные промты
- Параметры через API

### Claude-3 (Anthropic)
- Предпочитает XML-кодирование
- Поддержка длинных контекстов

### Llama3
- Специальные теги: `<SYS>` и `<INST>`
- SYS - system message
- INST - instructions

### Google
- Мощные языковые модели
- Собственные техники

### Open-source модели
- Альтернативы коммерческим моделям
- Уникальные подходы

## PromptTemplate в LangChain

### Основы
- Класс для управления промтами
- Текст с переменными
- Совместимость с экосистемой

### ChatPromptTemplate
- Для чат-сценариев
- Форматирование списка сообщений

### String prompt template
- Обычная строка с заполнителями
- Пример: `{question}`, `{context}`

### Методы
- `from_template()` - создание шаблона
- `input_variables` - автоопределение переменных
- Передача словаря параметров

### PromptValue
- Результат работы PromptTemplate
- Передача в LLM или ChatModel
- Использование в LCEL-конвейере

## Практические техники (Лаборатория 13.2)

### Итерация (Iterating)

#### Изменение тона
- Адаптация под маркетинговый стиль
- Формат информационного листа
- Профессиональный/неформальный тон

#### Сокращение длины
- Ограничение количества слов
- Пример: "Use at most 50 words"
- Компактный формат

#### Изменение фокуса
- Направление на определенные аспекты
- Пример: технологическая аудитория
- Релевантный контент

### Суммаризация (Summarization)

#### Базовая суммаризация
- Сжатие большого объема данных
- Сохранение ключевой информации
- Ограничение по словам (30 слов)

#### Суммаризация с фокусом
- Акцент на определенных аспектах
- Пример: эко-свойства продуктов
- Целевая информация

#### Извлечение vs суммаризация
- **Extract** - поиск конкретных данных
- **Summarize** - обобщение всего текста
- LLM понимает разницу

### Выведение (Inference)

#### Анализ тональности
- Положительный/отрицательный
- Boolean-style analysis
- Автоматическое определение

#### Извлечение ключевых данных
- Конкретная информация из контекста
- Пример: названия продуктов
- Структурированный вывод

#### Выведение тем
- Экстремальная суммаризация
- Список тем (8+ тем)
- 1-2 слова на тему

### Трансформация (Transformation)

#### Языковая трансформация (перевод)
- Перевод на разные языки
- Пример: испанский, французский, пиратский
- Множественные версии текста

#### Тональная трансформация
- Изменение стиля текста
- Пример: e-mail формат
- Дружелюбный/формальный тон

#### Другие трансформации
- Преобразование кода
- Проверка орфографии
- Проверка грамматики

### Расширение (Expansion)

#### Концепция
- Противоположность суммаризации
- Дополнение краткой информации
- Увеличение объема текста

#### Практическое применение
- Развернутое описание
- Адаптация для инвесторов
- Использование только резюме как основы

## Ключевые принципы

### Гибкость
- Нет универсального решения
- Экспериментирование с подходами
- Адаптация под задачи

### Итеративность
- Постепенное улучшение
- Множество итераций
- Поэтапный подход

### Контекстуальность
- Учет целевой аудитории
- Соответствие формату
- Релевантность контента

### Специфичность
- Четкие инструкции
- Конкретные запросы
- Структурированные промты

## Будущее промт инжиниринга

### Развитие области
- Постоянное появление новых техник
- Инновационные подходы
- Улучшение возможностей генеративного ИИ

### Продвинутые методы
- Вывод RAG-системы на новый уровень
- Следующие главы книги
- Лучшие практики
