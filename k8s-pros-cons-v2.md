# Плюсы и минусы внедрения Kubernetes

## С точки зрения инфраструктуры

Этот пункт понимается как то, что предоставляет K8s как платформа для запуска рабочих нагрузок

### Плюсы

* Оркестрация рабочих нагрузок: автоматическое управление множеством контейнеров поверх множества рабочих машин (в отличие от ручного управления через docker run / docker compose)
* Масштабируемость: статическое (replicas) и динамическое масштабирование (HPA даёт широкие возможности не только по CPU/RAM но и по кастомным метрикам)
* Отказоустойчивость: автоперезапуск упавших контейнеров; автоматическая балансировка и распределение трафика только на "здоровые" поды в группе; контроль состояния контейнеров через liveness/readiness probes; лёгкий HA через podAntiAffinity
* Возможность привязки нагрузок к конкретным группам нод через nodeAffinity, nodeSelectors
* Service Mesh как отдельный сетевой слой, прозрачный для приложений: mTLS, трейсинг запросов, метрики на стороне source и destination и мн. др.
* Встроенный Service Discovery от простого использования объектов Service, до продвинутых возможностей Service Mesh
* Возможность продвинутого препровиженинга и ожидания внешних зависимостей через initContainers
* Изоляция ресурсов – Лучший контроль CPU/RAM через requests/limits, нежели базовые `--cpus`, `--memory` в Docker
* Стратегии деплоя от уже неплохого встроенного RollingUpdate, до продвинутых Canary и Blue/Green через дополнительные инструменты (напр. ArgoRollouts)
* Декларативное управление через API подразумевает возможность полноценного использования GitOps без проблем
* Контроль и откат деплоев через Helm Releases; отслеживаение состояния через startup/readiness/liveness пробы
* CNI - единое прозрачное сетевое пространство для рабочих нагрузок поверх рабочих нод с возможностью настройки политик и ограничений
* CSI - гибкое управление слоем хранения данных

### Минусы

* Отдельный слой инфраструктуры, требующий настройки и администрирования
* Полностью новые и незнакомые концепции (Pods, Deployments, Services, Secrets, PVC) - требует серьёзного обучения, в отличие от простого и понятного Docker / docker-compose
* Некоторые абстракции придётся реализовать дополнительными внешними системи: Ceph-CSI, Metal Load Balancer и т.д.
* Требует значительного числа как рабочих так и управляющих машин со старта: это связано как с необходимостью кворумного кластера управляющих нод (3, лучше 5), так и удобства вывода на maintenance нод в целом (5, а лучше 7 рабочих нод со старта)

## С точки зрения администрирования

Этот пункт понимается как то, что ложится на плечи администраторов K8s

### Плюсы

* Провиженинг нод: не требуется установки и настройки никакого дополнительного ПО кроме kubelet и container runtime
* Ввод новых нод (а при некоторых условиях вывод имеющихся на maintenance) не ведёт к простою в работе кластера и его рабочих нагрузок
* Лёгкость запуска различных агентов на нодах через DaemonSet, легкость выполнения периодических задач через CronJob
* Хранилище и окружение автоматически перемещаются между нодами при перемещении пода (следуют за рабочей нагрузкой)
* Namespaces: логическое разделение кластерного пространтства
* Безопасность: RBAC, Network Policies и Secrets - мощные и удобные инструменты
* Vault Secrets Operator или аналоги как безопасная реализация хранилища секретов с возможностью инжектирования секретов при старте приложения и со стратегиями перезапуска подов при изменении содержимого
* Единый API: полное управление через kubectl / k9s / Helm вместо разнородных скриптов или compose-файлов
* Единая точка сбора логов, управление целями мониторинга через аннотации

### Минусы

* Новые и незнакомые инструменты управления kubectl, k9s, Helm
* Необходимость администрирования дополнительных систем, обеспечивающих реализацию абстракций K8s: Ceph, Prometheus, Metal LB и т.д.
* Эффективная отладка возможна только при хорошо настроенных инструментах Observability: централизованный сбор логов, метрик, трейсов; данные с одной ноды бесполезны
* Неудачное обновление или изменение конфигурации кластера K8s может вызвать общую недоступность кластера, а не отдельной ноды

## С точки зрения бизнеса

Этот пункт даёт оценку профитов и рисков бизнеса

### Плюсы

* Естественная способность к масштабированию: легко адаптируется под рост или снижение нагрузки
* Абстрагирование от нижележащей инфраструктуры: независимое планирование capacity, даже на основе статистики и AI моделей
* Надежность: при правильной настройке приложений отказоустойчивость выше, чем у standalone Docker
* Скорость доставки и отката: чем приложение массивнее, тем проще и удобнее накатывать и откатывать его релизы
* Снижение затрат: большая утилизация серверов, меньше простаивающих мощностей; возможность лёгкого аудита и контроля за потреблением ресурсов всего кластера

### Минусы

* Высокий порог входа: нужны специалисты по K8s; Docker знаком гораздо большему количеству людей
* Оверкилл для простых проектов: для 1–2 сервисов, K8s избыточен в отличие от Docker; требует (минимум) трёх дополнительных управляющих нод на старте для правильной работы
* Долгая окупаемость: Внедрение требует времени и денег, тогда как Docker дешевле в поддержке и эксплуатации
* Возникающие проблемы имеют совершенно иной характер и уровень сложности: смена подходов к их профилактике и устранению
