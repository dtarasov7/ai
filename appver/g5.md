Супер. Ниже — готовый дашборд Grafana v11 (JSON), который показывает историю версии ПО из метрики app{nodename, appname, version} на панели State timeline. Он делает это без value mappings: с помощью трансформаций Labels to fields → Rows to fields превращает строковую метку version в «значение состояния» и рисует сегменты со сменами версии.

Инструкция по импорту
- Grafana → Dashboards → Import → вставьте JSON → выберите ваш Prometheus datasource для переменной DS_PROMETHEUS → Import.
- Переменные $node и $app позволяют фильтровать по узлам и приложениям (поддерживают мультивыбор и All).

JSON дашборда
```json
{
  "__inputs": [
    {
      "name": "DS_PROMETHEUS",
      "label": "Prometheus",
      "description": "",
      "type": "datasource",
      "pluginId": "prometheus",
      "pluginName": "Prometheus"
    }
  ],
  "__requires": [
    { "type": "grafana", "id": "grafana", "name": "Grafana", "version": "11.0.0" },
    { "type": "panel", "id": "state-timeline", "name": "State timeline", "version": "11.0.0" },
    { "type": "datasource", "id": "prometheus", "name": "Prometheus", "version": "2.0.0" }
  ],
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": "-- Grafana --",
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard",
        "target": { "limit": 100, "matchAny": false, "tags": [], "type": "dashboard" }
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "gnetId": null,
  "graphTooltip": 0,
  "id": null,
  "iteration": 1710000000000,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "type": "state-timeline",
      "title": "App version history",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 13, "w": 24, "x": 0, "y": 0 },
      "options": {
        "mergeValues": true,
        "showValue": "always",
        "alignValue": "center",
        "rowHeight": 0.85,
        "pageSize": null
      },
      "fieldConfig": {
        "defaults": {
          "displayName": "${__field.labels.nodename} • ${__field.labels.appname}",
          "noValue": "",
          "color": { "mode": "palette-classic" },
          "mappings": []
        },
        "overrides": []
      },
      "targets": [
        {
          "refId": "A",
          "editorMode": "code",
          "expr": "app{nodename=~\"$node\",appname=~\"$app\"}",
          "legendFormat": "{{nodename}} • {{appname}} • {{version}}",
          "range": true,
          "instant": false
        }
      ],
      "transformations": [
        {
          "id": "labelsToFields",
          "options": {}
        },
        {
          "id": "rowsToFields",
          "options": {
            "mappings": [
              { "fieldName": "appname", "handlerKey": "field.name" },
              { "fieldName": "version", "handlerKey": "field.value" }
            ]
          }
        }
      ],
      "pluginVersion": "11.0.0"
    }
  ],
  "refresh": "30s",
  "schemaVersion": 39,
  "style": "dark",
  "tags": ["versions", "prometheus", "apps"],
  "templating": {
    "list": [
      {
        "type": "datasource",
        "name": "DS_PROMETHEUS",
        "label": "Prometheus",
        "query": "prometheus",
        "current": {}
      },
      {
        "hide": 0,
        "name": "node",
        "label": "Node",
        "query": { "query": "label_values(app,nodename)", "refId": "VarNode" },
        "refresh": 1,
        "type": "query",
        "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
        "includeAll": true,
        "multi": true,
        "options": [],
        "current": {}
      },
      {
        "hide": 0,
        "name": "app",
        "label": "App",
        "query": { "query": "label_values(app,appname)", "refId": "VarApp" },
        "refresh": 1,
        "type": "query",
        "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
        "includeAll": true,
        "multi": true,
        "options": [],
        "current": {}
      }
    ]
  },
  "time": { "from": "now-30d", "to": "now" },
  "timepicker": {},
  "timezone": "",
  "title": "App version timeline",
  "uid": null,
  "version": 1,
  "weekStart": ""
}
```

Как это работает и почему так
- Запрос получает time series со значением 1, а метка version содержит полезный текст.
- Labels to fields добавляет метки как отдельные строковые поля.
- Rows to fields назначает:
  - field.name ← appname (имя будущего ряда),
  - field.value ← version (значения рядов становятся строками версий).
  Остальные поля (например, nodename) попадают в labels и доступны в шаблоне Display name.
- В State timeline включено Merge equal consecutive values, поэтому одинаковые версии сливаются в один сегмент; текст сегмента — строка version. Документация: State timeline поддерживает строковые состояния и опции merge/show values; Rows to fields позволяет использовать строковые поля в качестве значений; шаблоны типа ${__field.labels.X} доступны в Display name. 

Подсказки
- Если в сегментах видите «1», значит трансформация Rows to fields не назначила field.value=version — проверьте блок transformations.
- Для больших инсталляций можно увеличить Min step/Resolution в запросе Prometheus, чтобы снизить плотность точек без потери смен состояний.
- Нужна версия с группировкой по-другому (например, одна строка на nodename)? Скажете — пришлю JSON-вариант.
