IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwoKaW1wb3J0IHVyd2lkCmltcG9ydCB0aHJlYWRpbmcKaW1w
b3J0IGpzb24KaW1wb3J0IG9zCmltcG9ydCBzeXMKaW1wb3J0IHNzbAppbXBvcnQgYXJncGFyc2UK
ZnJvbSBjb2xsZWN0aW9ucyBpbXBvcnQgZGVxdWUKZnJvbSBrYWZrYSBpbXBvcnQgS2Fma2FDb25z
dW1lciwgS2Fma2FBZG1pbkNsaWVudCwgS2Fma2FQcm9kdWNlciwgVG9waWNQYXJ0aXRpb24KZnJv
bSBrYWZrYS5hZG1pbiBpbXBvcnQgTmV3VG9waWMsIENvbmZpZ1Jlc291cmNlLCBDb25maWdSZXNv
dXJjZVR5cGUKZnJvbSBrYWZrYS5lcnJvcnMgaW1wb3J0IEthZmthRXJyb3IsIFRvcGljQWxyZWFk
eUV4aXN0c0Vycm9yCmltcG9ydCBsb2dnaW5nCmltcG9ydCBsb2dnaW5nLmhhbmRsZXJzCmltcG9y
dCB0cmFjZWJhY2sKaW1wb3J0IGdldHBhc3MKaW1wb3J0IGJhc2U2NAppbXBvcnQgcmVxdWVzdHMK
ZnJvbSBjcnlwdG9ncmFwaHkuaGF6bWF0LnByaW1pdGl2ZXMgaW1wb3J0IGhhc2hlcwpmcm9tIGNy
eXB0b2dyYXBoeS5oYXptYXQucHJpbWl0aXZlcy5rZGYucGJrZGYyIGltcG9ydCBQQktERjJITUFD
CmZyb20gY3J5cHRvZ3JhcGh5Lmhhem1hdC5iYWNrZW5kcyBpbXBvcnQgZGVmYXVsdF9iYWNrZW5k
CmZyb20gY3J5cHRvZ3JhcGh5LmZlcm5ldCBpbXBvcnQgRmVybmV0CgpfX3ZlcnNpb25fXyA9ICJ2
MS44LjAiCl9fQVVUSE9SX18gPSAiVGFyYWFzb3YgRG1pdHJ5IgoKY2xhc3MgU2VsZWN0YWJsZVRl
eHQodXJ3aWQuVGV4dCk6CiAgICBfc2VsZWN0YWJsZSA9IFRydWUKCiAgICBkZWYga2V5cHJlc3Mo
c2VsZiwgc2l6ZSwga2V5KToKICAgICAgICByZXR1cm4ga2V5CgoKTE9HID0gbG9nZ2luZy5nZXRM
b2dnZXIoImthZmthX3ZpZXdlciIpCgoKZGVmIHNldHVwX2xvZ2dpbmcobGV2ZWw9IklORk8iLCBs
b2dfZmlsZT1Ob25lKToKICAgICMgbGV2ZWw6IERFQlVHL0lORk8vV0FSTklORy9FUlJPUgogICAg
bHZsID0gZ2V0YXR0cihsb2dnaW5nLCBzdHIobGV2ZWwpLnVwcGVyKCksIGxvZ2dpbmcuSU5GTykK
ICAgIExPRy5zZXRMZXZlbChsdmwpCgogICAgZm10ID0gbG9nZ2luZy5Gb3JtYXR0ZXIoIiUoYXNj
dGltZSlzICUobGV2ZWxuYW1lKXMgJShuYW1lKXM6ICUobWVzc2FnZSlzIikKCiAgICBoYW5kbGVy
cyA9IFtdCiAgICAjCiAgICAjICMgc3RkZXJyIGhhbmRsZXIgKNC/0L4g0YPQvNC+0LvRh9Cw0L3Q
uNGOINCy0YHQtdCz0LTQsCDQtdGB0YLRjCkKICAgICMgc2ggPSBsb2dnaW5nLlN0cmVhbUhhbmRs
ZXIoc3lzLnN0ZGVycikKICAgICMgc2guc2V0Rm9ybWF0dGVyKGZtdCkKICAgICMgc2guc2V0TGV2
ZWwobHZsKQogICAgIyBoYW5kbGVycy5hcHBlbmQoc2gpCgogICAgIyBmaWxlIGhhbmRsZXIgKNC1
0YHQu9C4INC30LDQtNCw0L0pCiAgICBpZiBsb2dfZmlsZToKICAgICAgICBmaCA9IGxvZ2dpbmcu
aGFuZGxlcnMuUm90YXRpbmdGaWxlSGFuZGxlcigKICAgICAgICAgICAgbG9nX2ZpbGUsIG1heEJ5
dGVzPTEwICogMTAyNCAqIDEwMjQsIGJhY2t1cENvdW50PTUsIGVuY29kaW5nPSJ1dGYtOCIKICAg
ICAgICApCiAgICAgICAgZmguc2V0Rm9ybWF0dGVyKGZtdCkKICAgICAgICBmaC5zZXRMZXZlbChs
dmwpCiAgICAgICAgaGFuZGxlcnMuYXBwZW5kKGZoKQoKICAgICMg0L7Rh9C40YHRgtC40Lwg0YHR
gtCw0YDRi9C1LCDRh9GC0L7QsdGLINC90LUg0LTRg9Cx0LvQuNGA0L7QstCw0YLRjCDQv9GA0Lgg
0L/QvtCy0YLQvtGA0L3QvtC8INC30LDQv9GD0YHQutC1L9GC0LXRgdGC0LDRhQogICAgTE9HLmhh
bmRsZXJzLmNsZWFyKCkKICAgIGZvciBoIGluIGhhbmRsZXJzOgogICAgICAgIExPRy5hZGRIYW5k
bGVyKGgpCgoKIyBNZXNzYWdlIHJvdyB3aWRnZXQ6IGtlZXBzIG1ldGFkYXRhIGZvciBmb290ZXIg
JiBmdWxsIHZpZXcKY2xhc3MgTXNnUm93KFNlbGVjdGFibGVUZXh0KToKICAgIGRlZiBfX2luaXRf
XyhzZWxmLCBzdW1tYXJ5X2xpbmUsIGZ1bGxfdGV4dCwgdG9waWMsIHBhcnRpdGlvbiwgb2Zmc2V0
LCB0aW1lc3RhbXA9Tm9uZSwga2V5PU5vbmUsIHJhd192YWx1ZT1Ob25lLCByYXdfa2V5PU5vbmUp
OgogICAgICAgIHN1cGVyKCkuX19pbml0X18oc3VtbWFyeV9saW5lKQogICAgICAgIHNlbGYuZnVs
bF90ZXh0ID0gZnVsbF90ZXh0CiAgICAgICAgc2VsZi50b3BpYyA9IHRvcGljCiAgICAgICAgc2Vs
Zi5wYXJ0aXRpb24gPSBwYXJ0aXRpb24KICAgICAgICBzZWxmLm9mZnNldCA9IG9mZnNldAogICAg
ICAgIHNlbGYudGltZXN0YW1wID0gdGltZXN0YW1wCiAgICAgICAgc2VsZi5rZXkgPSBrZXkKICAg
ICAgICBzZWxmLnJhd192YWx1ZSA9IHJhd192YWx1ZQogICAgICAgIHNlbGYucmF3X2tleSA9IHJh
d19rZXkKCgojIE1lc3NhZ2Ugcm93IHdpZGdldDoga2VlcHMgbWV0YWRhdGEgZm9yIGZvb3RlciAm
IGZ1bGwgdmlldwojIGNsYXNzIE1zZ1JvdyhTZWxlY3RhYmxlVGV4dCk6CiMgICAgIGRlZiBfX2lu
aXRfXyhzZWxmLCBzdW1tYXJ5X2xpbmUsIGZ1bGxfdGV4dCwgdG9waWMsIHBhcnRpdGlvbiwgb2Zm
c2V0LCB0aW1lc3RhbXA9Tm9uZSwga2V5PU5vbmUpOgojICAgICAgICAgc3VwZXIoKS5fX2luaXRf
XyhzdW1tYXJ5X2xpbmUpCiMgICAgICAgICBzZWxmLmZ1bGxfdGV4dCA9IGZ1bGxfdGV4dAojICAg
ICAgICAgc2VsZi50b3BpYyA9IHRvcGljCiMgICAgICAgICBzZWxmLnBhcnRpdGlvbiA9IHBhcnRp
dGlvbgojICAgICAgICAgc2VsZi5vZmZzZXQgPSBvZmZzZXQKIyAgICAgICAgIHNlbGYudGltZXN0
YW1wID0gdGltZXN0YW1wCiMgICAgICAgICBzZWxmLmtleSA9IGtleQoKCmNsYXNzIER5bmFtaWNN
c2dMaXN0Qm94KHVyd2lkLkxpc3RCb3gpOgogICAgIiIiTGlzdEJveCB0aGF0IHJlZm9ybWF0cyBt
ZXNzYWdlIHJvd3MgYmFzZWQgb24gYXZhaWxhYmxlIHdpZHRoIiIiCgogICAgZGVmIF9faW5pdF9f
KHNlbGYsIHdhbGtlcik6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXyh3YWxrZXIpCiAgICAgICAg
c2VsZi5sYXN0X3dpZHRoID0gTm9uZQoKICAgIGRlZiByZW5kZXIoc2VsZiwgc2l6ZSwgZm9jdXM9
RmFsc2UpOgogICAgICAgICMgc2l6ZSBpcyBhIHR1cGxlIChtYXhjb2wsKSBvciAobWF4Y29sLCBt
YXhyb3cpCiAgICAgICAgaWYgc2l6ZToKICAgICAgICAgICAgY3VycmVudF93aWR0aCA9IHNpemVb
MF0KICAgICAgICAgICAgaWYgY3VycmVudF93aWR0aCAhPSBzZWxmLmxhc3Rfd2lkdGg6CiAgICAg
ICAgICAgICAgICBzZWxmLmxhc3Rfd2lkdGggPSBjdXJyZW50X3dpZHRoCiAgICAgICAgICAgICAg
ICBzZWxmLl9yZWZvcm1hdF9tZXNzYWdlcyhjdXJyZW50X3dpZHRoKQogICAgICAgIHJldHVybiBz
dXBlcigpLnJlbmRlcihzaXplLCBmb2N1cykKCiAgICBkZWYgZm9ybWF0X2FsbF9tZXNzYWdlcyhz
ZWxmLCBkZWZhdWx0X3dpZHRoPTE1MCk6CiAgICAgICAgIiIiTWFudWFsbHkgdHJpZ2dlciBmb3Jt
YXR0aW5nIHdpdGggZGVmYXVsdCBvciBsYXN0IGtub3duIHdpZHRoIiIiCiAgICAgICAgd2lkdGgg
PSBzZWxmLmxhc3Rfd2lkdGggaWYgc2VsZi5sYXN0X3dpZHRoIGVsc2UgZGVmYXVsdF93aWR0aAog
ICAgICAgIHNlbGYuX3JlZm9ybWF0X21lc3NhZ2VzKHdpZHRoKQoKICAgIGRlZiBfcmVmb3JtYXRf
bWVzc2FnZXMoc2VsZiwgd2lkdGgpOgogICAgICAgICIiIlJlZm9ybWF0IGFsbCBtZXNzYWdlIHJv
d3MgYmFzZWQgb24gYXZhaWxhYmxlIHdpZHRoIiIiCiAgICAgICAgIyBDb2x1bW4gd2lkdGhzCiAg
ICAgICAgY29sX3RpbWVzdGFtcCA9IDI4CiAgICAgICAgY29sX3RvcGljID0gMTMKICAgICAgICBj
b2xfb2Zmc2V0ID0gMTAKICAgICAgICBjb2xfc2l6ZSA9IDggICMgTmV3IGNvbHVtbiBmb3Igc2l6
ZQogICAgICAgIGNvbF9rZXkgPSAxMgogICAgICAgICMgQ2FsY3VsYXRlIHZhbHVlIHdpZHRoOiB0
b3RhbCB3aWR0aCAtIChvdGhlciBjb2x1bW5zICsgc3BhY2VzKQogICAgICAgICMgNSBzcGFjZXMg
YmV0d2VlbiBjb2x1bW5zCiAgICAgICAgY29sX3ZhbHVlID0gbWF4KDIwLCB3aWR0aCAtIGNvbF90
aW1lc3RhbXAgLSBjb2xfdG9waWMgLSBjb2xfb2Zmc2V0IC0gY29sX3NpemUgLSBjb2xfa2V5IC0g
NSkKCiAgICAgICAgZm9yIGl0ZW0gaW4gc2VsZi5ib2R5OgogICAgICAgICAgICBpZiBpc2luc3Rh
bmNlKGl0ZW0sIHVyd2lkLkF0dHJNYXApOgogICAgICAgICAgICAgICAgd2lkZ2V0ID0gaXRlbS5v
cmlnaW5hbF93aWRnZXQKICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uod2lkZ2V0LCBNc2dS
b3cpOgogICAgICAgICAgICAgICAgICAgICMgUmVmb3JtYXQgdGhpcyBtZXNzYWdlCiAgICAgICAg
ICAgICAgICAgICAgc2VsZi5fZm9ybWF0X21zZ19yb3cod2lkZ2V0LCBjb2xfdGltZXN0YW1wLCBj
b2xfdG9waWMsIGNvbF9vZmZzZXQsIGNvbF9zaXplLCBjb2xfa2V5LCBjb2xfdmFsdWUpCgogICAg
ZGVmIF9mb3JtYXRfbXNnX3JvdyhzZWxmLCByb3csIGNvbF90aW1lc3RhbXAsIGNvbF90b3BpYywg
Y29sX29mZnNldCwgY29sX3NpemUsIGNvbF9rZXksIGNvbF92YWx1ZSk6CiAgICAgICAgIiIiRm9y
bWF0IGEgc2luZ2xlIG1lc3NhZ2Ugcm93IiIiCiAgICAgICAgIyBGb3JtYXQgdGltZXN0YW1wCiAg
ICAgICAgaWYgcm93LnRpbWVzdGFtcDoKICAgICAgICAgICAgZnJvbSBkYXRldGltZSBpbXBvcnQg
ZGF0ZXRpbWUKICAgICAgICAgICAgZHQgPSBkYXRldGltZS5mcm9tdGltZXN0YW1wKHJvdy50aW1l
c3RhbXAgLyAxMDAwLjApCiAgICAgICAgICAgIHRpbWVzdGFtcF9zdHIgPSBkdC5zdHJmdGltZSgi
JVktJW0tJWQgJUg6JU06JVMuJWYiKVs6LTNdCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdGlt
ZXN0YW1wX3N0ciA9ICIiCgogICAgICAgICMgRm9ybWF0IHRvcGljIHdpdGggcGFydGl0aW9uCiAg
ICAgICAgdG9waWNfcGFydCA9IGYie3Jvdy50b3BpY31be3Jvdy5wYXJ0aXRpb259XSIKICAgICAg
ICBpZiBsZW4odG9waWNfcGFydCkgPiBjb2xfdG9waWM6CiAgICAgICAgICAgIHRvcGljX3BhcnQg
PSB0b3BpY19wYXJ0Wzpjb2xfdG9waWNdCgogICAgICAgICMgRm9ybWF0IG9mZnNldAogICAgICAg
IG9mZnNldF9zdHIgPSBzdHIocm93Lm9mZnNldCkKCiAgICAgICAgIyBGb3JtYXQgc2l6ZQogICAg
ICAgIGlmIHJvdy5mdWxsX3RleHQ6CiAgICAgICAgICAgIHNpemVfYnl0ZXMgPSBsZW4ocm93LmZ1
bGxfdGV4dC5lbmNvZGUoJ3V0Zi04JykpCiAgICAgICAgICAgIGlmIHNpemVfYnl0ZXMgPCAxMDI0
OgogICAgICAgICAgICAgICAgc2l6ZV9zdHIgPSBmIntzaXplX2J5dGVzfUIiCiAgICAgICAgICAg
IGVsaWYgc2l6ZV9ieXRlcyA8IDEwMjQgKiAxMDI0OgogICAgICAgICAgICAgICAgc2l6ZV9zdHIg
PSBmIntzaXplX2J5dGVzIC8gMTAyNDouMWZ9SyIKICAgICAgICAgICAgZWxzZToKICAgICAgICAg
ICAgICAgIHNpemVfc3RyID0gZiJ7c2l6ZV9ieXRlcyAvICgxMDI0ICogMTAyNCk6LjFmfU0iCiAg
ICAgICAgZWxzZToKICAgICAgICAgICAgc2l6ZV9zdHIgPSAiMEIiCgogICAgICAgICMgRm9ybWF0
IGtleSB3aXRoIHRydW5jYXRpb24KICAgICAgICBrZXlfc3RyID0gKHJvdy5rZXkgb3IgIiIpLnJl
cGxhY2UoIlxuIiwgIiAiKS5yZXBsYWNlKCJcciIsICIiKS5yZXBsYWNlKCJcdCIsICIgIikKICAg
ICAgICBpZiBsZW4oa2V5X3N0cikgPiBjb2xfa2V5OgogICAgICAgICAgICBrZXlfZGlzcGxheSA9
IGtleV9zdHJbOmNvbF9rZXkgLSAyXSArICIuLiIKICAgICAgICBlbHNlOgogICAgICAgICAgICBr
ZXlfZGlzcGxheSA9IGtleV9zdHIKCiAgICAgICAgIyBGb3JtYXQgdmFsdWUgd2l0aCB0cnVuY2F0
aW9uCiAgICAgICAgdmFsX3N0ciA9IChyb3cuZnVsbF90ZXh0IG9yICIiKS5yZXBsYWNlKCJcbiIs
ICIgIikucmVwbGFjZSgiXHIiLCAiIikucmVwbGFjZSgiXHQiLCAiICIpCiAgICAgICAgaWYgbGVu
KHZhbF9zdHIpID4gY29sX3ZhbHVlOgogICAgICAgICAgICB2YWxfZGlzcGxheSA9IHZhbF9zdHJb
OmNvbF92YWx1ZSAtIDJdICsgIi4uIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHZhbF9kaXNw
bGF5ID0gdmFsX3N0cgoKICAgICAgICAjIEJ1aWxkIHN1bW1hcnkgbGluZQogICAgICAgIHN1bW1h
cnkgPSAoCiAgICAgICAgICAgIGYie3RpbWVzdGFtcF9zdHI6PHtjb2xfdGltZXN0YW1wfX0gIgog
ICAgICAgICAgICBmInt0b3BpY19wYXJ0Ojx7Y29sX3RvcGljfX0gIgogICAgICAgICAgICBmIntv
ZmZzZXRfc3RyOjx7Y29sX29mZnNldH19ICIKICAgICAgICAgICAgZiJ7c2l6ZV9zdHI6PHtjb2xf
c2l6ZX19ICIKICAgICAgICAgICAgZiJ7a2V5X2Rpc3BsYXk6PHtjb2xfa2V5fX0gIgogICAgICAg
ICAgICBmInt2YWxfZGlzcGxheX0iCiAgICAgICAgKQogICAgICAgIHJvdy5zZXRfdGV4dChzdW1t
YXJ5KQoKCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBjb25maWcgLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLQoKY2xhc3MgQ29uZmlnTWFuYWdlcjoKICAgIERFRkFVTFRfQ09ORklHX1BBVEggPSAiY29u
ZmlnLmpzb24iCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIGxvYWRfZnJvbV9lbmNyeXB0ZWQo
Y29uZmlnX3BhdGgpOgogICAgICAgICIiItCX0LDQs9GA0YPQt9C60LAg0LrQvtC90YTQuNCz0YPR
gNCw0YbQuNC4INC40Lcg0LfQsNGI0LjRhNGA0L7QstCw0L3QvdC+0LPQviDRhNCw0LnQu9CwIiIi
CiAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGNvbmZpZ19wYXRoKToKICAgICAgICAgICAg
TE9HLmVycm9yKGYiRW5jcnlwdGVkIGNvbmZpZyBmaWxlIG5vdCBmb3VuZDoge2NvbmZpZ19wYXRo
fSIpCiAgICAgICAgICAgIHN5cy5leGl0KDEpCgogICAgICAgIHRyeToKICAgICAgICAgICAgd2l0
aCBvcGVuKGNvbmZpZ19wYXRoLCAncmInKSBhcyBmOgogICAgICAgICAgICAgICAgZmlsZV9kYXRh
ID0gZi5yZWFkKCkKCiAgICAgICAgICAgICMg0J/QtdGA0LLRi9C1IDE2INCx0LDQudGCIC0g0Y3R
gtC+IHNhbHQKICAgICAgICAgICAgaWYgbGVuKGZpbGVfZGF0YSkgPCAxNjoKICAgICAgICAgICAg
ICAgIHByaW50KCJFbmNyeXB0ZWQgZmlsZSBpcyBjb3JydXB0ZWQgKHRvbyBzaG9ydCkiLCBmaWxl
PXN5cy5zdGRlcnIpCiAgICAgICAgICAgICAgICBzeXMuZXhpdCgxKQoKICAgICAgICAgICAgc2Fs
dCA9IGZpbGVfZGF0YVs6MTZdCiAgICAgICAgICAgIGVuY3J5cHRlZF9kYXRhID0gZmlsZV9kYXRh
WzE2Ol0KCiAgICAgICAgICAgICMg0JfQsNC/0YDQsNGI0LjQstCw0LXQvCDQv9Cw0YDQvtC70YwK
ICAgICAgICAgICAgcGFzc3dvcmQgPSBnZXRwYXNzLmdldHBhc3MoIkVudGVyIGRlY3J5cHRpb24g
cGFzc3dvcmQ6ICIpCgogICAgICAgICAgICAjINCT0LXQvdC10YDQuNGA0YPQtdC8INC60LvRjtGH
ICjQv9Cw0YDQsNC80LXRgtGA0Ysg0JTQntCb0JbQndCrINGB0L7QstC/0LDQtNCw0YLRjCDRgSBl
bmNyeXB0b3IucHkpCiAgICAgICAgICAgIGtkZiA9IFBCS0RGMkhNQUMoCiAgICAgICAgICAgICAg
ICBhbGdvcml0aG09aGFzaGVzLlNIQTI1NigpLAogICAgICAgICAgICAgICAgbGVuZ3RoPTMyLAog
ICAgICAgICAgICAgICAgc2FsdD1zYWx0LAogICAgICAgICAgICAgICAgaXRlcmF0aW9ucz0xMDAw
MDAsCiAgICAgICAgICAgICAgICBiYWNrZW5kPWRlZmF1bHRfYmFja2VuZCgpCiAgICAgICAgICAg
ICkKICAgICAgICAgICAga2V5ID0gYmFzZTY0LnVybHNhZmVfYjY0ZW5jb2RlKGtkZi5kZXJpdmUo
cGFzc3dvcmQuZW5jb2RlKCd1dGYtOCcpKSkKCiAgICAgICAgICAgIGYgPSBGZXJuZXQoa2V5KQoK
ICAgICAgICAgICAgIyDQoNCw0YHRiNC40YTRgNC+0LLRi9Cy0LDQtdC8CiAgICAgICAgICAgIHRy
eToKICAgICAgICAgICAgICAgIGRlY3J5cHRlZF9kYXRhID0gZi5kZWNyeXB0KGVuY3J5cHRlZF9k
YXRhKQogICAgICAgICAgICAgICAgcmV0dXJuIGpzb24ubG9hZHMoZGVjcnlwdGVkX2RhdGEuZGVj
b2RlKCd1dGYtOCcpKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAg
ICAgcHJpbnQoIkRlY3J5cHRpb24gZmFpbGVkISBJbnZhbGlkIHBhc3N3b3JkIG9yIGNvcnJ1cHRl
ZCBmaWxlLiIsIGZpbGU9c3lzLnN0ZGVycikKICAgICAgICAgICAgICAgIHN5cy5leGl0KDEpCiAg
ICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkVycm9yIGxv
YWRpbmcgZW5jcnlwdGVkIGNvbmZpZzoge2V9IiwgZmlsZT1zeXMuc3RkZXJyKQogICAgICAgICAg
ICBzeXMuZXhpdCgxKQoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBsb2FkX2Zyb21fdmF1bHQo
dmF1bHRfdXJsLCB2YXVsdF9wYXRoKToKICAgICAgICAiIiLQl9Cw0LPRgNGD0LfQutCwINC60L7Q
vdGE0LjQs9GD0YDQsNGG0LjQuCDQuNC3IEhhc2hpQ29ycCBWYXVsdCIiIgogICAgICAgIHByaW50
KGYiQ29ubmVjdGluZyB0byBWYXVsdDoge3ZhdWx0X3VybH0iKQogICAgICAgIHVzZXJuYW1lID0g
aW5wdXQoIlZhdWx0IFVzZXJuYW1lOiAiKQogICAgICAgIHBhc3N3b3JkID0gZ2V0cGFzcy5nZXRw
YXNzKCJWYXVsdCBQYXNzd29yZDogIikKCiAgICAgICAgIyAxLiBMb2dpbiAoVXNlclBhc3MpCiAg
ICAgICAgYXV0aF91cmwgPSBmInt2YXVsdF91cmwucnN0cmlwKCcvJyl9L3YxL2F1dGgvdXNlcnBh
c3MvbG9naW4ve3VzZXJuYW1lfSIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3AgPSByZXF1
ZXN0cy5wb3N0KGF1dGhfdXJsLCBqc29uPXsicGFzc3dvcmQiOiBwYXNzd29yZH0sIHRpbWVvdXQ9
MTApCiAgICAgICAgICAgIHJlc3AucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgICAgIHRva2Vu
ID0gcmVzcC5qc29uKClbImF1dGgiXVsiY2xpZW50X3Rva2VuIl0KICAgICAgICBleGNlcHQgRXhj
ZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiVmF1bHQgbG9naW4gZmFpbGVkOiB7ZX0i
LCBmaWxlPXN5cy5zdGRlcnIpCiAgICAgICAgICAgIHN5cy5leGl0KDEpCgogICAgICAgICMgMi4g
R2V0IFNlY3JldAogICAgICAgIHNlY3JldF91cmwgPSBmInt2YXVsdF91cmwucnN0cmlwKCcvJyl9
L3YxL3t2YXVsdF9wYXRofSIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3AgPSByZXF1ZXN0
cy5nZXQoc2VjcmV0X3VybCwgaGVhZGVycz17IlgtVmF1bHQtVG9rZW4iOiB0b2tlbn0sIHRpbWVv
dXQ9MTApCiAgICAgICAgICAgIHJlc3AucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgICAgIGRh
dGEgPSByZXNwLmpzb24oKQoKICAgICAgICAgICAgIyDQntCx0YDQsNCx0L7RgtC60LAg0YHRgtGA
0YPQutGC0YPRgNGLIEtWIFYxINC4IEtWIFYyCiAgICAgICAgICAgICMgVjIg0LLQvtC30LLRgNCw
0YnQsNC10YIgZGF0YVsnZGF0YSddWydkYXRhJ10sIFYxINCy0L7Qt9Cy0YDQsNGJ0LDQtdGCIGRh
dGFbJ2RhdGEnXQogICAgICAgICAgICBpZiAnZGF0YScgaW4gZGF0YSBhbmQgaXNpbnN0YW5jZShk
YXRhWydkYXRhJ10sIGRpY3QpIGFuZCAnZGF0YScgaW4gZGF0YVsnZGF0YSddOgogICAgICAgICAg
ICAgICAgcmV0dXJuIGRhdGFbJ2RhdGEnXVsnZGF0YSddCiAgICAgICAgICAgIGVsaWYgJ2RhdGEn
IGluIGRhdGE6CiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVsnZGF0YSddCiAgICAgICAgICAg
IGVsc2U6CiAgICAgICAgICAgICAgICAjIEZhbGxiYWNrLCDQtdGB0LvQuCDRgdGC0YDRg9C60YLR
g9GA0LAg0L3QtdGB0YLQsNC90LTQsNGA0YLQvdCw0Y8KICAgICAgICAgICAgICAgIHJldHVybiBk
YXRhCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIlZh
dWx0IHJlYWQgZmFpbGVkOiB7ZX0iLCBmaWxlPXN5cy5zdGRlcnIpCiAgICAgICAgICAgIHN5cy5l
eGl0KDEpCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIGxvYWRfY29uZmlnKGNsaV9hcmdzPU5v
bmUpOgogICAgICAgICIiItCe0L/RgNC10LTQtdC70Y/QtdGCINC40YHRgtC+0YfQvdC40Log0LrQ
vtC90YTQuNCz0YPRgNCw0YbQuNC4INC4INC30LDQs9GA0YPQttCw0LXRgiDQtdGRIiIiCiAgICAg
ICAgY29uZmlnX2RhdGEgPSB7fQoKICAgICAgICAjINCf0YDQuNC+0YDQuNGC0LXRgiAxOiBIYXNo
aUNvcnAgVmF1bHQKICAgICAgICBpZiBjbGlfYXJncyBhbmQgY2xpX2FyZ3MudmF1bHRfdXJsIGFu
ZCBjbGlfYXJncy52YXVsdF9wYXRoOgogICAgICAgICAgICBjb25maWdfZGF0YSA9IENvbmZpZ01h
bmFnZXIubG9hZF9mcm9tX3ZhdWx0KGNsaV9hcmdzLnZhdWx0X3VybCwgY2xpX2FyZ3MudmF1bHRf
cGF0aCkKCiAgICAgICAgIyDQn9GA0LjQvtGA0LjRgtC10YIgMjog0JfQsNGI0LjRhNGA0L7QstCw
0L3QvdGL0Lkg0YTQsNC50LsKICAgICAgICBlbGlmIGNsaV9hcmdzIGFuZCBjbGlfYXJncy5lbmNy
eXB0ZWRfY29uZmlnOgogICAgICAgICAgICBjb25maWdfZGF0YSA9IENvbmZpZ01hbmFnZXIubG9h
ZF9mcm9tX2VuY3J5cHRlZChjbGlfYXJncy5lbmNyeXB0ZWRfY29uZmlnKQoKICAgICAgICAjINCf
0YDQuNC+0YDQuNGC0LXRgiAzOiDQntCx0YvRh9C90YvQuSDRhNCw0LnQuyAo0L/QviDRg9C80L7Q
u9GH0LDQvdC40Y4pCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcGF0aCA9IGNsaV9hcmdzLmNv
bmZpZyBpZiBjbGlfYXJncyBlbHNlIENvbmZpZ01hbmFnZXIuREVGQVVMVF9DT05GSUdfUEFUSAog
ICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhwYXRoKToKICAgICAgICAgICAgICAgIHRyeToK
ICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4ocGF0aCwgInIiKSBhcyBmOgogICAgICAgICAg
ICAgICAgICAgICAgICBjb25maWdfZGF0YSA9IGpzb24ubG9hZChmKQogICAgICAgICAgICAgICAg
ZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIExPRy53YXJuaW5nKCJG
YWlsZWQgdG8gbG9hZCBjb25maWcgZnJvbSAlczogJXMiLCBwYXRoLCBlLCBleGNfaW5mbz1UcnVl
KQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyDQldGB0LvQuCDQtNC10YTQvtC7
0YLQvdC+0LPQviDQutC+0L3RhNC40LPQsCDQvdC10YIsINC/0YDQvtGB0YLQviDQstC+0LfQstGA
0LDRidCw0LXQvCDQv9GD0YHRgtC+0LUsINGH0YLQvtCx0Ysg0YDQsNCx0L7RgtCw0YLRjCDQvdCw
INCw0YDQs9GD0LzQtdC90YLQsNGFIENMSQogICAgICAgICAgICAgICAgcGFzcwoKICAgICAgICBy
ZXR1cm4gY29uZmlnX2RhdGEuZ2V0KCJwcm9maWxlcyIsIHt9KSwgY29uZmlnX2RhdGEuZ2V0KCJk
ZWZhdWx0X3Byb2ZpbGUiKQoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBnZXRfY29ubmVjdGlv
bl9wYXJhbXMocHJvZmlsZV9uYW1lPU5vbmUsIGNsaV9hcmdzPU5vbmUpOgogICAgICAgIHByb2Zp
bGVzLCBkZWZhdWx0X3Byb2ZpbGUgPSBDb25maWdNYW5hZ2VyLmxvYWRfY29uZmlnKGNsaV9hcmdz
KQoKICAgICAgICBpZiBjbGlfYXJncyBhbmQgY2xpX2FyZ3MucHJvZmlsZToKICAgICAgICAgICAg
cHJvZmlsZV9uYW1lID0gY2xpX2FyZ3MucHJvZmlsZQogICAgICAgIGVsaWYgbm90IHByb2ZpbGVf
bmFtZToKICAgICAgICAgICAgcHJvZmlsZV9uYW1lID0gZGVmYXVsdF9wcm9maWxlIG9yICJkZWZh
dWx0IgoKICAgICAgICBwYXJhbXMgPSBwcm9maWxlcy5nZXQocHJvZmlsZV9uYW1lLCB7fSkuY29w
eSgpCgogICAgICAgICMgTWFwcGluZyBlbnYgdmFycyB0byBjb25maWcgcGFyYW1zCiAgICAgICAg
ZW52X21hcHBpbmdzID0gewogICAgICAgICAgICAiS0FGS0FfQk9PVFNUUkFQX1NFUlZFUlMiOiAi
Ym9vdHN0cmFwX3NlcnZlcnMiLAogICAgICAgICAgICAiS0FGS0FfU0VDVVJJVFlfUFJPVE9DT0wi
OiAic2VjdXJpdHlfcHJvdG9jb2wiLAogICAgICAgICAgICAiS0FGS0FfU1NMX0NBX0ZJTEUiOiAi
c3NsX2NhX2ZpbGUiLAogICAgICAgICAgICAiS0FGS0FfU1NMX0NFUlRfRklMRSI6ICJzc2xfY2Vy
dF9maWxlIiwKICAgICAgICAgICAgIktBRktBX1NTTF9LRVlfRklMRSI6ICJzc2xfa2V5X2ZpbGUi
LAogICAgICAgICAgICAiS0FGS0FfU1NMX1BBU1NXT1JEIjogInNzbF9wYXNzd29yZCIsCiAgICAg
ICAgICAgICJLQUZLQV9TU0xfQ0hFQ0tfSE9TVE5BTUUiOiAic3NsX2NoZWNrX2hvc3RuYW1lIiwK
ICAgICAgICAgICAgIktBRktBX1NBU0xfTUVDSEFOSVNNIjogInNhc2xfbWVjaGFuaXNtIiwKICAg
ICAgICAgICAgIktBRktBX1NBU0xfVVNFUk5BTUUiOiAic2FzbF91c2VybmFtZSIsCiAgICAgICAg
ICAgICJLQUZLQV9TQVNMX1BBU1NXT1JEIjogInNhc2xfcGFzc3dvcmQiLAogICAgICAgICAgICAi
S0FGS0FfU1NMX0lOU0VDVVJFX1NLSVBfVkVSSUZZIjogInNzbF9pbnNlY3VyZV9za2lwX3Zlcmlm
eSIsCiAgICAgICAgfQoKICAgICAgICBmb3IgZW52X3ZhciwgcGFyYW1fbmFtZSBpbiBlbnZfbWFw
cGluZ3MuaXRlbXMoKToKICAgICAgICAgICAgdiA9IG9zLmdldGVudihlbnZfdmFyKQogICAgICAg
ICAgICBpZiB2OgogICAgICAgICAgICAgICAgIyBIYW5kbGUgYm9vbGVhbiB2YWx1ZXMKICAgICAg
ICAgICAgICAgIGlmIHBhcmFtX25hbWUgaW4gKCJzc2xfY2hlY2tfaG9zdG5hbWUiLCAic3NsX2lu
c2VjdXJlX3NraXBfdmVyaWZ5Iik6CiAgICAgICAgICAgICAgICAgICAgcGFyYW1zW3BhcmFtX25h
bWVdID0gdi5sb3dlcigpIGluICgidHJ1ZSIsICIxIiwgInllcyIpCiAgICAgICAgICAgICAgICBl
bHNlOgogICAgICAgICAgICAgICAgICAgIHBhcmFtc1twYXJhbV9uYW1lXSA9IHYKCiAgICAgICAg
IyBPdmVycmlkZSB3aXRoIENMSSBhcmdzCiAgICAgICAgaWYgY2xpX2FyZ3M6CiAgICAgICAgICAg
IGlmIGNsaV9hcmdzLmJvb3RzdHJhcF9zZXJ2ZXJzOgogICAgICAgICAgICAgICAgcGFyYW1zWyJi
b290c3RyYXBfc2VydmVycyJdID0gY2xpX2FyZ3MuYm9vdHN0cmFwX3NlcnZlcnMKICAgICAgICAg
ICAgaWYgY2xpX2FyZ3Muc2VjdXJpdHlfcHJvdG9jb2w6CiAgICAgICAgICAgICAgICBwYXJhbXNb
InNlY3VyaXR5X3Byb3RvY29sIl0gPSBjbGlfYXJncy5zZWN1cml0eV9wcm90b2NvbAogICAgICAg
ICAgICBpZiBjbGlfYXJncy5zc2xfY2FfZmlsZToKICAgICAgICAgICAgICAgIHBhcmFtc1sic3Ns
X2NhX2ZpbGUiXSA9IGNsaV9hcmdzLnNzbF9jYV9maWxlCiAgICAgICAgICAgIGlmIGNsaV9hcmdz
LnNzbF9jZXJ0X2ZpbGU6CiAgICAgICAgICAgICAgICBwYXJhbXNbInNzbF9jZXJ0X2ZpbGUiXSA9
IGNsaV9hcmdzLnNzbF9jZXJ0X2ZpbGUKICAgICAgICAgICAgaWYgY2xpX2FyZ3Muc3NsX2tleV9m
aWxlOgogICAgICAgICAgICAgICAgcGFyYW1zWyJzc2xfa2V5X2ZpbGUiXSA9IGNsaV9hcmdzLnNz
bF9rZXlfZmlsZQogICAgICAgICAgICBpZiBjbGlfYXJncy5zc2xfcGFzc3dvcmQ6CiAgICAgICAg
ICAgICAgICBwYXJhbXNbInNzbF9wYXNzd29yZCJdID0gY2xpX2FyZ3Muc3NsX3Bhc3N3b3JkCiAg
ICAgICAgICAgIGlmIGhhc2F0dHIoY2xpX2FyZ3MsICdzc2xfY2hlY2tfaG9zdG5hbWUnKSBhbmQg
Y2xpX2FyZ3Muc3NsX2NoZWNrX2hvc3RuYW1lIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAg
cGFyYW1zWyJzc2xfY2hlY2tfaG9zdG5hbWUiXSA9IGNsaV9hcmdzLnNzbF9jaGVja19ob3N0bmFt
ZQogICAgICAgICAgICBpZiBoYXNhdHRyKGNsaV9hcmdzLCAnc3NsX2luc2VjdXJlX3NraXBfdmVy
aWZ5JykgYW5kIGNsaV9hcmdzLnNzbF9pbnNlY3VyZV9za2lwX3ZlcmlmeSBpcyBub3QgTm9uZToK
ICAgICAgICAgICAgICAgIHBhcmFtc1sic3NsX2luc2VjdXJlX3NraXBfdmVyaWZ5Il0gPSBjbGlf
YXJncy5zc2xfaW5zZWN1cmVfc2tpcF92ZXJpZnkKICAgICAgICAgICAgaWYgY2xpX2FyZ3Muc2Fz
bF9tZWNoYW5pc206CiAgICAgICAgICAgICAgICBwYXJhbXNbInNhc2xfbWVjaGFuaXNtIl0gPSBj
bGlfYXJncy5zYXNsX21lY2hhbmlzbQogICAgICAgICAgICBpZiBjbGlfYXJncy5zYXNsX3VzZXJu
YW1lOgogICAgICAgICAgICAgICAgcGFyYW1zWyJzYXNsX3VzZXJuYW1lIl0gPSBjbGlfYXJncy5z
YXNsX3VzZXJuYW1lCiAgICAgICAgICAgIGlmIGNsaV9hcmdzLnNhc2xfcGFzc3dvcmQ6CiAgICAg
ICAgICAgICAgICBwYXJhbXNbInNhc2xfcGFzc3dvcmQiXSA9IGNsaV9hcmdzLnNhc2xfcGFzc3dv
cmQKCiAgICAgICAgcGFyYW1zLnNldGRlZmF1bHQoImJvb3RzdHJhcF9zZXJ2ZXJzIiwgImxvY2Fs
aG9zdDo5MDkyIikKICAgICAgICByZXR1cm4gcGFyYW1zLCBwcm9maWxlX25hbWUKCiAgICBAc3Rh
dGljbWV0aG9kCiAgICBkZWYgdmFsaWRhdGVfcGFyYW1zKHBhcmFtcyk6CiAgICAgICAgZXJyb3Jz
ID0gW10KICAgICAgICBzc2xfZmlsZXMgPSBbInNzbF9jYV9maWxlIiwgInNzbF9jZXJ0X2ZpbGUi
LCAic3NsX2tleV9maWxlIl0KICAgICAgICBmb3IgcGFyYW0gaW4gc3NsX2ZpbGVzOgogICAgICAg
ICAgICBpZiBwYXJhbSBpbiBwYXJhbXMgYW5kIHBhcmFtc1twYXJhbV06CiAgICAgICAgICAgICAg
ICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGFyYW1zW3BhcmFtXSk6CiAgICAgICAgICAgICAgICAg
ICAgZXJyb3JzLmFwcGVuZChmIntwYXJhbX06IGZpbGUgbm90IGZvdW5kOiB7cGFyYW1zW3BhcmFt
XX0iKQoKICAgICAgICB2YWxpZF9wcm90b2NvbHMgPSBbIlBMQUlOVEVYVCIsICJTU0wiLCAiU0FT
TF9QTEFJTlRFWFQiLCAiU0FTTF9TU0wiXQogICAgICAgIGlmICJzZWN1cml0eV9wcm90b2NvbCIg
aW4gcGFyYW1zIGFuZCBwYXJhbXNbInNlY3VyaXR5X3Byb3RvY29sIl0gbm90IGluIHZhbGlkX3By
b3RvY29sczoKICAgICAgICAgICAgZXJyb3JzLmFwcGVuZChmInNlY3VyaXR5X3Byb3RvY29sIG11
c3QgYmUgb25lIG9mOiB7dmFsaWRfcHJvdG9jb2xzfSIpCgogICAgICAgIHZhbGlkX3Nhc2wgPSBb
IlBMQUlOIiwgIlNDUkFNLVNIQS0yNTYiLCAiU0NSQU0tU0hBLTUxMiJdCiAgICAgICAgaWYgInNh
c2xfbWVjaGFuaXNtIiBpbiBwYXJhbXMgYW5kIHBhcmFtc1sic2FzbF9tZWNoYW5pc20iXSBub3Qg
aW4gdmFsaWRfc2FzbDoKICAgICAgICAgICAgZXJyb3JzLmFwcGVuZChmInNhc2xfbWVjaGFuaXNt
IG11c3QgYmUgb25lIG9mOiB7dmFsaWRfc2FzbH0iKQoKICAgICAgICBpZiBwYXJhbXMuZ2V0KCJz
ZWN1cml0eV9wcm90b2NvbCIpIGluICgiU0FTTF9QTEFJTlRFWFQiLCAiU0FTTF9TU0wiKToKICAg
ICAgICAgICAgaWYgbm90IHBhcmFtcy5nZXQoInNhc2xfbWVjaGFuaXNtIik6CiAgICAgICAgICAg
ICAgICBlcnJvcnMuYXBwZW5kKCJzYXNsX21lY2hhbmlzbSByZXF1aXJlZCB3aGVuIHVzaW5nIFNB
U0wiKQogICAgICAgICAgICBpZiBub3QgcGFyYW1zLmdldCgic2FzbF91c2VybmFtZSIpOgogICAg
ICAgICAgICAgICAgZXJyb3JzLmFwcGVuZCgic2FzbF91c2VybmFtZSByZXF1aXJlZCB3aGVuIHVz
aW5nIFNBU0wiKQogICAgICAgICAgICBpZiBub3QgcGFyYW1zLmdldCgic2FzbF9wYXNzd29yZCIp
OgogICAgICAgICAgICAgICAgZXJyb3JzLmFwcGVuZCgic2FzbF9wYXNzd29yZCByZXF1aXJlZCB3
aGVuIHVzaW5nIFNBU0wiKQogICAgICAgIHJldHVybiBlcnJvcnMKCgojIC0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0gYXBwIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCmNsYXNzIEthZmthVmlld2VyQXBw
OgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGNvbm5lY3Rpb25fcGFyYW1zLCBwcm9maWxlX25hbWU9
ImRlZmF1bHQiKToKICAgICAgICBzZWxmLmNvbm5lY3Rpb25fcGFyYW1zID0gY29ubmVjdGlvbl9w
YXJhbXMKICAgICAgICBzZWxmLnByb2ZpbGVfbmFtZSA9IHByb2ZpbGVfbmFtZQogICAgICAgIHNl
bGYuYm9vdHN0cmFwX3NlcnZlcnMgPSBjb25uZWN0aW9uX3BhcmFtc1siYm9vdHN0cmFwX3NlcnZl
cnMiXQogICAgICAgIHNlbGYuYWRtaW5fY2xpZW50ID0gTm9uZQogICAgICAgIHNlbGYuY3VycmVu
dF90b3BpYyA9IE5vbmUKCiAgICAgICAgIyBTbmFwc2hvdCBzZXR0aW5ncwogICAgICAgIHNlbGYu
c25hcHNob3RfbW9kZSA9ICJ0YWlsIiAgIyAidGFpbCIgb3IgImZyb21fYmVnaW5uaW5nIgogICAg
ICAgIHNlbGYuc25hcHNob3RfdGFpbF9uID0gNTAwICAjIHBlciBwYXJ0aXRpb24KICAgICAgICBz
ZWxmLnNuYXBzaG90X21heF90b3RhbCA9IDUwMDAgICMgYWNyb3NzIHBhcnRpdGlvbnMKCiAgICAg
ICAgIyBTb3J0aW5nIHNldHRpbmdzCiAgICAgICAgc2VsZi5zb3J0X21vZGUgPSAidW5zb3J0ZWQi
ICAjICJ1bnNvcnRlZCIsICJ0aW1lc3RhbXAiLCAicGFydGl0aW9uIiwgInNpemUiCiAgICAgICAg
c2VsZi5zb3J0X2FzY2VuZGluZyA9IFRydWUKCiAgICAgICAgIyBGaWx0ZXIgc2V0dGluZ3MKICAg
ICAgICBzZWxmLnRvcGljX2ZpbHRlciA9ICIiICAjIEZpbHRlciBtYXNrIGZvciB0b3BpY3MKICAg
ICAgICBzZWxmLm1zZ19maWx0ZXJzID0gewogICAgICAgICAgICAia2V5IjogIiIsCiAgICAgICAg
ICAgICJ2YWx1ZSI6ICIiLAogICAgICAgICAgICAicGFydGl0aW9uIjogIiIsCiAgICAgICAgICAg
ICJvZmZzZXQiOiAiIgogICAgICAgIH0KCiAgICAgICAgIyBTdG9yZSBhbGwgbG9hZGVkIG1lc3Nh
Z2VzIGZvciBmaWx0ZXJpbmcKICAgICAgICBzZWxmLmFsbF9tZXNzYWdlcyA9IFtdCgogICAgICAg
ICMgVUkgbGlzdHMKICAgICAgICBzZWxmLnRvcGljX3dhbGtlciA9IHVyd2lkLlNpbXBsZUZvY3Vz
TGlzdFdhbGtlcihbXSkKICAgICAgICBzZWxmLnRvcGljX2xpc3Rib3ggPSB1cndpZC5MaXN0Qm94
KHNlbGYudG9waWNfd2Fsa2VyKQogICAgICAgIHNlbGYubXNnX3dhbGtlciA9IHVyd2lkLlNpbXBs
ZUZvY3VzTGlzdFdhbGtlcihbXSkKICAgICAgICBzZWxmLm1zZ19saXN0Ym94ID0gRHluYW1pY01z
Z0xpc3RCb3goc2VsZi5tc2dfd2Fsa2VyKQoKICAgICAgICBzZWxmLmNvbHVtbnMgPSBOb25lCiAg
ICAgICAgc2VsZi5tYWluX2ZyYW1lID0gTm9uZQogICAgICAgIHNlbGYuZGlhbG9nX292ZXJsYXkg
PSBOb25lCiAgICAgICAgc2VsZi5sb29wID0gTm9uZQoKICAgICAgICAjIHN0YXR1cwogICAgICAg
IHNlbGYuc3RhdHVzX3RleHQgPSB1cndpZC5UZXh0KCIiKQogICAgICAgIHNlbGYuX2J1aWxkX3Vp
KCkKICAgICAgICBzZWxmLl9pbml0X2FkbWluX2NsaWVudCgpCiAgICAgICAgc2VsZi5fZmV0Y2hf
dG9waWNzKCkKCiAgICAgICAgIyBob29rIGZvY3VzIGNoYW5nZXMgaW4gbWVzc2FnZSBsaXN0IHRv
IHVwZGF0ZSBmb290ZXIKICAgICAgICBzZWxmLl9tc2dfZm9jdXNfcHJldiA9IE5vbmUKCiAgICAg
ICAgIyBBQ0wgZmlsdGVyIHNldHRpbmdzCiAgICAgICAgc2VsZi5hY2xfZmlsdGVycyA9IHsKICAg
ICAgICAgICAgInByaW5jaXBhbCI6ICIiLAogICAgICAgICAgICAiaG9zdCI6ICIiLAogICAgICAg
ICAgICAib3BlcmF0aW9uIjogIkFOWSIsCiAgICAgICAgICAgICJwZXJtaXNzaW9uIjogIkFOWSIs
CiAgICAgICAgICAgICJwYXR0ZXJuX3R5cGUiOiAiQU5ZIgogICAgICAgIH0KICAgICAgICBzZWxm
LmFsbF9hY2xzID0gW10gICMgU3RvcmUgYWxsIEFDTHMgZm9yIGZpbHRlcmluZwogICAgICAgIHNl
bGYuY3VycmVudF9hY2xfdG9waWMgPSBOb25lICAjIFRyYWNrIHdoaWNoIHRvcGljJ3MgQUNMcyB3
ZSdyZSB2aWV3aW5nCgogICAgICAgICMgRGlhbG9nIG5hdmlnYXRpb24gc3RhY2sKICAgICAgICBz
ZWxmLmRpYWxvZ19zdGFjayA9IFtdICAjIFN0YWNrIG9mIGRpYWxvZyBjcmVhdGlvbiBmdW5jdGlv
bnMKCiAgICAjIC0tLS0tIGthZmthIGNvbmZpZyAtLS0tLQoKICAgIGRlZiBfZ2V0X2thZmthX2Nv
bmZpZyhzZWxmKToKICAgICAgICBjZmcgPSB7ImJvb3RzdHJhcF9zZXJ2ZXJzIjogc2VsZi5jb25u
ZWN0aW9uX3BhcmFtc1siYm9vdHN0cmFwX3NlcnZlcnMiXX0KICAgICAgICBzcCA9IHNlbGYuY29u
bmVjdGlvbl9wYXJhbXMuZ2V0KCJzZWN1cml0eV9wcm90b2NvbCIsICJQTEFJTlRFWFQiKQogICAg
ICAgIGNmZ1sic2VjdXJpdHlfcHJvdG9jb2wiXSA9IHNwCgogICAgICAgIGlmIHNwIGluICgiU1NM
IiwgIlNBU0xfU1NMIik6CiAgICAgICAgICAgIGluc2VjdXJlID0gYm9vbChzZWxmLmNvbm5lY3Rp
b25fcGFyYW1zLmdldCgic3NsX2luc2VjdXJlX3NraXBfdmVyaWZ5IiwgRmFsc2UpKQoKICAgICAg
ICAgICAgc3NsX2NoZWNrX2hvc3RuYW1lID0gc2VsZi5jb25uZWN0aW9uX3BhcmFtcy5nZXQoInNz
bF9jaGVja19ob3N0bmFtZSIsIFRydWUpCgogICAgICAgICAgICAjIDEpINCh0L7Qt9C00LDRkdC8
IFNTTENvbnRleHQg0YEgQ0EgKNC10YHQu9C4INC30LDQtNCw0L0pCiAgICAgICAgICAgIGNhX2Zp
bGUgPSBzZWxmLmNvbm5lY3Rpb25fcGFyYW1zLmdldCgic3NsX2NhX2ZpbGUiKQogICAgICAgICAg
ICBjdHggPSBzc2wuY3JlYXRlX2RlZmF1bHRfY29udGV4dCgKICAgICAgICAgICAgICAgIHB1cnBv
c2U9c3NsLlB1cnBvc2UuU0VSVkVSX0FVVEgsCiAgICAgICAgICAgICAgICBjYWZpbGU9Y2FfZmls
ZSBpZiBjYV9maWxlIGVsc2UgTm9uZSwKICAgICAgICAgICAgKQoKICAgICAgICAgICAgIyAyKSDQ
oNC10LbQuNC8INC/0YDQvtCy0LXRgNC60Lgg0YHQtdGA0LLQtdGA0LAKICAgICAgICAgICAgaWYg
aW5zZWN1cmU6CiAgICAgICAgICAgICAgICBjdHguY2hlY2tfaG9zdG5hbWUgPSBGYWxzZQogICAg
ICAgICAgICAgICAgY3R4LnZlcmlmeV9tb2RlID0gc3NsLkNFUlRfTk9ORQogICAgICAgICAgICBl
bHNlOgogICAgICAgICAgICAgICAgY3R4LmNoZWNrX2hvc3RuYW1lID0gYm9vbChzc2xfY2hlY2tf
aG9zdG5hbWUpCiAgICAgICAgICAgICAgICBjdHgudmVyaWZ5X21vZGUgPSBzc2wuQ0VSVF9SRVFV
SVJFRAoKICAgICAgICAgICAgIyAzKSBtVExTOiDQv9C+0LTQs9GA0YPQttCw0LXQvCDQutC70LjQ
tdC90YLRgdC60LjQuSDRgdC10YDRgtC40YTQuNC60LDRgivQutC70Y7RhyAo0LXRgdC70Lgg0LfQ
sNC00LDQvdGLKQogICAgICAgICAgICBjZXJ0X2ZpbGUgPSBzZWxmLmNvbm5lY3Rpb25fcGFyYW1z
LmdldCgic3NsX2NlcnRfZmlsZSIpCiAgICAgICAgICAgIGtleV9maWxlID0gc2VsZi5jb25uZWN0
aW9uX3BhcmFtcy5nZXQoInNzbF9rZXlfZmlsZSIpCiAgICAgICAgICAgIGtleV9wYXNzd29yZCA9
IHNlbGYuY29ubmVjdGlvbl9wYXJhbXMuZ2V0KCJzc2xfcGFzc3dvcmQiKQoKICAgICAgICAgICAg
aWYgY2VydF9maWxlIGFuZCBrZXlfZmlsZToKICAgICAgICAgICAgICAgIGN0eC5sb2FkX2NlcnRf
Y2hhaW4oCiAgICAgICAgICAgICAgICAgICAgY2VydGZpbGU9Y2VydF9maWxlLAogICAgICAgICAg
ICAgICAgICAgIGtleWZpbGU9a2V5X2ZpbGUsCiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ9
a2V5X3Bhc3N3b3JkLAogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgIyA0KSDQntGB0L3Q
vtCy0L3QvtC5INC/0YPRgtGMOiDQvtGC0LTQsNGR0Lwg0LrQvtC90YLQtdC60YHRgiAo0YLQsNC6
IG1UTFMg0YLQvtGH0L3QviDQstC60LvRjtGH0LjRgtGB0Y8pCiAgICAgICAgICAgIGNmZ1sic3Ns
X2NvbnRleHQiXSA9IGN0eAoKICAgICAgICAgICAgIyA1KSDQntGB0YLQsNCy0LvRj9C10Lwg0YLQ
sNC60LbQtSDQv9C+0LvRjyBrYWZrYS1weXRob24g0LTQu9GPINGB0L7QstC80LXRgdGC0LjQvNC+
0YHRgtC4L9C/0YDQvtC30YDQsNGH0L3QvtGB0YLQuAogICAgICAgICAgICBpZiBjYV9maWxlOgog
ICAgICAgICAgICAgICAgY2ZnWyJzc2xfY2FmaWxlIl0gPSBjYV9maWxlCiAgICAgICAgICAgIGlm
IGNlcnRfZmlsZToKICAgICAgICAgICAgICAgIGNmZ1sic3NsX2NlcnRmaWxlIl0gPSBjZXJ0X2Zp
bGUKICAgICAgICAgICAgaWYga2V5X2ZpbGU6CiAgICAgICAgICAgICAgICBjZmdbInNzbF9rZXlm
aWxlIl0gPSBrZXlfZmlsZQogICAgICAgICAgICBpZiBrZXlfcGFzc3dvcmQ6CiAgICAgICAgICAg
ICAgICBjZmdbInNzbF9wYXNzd29yZCJdID0ga2V5X3Bhc3N3b3JkCgogICAgICAgICAgICBjZmdb
InNzbF9jaGVja19ob3N0bmFtZSJdID0gRmFsc2UgaWYgaW5zZWN1cmUgZWxzZSBib29sKHNzbF9j
aGVja19ob3N0bmFtZSkKCiAgICAgICAgaWYgc3AgaW4gKCJTQVNMX1BMQUlOVEVYVCIsICJTQVNM
X1NTTCIpOgogICAgICAgICAgICBjZmdbInNhc2xfbWVjaGFuaXNtIl0gPSBzZWxmLmNvbm5lY3Rp
b25fcGFyYW1zLmdldCgic2FzbF9tZWNoYW5pc20iLCAiUExBSU4iKQogICAgICAgICAgICBjZmdb
InNhc2xfcGxhaW5fdXNlcm5hbWUiXSA9IHNlbGYuY29ubmVjdGlvbl9wYXJhbXMuZ2V0KCJzYXNs
X3VzZXJuYW1lIiwgIiIpCiAgICAgICAgICAgIGNmZ1sic2FzbF9wbGFpbl9wYXNzd29yZCJdID0g
c2VsZi5jb25uZWN0aW9uX3BhcmFtcy5nZXQoInNhc2xfcGFzc3dvcmQiLCAiIikKCiAgICAgICAg
cmV0dXJuIGNmZwoKICAgIGRlZiBfaW5pdF9hZG1pbl9jbGllbnQoc2VsZik6CiAgICAgICAgdHJ5
OgogICAgICAgICAgICBzZWxmLmFkbWluX2NsaWVudCA9IEthZmthQWRtaW5DbGllbnQoKipzZWxm
Ll9nZXRfa2Fma2FfY29uZmlnKCkpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAg
ICAgICAgICBzZWxmLmFkbWluX2NsaWVudCA9IE5vbmUKICAgICAgICAgICAgc2VsZi5fc2V0X3N0
YXR1cyhmIkFkbWluQ2xpZW50IGluaXQgZmFpbGVkOiB7ZX0iKQoKICAgIGRlZiBfc2hvd19zYXZl
X2RpYWxvZyhzZWxmLCByb3c6IE1zZ1Jvdyk6CiAgICAgICAgIiIiU2hvdyBkaWFsb2cgdG8gc2F2
ZSBtZXNzYWdlIHRvIGZpbGUiIiIKCiAgICAgICAgIyAtLS0gMS4g0JvQvtCz0LjQutCwINGB0L7R
hdGA0LDQvdC10L3QuNGPICjQvtC/0YDQtdC00LXQu9GP0LXQvCDQt9Cw0YDQsNC90LXQtSkgLS0t
CgogICAgICAgICMg0K3RgtC4INC/0LXRgNC10LzQtdC90L3Ri9C1INCx0YPQtNGD0YIg0LjQvdC4
0YbQuNCw0LvQuNC30LjRgNC+0LLQsNC90Ysg0L3QuNC20LUsINC90L4g0L3Rg9C20L3RiyDQsiDQ
t9Cw0LzRi9C60LDQvdC40LgKICAgICAgICBmbmFtZV9lZGl0ID0gTm9uZQogICAgICAgIHJiX2Z1
bGxfanNvbiA9IE5vbmUKICAgICAgICByYl9yYXdfdmFsdWUgPSBOb25lCgogICAgICAgIGRlZiBv
bl9zYXZlKGJ0bj1Ob25lKTogICMgYnRuPU5vbmUsINGC0LDQuiDQutCw0Log0LLRi9C30YvQstCw
0LXQvCDQuCDQv9C+IEVudGVyCiAgICAgICAgICAgIGZpbGVuYW1lID0gZm5hbWVfZWRpdC5lZGl0
X3RleHQuc3RyaXAoKQogICAgICAgICAgICBpZiBub3QgZmlsZW5hbWU6CiAgICAgICAgICAgICAg
ICBzZWxmLl9zaG93X21lc3NhZ2UoIkZpbGVuYW1lIGlzIHJlcXVpcmVkIikKICAgICAgICAgICAg
ICAgIHJldHVybgoKICAgICAgICAgICAgbW9kZSA9ICJmdWxsIiBpZiByYl9mdWxsX2pzb24uc3Rh
dGUgZWxzZSAicmF3IgogICAgICAgICAgICBzZWxmLl9zYXZlX21lc3NhZ2VfdG9fZmlsZShyb3cs
IGZpbGVuYW1lLCBtb2RlKQoKICAgICAgICBkZWYgb25fY2FuY2VsKGJ0bik6CiAgICAgICAgICAg
IHNlbGYuX29wZW5fbWVzc2FnZV92aWV3KHJvdykKCiAgICAgICAgIyAtLS0gMi4g0JLQuNC00LbQ
tdGC0YsgLS0tCgogICAgICAgIGJhc2VfbmFtZSA9IGYibXNnX3tyb3cudG9waWN9X3tyb3cucGFy
dGl0aW9ufV97cm93Lm9mZnNldH0iCgogICAgICAgICMg0KHQv9C10YbQuNCw0LvRjNC90YvQuSBF
ZGl0LCDQutC+0YLQvtGA0YvQuSDQu9C+0LLQuNGCIEVudGVyCiAgICAgICAgY2xhc3MgRW50ZXJT
dWJtaXRFZGl0KHVyd2lkLkVkaXQpOgogICAgICAgICAgICBkZWYga2V5cHJlc3Moc2VsZiwgc2l6
ZSwga2V5KToKICAgICAgICAgICAgICAgIGlmIGtleSA9PSAnZW50ZXInOgogICAgICAgICAgICAg
ICAgICAgIG9uX3NhdmUoKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAg
ICAgICAgICByZXR1cm4gc3VwZXIoKS5rZXlwcmVzcyhzaXplLCBrZXkpCgogICAgICAgICMgZm5h
bWVfZWRpdCA9IEVudGVyU3VibWl0RWRpdCgiRmlsZW5hbWU6ICIsIGJhc2VfbmFtZSArICIuanNv
biIpCiAgICAgICAgZm5hbWVfZWRpdCA9IEVudGVyU3VibWl0RWRpdCgiIiwgYmFzZV9uYW1lICsg
Ii5qc29uIikKCiAgICAgICAgIyDQntCx0L7RgNCw0YfQuNCy0LDQtdC8IEVkaXQg0LIgQXR0ck1h
cCDQtNC70Y8g0YbQstC10YLQsCAo0L3QsNC/0YDQuNC80LXRgCwgImZpZWxkIiAtINGH0LXRgNC9
0YvQuSDQvdCwINCz0L7Qu9GD0LHQvtC8KQogICAgICAgICMg0J3Rg9C20L3QviDQtNC+0LHQsNCy
0LjRgtGMINGB0YLQuNC70YwgImZpZWxkIiDQsiDQv9Cw0LvQuNGC0YDRgywg0LXRgdC70Lgg0LXQ
s9C+INC90LXRgi4KICAgICAgICAjINCY0LvQuCDQuNGB0L/QvtC70YzQt9GD0LXQvCAicm93X3Nl
bGVjdCIgKNC10YHQu9C4INC+0L0g0YMg0LLQsNGBINC10YHRgtGMOiBibGFjaywgbGlnaHQgY3lh
bikKICAgICAgICAjINCY0LvQuCDQttC10YHRgtC60L4g0LfQsNC00LDQtdC8OgogICAgICAgIGZu
YW1lX2VkaXRfc3R5bGVkID0gdXJ3aWQuQXR0ck1hcChmbmFtZV9lZGl0LCAiZWRpdF9maWVsZCIs
IGZvY3VzX21hcD0iZWRpdF9mb2N1cyIpCgogICAgICAgICMg0KHQvtC30LTQsNC10Lwg0LrQvtC7
0L7QvdC60Lg6IFsgTGFiZWwgKGZpeGVkIHdpZHRoKSB8IEVkaXQgRmllbGQgXQogICAgICAgIGZu
YW1lX2NvbHVtbnMgPSB1cndpZC5Db2x1bW5zKFsKICAgICAgICAgICAgKCdmaXhlZCcsIDEwLCB1
cndpZC5UZXh0KCJGaWxlbmFtZToiKSksICAjINCc0LXRgtC60LAKICAgICAgICAgICAgZm5hbWVf
ZWRpdF9zdHlsZWQgICMg0J/QvtC70LUg0LLQstC+0LTQsCDRgSDRhtCy0LXRgtC+0LwKICAgICAg
ICBdLCBkaXZpZGVjaGFycz0xKQoKICAgICAgICBzYXZlX21vZGVfZ3JvdXAgPSBbXQogICAgICAg
IHJiX2Z1bGxfanNvbiA9IHVyd2lkLlJhZGlvQnV0dG9uKHNhdmVfbW9kZV9ncm91cCwgIkZ1bGwg
TWVzc2FnZSBEdW1wIChKU09OKSIsIHN0YXRlPVRydWUpCiAgICAgICAgcmJfcmF3X3ZhbHVlID0g
dXJ3aWQuUmFkaW9CdXR0b24oc2F2ZV9tb2RlX2dyb3VwLCAiUmF3IFZhbHVlIE9ubHkgKEJpbmFy
eSkiKQoKICAgICAgICAjINCe0LHRgNCw0LHQvtGC0YfQuNC6INGB0LzQtdC90Ysg0YDQtdC20LjQ
vNCwICjRgNCw0YHRiNC40YDQtdC90LjQtSDRhNCw0LnQu9CwKQogICAgICAgIGRlZiBvbl9tb2Rl
X2NoYW5nZShyYiwgc3RhdGUpOgogICAgICAgICAgICBpZiBzdGF0ZToKICAgICAgICAgICAgICAg
IGN1cnJlbnRfdGV4dCA9IGZuYW1lX2VkaXQuZWRpdF90ZXh0CiAgICAgICAgICAgICAgICBpZiBy
YiA9PSByYl9yYXdfdmFsdWU6CiAgICAgICAgICAgICAgICAgICAgaWYgY3VycmVudF90ZXh0LmVu
ZHN3aXRoKCIuanNvbiIpOgogICAgICAgICAgICAgICAgICAgICAgICBmbmFtZV9lZGl0LnNldF9l
ZGl0X3RleHQoY3VycmVudF90ZXh0WzotNV0gKyAiLmJpbiIpCiAgICAgICAgICAgICAgICBlbGlm
IHJiID09IHJiX2Z1bGxfanNvbjoKICAgICAgICAgICAgICAgICAgICBpZiBjdXJyZW50X3RleHQu
ZW5kc3dpdGgoIi5iaW4iKToKICAgICAgICAgICAgICAgICAgICAgICAgZm5hbWVfZWRpdC5zZXRf
ZWRpdF90ZXh0KGN1cnJlbnRfdGV4dFs6LTRdICsgIi5qc29uIikKCiAgICAgICAgdXJ3aWQuY29u
bmVjdF9zaWduYWwocmJfZnVsbF9qc29uLCAnY2hhbmdlJywgb25fbW9kZV9jaGFuZ2UpCiAgICAg
ICAgdXJ3aWQuY29ubmVjdF9zaWduYWwocmJfcmF3X3ZhbHVlLCAnY2hhbmdlJywgb25fbW9kZV9j
aGFuZ2UpCgogICAgICAgICMg0JrQvdC+0L/QutC4CiAgICAgICAgYnRuX3NhdmUgPSB1cndpZC5C
dXR0b24oIlNhdmUiLCBvbl9wcmVzcz1vbl9zYXZlKQogICAgICAgIGJ0bl9jYW5jZWwgPSB1cndp
ZC5CdXR0b24oIkNhbmNlbCIsIG9uX3ByZXNzPW9uX2NhbmNlbCkKCiAgICAgICAgcGlsZSA9IHVy
d2lkLlBpbGUoWwogICAgICAgICAgICB1cndpZC5UZXh0KCJTYXZlIE1lc3NhZ2UiKSwKICAgICAg
ICAgICAgdXJ3aWQuRGl2aWRlcigpLAogICAgICAgICAgICAjIGZuYW1lX2VkaXQsCiAgICAgICAg
ICAgIGZuYW1lX2NvbHVtbnMsCiAgICAgICAgICAgIHVyd2lkLkRpdmlkZXIoKSwKICAgICAgICAg
ICAgdXJ3aWQuVGV4dCgiRm9ybWF0OiIpLAogICAgICAgICAgICByYl9mdWxsX2pzb24sCiAgICAg
ICAgICAgIHJiX3Jhd192YWx1ZSwKICAgICAgICAgICAgdXJ3aWQuRGl2aWRlcigpLAogICAgICAg
ICAgICB1cndpZC5BdHRyTWFwKGJ0bl9zYXZlLCAiYnRuIiwgZm9jdXNfbWFwPSJidG5fZm9jdXMi
KSwKICAgICAgICAgICAgdXJ3aWQuQXR0ck1hcChidG5fY2FuY2VsLCAiYnRuIiwgZm9jdXNfbWFw
PSJidG5fZm9jdXMiKSwKICAgICAgICBdKQoKICAgICAgICAjINCf0LXRgNC10YXQstCw0YIgRVND
INC4IEVudGVyICjQs9C70L7QsdCw0LvRjNC90L4g0LTQu9GPINC00LjQsNC70L7Qs9CwLCDQtdGB
0LvQuCDRhNC+0LrRg9GBINC90LUg0L3QsCDQutC90L7Qv9C60LDRhSkKICAgICAgICBkZWYgY3Vz
dG9tX2tleXByZXNzKHNpemUsIGtleSk6CiAgICAgICAgICAgIGlmIGtleSA9PSAnZXNjJzoKICAg
ICAgICAgICAgICAgIG9uX2NhbmNlbChOb25lKQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUK
CiAgICAgICAgICAgICMg0JXRgdC70Lgg0L3QsNC20LDQu9C4IEVudGVyLCDQuCDRhNC+0LrRg9GB
INCd0JUg0L3QsCDQutC90L7Qv9C60LUgQ2FuY2VsICjRh9GC0L7QsdGLINC+0L3QsCDRgdGA0LDQ
sdC+0YLQsNC70LAg0YjRgtCw0YLQvdC+KQogICAgICAgICAgICAjINCYINC90LUg0L3QsCDQutC9
0L7Qv9C60LUgU2F2ZSAo0L7QvdCwINC4INGC0LDQuiDRgdGA0LDQsdC+0YLQsNC10YIpCiAgICAg
ICAgICAgICMg0KLQviDQstGL0LfRi9Cy0LDQtdC8IFNhdmUuCiAgICAgICAgICAgICMg0J3QviBF
ZGl0LmtleXByZXNzINGD0LbQtSDQvtCx0YDQsNCx0L7RgtCw0LsgRW50ZXIg0LLRi9GI0LUsINGC
0LDQuiDRh9GC0L4g0Y3RgtC+INGB0LrQvtGA0LXQtSDQtNC70Y8gUmFkaW9CdXR0b24KICAgICAg
ICAgICAgaWYga2V5ID09ICdlbnRlcic6CiAgICAgICAgICAgICAgICAjINCf0YDQvtCy0LXRgNGP
0LXQvCwg0LPQtNC1INGE0L7QutGD0YEuINCV0YHQu9C4INC90LAgQ2FuY2VsIC0g0L3QtSDRgtGA
0L7Qs9Cw0LXQvC4KICAgICAgICAgICAgICAgICMgcGlsZS5mb2N1cyAtINGN0YLQviDQstC40LTQ
ttC10YIgKNC40LvQuCBBdHRyTWFwKS4KICAgICAgICAgICAgICAgICMg0J/RgNC+0YnQtSDQstGB
0LXQs9C+OiDQtdGB0LvQuCDRhNC+0LrRg9GBINC90LAgUmFkaW9CdXR0b24sINGC0L4gRW50ZXIg
PSBTYXZlLgogICAgICAgICAgICAgICAgZm9jdXNfdyA9IHBpbGUuZm9jdXMKICAgICAgICAgICAg
ICAgIGlmIGlzaW5zdGFuY2UoZm9jdXNfdywgdXJ3aWQuUmFkaW9CdXR0b24pOgogICAgICAgICAg
ICAgICAgICAgIG9uX3NhdmUoKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBOb25lCgogICAg
ICAgICAgICByZXR1cm4gdXJ3aWQuUGlsZS5rZXlwcmVzcyhwaWxlLCBzaXplLCBrZXkpCgogICAg
ICAgIHBpbGUua2V5cHJlc3MgPSBjdXN0b21fa2V5cHJlc3MKCiAgICAgICAgc2VsZi5fc2hvd19k
aWFsb2cocGlsZSwgIkV4cG9ydCBNZXNzYWdlIikKCiAgICBkZWYgX3NhdmVfbWVzc2FnZV90b19m
aWxlKHNlbGYsIHJvdzogTXNnUm93LCBmaWxlbmFtZSwgbW9kZSk6CiAgICAgICAgaW1wb3J0IGpz
b24KICAgICAgICBpbXBvcnQgYmFzZTY0CiAgICAgICAgZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0
ZXRpbWUKCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjINCf0L7Qu9GD0YfQsNC10Lwg0YHRi9GA
0YvQtSDQtNCw0L3QvdGL0LUuCiAgICAgICAgICAgICMgTXNnUm93INGF0YDQsNC90LjRgiByYXdf
dmFsdWUgKGJ5dGVzKSDQuCByYXdfa2V5IChieXRlcykKICAgICAgICAgICAgIyByb3cuZnVsbF90
ZXh0IC0g0Y3RgtC+INGD0LbQtSDQtNC10LrQvtC00LjRgNC+0LLQsNC90L3QsNGPINGB0YLRgNC+
0LrQsCAo0LXRgdC70Lgg0YPQtNCw0LvQvtGB0YwpCgogICAgICAgICAgICByYXdfdmFsID0gZ2V0
YXR0cihyb3csICJyYXdfdmFsdWUiLCBiIiIpCiAgICAgICAgICAgIGlmIHJhd192YWwgaXMgTm9u
ZTogcmF3X3ZhbCA9IGIiIgogICAgICAgICAgICAjINCV0YHQu9C4IHJhd192YWx1ZSDQvdC1INGB
0L7RhdGA0LDQvdC10L0gKNCyINGB0YLQsNGA0YvRhSDQstC10YDRgdC40Y/RhSDQutC+0LTQsCBN
c2dSb3cg0LzQvtC20LXRgiDQvdC1INC40LzQtdGC0Ywg0LXQs9C+KSwKICAgICAgICAgICAgIyDQ
v9GL0YLQsNC10LzRgdGPINCy0L7RgdGB0YLQsNC90L7QstC40YLRjCDQuNC3IGZ1bGxfdGV4dCwg
0L3QviDRjdGC0L4g0L/QvtGC0LXRgNC4LgogICAgICAgICAgICAjINCj0LHQtdC00LjRgtC10YHR
jCwg0YfRgtC+IE1zZ1JvdyDQuNC90LjRhtC40LDQu9C40LfQuNGA0YPQtdGC0YHRjyDRgSByYXdf
dmFsdWUuCgogICAgICAgICAgICBpZiBtb2RlID09ICJyYXciOgogICAgICAgICAgICAgICAgIyDQ
kdC40L3QsNGA0L3QvtC1INGB0L7RhdGA0LDQvdC10L3QuNC1CiAgICAgICAgICAgICAgICB3aXRo
IG9wZW4oZmlsZW5hbWUsICJ3YiIpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShy
YXdfdmFsKQogICAgICAgICAgICAgICAgbXNnID0gZiJTYXZlZCB7bGVuKHJhd192YWwpfSBieXRl
cyB0byB7ZmlsZW5hbWV9IgoKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgRnVs
bCBKU09OIER1bXAKICAgICAgICAgICAgICAgIGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAg
InRvcGljIjogcm93LnRvcGljLAogICAgICAgICAgICAgICAgICAgICJwYXJ0aXRpb24iOiByb3cu
cGFydGl0aW9uLAogICAgICAgICAgICAgICAgICAgICJvZmZzZXQiOiByb3cub2Zmc2V0LAogICAg
ICAgICAgICAgICAgICAgICJ0aW1lc3RhbXAiOiByb3cudGltZXN0YW1wLAogICAgICAgICAgICAg
ICAgICAgICJ0aW1lc3RhbXBfaXNvIjogZGF0ZXRpbWUuZnJvbXRpbWVzdGFtcCgKICAgICAgICAg
ICAgICAgICAgICAgICAgcm93LnRpbWVzdGFtcCAvIDEwMDAuMCkuaXNvZm9ybWF0KCkgaWYgcm93
LnRpbWVzdGFtcCBlbHNlIE5vbmUsCiAgICAgICAgICAgICAgICAgICAgImtleV9zdHIiOiByb3cu
a2V5LAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMg0J/QvtC/0YvRgtC60LAg
0LTQtdC60L7QtNC40YDQvtCy0LDRgtGMIHZhbHVlCiAgICAgICAgICAgICAgICB0cnk6CiAgICAg
ICAgICAgICAgICAgICAgIyDQodC90LDRh9Cw0LvQsCDQv9GA0L7QsdGD0LXQvCDRh9C10YHRgtC9
0YvQuSBKU09OINC40LcgcmF3X2J5dGVzCiAgICAgICAgICAgICAgICAgICAgIyAocm93LmZ1bGxf
dGV4dCDQvNC+0LbQtdGCINCx0YvRgtGMINGD0LbQtSDRgSAiIiwg0LXRgdC70Lgg0LTQtdC60L7Q
tNC40L3QsyDQvdC1INC/0YDQvtGI0LXQuykKICAgICAgICAgICAgICAgICAgICB2YWxfc3RyID0g
cmF3X3ZhbC5kZWNvZGUoJ3V0Zi04JykgICMg0KHRgtGA0L7Qs9C40Lkg0LTQtdC60L7QtNC40L3Q
swogICAgICAgICAgICAgICAgICAgIHZhbF9qc29uID0ganNvbi5sb2Fkcyh2YWxfc3RyKQogICAg
ICAgICAgICAgICAgICAgIGRhdGFbInZhbHVlX2pzb24iXSA9IHZhbF9qc29uCiAgICAgICAgICAg
ICAgICAgICAgZGF0YVsidmFsdWVfdHlwZSJdID0gImpzb24iCiAgICAgICAgICAgICAgICBleGNl
cHQgKFVuaWNvZGVEZWNvZGVFcnJvciwganNvbi5KU09ORGVjb2RlRXJyb3IpOgogICAgICAgICAg
ICAgICAgICAgICMg0JXRgdC70Lgg0Y3RgtC+INC90LUgSlNPTiDQuNC70Lgg0L3QtSBVVEYtOAoK
ICAgICAgICAgICAgICAgICAgICAjINCf0YDQvtCy0LXRgNGP0LXQvCwg0L/QvtGF0L7QttC1INC7
0Lgg0Y3RgtC+INC90LAg0YLQtdC60YHRgiDQstC+0L7QsdGJ0LU/CiAgICAgICAgICAgICAgICAg
ICAgIyDQldGB0LvQuCBkZWNvZGUoJ3V0Zi04Jykg0YPQv9Cw0LssINC30L3QsNGH0LjRgiDRjdGC
0L4g0LHQuNC90LDRgNC90LjQui4KICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAg
ICAgICAgICAgICAgIHRleHRfdmFsID0gcmF3X3ZhbC5kZWNvZGUoJ3V0Zi04JykKICAgICAgICAg
ICAgICAgICAgICAgICAgIyDQldGB0LvQuCDQtNC10LrQvtC00LjRgNC+0LLQsNC70L7RgdGMLCDQ
vdC+INC90LUgSlNPTiAtINGB0L7RhdGA0LDQvdGP0LXQvCDQutCw0Log0YLQtdC60YHRggogICAg
ICAgICAgICAgICAgICAgICAgICBkYXRhWyJ2YWx1ZV90ZXh0Il0gPSB0ZXh0X3ZhbAogICAgICAg
ICAgICAgICAgICAgICAgICBkYXRhWyJ2YWx1ZV90eXBlIl0gPSAidGV4dCIKICAgICAgICAgICAg
ICAgICAgICBleGNlcHQgVW5pY29kZURlY29kZUVycm9yOgogICAgICAgICAgICAgICAgICAgICAg
ICAjINCt0KLQniDQkdCY0J3QkNCg0J3Qq9CVINCU0JDQndCd0KvQlQogICAgICAgICAgICAgICAg
ICAgICAgICBkYXRhWyJ2YWx1ZV90eXBlIl0gPSAiYmluYXJ5IgogICAgICAgICAgICAgICAgICAg
ICAgICAjINCd0LUg0L/QuNGI0LXQvCB2YWx1ZV90ZXh0LCDRgtCw0Log0LrQsNC6INGN0YLQviDQ
vNGD0YHQvtGALgogICAgICAgICAgICAgICAgICAgICAgICAjINCb0LjQsdC+INC/0LjRiNC10Lwg
0Y/QstC90L7QtSDRgdC+0L7QsdGJ0LXQvdC40LUKICAgICAgICAgICAgICAgICAgICAgICAgZGF0
YVsidmFsdWVfdGV4dCJdID0gIjxiaW5hcnkgZGF0YT4iCgogICAgICAgICAgICAgICAgIyDQktGB
0LXQs9C00LAg0LTQvtCx0LDQstC70Y/QtdC8IGJhc2U2NCDQtNC70Y8g0L3QsNC00LXQttC90L7R
gdGC0LggKNC00LvRjyDQsdC40L3QsNGA0L3Ri9GFINC4INGB0LvQvtC80LDQvdC90YvRhSDRgtC1
0LrRgdGC0L7QsikKICAgICAgICAgICAgICAgIGlmIGRhdGEuZ2V0KCJ2YWx1ZV90eXBlIikgPT0g
ImJpbmFyeSIgb3IgZGF0YS5nZXQoInZhbHVlX3R5cGUiKSA9PSAidGV4dCI6CiAgICAgICAgICAg
ICAgICAgICAgIGRhdGFbInZhbHVlX2Jhc2U2NCJdID0gYmFzZTY0LmI2NGVuY29kZShyYXdfdmFs
KS5kZWNvZGUoJ2FzY2lpJykKCiAgICAgICAgICAgICAgICAjIEhlYWRlcnMgKNC10YHQu9C4INC+
0L3QuCDQtdGB0YLRjCDQsiBNc2dSb3csINC/0L7QutCwINC90LXRgiwg0L3QviDRgdGC0YDRg9C6
0YLRg9GA0YMg0LfQsNC70L7QttC40LwpCiAgICAgICAgICAgICAgICAjIGRhdGFbImhlYWRlcnMi
XSA9IC4uLgoKICAgICAgICAgICAgICAgIHdpdGggb3BlbihmaWxlbmFtZSwgInciLCBlbmNvZGlu
Zz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICAgICAgICAgIGpzb24uZHVtcChkYXRhLCBmLCBp
bmRlbnQ9MiwgZW5zdXJlX2FzY2lpPUZhbHNlKQoKICAgICAgICAgICAgICAgIG1zZyA9IGYiU2F2
ZWQgSlNPTiBkdW1wIHRvIHtmaWxlbmFtZX0iCgogICAgICAgICAgICBzZWxmLl9zaG93X21lc3Nh
Z2UobXNnKQogICAgICAgICAgICAjINCe0L/RhtC40L7QvdCw0LvRjNC90L46INCy0LXRgNC90YPR
gtGM0YHRjyDQsiDQv9GA0L7RgdC80L7RgtGACiAgICAgICAgICAgICMgc2VsZi5fb3Blbl9tZXNz
YWdlX3ZpZXcocm93KQogICAgICAgICAgICAjINCd0L4gX3Nob3dfbWVzc2FnZSDQv9C10YDQtdC6
0YDQvtC10YIg0LXQs9C+LiDQm9GD0YfRiNC1INC/0YPRgdGC0Ywg0L/QvtC70YzQt9C+0LLQsNGC
0LXQu9GMINGB0LDQvCDQt9Cw0LrRgNC+0LXRgiBtZXNzYWdlLgoKICAgICAgICBleGNlcHQgRXhj
ZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIExPRy5leGNlcHRpb24oIlNhdmUgZmFpbGVkOiAlcyIs
IGUpCiAgICAgICAgICAgIHNlbGYuX3Nob3dfbWVzc2FnZShmIkVycm9yIHNhdmluZyBmaWxlOiB7
ZX0iKQoKICAgICMgLS0tLS0gQ29uc3VtZXIgR3JvdXAgTW9uaXRvcmluZyAtLS0tLQoKICAgIGRl
ZiBfc2hvd19jb25zdW1lcl9ncm91cHNfbW9uaXRvcihzZWxmKToKICAgICAgICAiIiJTaG93IHN1
bW1hcnkgbGlzdCBvZiBhbGwgY29uc3VtZXIgZ3JvdXBzIHdpdGggYWdncmVnYXRlZCBMYWcgbWV0
cmljcyIiIgogICAgICAgIHNlbGYuX3NldF9zdGF0dXMoIkxvYWRpbmcgY29uc3VtZXIgZ3JvdXBz
IGFuYWx5c2lzICh0aGlzIG1heSB0YWtlIGEgbW9tZW50KS4uLiIpCgogICAgICAgIHRyeToKICAg
ICAgICAgICAgaWYgbm90IHNlbGYuYWRtaW5fY2xpZW50OgogICAgICAgICAgICAgICAgc2VsZi5f
aW5pdF9hZG1pbl9jbGllbnQoKQoKICAgICAgICAgICAgIyAxLiDQn9C+0LvRg9GH0LDQtdC8INGB
0L/QuNGB0L7QuiDQstGB0LXRhSDQs9GA0YPQv9C/CiAgICAgICAgICAgIGdyb3Vwc19saXN0aW5n
ID0gc2VsZi5hZG1pbl9jbGllbnQubGlzdF9jb25zdW1lcl9ncm91cHMoKQogICAgICAgICAgICBh
bGxfZ3JvdXBfaWRzID0gW2dbMF0gaWYgaXNpbnN0YW5jZShnLCB0dXBsZSkgZWxzZSBnLmdyb3Vw
X2lkIGZvciBnIGluIGdyb3Vwc19saXN0aW5nXQogICAgICAgICAgICBhbGxfZ3JvdXBfaWRzID0g
c29ydGVkKGFsbF9ncm91cF9pZHMpCgogICAgICAgICAgICBpZiBub3QgYWxsX2dyb3VwX2lkczoK
ICAgICAgICAgICAgICAgIHNlbGYuX3Nob3dfbWVzc2FnZSgiTm8gY29uc3VtZXIgZ3JvdXBzIGZv
dW5kLiIpCiAgICAgICAgICAgICAgICByZXR1cm4KCiAgICAgICAgICAgICMgMi4g0J/QvtC70YPR
h9Cw0LXQvCDRgdC+0YHRgtC+0Y/QvdC40LUgKFN0YXRlKQogICAgICAgICAgICB0cnk6CiAgICAg
ICAgICAgICAgICBncm91cHNfZGVzYyA9IHNlbGYuYWRtaW5fY2xpZW50LmRlc2NyaWJlX2NvbnN1
bWVyX2dyb3VwcyhhbGxfZ3JvdXBfaWRzKQogICAgICAgICAgICAgICAgZ3JvdXBfc3RhdGVzID0g
e2cuZ3JvdXBfaWQ6IGcuc3RhdGUgZm9yIGcgaW4gZ3JvdXBzX2Rlc2N9CiAgICAgICAgICAgIGV4
Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBncm91cF9zdGF0ZXMgPSB7fQoKICAgICAg
ICAgICAgIyAzLiDQkNCT0KDQldCT0JDQptCY0K8gTEFHICjQodCw0LzQsNGPINGC0Y/QttC10LvQ
sNGPINGH0LDRgdGC0YwpCiAgICAgICAgICAgICMg0KfRgtC+0LHRiyDQv9C+0LrQsNC30LDRgtGM
IFRvdGFsIExhZywg0L3Rg9C20L3QviDQt9Cw0L/RgNC+0YHQuNGC0YwgY29tbWl0dGVkICsgZW5k
IG9mZnNldHMg0LTQu9GPINC60LDQttC00L7QuSDQs9GA0YPQv9C/0YsuCiAgICAgICAgICAgICMg
0JTQu9GPINC+0L/RgtC40LzQuNC30LDRhtC40LggKNGH0YLQvtCx0Ysg0L3QtSDQttC00LDRgtGM
INC80LjQvdGD0YLRgykg0LzQvtC20L3QviDRgdC00LXQu9Cw0YLRjCDRjdGC0L4g0YLQvtC70YzQ
utC+INC00LvRjyDQstC40LTQuNC80YvRhSwKICAgICAgICAgICAgIyDQvdC+INCyIFRVSSDQvNGL
INCz0YDRg9C30LjQvCDQstGB0ZEuCgogICAgICAgICAgICAjINCf0L7QtNCz0L7RgtC+0LLQuNC8
IENvbnN1bWVyINC00LvRjyDQt9Cw0L/RgNC+0YHQsCBFbmQgT2Zmc2V0cwogICAgICAgICAgICBj
ZmcgPSBzZWxmLl9nZXRfa2Fma2FfY29uZmlnKCkKICAgICAgICAgICAgY2ZnWyJlbmFibGVfYXV0
b19jb21taXQiXSA9IEZhbHNlCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGNvbnN1
bWVyID0gS2Fma2FDb25zdW1lcigqKmNmZykKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBh
cyBlOgogICAgICAgICAgICAgICAgc2VsZi5fc2hvd19tZXNzYWdlKGYiRXJyb3IgY3JlYXRpbmcg
Y29uc3VtZXIgZm9yIG1ldHJpY3M6IHtlfSIpCiAgICAgICAgICAgICAgICByZXR1cm4KCiAgICAg
ICAgICAgIGdyb3VwX21ldHJpY3MgPSB7fSAgIyB7Z3JvdXBfaWQ6IHsndG90YWxfbGFnJzogaW50
LCAnbWF4X2xhZyc6IGludCwgJ21heF9sYWdfdG9waWMnOiBzdHIsICd0b3BpY3NfY291bnQnOiBp
bnR9fQoKICAgICAgICAgICAgZm9yIGdpZCBpbiBhbGxfZ3JvdXBfaWRzOgogICAgICAgICAgICAg
ICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICMgR2V0IENvbW1pdHRlZAogICAgICAgICAgICAg
ICAgICAgIGNvbW1pdHRlZCA9IHNlbGYuYWRtaW5fY2xpZW50Lmxpc3RfY29uc3VtZXJfZ3JvdXBf
b2Zmc2V0cyhnaWQpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGNvbW1pdHRlZDoKICAgICAg
ICAgICAgICAgICAgICAgICAgZ3JvdXBfbWV0cmljc1tnaWRdID0geyd0b3RhbF9sYWcnOiAwLCAn
bWF4X2xhZyc6IDAsICdtYXhfbGFnX3RvcGljJzogIi0iLCAndG9waWNzX2NvdW50JzogMH0KICAg
ICAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICAgICAgICAgdHBzID0g
bGlzdChjb21taXR0ZWQua2V5cygpKQogICAgICAgICAgICAgICAgICAgIHRvcGljc19zZXQgPSBz
ZXQodHAudG9waWMgZm9yIHRwIGluIHRwcykKCiAgICAgICAgICAgICAgICAgICAgIyDQl9Cw0YnQ
uNGC0LA6INC30LDQv9GA0LDRiNC40LLQsNC10LwgZW5kX29mZnNldHMg0YLQvtC70YzQutC+INC0
0LvRjyDRgdGD0YnQtdGB0YLQstGD0Y7RidC40YUg0L/QsNGA0YLQuNGG0LjQuT8KICAgICAgICAg
ICAgICAgICAgICAjIGNvbnN1bWVyLmVuZF9vZmZzZXRzINC80L7QttC10YIg0YPQv9Cw0YHRgtGM
LCDQtdGB0LvQuCDRgtC+0L/QuNC60LAg0L3QtdGCLgogICAgICAgICAgICAgICAgICAgICMg0J3Q
viDQvtCx0YvRh9C90L4g0L7QvSDQv9GA0L7RgdGC0L4g0LLQvtC30LLRgNCw0YnQsNC10YIg0L/R
g9GB0YLQvtC5INGA0LXQt9GD0LvRjNGC0LDRgiDQuNC70Lgg0LjQs9C90L7RgNC40YDRg9C10YIu
CiAgICAgICAgICAgICAgICAgICAgIyDQlNCw0LLQsNC50YLQtSDQvtCx0LXRgNC90LXQvCDRgdCw
0Lwg0LfQsNC/0YDQvtGBLgoKICAgICAgICAgICAgICAgICAgICBlbmRfb2Zmc2V0cyA9IHt9CiAg
ICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBlbmRfb2Zmc2V0
cyA9IGNvbnN1bWVyLmVuZF9vZmZzZXRzKHRwcykKICAgICAgICAgICAgICAgICAgICBleGNlcHQg
RXhjZXB0aW9uIGFzIGVfYmF0Y2g6CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy53YXJuaW5n
KGYiQmF0Y2ggZW5kX29mZnNldHMgZmFpbGVkIGZvciB7Z2lkfToge2VfYmF0Y2h9LiBUcnlpbmcg
aW5kaXZpZHVhbGx5LiIpCiAgICAgICAgICAgICAgICAgICAgICAgICMgRmFsbGJhY2s6INC/0YDQ
vtCx0YPQtdC8INC/0L4g0L7QtNC90L7QuSDQv9Cw0YDRgtC40YbQuNC4CiAgICAgICAgICAgICAg
ICAgICAgICAgIGZvciB0cCBpbiB0cHM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyDQl9Cw0L/RgNCw0YjQuNCy0LDQtdC8
IGVuZF9vZmZzZXQg0LTQu9GPINC+0LTQvdC+0Lkg0L/QsNGA0YLQuNGG0LjQuAogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICMgZW5kX29mZnNldHMoW3RwXSkg0LLQvtC30LLRgNCw0YnQ
sNC10YIgZGljdCB7dHA6IG9mZnNldH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBy
ZXMgPSBjb25zdW1lci5lbmRfb2Zmc2V0cyhbdHBdKQogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGVuZF9vZmZzZXRzLnVwZGF0ZShyZXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBleGNlcHQgRXhjZXB0aW9uIGFzIGVfc2luZ2xlOgogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIExPRy5kZWJ1ZyhmIkZhaWxlZCB0byBnZXQgZW5kX29mZnNldCBmb3Ige3RwfToge2Vf
c2luZ2xlfSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyDQmNCz0L3QvtGA0LjR
gNGD0LXQvCDRjdGC0YMg0L/QsNGA0YLQuNGG0LjRjiwg0L7QvdCwINC/0YDQvtGB0YLQviDQvdC1
INC/0L7Qv9Cw0LTQtdGCINCyIGVuZF9vZmZzZXRzCgoKICAgICAgICAgICAgICAgICAgICB0b3Rh
bF9sYWcgPSAwCiAgICAgICAgICAgICAgICAgICAgbWF4X2xhZyA9IC0xCiAgICAgICAgICAgICAg
ICAgICAgbWF4X2xhZ190b3BpYyA9ICIiCgogICAgICAgICAgICAgICAgICAgIGZvciB0cCBpbiB0
cHM6CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBjb21taXR0ZWRbdHBdLm9mZnNl
dAogICAgICAgICAgICAgICAgICAgICAgICBpZiBjdXJyZW50IDwgMDogY3VycmVudCA9IDAgICMg
VW5rbm93biBvZmZzZXQKCiAgICAgICAgICAgICAgICAgICAgICAgICMg0JHQtdC30L7Qv9Cw0YHQ
vdC+0LUg0L/QvtC70YPRh9C10L3QuNC1IGVuZCBvZmZzZXQKICAgICAgICAgICAgICAgICAgICAg
ICAgbG9nX2VuZCA9IGVuZF9vZmZzZXRzLmdldCh0cCkKCiAgICAgICAgICAgICAgICAgICAgICAg
ICMg0JXRgdC70LggbG9nX2VuZCBOb25lICjQvdC1INGD0LTQsNC70L7RgdGMINC/0L7Qu9GD0YfQ
uNGC0YwpLCDRgdGH0LjRgtCw0LXQvCDQu9Cw0LMg0L3QtdC40LfQstC10YHRgtC90YvQvCAoMCkK
ICAgICAgICAgICAgICAgICAgICAgICAgaWYgbG9nX2VuZCBpcyBOb25lOgogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgbGFnID0gMAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgbGFnID0gbWF4KDAsIGxvZ19lbmQgLSBjdXJyZW50KQoK
ICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfbGFnICs9IGxhZwogICAgICAgICAgICAgICAg
ICAgICAgICBpZiBsYWcgPiBtYXhfbGFnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4
X2xhZyA9IGxhZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4X2xhZ190b3BpYyA9IHRw
LnRvcGljCgogICAgICAgICAgICAgICAgICAgIGdyb3VwX21ldHJpY3NbZ2lkXSA9IHsKICAgICAg
ICAgICAgICAgICAgICAgICAgJ3RvdGFsX2xhZyc6IHRvdGFsX2xhZywKICAgICAgICAgICAgICAg
ICAgICAgICAgJ21heF9sYWcnOiBtYXhfbGFnLAogICAgICAgICAgICAgICAgICAgICAgICAnbWF4
X2xhZ190b3BpYyc6IG1heF9sYWdfdG9waWMsCiAgICAgICAgICAgICAgICAgICAgICAgICd0b3Bp
Y3NfY291bnQnOiBsZW4odG9waWNzX3NldCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg
ICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgIyDQktC+
0YIg0YLRg9GCINCy0Ysg0LLQuNC00LjRgtC1INCy0LDRiNGDINC+0YjQuNCx0LrRgy4g0JTQsNCy
0LDQudGC0LUg0LLRi9Cy0LXQtNC10Lwg0YLQuNC/INC+0YjQuNCx0LrQuC4KICAgICAgICAgICAg
ICAgICAgICBMT0cuZXJyb3IoZiJFcnJvciBtZXRyaWNzIGZvciBncm91cCB7Z2lkfToge3R5cGUo
ZSkuX19uYW1lX199IHtlfSIpCiAgICAgICAgICAgICAgICAgICAgZ3JvdXBfbWV0cmljc1tnaWRd
ID0geyd0b3RhbF9sYWcnOiAtMSwgJ21heF9sYWcnOiAtMSwgJ21heF9sYWdfdG9waWMnOiAiRXJy
b3IiLCAndG9waWNzX2NvdW50JzogMH0KCiAgICAgICAgICAgIGNvbnN1bWVyLmNsb3NlKCkKCiAg
ICAgICAgICAgICMgNC4g0J/QvtGB0YLRgNC+0LXQvdC40LUg0YLQsNCx0LvQuNGG0YsKCiAgICAg
ICAgICAgIGRlZiBvbl9ncm91cF9zZWxlY3QoYnRuLCBncm91cF9pZCk6CiAgICAgICAgICAgICAg
ICBzZWxmLl9zaG93X2dyb3VwX2RldGFpbHMoZ3JvdXBfaWQpCgogICAgICAgICAgICBib2R5X3dp
ZGdldHMgPSBbXQoKICAgICAgICAgICAgIyBIZWFkZXIKICAgICAgICAgICAgIyBHUk9VUCBJRCAo
MzApIHwgU1RBVEUgKDE1KSB8IFRPUElDUyAoNikgfCBUT1RBTCBMQUcgKDEyKSB8IE1BWCBMQUcg
KFRPUElDKQogICAgICAgICAgICBoZWFkZXJfdHh0ID0gZiJ7J0dST1VQIElEJzo8MzB9IHsnU1RB
VEUnOjwxNX0geydUT1BJQ1MnOjw2fSB7J1RPVEFMIExBRyc6PDEyfSB7J01BWCBMQUcgKFRvcGlj
KSd9IgogICAgICAgICAgICBib2R5X3dpZGdldHMuYXBwZW5kKHVyd2lkLkF0dHJNYXAodXJ3aWQu
VGV4dChoZWFkZXJfdHh0KSwgImhlYWRlciIpKQoKICAgICAgICAgICAgZm9yIGdpZCBpbiBhbGxf
Z3JvdXBfaWRzOgogICAgICAgICAgICAgICAgc3RhdGUgPSBncm91cF9zdGF0ZXMuZ2V0KGdpZCwg
IlVua25vd24iKQogICAgICAgICAgICAgICAgbWV0cmljcyA9IGdyb3VwX21ldHJpY3MuZ2V0KGdp
ZCwge30pCgogICAgICAgICAgICAgICAgdF9jb3VudCA9IG1ldHJpY3MuZ2V0KCd0b3BpY3NfY291
bnQnLCAwKQogICAgICAgICAgICAgICAgdG90X2xhZyA9IG1ldHJpY3MuZ2V0KCd0b3RhbF9sYWcn
LCAwKQogICAgICAgICAgICAgICAgbXhfbGFnID0gbWV0cmljcy5nZXQoJ21heF9sYWcnLCAwKQog
ICAgICAgICAgICAgICAgbXhfdG9waWMgPSBtZXRyaWNzLmdldCgnbWF4X2xhZ190b3BpYycsICcn
KQoKICAgICAgICAgICAgICAgIGlmIHRvdF9sYWcgPT0gLTE6ICAjIEVycm9yIGNhc2UKICAgICAg
ICAgICAgICAgICAgICBsYWdfc3RyID0gIkVycm9yIgogICAgICAgICAgICAgICAgICAgIG1heF9z
dHIgPSAiLSIKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbGFnX3N0
ciA9IHN0cih0b3RfbGFnKQogICAgICAgICAgICAgICAgICAgIG1heF9zdHIgPSBmIntteF9sYWd9
ICh7bXhfdG9waWN9KSIgaWYgbXhfbGFnID4gMCBlbHNlICIwIgoKICAgICAgICAgICAgICAgICMg
0KHRgtGA0L7QutCwINC00LDQvdC90YvRhQogICAgICAgICAgICAgICAgbGluZSA9IGYie2dpZDo8
MzB9IHtzdGF0ZTo8MTV9IHt0X2NvdW50Ojw2fSB7bGFnX3N0cjo8MTJ9IHttYXhfc3RyfSIKCiAg
ICAgICAgICAgICAgICAjIENvbG9ycwogICAgICAgICAgICAgICAgYXR0ciA9ICJib2R5IgogICAg
ICAgICAgICAgICAgaWYgdG90X2xhZyA+IDA6CiAgICAgICAgICAgICAgICAgICAgYXR0ciA9ICJ3
YXJuaW5nIgogICAgICAgICAgICAgICAgaWYgdG90X2xhZyA+IDEwMDAwOiAgIyBUaHJlc2hvbGQg
Zm9yIFJFRAogICAgICAgICAgICAgICAgICAgIGF0dHIgPSAiZXJyb3IiCiAgICAgICAgICAgICAg
ICBpZiBzdGF0ZSBpbiAoIkVtcHR5IiwgIkRlYWQiKToKICAgICAgICAgICAgICAgICAgICBhdHRy
ID0gImNvbW1lbnQiCgogICAgICAgICAgICAgICAgYnRuID0gdXJ3aWQuQnV0dG9uKGxpbmUsIG9u
X3ByZXNzPW9uX2dyb3VwX3NlbGVjdCwgdXNlcl9kYXRhPWdpZCkKICAgICAgICAgICAgICAgIGJv
ZHlfd2lkZ2V0cy5hcHBlbmQodXJ3aWQuQXR0ck1hcChidG4sIGF0dHIsIGZvY3VzX21hcD0icmV2
ZXJzZWQiKSkKCiAgICAgICAgICAgIGJvZHlfd2lkZ2V0cy5hcHBlbmQodXJ3aWQuRGl2aWRlcigp
KQogICAgICAgICAgICBib2R5X3dpZGdldHMuYXBwZW5kKHVyd2lkLkF0dHJNYXAodXJ3aWQuQnV0
dG9uKCJDbG9zZSIsIG9uX3ByZXNzPWxhbWJkYSBiOiBzZWxmLl9jbG9zZV9kaWFsb2coKSksICJi
dG4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9jdXNf
bWFwPSJidG5fZm9jdXMiKSkKCiAgICAgICAgICAgIHdhbGtlciA9IHVyd2lkLlNpbXBsZUZvY3Vz
TGlzdFdhbGtlcihib2R5X3dpZGdldHMpCiAgICAgICAgICAgIGxpc3Rib3ggPSB1cndpZC5MaXN0
Qm94KHdhbGtlcikKCiAgICAgICAgICAgIGJveCA9IHVyd2lkLkxpbmVCb3godXJ3aWQuQXR0ck1h
cChsaXN0Ym94LCAiZGlhbG9nX2JnIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
dGl0bGU9ZiJDb25zdW1lciBHcm91cHMgTW9uaXRvciAoe2xlbihhbGxfZ3JvdXBfaWRzKX0pIikK
CiAgICAgICAgICAgIHNlbGYuZGlhbG9nX292ZXJsYXkgPSB1cndpZC5PdmVybGF5KAogICAgICAg
ICAgICAgICAgdG9wX3c9dXJ3aWQuUGFkZGluZyhib3gsIGxlZnQ9MiwgcmlnaHQ9MiksCiAgICAg
ICAgICAgICAgICBib3R0b21fdz1zZWxmLm1haW5fZnJhbWUsCiAgICAgICAgICAgICAgICBhbGln
bj0iY2VudGVyIiwKICAgICAgICAgICAgICAgIHdpZHRoPSgicmVsYXRpdmUiLCA5NSksCiAgICAg
ICAgICAgICAgICB2YWxpZ249Im1pZGRsZSIsCiAgICAgICAgICAgICAgICBoZWlnaHQ9KCJyZWxh
dGl2ZSIsIDkwKSwKICAgICAgICAgICAgICAgIG1pbl93aWR0aD04MCwKICAgICAgICAgICAgICAg
IG1pbl9oZWlnaHQ9MjAKICAgICAgICAgICAgKQogICAgICAgICAgICBzZWxmLmxvb3Aud2lkZ2V0
ID0gc2VsZi5kaWFsb2dfb3ZlcmxheQogICAgICAgICAgICBzZWxmLl9zZXRfc3RhdHVzKCJHcm91
cHMgTG9hZGVkLiBTZWxlY3QgdG8gdmlldyBkZXRhaWxzLiIpCgogICAgICAgIGV4Y2VwdCBFeGNl
cHRpb24gYXMgZToKICAgICAgICAgICAgTE9HLmV4Y2VwdGlvbigiRXJyb3IgbGlzdGluZyBncm91
cHM6ICVzIiwgZSkKICAgICAgICAgICAgc2VsZi5fc2hvd19tZXNzYWdlKGYiRXJyb3IgbGlzdGlu
ZyBncm91cHM6IHtlfSIpCgogICAgZGVmIF9zaG93X2dyb3VwX2RldGFpbHMoc2VsZiwgZ3JvdXBf
aWQpOgogICAgICAgICIiIlNob3cgZGV0YWlsZWQgTGFnIGZvciBhIHNwZWNpZmljIGdyb3VwIiIi
CiAgICAgICAgc2VsZi5fc2V0X3N0YXR1cyhmIkRldGFpbHMgZm9yIHtncm91cF9pZH0uIEY5OiBS
ZXNldCBBTEwgfCBGMTA6IFJlc2V0IEN1cnJlbnQgVG9waWMiKQoKICAgICAgICB0cnk6CiAgICAg
ICAgICAgICMgMS4gR2V0IENvbW1pdHRlZCBPZmZzZXRzCiAgICAgICAgICAgIGNvbW1pdHRlZCA9
IHNlbGYuYWRtaW5fY2xpZW50Lmxpc3RfY29uc3VtZXJfZ3JvdXBfb2Zmc2V0cyhncm91cF9pZCkK
ICAgICAgICAgICAgaWYgbm90IGNvbW1pdHRlZDoKICAgICAgICAgICAgICAgIHNlbGYuX3Nob3df
bWVzc2FnZShmIkdyb3VwIHtncm91cF9pZH0gaGFzIG5vIGNvbW1pdHRlZCBvZmZzZXRzLiIpCiAg
ICAgICAgICAgICAgICBzZWxmLl9zaG93X2NvbnN1bWVyX2dyb3Vwc19tb25pdG9yKCkKICAgICAg
ICAgICAgICAgIHJldHVybgoKICAgICAgICAgICAgIyAyLiBHZXQgRW5kIE9mZnNldHMKICAgICAg
ICAgICAgY2ZnID0gc2VsZi5fZ2V0X2thZmthX2NvbmZpZygpCiAgICAgICAgICAgIGNmZ1siZW5h
YmxlX2F1dG9fY29tbWl0Il0gPSBGYWxzZQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAg
ICBjb25zdW1lciA9IEthZmthQ29uc3VtZXIoKipjZmcpCiAgICAgICAgICAgICAgICB0cHMgPSBs
aXN0KGNvbW1pdHRlZC5rZXlzKCkpCiAgICAgICAgICAgICAgICBlbmRfb2Zmc2V0cyA9IGNvbnN1
bWVyLmVuZF9vZmZzZXRzKHRwcykKICAgICAgICAgICAgICAgIGNvbnN1bWVyLmNsb3NlKCkKICAg
ICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgc2VsZi5fc2hv
d19tZXNzYWdlKGYiRXJyb3IgZmV0Y2hpbmcgZW5kIG9mZnNldHM6IHtlfSIpCiAgICAgICAgICAg
ICAgICByZXR1cm4KCiAgICAgICAgICAgICMgMy4gR2V0IFN0YXRlCiAgICAgICAgICAgIHRyeToK
ICAgICAgICAgICAgICAgIGRlc2MgPSBzZWxmLmFkbWluX2NsaWVudC5kZXNjcmliZV9jb25zdW1l
cl9ncm91cHMoW2dyb3VwX2lkXSkKICAgICAgICAgICAgICAgIHN0YXRlID0gZGVzY1swXS5zdGF0
ZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBzdGF0ZSA9ICJVbmtub3duIgoK
ICAgICAgICAgICAgIyA0LiBCdWlsZCBSb3dzCiAgICAgICAgICAgIHJvd3MgPSBbXQogICAgICAg
ICAgICB0b3RhbF9sYWcgPSAwCiAgICAgICAgICAgIHNvcnRlZF90cHMgPSBzb3J0ZWQodHBzLCBr
ZXk9bGFtYmRhIHg6ICh4LnRvcGljLCB4LnBhcnRpdGlvbikpCgogICAgICAgICAgICBmb3IgdHAg
aW4gc29ydGVkX3RwczoKICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBjb21taXR0ZWRbdHBdLm9m
ZnNldAogICAgICAgICAgICAgICAgaWYgY3VycmVudCA8IDA6IGN1cnJlbnQgPSAwCiAgICAgICAg
ICAgICAgICBsb2dfZW5kID0gZW5kX29mZnNldHMuZ2V0KHRwLCAwKQogICAgICAgICAgICAgICAg
bGFnID0gbWF4KDAsIGxvZ19lbmQgLSBjdXJyZW50KQogICAgICAgICAgICAgICAgdG90YWxfbGFn
ICs9IGxhZwoKICAgICAgICAgICAgICAgIHJvd3MuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAg
ICAidG9waWMiOiB0cC50b3BpYywKICAgICAgICAgICAgICAgICAgICAicGFydCI6IHRwLnBhcnRp
dGlvbiwKICAgICAgICAgICAgICAgICAgICAibGFnIjogbGFnLAogICAgICAgICAgICAgICAgICAg
ICJjdXJyZW50IjogY3VycmVudCwKICAgICAgICAgICAgICAgICAgICAiZW5kIjogbG9nX2VuZAog
ICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICMgNS4gVUkKICAgICAgICAgICAgY29udGVu
dF93aWRnZXRzID0gW10KCiAgICAgICAgICAgIHN1bW1hcnlfdHh0ID0gZiJHcm91cDoge2dyb3Vw
X2lkfSB8IFN0YXRlOiB7c3RhdGV9IHwgVG90YWwgTGFnOiB7dG90YWxfbGFnfVxuIiBcCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgZiJBY3Rpb25zOiBbRjldIFJlc2V0IEFMTCB0b3BpY3MgfCBb
RjEwXSBSZXNldCBTZWxlY3RlZCBUb3BpYyIKICAgICAgICAgICAgY29udGVudF93aWRnZXRzLmFw
cGVuZCh1cndpZC5UZXh0KHN1bW1hcnlfdHh0KSkKICAgICAgICAgICAgY29udGVudF93aWRnZXRz
LmFwcGVuZCh1cndpZC5EaXZpZGVyKCkpCgogICAgICAgICAgICBoZWFkZXJfc3RyID0gZiJ7J1RP
UElDJzo8MzB9IHsnUEFSVCc6PDZ9IHsnTEFHJzo8MTB9IHsnQ1VSUkVOVCc6PDEyfSB7J0xPRy1F
TkQnOjwxMn0iCiAgICAgICAgICAgIGNvbnRlbnRfd2lkZ2V0cy5hcHBlbmQodXJ3aWQuQXR0ck1h
cCh1cndpZC5UZXh0KGhlYWRlcl9zdHIpLCAiaGVhZGVyIikpCgogICAgICAgICAgICAjIEhlbHBl
ciBjbGFzcyB0byBzdG9yZSBkYXRhIGluIHRoZSByb3cgd2lkZ2V0CiAgICAgICAgICAgIGNsYXNz
IFJvd1dpZGdldChTZWxlY3RhYmxlVGV4dCk6CiAgICAgICAgICAgICAgICBkZWYgX19pbml0X18o
c2VsZiwgdGV4dCwgdG9waWMpOgogICAgICAgICAgICAgICAgICAgIHNlbGYudG9waWNfbmFtZSA9
IHRvcGljCiAgICAgICAgICAgICAgICAgICAgc3VwZXIoKS5fX2luaXRfXyh0ZXh0KQoKICAgICAg
ICAgICAgZm9yIHIgaW4gcm93czoKICAgICAgICAgICAgICAgIGxpbmUgPSBmIntyWyd0b3BpYydd
OjwzMH0ge3JbJ3BhcnQnXTo8Nn0ge3JbJ2xhZyddOjwxMH0ge3JbJ2N1cnJlbnQnXTo8MTJ9IHty
WydlbmQnXTo8MTJ9IgogICAgICAgICAgICAgICAgYXR0ciA9ICJib2R5IgogICAgICAgICAgICAg
ICAgaWYgclsnbGFnJ10gPiAwOiBhdHRyID0gIndhcm5pbmciCiAgICAgICAgICAgICAgICBpZiBy
WydsYWcnXSA+IDEwMDA6IGF0dHIgPSAiZXJyb3IiCgogICAgICAgICAgICAgICAgIyDQodC+0LfQ
tNCw0LXQvCDRgdGC0YDQvtC60YMg0Lgg0L/RgNC40LrRgNC10L/Qu9GP0LXQvCDQuNC80Y8g0YLQ
vtC/0LjQutCwCiAgICAgICAgICAgICAgICByb3dfdyA9IFJvd1dpZGdldChsaW5lLCByWyd0b3Bp
YyddKQogICAgICAgICAgICAgICAgY29udGVudF93aWRnZXRzLmFwcGVuZCh1cndpZC5BdHRyTWFw
KHJvd193LCBhdHRyLCBmb2N1c19tYXA9InJldmVyc2VkIikpCgogICAgICAgICAgICBjb250ZW50
X3dpZGdldHMuYXBwZW5kKHVyd2lkLkRpdmlkZXIoKSkKCiAgICAgICAgICAgIGJhY2tfYnRuID0g
dXJ3aWQuQnV0dG9uKCJCYWNrIHRvIEdyb3VwcyIsIG9uX3ByZXNzPWxhbWJkYSBiOiBzZWxmLl9z
aG93X2NvbnN1bWVyX2dyb3Vwc19tb25pdG9yKCkpCiAgICAgICAgICAgIGNvbnRlbnRfd2lkZ2V0
cy5hcHBlbmQodXJ3aWQuQXR0ck1hcChiYWNrX2J0biwgImJ0biIsIGZvY3VzX21hcD0iYnRuX2Zv
Y3VzIikpCgogICAgICAgICAgICB3YWxrZXIgPSB1cndpZC5TaW1wbGVGb2N1c0xpc3RXYWxrZXIo
Y29udGVudF93aWRnZXRzKQoKICAgICAgICAgICAgIyAtLS0gQ3VzdG9tIExpc3RCb3ggd2l0aCBG
OS9GMTAgbG9naWMgLS0tCiAgICAgICAgICAgIGNsYXNzIERldGFpbHNMaXN0Qm94KHVyd2lkLkxp
c3RCb3gpOgogICAgICAgICAgICAgICAgZGVmIF9faW5pdF9fKHNlbGYsIHdhbGtlciwgYXBwX3Jl
ZiwgZ3JvdXBfaWQpOgogICAgICAgICAgICAgICAgICAgIHN1cGVyKCkuX19pbml0X18od2Fsa2Vy
KQogICAgICAgICAgICAgICAgICAgIHNlbGYuYXBwID0gYXBwX3JlZgogICAgICAgICAgICAgICAg
ICAgIHNlbGYuZ3JvdXBfaWQgPSBncm91cF9pZAoKICAgICAgICAgICAgICAgIGRlZiBrZXlwcmVz
cyhzZWxmLCBzaXplLCBrZXkpOgogICAgICAgICAgICAgICAgICAgIGlmIGtleSA9PSAnZXNjJzoK
ICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hcHAuX3Nob3dfY29uc3VtZXJfZ3JvdXBzX21v
bml0b3IoKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgICAgICAgICAg
ICAgICAgICBlbGlmIGtleSA9PSAnZjknOgogICAgICAgICAgICAgICAgICAgICAgICAjIFJlc2V0
IEFMTAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFwcC5fc2hvd19yZXNldF9vZmZzZXRz
X2RpYWxvZyhzZWxmLmdyb3VwX2lkLCB0YXJnZXRfdG9waWM9Tm9uZSkKICAgICAgICAgICAgICAg
ICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgICAgICAgICAgICAgZWxpZiBrZXkgPT0gJ2Yx
MCc6CiAgICAgICAgICAgICAgICAgICAgICAgICMgUmVzZXQgU2VsZWN0ZWQgVG9waWMKICAgICAg
ICAgICAgICAgICAgICAgICAgIyDQndGD0LbQvdC+INC90LDQudGC0LgsINC60LDQutC+0Lkg0LLQ
uNC00LbQtdGCINGB0LXQudGH0LDRgSDQsiDRhNC+0LrRg9GB0LUKICAgICAgICAgICAgICAgICAg
ICAgICAgZm9jdXNfd2lkZ2V0LCBfID0gc2VsZi5nZXRfZm9jdXMoKQoKICAgICAgICAgICAgICAg
ICAgICAgICAgIyBmb2N1c193aWRnZXQg0LzQvtC20LXRgiDQsdGL0YLRjCBBdHRyTWFwLCDQstC9
0YPRgtGA0Lgg0LrQvtGC0L7RgNC+0LPQviBSb3dXaWRnZXQKICAgICAgICAgICAgICAgICAgICAg
ICAgdG9waWNfdG9fcmVzZXQgPSBOb25lCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBpc2lu
c3RhbmNlKGZvY3VzX3dpZGdldCwgdXJ3aWQuQXR0ck1hcCk6CiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICB3ID0gZm9jdXNfd2lkZ2V0Lm9yaWdpbmFsX3dpZGdldAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgaWYgaGFzYXR0cih3LCAndG9waWNfbmFtZScpOgogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHRvcGljX3RvX3Jlc2V0ID0gdy50b3BpY19uYW1lCgogICAgICAgICAg
ICAgICAgICAgICAgICBpZiB0b3BpY190b19yZXNldDoKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHNlbGYuYXBwLl9zaG93X3Jlc2V0X29mZnNldHNfZGlhbG9nKHNlbGYuZ3JvdXBfaWQsIHRh
cmdldF90b3BpYz10b3BpY190b19yZXNldCkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICMg0JXRgdC70Lgg0YTQvtC60YPRgSDQvdCwINC6
0L3QvtC/0LrQtSBCYWNrINC40LvQuCDQt9Cw0LPQvtC70L7QstC60LUKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHNlbGYuYXBwLl9zaG93X21lc3NhZ2UoIlNlbGVjdCBhIHRvcGljIHJvdyB0
byByZXNldCBzcGVjaWZpYyB0b3BpYy4iKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4g
Tm9uZQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIoKS5rZXlwcmVzcyhzaXplLCBr
ZXkpCgogICAgICAgICAgICB3cmFwcGVkX2xpc3Rib3ggPSBEZXRhaWxzTGlzdEJveCh3YWxrZXIs
IHNlbGYsIGdyb3VwX2lkKQoKICAgICAgICAgICAgYm94ID0gdXJ3aWQuTGluZUJveCh1cndpZC5B
dHRyTWFwKHdyYXBwZWRfbGlzdGJveCwgImRpYWxvZ19iZyIpLCB0aXRsZT1mIkRldGFpbHM6IHtn
cm91cF9pZH0iKQoKICAgICAgICAgICAgc2VsZi5kaWFsb2dfb3ZlcmxheSA9IHVyd2lkLk92ZXJs
YXkoCiAgICAgICAgICAgICAgICB0b3Bfdz11cndpZC5QYWRkaW5nKGJveCwgbGVmdD0yLCByaWdo
dD0yKSwKICAgICAgICAgICAgICAgIGJvdHRvbV93PXNlbGYubWFpbl9mcmFtZSwKICAgICAgICAg
ICAgICAgIGFsaWduPSJjZW50ZXIiLAogICAgICAgICAgICAgICAgd2lkdGg9KCJyZWxhdGl2ZSIs
IDkwKSwKICAgICAgICAgICAgICAgIHZhbGlnbj0ibWlkZGxlIiwKICAgICAgICAgICAgICAgIGhl
aWdodD0oInJlbGF0aXZlIiwgOTApLAogICAgICAgICAgICAgICAgbWluX3dpZHRoPTcwLAogICAg
ICAgICAgICAgICAgbWluX2hlaWdodD0yMAogICAgICAgICAgICApCiAgICAgICAgICAgIHNlbGYu
bG9vcC53aWRnZXQgPSBzZWxmLmRpYWxvZ19vdmVybGF5CgogICAgICAgIGV4Y2VwdCBFeGNlcHRp
b24gYXMgZToKICAgICAgICAgICAgTE9HLmV4Y2VwdGlvbigiRXJyb3IgZGV0YWlsczogJXMiLCBl
KQogICAgICAgICAgICBzZWxmLl9zaG93X21lc3NhZ2UoZiJFcnJvciBsb2FkaW5nIGRldGFpbHM6
IHtlfSIpCgogICAgIyAtLS0tLSBSZXNldCBPZmZzZXRzIExvZ2ljIC0tLS0tCgogICAgZGVmIF9z
aG93X3Jlc2V0X29mZnNldHNfZGlhbG9nKHNlbGYsIGdyb3VwX2lkLCB0YXJnZXRfdG9waWM9Tm9u
ZSk6CiAgICAgICAgIiIiU3RlcCAxOiBTZWxlY3QgUmVzZXQgU3RyYXRlZ3kuIHRhcmdldF90b3Bp
Yz1Ob25lIG1lYW5zIEFMTCB0b3BpY3MuIiIiCgogICAgICAgICMgRGVidWcgcHJpbnQgKHJlbW92
ZSBpbiBwcm9kKQogICAgICAgICMgTE9HLmluZm8oZiJPcGVuaW5nIFJlc2V0IERpYWxvZyBmb3Ig
e2dyb3VwX2lkfSwgdGFyZ2V0PXt0YXJnZXRfdG9waWN9IikKCiAgICAgICAgc2NvcGVfc3RyID0g
ZiJPTkxZIHRvcGljICd7dGFyZ2V0X3RvcGljfSciIGlmIHRhcmdldF90b3BpYyBlbHNlICJBTEwg
dG9waWNzIgoKICAgICAgICBzdHJhdGVnaWVzID0gWwogICAgICAgICAgICAoIlRvIExhdGVzdCAo
U2tpcCBhbGwpIiwgImxhdGVzdCIpLAogICAgICAgICAgICAoIlRvIEVhcmxpZXN0IChSZXBsYXkg
YWxsKSIsICJlYXJsaWVzdCIpLAogICAgICAgICAgICAoIkJ5IER1cmF0aW9uIChlLmcuIDFoIGFn
bykiLCAiZHVyYXRpb24iKSwKICAgICAgICAgICAgKCJTcGVjaWZpYyBEYXRlVGltZSIsICJkYXRl
dGltZSIpCiAgICAgICAgXQoKICAgICAgICByYWRpb19ncm91cCA9IFtdCiAgICAgICAgc3RyYXRl
Z3lfcmFkaW9zID0gW10KICAgICAgICBmb3IgbGFiZWwsIHZhbCBpbiBzdHJhdGVnaWVzOgogICAg
ICAgICAgICByYiA9IHVyd2lkLlJhZGlvQnV0dG9uKHJhZGlvX2dyb3VwLCBsYWJlbCkKICAgICAg
ICAgICAgcmIudXNlcl9kYXRhID0gdmFsCiAgICAgICAgICAgIHN0cmF0ZWd5X3JhZGlvcy5hcHBl
bmQocmIpCgogICAgICAgIGR1cmF0aW9uX2VkaXQgPSB1cndpZC5FZGl0KCJEdXJhdGlvbiAoZS5n
LiAzMG0sIDJoKTogIiwgIjFoIikKICAgICAgICBkYXRldGltZV9lZGl0ID0gdXJ3aWQuRWRpdCgi
RGF0ZVRpbWUgKElTTyA4NjAxKTogIiwgIjIwMjMtMDEtMDFUMTI6MDA6MDAiKQoKICAgICAgICBz
dHJhdGVneV9yYWRpb3NbMF0uc2V0X3N0YXRlKFRydWUpCgogICAgICAgIGRlZiBvbl9wcmV2aWV3
KGJ0bik6CiAgICAgICAgICAgIHNlbGVjdGVkX3N0cmF0ZWd5ID0gImxhdGVzdCIKICAgICAgICAg
ICAgZm9yIHJiIGluIHN0cmF0ZWd5X3JhZGlvczoKICAgICAgICAgICAgICAgIGlmIHJiLnN0YXRl
OgogICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkX3N0cmF0ZWd5ID0gcmIudXNlcl9kYXRhCiAg
ICAgICAgICAgICAgICAgICAgYnJlYWsKCiAgICAgICAgICAgIHBhcmFtcyA9IHt9CiAgICAgICAg
ICAgIGlmIHNlbGVjdGVkX3N0cmF0ZWd5ID09ICJkdXJhdGlvbiI6CiAgICAgICAgICAgICAgICBw
YXJhbXNbImR1cmF0aW9uIl0gPSBkdXJhdGlvbl9lZGl0LmVkaXRfdGV4dAogICAgICAgICAgICBl
bGlmIHNlbGVjdGVkX3N0cmF0ZWd5ID09ICJkYXRldGltZSI6CiAgICAgICAgICAgICAgICBwYXJh
bXNbImRhdGV0aW1lIl0gPSBkYXRldGltZV9lZGl0LmVkaXRfdGV4dAoKICAgICAgICAgICAgIyDQ
ktCQ0JbQndCeOiDQn9C10YDQtdC00LDQtdC8IHRhcmdldF90b3BpYwogICAgICAgICAgICBzZWxm
Ll9zaG93X3Jlc2V0X3ByZXZpZXcoZ3JvdXBfaWQsIHNlbGVjdGVkX3N0cmF0ZWd5LCBwYXJhbXMs
IHRhcmdldF90b3BpYykKCiAgICAgICAgZGVmIG9uX2NhbmNlbChidG4pOgogICAgICAgICAgICAj
INCS0L7Qt9Cy0YDQsNGJ0LDQtdC80YHRjyDQsiDQtNC10YLQsNC70Lgg0LPRgNGD0L/Qv9GLCiAg
ICAgICAgICAgIHNlbGYuX3Nob3dfZ3JvdXBfZGV0YWlscyhncm91cF9pZCkKCiAgICAgICAgcGls
ZSA9IHVyd2lkLlBpbGUoWwogICAgICAgICAgICB1cndpZC5UZXh0KGYiUmVzZXQgT2Zmc2V0cyBm
b3IgR3JvdXA6IHtncm91cF9pZH0iKSwKICAgICAgICAgICAgdXJ3aWQuVGV4dChmIlNjb3BlOiB7
c2NvcGVfc3RyfSIsIGFsaWduPSdjZW50ZXInKSwKICAgICAgICAgICAgdXJ3aWQuRGl2aWRlcigp
LAogICAgICAgICAgICB1cndpZC5UZXh0KCJTZWxlY3QgU3RyYXRlZ3k6IiksCiAgICAgICAgICAg
ICpzdHJhdGVneV9yYWRpb3MsCiAgICAgICAgICAgIHVyd2lkLkRpdmlkZXIoKSwKICAgICAgICAg
ICAgdXJ3aWQuVGV4dCgiUGFyYW1ldGVycyAoaWYgYXBwbGljYWJsZSk6IiksCiAgICAgICAgICAg
IGR1cmF0aW9uX2VkaXQsCiAgICAgICAgICAgIGRhdGV0aW1lX2VkaXQsCiAgICAgICAgICAgIHVy
d2lkLkRpdmlkZXIoKSwKICAgICAgICAgICAgdXJ3aWQuQXR0ck1hcCh1cndpZC5CdXR0b24oIlBy
ZXZpZXcgKERyeSBSdW4pIiwgb25fcHJlc3M9b25fcHJldmlldyksICJidG4iLCBmb2N1c19tYXA9
ImJ0bl9mb2N1cyIpLAogICAgICAgICAgICB1cndpZC5BdHRyTWFwKHVyd2lkLkJ1dHRvbigiQ2Fu
Y2VsIiwgb25fcHJlc3M9b25fY2FuY2VsKSwgImJ0biIsIGZvY3VzX21hcD0iYnRuX2ZvY3VzIiks
CiAgICAgICAgXSkKCiAgICAgICAgIyAjINCe0LHQtdGA0YLQutCwINC00LvRjyDQvtCx0YDQsNCx
0L7RgtC60LggRVNDINCy0L3Rg9GC0YDQuCDRjdGC0L7Qs9C+INC00LjQsNC70L7Qs9CwCiAgICAg
ICAgIyBjbGFzcyBSZXNldFBpbGUodXJ3aWQuUGlsZSk6CiAgICAgICAgIyAgICAgZGVmIGtleXBy
ZXNzKHNlbGYsIHNpemUsIGtleSk6CiAgICAgICAgIyAgICAgICAgIGlmIGtleSA9PSAnZXNjJzoK
ICAgICAgICAjICAgICAgICAgICAgIG9uX2NhbmNlbChOb25lKQogICAgICAgICMgICAgICAgICAg
ICAgcmV0dXJuIE5vbmUKICAgICAgICAjICAgICAgICAgcmV0dXJuIHN1cGVyKCkua2V5cHJlc3Mo
c2l6ZSwga2V5KQogICAgICAgICMKICAgICAgICAjIHdyYXBwZWRfcGlsZSA9IFJlc2V0UGlsZShw
aWxlLmNvbnRlbnRzKQoKICAgICAgICBvcmlnaW5hbF9rZXlwcmVzcyA9IHBpbGUua2V5cHJlc3MK
CiAgICAgICAgZGVmIGN1c3RvbV9rZXlwcmVzcyhzaXplLCBrZXkpOgogICAgICAgICAgICBpZiBr
ZXkgPT0gJ2VzYyc6CiAgICAgICAgICAgICAgICBvbl9jYW5jZWwoTm9uZSkKICAgICAgICAgICAg
ICAgIHJldHVybiBOb25lCiAgICAgICAgICAgICMgcmV0dXJuIG9yaWdpbmFsX2tleXByZXNzKHNp
emUsIGtleSkKICAgICAgICAgICAgcmV0dXJuIHVyd2lkLlBpbGUua2V5cHJlc3MocGlsZSwgc2l6
ZSwga2V5KQoKICAgICAgICBwaWxlLmtleXByZXNzID0gY3VzdG9tX2tleXByZXNzCgogICAgICAg
IHNlbGYuX3Nob3dfZGlhbG9nKHBpbGUsICJSZXNldCBPZmZzZXRzIENvbmZpZ3VyYXRpb24iKQoK
ICAgIGRlZiBfc2hvd19yZXNldF9wcmV2aWV3KHNlbGYsIGdyb3VwX2lkLCBzdHJhdGVneSwgcGFy
YW1zLCB0YXJnZXRfdG9waWM9Tm9uZSk6CiAgICAgICAgIiIiU3RlcCAyOiBDYWxjdWxhdGUgYW5k
IFNob3cgRHJ5IFJ1biIiIgogICAgICAgIHNlbGYuX3NldF9zdGF0dXMoIkNhbGN1bGF0aW5nIG5l
dyBvZmZzZXRzLi4uIikKCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIDEuIEdldCBjdXJyZW50
IHN1YnNjcmlwdGlvbgogICAgICAgICAgICBjb21taXR0ZWQgPSBzZWxmLmFkbWluX2NsaWVudC5s
aXN0X2NvbnN1bWVyX2dyb3VwX29mZnNldHMoZ3JvdXBfaWQpCiAgICAgICAgICAgIGlmIG5vdCBj
b21taXR0ZWQ6CiAgICAgICAgICAgICAgICBzZWxmLl9zaG93X21lc3NhZ2UoIkdyb3VwIGhhcyBu
byBvZmZzZXRzIHRvIHJlc2V0LiIpCiAgICAgICAgICAgICAgICByZXR1cm4KCiAgICAgICAgICAg
IHRwcyA9IGxpc3QoY29tbWl0dGVkLmtleXMoKSkKCiAgICAgICAgICAgICMg0KTQmNCb0KzQotCg
0JDQptCY0K8KICAgICAgICAgICAgaWYgdGFyZ2V0X3RvcGljOgogICAgICAgICAgICAgICAgb3Jp
Z2luYWxfY291bnQgPSBsZW4odHBzKQogICAgICAgICAgICAgICAgdHBzID0gW3RwIGZvciB0cCBp
biB0cHMgaWYgdHAudG9waWMgPT0gdGFyZ2V0X3RvcGljXQogICAgICAgICAgICAgICAgIyBMT0cu
aW5mbyhmIkZpbHRlcmVkIFRQczoge29yaWdpbmFsX2NvdW50fSAtPiB7bGVuKHRwcyl9IGZvciB0
b3BpYyB7dGFyZ2V0X3RvcGljfSIpCgogICAgICAgICAgICAgICAgaWYgbm90IHRwczoKICAgICAg
ICAgICAgICAgICAgICBzZWxmLl9zaG93X21lc3NhZ2UoZiJHcm91cCBpcyBub3Qgc3Vic2NyaWJl
ZCB0byB0b3BpYyAne3RhcmdldF90b3BpY30nLiIpCiAgICAgICAgICAgICAgICAgICAgIyDQktC+
0LfQstGA0LDRgiDQsiDQutC+0L3RhNC40LMKICAgICAgICAgICAgICAgICAgICBzZWxmLl9zaG93
X3Jlc2V0X29mZnNldHNfZGlhbG9nKGdyb3VwX2lkLCB0YXJnZXRfdG9waWMpCiAgICAgICAgICAg
ICAgICAgICAgcmV0dXJuCgogICAgICAgICAgICAjIDIuIENhbGN1bGF0ZSBOZXcgT2Zmc2V0cwog
ICAgICAgICAgICBjZmcgPSBzZWxmLl9nZXRfa2Fma2FfY29uZmlnKCkKICAgICAgICAgICAgY2Zn
WyJlbmFibGVfYXV0b19jb21taXQiXSA9IEZhbHNlCiAgICAgICAgICAgIGNvbnN1bWVyID0gS2Fm
a2FDb25zdW1lcigqKmNmZykKCiAgICAgICAgICAgIG5ld19vZmZzZXRzX21hcCA9IHt9CgogICAg
ICAgICAgICBpZiBzdHJhdGVneSA9PSAibGF0ZXN0IjoKICAgICAgICAgICAgICAgIG5ld19vZmZz
ZXRzX21hcCA9IGNvbnN1bWVyLmVuZF9vZmZzZXRzKHRwcykKICAgICAgICAgICAgZWxpZiBzdHJh
dGVneSA9PSAiZWFybGllc3QiOgogICAgICAgICAgICAgICAgbmV3X29mZnNldHNfbWFwID0gY29u
c3VtZXIuYmVnaW5uaW5nX29mZnNldHModHBzKQogICAgICAgICAgICBlbGlmIHN0cmF0ZWd5IGlu
ICgiZHVyYXRpb24iLCAiZGF0ZXRpbWUiKToKICAgICAgICAgICAgICAgIGZyb20gZGF0ZXRpbWUg
aW1wb3J0IGRhdGV0aW1lLCB0aW1lZGVsdGEsIHRpbWV6b25lCiAgICAgICAgICAgICAgICB0YXJn
ZXRfdHNfbXMgPSAwCiAgICAgICAgICAgICAgICBub3cgPSBkYXRldGltZS5ub3codGltZXpvbmUu
dXRjKQogICAgICAgICAgICAgICAgaWYgc3RyYXRlZ3kgPT0gImR1cmF0aW9uIjoKICAgICAgICAg
ICAgICAgICAgICBkdXJfc3RyID0gcGFyYW1zLmdldCgiZHVyYXRpb24iLCAiMWgiKS5sb3dlcigp
CiAgICAgICAgICAgICAgICAgICAgZGVsdGEgPSB0aW1lZGVsdGEoaG91cnM9MSkKICAgICAgICAg
ICAgICAgICAgICBpZiBkdXJfc3RyLmVuZHN3aXRoKCJtIik6CiAgICAgICAgICAgICAgICAgICAg
ICAgIGRlbHRhID0gdGltZWRlbHRhKG1pbnV0ZXM9aW50KGR1cl9zdHJbOi0xXSkpCiAgICAgICAg
ICAgICAgICAgICAgZWxpZiBkdXJfc3RyLmVuZHN3aXRoKCJoIik6CiAgICAgICAgICAgICAgICAg
ICAgICAgIGRlbHRhID0gdGltZWRlbHRhKGhvdXJzPWludChkdXJfc3RyWzotMV0pKQogICAgICAg
ICAgICAgICAgICAgIGVsaWYgZHVyX3N0ci5lbmRzd2l0aCgiZCIpOgogICAgICAgICAgICAgICAg
ICAgICAgICBkZWx0YSA9IHRpbWVkZWx0YShkYXlzPWludChkdXJfc3RyWzotMV0pKQogICAgICAg
ICAgICAgICAgICAgIHRhcmdldF90c19tcyA9IGludCgobm93IC0gZGVsdGEpLnRpbWVzdGFtcCgp
ICogMTAwMCkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgdHJ5Ogog
ICAgICAgICAgICAgICAgICAgICAgICBkdCA9IGRhdGV0aW1lLmZyb21pc29mb3JtYXQocGFyYW1z
LmdldCgiZGF0ZXRpbWUiKSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZHQudHppbmZvIGlz
IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRfdHNfbXMgPSBpbnQoZHQu
dGltZXN0YW1wKCkgKiAxMDAwKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3RzX21zID0gaW50KGR0LnRpbWVzdGFtcCgpICog
MTAwMCkKICAgICAgICAgICAgICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAg
ICAgICAgICAgICAgc2VsZi5fc2hvd19tZXNzYWdlKCJJbnZhbGlkIGRhdGUgZm9ybWF0IikKICAg
ICAgICAgICAgICAgICAgICAgICAgY29uc3VtZXIuY2xvc2UoKQogICAgICAgICAgICAgICAgICAg
ICAgICByZXR1cm4KCiAgICAgICAgICAgICAgICB0c19tYXAgPSB7dHA6IHRhcmdldF90c19tcyBm
b3IgdHAgaW4gdHBzfQogICAgICAgICAgICAgICAgcmVzID0gY29uc3VtZXIub2Zmc2V0c19mb3Jf
dGltZXModHNfbWFwKQogICAgICAgICAgICAgICAgZm9yIHRwLCBvZmZfYW5kX3RzIGluIHJlcy5p
dGVtcygpOgogICAgICAgICAgICAgICAgICAgIGlmIG9mZl9hbmRfdHM6CiAgICAgICAgICAgICAg
ICAgICAgICAgIG5ld19vZmZzZXRzX21hcFt0cF0gPSBvZmZfYW5kX3RzLm9mZnNldAogICAgICAg
ICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld19vZmZzZXRzX21h
cFt0cF0gPSBjb25zdW1lci5lbmRfb2Zmc2V0cyhbdHBdKVt0cF0KCiAgICAgICAgICAgIGNvbnN1
bWVyLmNsb3NlKCkKCiAgICAgICAgICAgICMgMy4gQnVpbGQgUHJldmlldyBUYWJsZQogICAgICAg
ICAgICBib2R5ID0gW10KICAgICAgICAgICAgaGVhZGVyID0gZiJ7J1RPUElDJzo8MzB9IHsnUEFS
VCc6PDV9IHsnT0xEJzo8MTJ9IHsnTkVXJzo8MTJ9IHsnQ0hBTkdFJ30iCiAgICAgICAgICAgIGJv
ZHkuYXBwZW5kKHVyd2lkLkF0dHJNYXAodXJ3aWQuVGV4dChoZWFkZXIpLCAiaGVhZGVyIikpCgog
ICAgICAgICAgICBjaGFuZ2VzX2xpc3QgPSBbXQoKICAgICAgICAgICAgZm9yIHRwIGluIHNvcnRl
ZCh0cHMsIGtleT1sYW1iZGEgeDogKHgudG9waWMsIHgucGFydGl0aW9uKSk6CiAgICAgICAgICAg
ICAgICBvbGRfb2ZmID0gY29tbWl0dGVkW3RwXS5vZmZzZXQKICAgICAgICAgICAgICAgIG5ld19v
ZmYgPSBuZXdfb2Zmc2V0c19tYXAuZ2V0KHRwLCBvbGRfb2ZmKQogICAgICAgICAgICAgICAgZGlm
ZiA9IG5ld19vZmYgLSBvbGRfb2ZmCiAgICAgICAgICAgICAgICBkaWZmX3N0ciA9IGYie2RpZmY6
K2R9IiBpZiBkaWZmICE9IDAgZWxzZSAiMCIKCiAgICAgICAgICAgICAgICBjaGFuZ2VzX2xpc3Qu
YXBwZW5kKCh0cCwgbmV3X29mZikpCiAgICAgICAgICAgICAgICBsaW5lID0gZiJ7dHAudG9waWM6
PDMwfSB7dHAucGFydGl0aW9uOjw1fSB7b2xkX29mZjo8MTJ9IHtuZXdfb2ZmOjwxMn0ge2RpZmZf
c3RyfSIKICAgICAgICAgICAgICAgIGF0dHIgPSAiYm9keSIKICAgICAgICAgICAgICAgIGlmIGRp
ZmYgIT0gMDogYXR0ciA9ICJ3YXJuaW5nIgogICAgICAgICAgICAgICAgYm9keS5hcHBlbmQodXJ3
aWQuQXR0ck1hcCh1cndpZC5UZXh0KGxpbmUpLCBhdHRyKSkKCiAgICAgICAgICAgICMgNC4gQnV0
dG9ucwogICAgICAgICAgICBkZWYgb25fY29uZmlybShidG4pOgogICAgICAgICAgICAgICAgc2Vs
Zi5fZXhlY3V0ZV9yZXNldChncm91cF9pZCwgY2hhbmdlc19saXN0KQoKICAgICAgICAgICAgZGVm
IG9uX2JhY2soYnRuKToKICAgICAgICAgICAgICAgICMg0JLQvtC30LLRgNCw0YIg0LIg0LrQvtC9
0YTQuNCzINGBINCi0JXQnCDQltCVIHRhcmdldF90b3BpYwogICAgICAgICAgICAgICAgc2VsZi5f
c2hvd19yZXNldF9vZmZzZXRzX2RpYWxvZyhncm91cF9pZCwgdGFyZ2V0X3RvcGljKQoKICAgICAg
ICAgICAgYm9keS5hcHBlbmQodXJ3aWQuRGl2aWRlcigpKQogICAgICAgICAgICBib2R5LmFwcGVu
ZCh1cndpZC5UZXh0KGYiU2NvcGU6IHsnT05MWSAnICsgdGFyZ2V0X3RvcGljIGlmIHRhcmdldF90
b3BpYyBlbHNlICdBTEwnfSIpKQogICAgICAgICAgICBib2R5LmFwcGVuZCh1cndpZC5EaXZpZGVy
KCkpCgogICAgICAgICAgICBidG5zID0gdXJ3aWQuQ29sdW1ucyhbCiAgICAgICAgICAgICAgICB1
cndpZC5BdHRyTWFwKHVyd2lkLkJ1dHRvbigiQ09ORklSTSBSRVNFVCIsIG9uX2NvbmZpcm0pLCAi
YnRuIiwgZm9jdXNfbWFwPSJidG5fZm9jdXMiKSwKICAgICAgICAgICAgICAgIHVyd2lkLkF0dHJN
YXAodXJ3aWQuQnV0dG9uKCJCYWNrIiwgb25fYmFjayksICJidG4iLCBmb2N1c19tYXA9ImJ0bl9m
b2N1cyIpCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIGJvZHkuYXBwZW5kKGJ0bnMpCgogICAg
ICAgICAgICB3YWxrZXIgPSB1cndpZC5TaW1wbGVGb2N1c0xpc3RXYWxrZXIoYm9keSkKICAgICAg
ICAgICAgbGlzdGJveCA9IHVyd2lkLkxpc3RCb3god2Fsa2VyKQoKICAgICAgICAgICAgIyDQlNC+
0LHQsNCy0LvRj9C10Lwg0L7QsdGA0LDQsdC+0YLQutGDIEVTQyDQuCDQsiBQcmV2aWV3CiAgICAg
ICAgICAgIGNsYXNzIFByZXZpZXdMaXN0Qm94KHVyd2lkLkxpc3RCb3gpOgogICAgICAgICAgICAg
ICAgZGVmIGtleXByZXNzKHNlbGYsIHNpemUsIGtleSk6CiAgICAgICAgICAgICAgICAgICAgaWYg
a2V5ID09ICdlc2MnOgogICAgICAgICAgICAgICAgICAgICAgICBvbl9iYWNrKE5vbmUpCiAgICAg
ICAgICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu
IHN1cGVyKCkua2V5cHJlc3Moc2l6ZSwga2V5KQoKICAgICAgICAgICAgd3JhcHBlZF9saXN0Ym94
ID0gUHJldmlld0xpc3RCb3god2Fsa2VyKQoKICAgICAgICAgICAgYm94ID0gdXJ3aWQuTGluZUJv
eCh1cndpZC5BdHRyTWFwKHdyYXBwZWRfbGlzdGJveCwgImRpYWxvZ19iZyIpLCB0aXRsZT1mIkRy
eSBSdW46IHtncm91cF9pZH0iKQoKICAgICAgICAgICAgc2VsZi5kaWFsb2dfb3ZlcmxheSA9IHVy
d2lkLk92ZXJsYXkoCiAgICAgICAgICAgICAgICB0b3Bfdz11cndpZC5QYWRkaW5nKGJveCwgbGVm
dD0yLCByaWdodD0yKSwKICAgICAgICAgICAgICAgIGJvdHRvbV93PXNlbGYubWFpbl9mcmFtZSwK
ICAgICAgICAgICAgICAgIGFsaWduPSJjZW50ZXIiLAogICAgICAgICAgICAgICAgd2lkdGg9KCJy
ZWxhdGl2ZSIsIDgwKSwKICAgICAgICAgICAgICAgIHZhbGlnbj0ibWlkZGxlIiwKICAgICAgICAg
ICAgICAgIGhlaWdodD0oInJlbGF0aXZlIiwgODApLAogICAgICAgICAgICAgICAgbWluX3dpZHRo
PTYwLAogICAgICAgICAgICAgICAgbWluX2hlaWdodD0yMAogICAgICAgICAgICApCiAgICAgICAg
ICAgIHNlbGYubG9vcC53aWRnZXQgPSBzZWxmLmRpYWxvZ19vdmVybGF5CgogICAgICAgIGV4Y2Vw
dCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgTE9HLmV4Y2VwdGlvbigiRXJyb3IgY2FsY3Vs
YXRpbmcgb2Zmc2V0czogJXMiLCBlKQogICAgICAgICAgICBzZWxmLl9zaG93X21lc3NhZ2UoZiJD
YWxjdWxhdGlvbiBmYWlsZWQ6IHtlfSIpCgogICAgZGVmIF9leGVjdXRlX3Jlc2V0KHNlbGYsIGdy
b3VwX2lkLCBjaGFuZ2VzX2xpc3QpOgogICAgICAgICIiIlN0ZXAgMzogRXhlY3V0ZSAoVHJ5IEFk
bWluQ2xpZW50LCBmYWxsYmFjayB0byBDb25zdW1lciBjb21taXQpIiIiCiAgICAgICAgdHJ5Ogog
ICAgICAgICAgICAjINCf0L7Qv9GL0YLQutCwIDE6IEFkbWluIENsaWVudCAo0YHQvtCy0YDQtdC8
0LXQvdC90YvQuSDRgdC/0L7RgdC+0LEpCiAgICAgICAgICAgIGlmIGhhc2F0dHIoc2VsZi5hZG1p
bl9jbGllbnQsICdhbHRlcl9jb25zdW1lcl9ncm91cF9vZmZzZXRzJyk6CiAgICAgICAgICAgICAg
ICBmcm9tIGthZmthLnN0cnVjdHMgaW1wb3J0IE9mZnNldEFuZE1ldGFkYXRhCiAgICAgICAgICAg
ICAgICBvZmZzZXRzID0ge30KICAgICAgICAgICAgICAgIGZvciB0cCwgb2Zmc2V0IGluIGNoYW5n
ZXNfbGlzdDoKICAgICAgICAgICAgICAgICAgICAjINCf0YDQvtCx0YPQtdC8INGA0LDQt9C90YvQ
tSDRgdC40LPQvdCw0YLRg9GA0Ysg0LrQvtC90YHRgtGA0YPQutGC0L7RgNCwCiAgICAgICAgICAg
ICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXRzW3RwXSA9IE9mZnNl
dEFuZE1ldGFkYXRhKG9mZnNldD1vZmZzZXQsIG1ldGFkYXRhPSIiLCBsZWFkZXJfZXBvY2g9LTEp
CiAgICAgICAgICAgICAgICAgICAgI2V4Y2VwdCBUeXBlRXJyb3I6CiAgICAgICAgICAgICAgICAg
ICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXhj
ZXB0aW9uKCJFcnJvciBjYWxjdWxhdGluZyBvZmZzZXRzOiAlcyIsIGUpCiAgICAgICAgICAgICAg
ICAgICAgICAgIHNlbGYuX3Nob3dfbWVzc2FnZShmIk9mZnNldCBmYWlsZWQ6IHtlfSIpCgogICAg
ICAgICAgICAgICAgc2VsZi5hZG1pbl9jbGllbnQuYWx0ZXJfY29uc3VtZXJfZ3JvdXBfb2Zmc2V0
cygKICAgICAgICAgICAgICAgICAgICBncm91cF9pZD1ncm91cF9pZCwKICAgICAgICAgICAgICAg
ICAgICBvZmZzZXRzPW9mZnNldHMKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgIGVsc2U6
CiAgICAgICAgICAgICAgICAjINCf0L7Qv9GL0YLQutCwIDI6IExlZ2FjeSDRgdC/0L7RgdC+0LEg
0YfQtdGA0LXQtyBDb25zdW1lciBjb21taXQKICAgICAgICAgICAgICAgICMg0K3RgtC+INGA0LDQ
sdC+0YLQsNC10YIg0LLRgdC10LPQtNCwLCDQvdC+INGC0YDQtdCx0YPQtdGCINGB0L7Qt9C00LDQ
vdC40Y8g0LrQvtC90YHRjNGO0LzQtdGA0LAKCiAgICAgICAgICAgICAgICAjIHNlbGYuX3Nob3df
bWVzc2FnZSgiQWRtaW5DbGllbnQgbWV0aG9kIG1pc3NpbmcsIHVzaW5nIENvbnN1bWVyIGNvbW1p
dCBmYWxsYmFjay4uLiIpCgogICAgICAgICAgICAgICAgY2ZnID0gc2VsZi5fZ2V0X2thZmthX2Nv
bmZpZygpCiAgICAgICAgICAgICAgICBjZmdbImdyb3VwX2lkIl0gPSBncm91cF9pZAogICAgICAg
ICAgICAgICAgY2ZnWyJlbmFibGVfYXV0b19jb21taXQiXSA9IEZhbHNlCiAgICAgICAgICAgICAg
ICAjINCS0LDQttC90L4g0L7RgtC60LvRjtGH0LjRgtGMIGF1dG8ub2Zmc2V0LnJlc2V0LCDRh9GC
0L7QsdGLINC90LUg0YHQsdGA0L7RgdC40LvQviDRgdCw0LzQvgogICAgICAgICAgICAgICAgY2Zn
WyJhdXRvX29mZnNldF9yZXNldCJdID0gIm5vbmUiCgogICAgICAgICAgICAgICAgY29uc3VtZXIg
PSBLYWZrYUNvbnN1bWVyKCoqY2ZnKQoKICAgICAgICAgICAgICAgICMg0KTQvtGA0LzQuNGA0YPQ
tdC8INGB0LvQvtCy0LDRgNGMINC00LvRjyDQutC+0LzQvNC40YLQsAogICAgICAgICAgICAgICAg
ZnJvbSBrYWZrYSBpbXBvcnQgT2Zmc2V0QW5kTWV0YWRhdGEsIFRvcGljUGFydGl0aW9uCiAgICAg
ICAgICAgICAgICBvZmZzZXRzX3RvX2NvbW1pdCA9IHt9CgogICAgICAgICAgICAgICAgdG9waWNz
ID0gc2V0KCkKICAgICAgICAgICAgICAgIGZvciB0cCwgb2Zmc2V0IGluIGNoYW5nZXNfbGlzdDoK
ICAgICAgICAgICAgICAgICAgICB0b3BpY3MuYWRkKHRwLnRvcGljKQogICAgICAgICAgICAgICAg
ICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0c190b19jb21taXRbdHBdID0g
T2Zmc2V0QW5kTWV0YWRhdGEob2Zmc2V0PW9mZnNldCwgbWV0YWRhdGE9IiIsIGxlYWRlcl9lcG9j
aD0tMSkKICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAg
ICAgICAgICAgICAgICAgIExPRy5leGNlcHRpb24oIkVycm9yIGNyZWF0aW5nIE9mZnNldEFuZE1l
dGFkYXRhOiAlcyIsIGUpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3Nob3dfbWVzc2Fn
ZShmIkZhaWxlZCB0byBwcmVwYXJlIG9mZnNldCBmb3Ige3RwfToge2V9IikKICAgICAgICAgICAg
ICAgICAgICAgICAgY29uc3VtZXIuY2xvc2UoKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1
cm4gIyDQn9GA0LXRgNGL0LLQsNC10Lwg0L7Qv9C10YDQsNGG0LjRjiwg0YfRgtC+0LHRiyDQvdC1
INC60L7QvNC80LjRgtC40YLRjCDRh9Cw0YHRgtC40YfQvdC+CgogICAgICAgICAgICAgICAgIyDQ
lNC70Y8g0LrQvtC80LzQuNGC0LAg0L3QtSDQvtCx0Y/Qt9Cw0YLQtdC70YzQvdC+INCx0YvRgtGM
INC/0L7QtNC/0LjRgdCw0L3QvdGL0Lwg0LIg0L3QvtCy0YvRhSDQstC10YDRgdC40Y/RhSBLYWZr
YSwKICAgICAgICAgICAgICAgICMg0L3QviDQvdCw0LTQtdC20L3QtdC1INC/0YDQvtGB0YLQviDQ
vtGC0L/RgNCw0LLQuNGC0YwgY29tbWl0U3luYy4KICAgICAgICAgICAgICAgICMgQ29uc3VtZXIu
Y29tbWl0KCkg0L7RgtC/0YDQsNCy0LvRj9C10YIgT2Zmc2V0Q29tbWl0UmVxdWVzdAoKICAgICAg
ICAgICAgICAgIGNvbnN1bWVyLmNvbW1pdChvZmZzZXRzX3RvX2NvbW1pdCkKICAgICAgICAgICAg
ICAgIGNvbnN1bWVyLmNsb3NlKCkKCiAgICAgICAgICAgIHNlbGYuX3Nob3dfbWVzc2FnZShmIlN1
Y2Nlc3NmdWxseSByZXNldCBvZmZzZXRzIGZvciBncm91cCB7Z3JvdXBfaWR9IikKICAgICAgICAg
ICAgIyDQktC+0LfQstGA0LDRidCw0LXQvNGB0Y8g0LIg0LTQtdGC0LDQu9C4CiAgICAgICAgICAg
IHNlbGYuX3Nob3dfZ3JvdXBfZGV0YWlscyhncm91cF9pZCkKCiAgICAgICAgZXhjZXB0IEV4Y2Vw
dGlvbiBhcyBlOgogICAgICAgICAgICBMT0cuZXhjZXB0aW9uKCJSZXNldCBmYWlsZWQ6ICVzIiwg
ZSkKICAgICAgICAgICAgc2VsZi5fc2hvd19tZXNzYWdlKGYiUmVzZXQgZmFpbGVkOiB7ZX0iKQoK
ICAgIGRlZiBfc2hvd19kZWxldGVfdG9waWNfY29uZmlybShzZWxmLCB0b3BpYyk6CiAgICAgICAg
aWYgbm90IHRvcGljOgogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgaWYgdG9waWMuc3RhcnRz
d2l0aCgiX18iKToKICAgICAgICAgICAgc2VsZi5fc2hvd19tZXNzYWdlKGYiRGVsZXRpbmcgaW50
ZXJuYWwgdG9waWNzIGlzIGZvcmJpZGRlbjoge3RvcGljfSIpCiAgICAgICAgICAgIHJldHVybgoK
ICAgICAgICBkZWYgb25fZGVsZXRlKGJ0bj1Ob25lKToKICAgICAgICAgICAgdHJ5OgogICAgICAg
ICAgICAgICAgaWYgbm90IHNlbGYuYWRtaW5fY2xpZW50OgogICAgICAgICAgICAgICAgICAgIHNl
bGYuX2luaXRfYWRtaW5fY2xpZW50KCkKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLmFkbWlu
X2NsaWVudDoKICAgICAgICAgICAgICAgICAgICBzZWxmLl9zaG93X21lc3NhZ2UoIkFkbWluIGNs
aWVudCBpcyBub3QgaW5pdGlhbGl6ZWQiKQogICAgICAgICAgICAgICAgICAgIHJldHVybgoKICAg
ICAgICAgICAgICAgIHNlbGYuYWRtaW5fY2xpZW50LmRlbGV0ZV90b3BpY3MoW3RvcGljXSkKICAg
ICAgICAgICAgICAgIHNlbGYuX2Nsb3NlX2RpYWxvZygpCiAgICAgICAgICAgICAgICBzZWxmLl9m
ZXRjaF90b3BpY3MoKQogICAgICAgICAgICAgICAgc2VsZi5fc2V0X3N0YXR1cyhmIkRlbGV0ZWQg
dG9waWM6IHt0b3BpY30iKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAg
ICAgICAgICAgICBzZWxmLl9zaG93X21lc3NhZ2UoZiJFcnJvciBkZWxldGluZyB0b3BpYzoge2V9
IikKCiAgICAgICAgZGVmIG9uX2NhbmNlbChidG49Tm9uZSk6CiAgICAgICAgICAgIHNlbGYuX2Ns
b3NlX2RpYWxvZygpCgogICAgICAgICMgRW50ZXIgPSBkZWxldGUsIEVzYy9RID0gY2FuY2VsCiAg
ICAgICAgY2xhc3MgQ29uZmlybVBpbGUodXJ3aWQuUGlsZSk6CiAgICAgICAgICAgIGRlZiBrZXlw
cmVzcyhwaWxlX3NlbGYsIHNpemUsIGtleSk6CiAgICAgICAgICAgICAgICBpZiBrZXkgPT0gJ2Vu
dGVyJzoKICAgICAgICAgICAgICAgICAgICBvbl9kZWxldGUoKQogICAgICAgICAgICAgICAgICAg
IHJldHVybiBOb25lCiAgICAgICAgICAgICAgICBpZiBrZXkgaW4gKCdlc2MnLCAncScsICdRJyk6
CiAgICAgICAgICAgICAgICAgICAgb25fY2FuY2VsKCkKICAgICAgICAgICAgICAgICAgICByZXR1
cm4gTm9uZQogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyKCkua2V5cHJlc3Moc2l6ZSwga2V5
KQoKICAgICAgICBwaWxlID0gQ29uZmlybVBpbGUoWwogICAgICAgICAgICB1cndpZC5UZXh0KCJE
ZWxldGUgdG9waWM/IiksCiAgICAgICAgICAgIHVyd2lkLkRpdmlkZXIoKSwKICAgICAgICAgICAg
dXJ3aWQuVGV4dChmIlRvcGljOiB7dG9waWN9IiksCiAgICAgICAgICAgIHVyd2lkLlRleHQoIlRo
aXMgb3BlcmF0aW9uIGlzIGRlc3RydWN0aXZlLiIpLAogICAgICAgICAgICB1cndpZC5EaXZpZGVy
KCksCiAgICAgICAgICAgIHVyd2lkLkF0dHJNYXAodXJ3aWQuQnV0dG9uKCJERUxFVEUiLCBvbl9w
cmVzcz1vbl9kZWxldGUpLCAiYnRuIiwgZm9jdXNfbWFwPSJidG5fZm9jdXMiKSwKICAgICAgICAg
ICAgdXJ3aWQuQXR0ck1hcCh1cndpZC5CdXR0b24oIkNhbmNlbCIsIG9uX3ByZXNzPW9uX2NhbmNl
bCksICJidG4iLCBmb2N1c19tYXA9ImJ0bl9mb2N1cyIpLAogICAgICAgIF0pCgogICAgICAgIHNl
bGYuX3Nob3dfZGlhbG9nKHBpbGUsICJDb25maXJtIGRlbGV0ZSIpCgogICAgZGVmIF9zaG93X2Ny
ZWF0ZV90b3BpY19kaWFsb2coc2VsZik6CiAgICAgICAgIyAtLS0gUHJlc2V0cyBEZWZpbml0aW9u
IC0tLQogICAgICAgIFBSRVNFVFMgPSB7CiAgICAgICAgICAgICJNYW51YWwgKEN1c3RvbSkiOiB7
fSwKICAgICAgICAgICAgIlRlbXBvcmFyeSBEZWJ1ZyAoMjRoLCBkZWxldGUpIjogewogICAgICAg
ICAgICAgICAgImNsZWFudXAucG9saWN5IjogImRlbGV0ZSIsCiAgICAgICAgICAgICAgICAicmV0
ZW50aW9uLm1zIjogIjg2NDAwMDAwIiwKICAgICAgICAgICAgICAgICJyZXBsaWNhdGlvbl9mYWN0
b3IiOiAiMSIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIlNob3J0IExpdmVkICg3IGRheXMs
IGRlbGV0ZSkiOiB7CiAgICAgICAgICAgICAgICAiY2xlYW51cC5wb2xpY3kiOiAiZGVsZXRlIiwK
ICAgICAgICAgICAgICAgICJyZXRlbnRpb24ubXMiOiAiNjA0ODAwMDAwIiwgICMgNyAqIDI0ICog
MzYwMCAqIDEwMDAKICAgICAgICAgICAgICAgICJyZXBsaWNhdGlvbl9mYWN0b3IiOiAiMSIKICAg
ICAgICAgICAgfSwKICAgICAgICAgICAgIkNvbXBhY3RlZCBLViAoS2V5cytWYWx1ZXMpIjogewog
ICAgICAgICAgICAgICAgImNsZWFudXAucG9saWN5IjogImNvbXBhY3QiLAogICAgICAgICAgICAg
ICAgInNlZ21lbnQuYnl0ZXMiOiAiNjcxMDg4NjQiLCAgIyA2NE1CIGZvciBtb3JlIGZyZXF1ZW50
IGNvbXBhY3Rpb24KICAgICAgICAgICAgICAgICJtaW4uaW5zeW5jLnJlcGxpY2FzIjogIjEiCiAg
ICAgICAgICAgIH0sCiAgICAgICAgICAgICJIaWdoIER1cmFiaWxpdHkgKDMgcmVwbGljYXMpIjog
ewogICAgICAgICAgICAgICAgInJlcGxpY2F0aW9uX2ZhY3RvciI6ICIzIiwKICAgICAgICAgICAg
ICAgICJtaW4uaW5zeW5jLnJlcGxpY2FzIjogIjIiLAogICAgICAgICAgICAgICAgInJldGVudGlv
bi5tcyI6ICI2MDQ4MDAwMDAiICAjIERlZmF1bHQgNyBkYXlzCiAgICAgICAgICAgIH0KICAgICAg
ICB9CgogICAgICAgIHByZXNldF9uYW1lcyA9IGxpc3QoUFJFU0VUUy5rZXlzKCkpCgogICAgICAg
ICMgLS0tIEhlbHBlciBGdW5jdGlvbnMgLS0tCiAgICAgICAgZGVmIHBhcnNlX2ludChuYW1lLCBz
LCBtaW5fdmFsdWU9MSk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHYgPSBpbnQo
c3RyKHMpLnN0cmlwKCkpCiAgICAgICAgICAgICAgICBpZiB2IDwgbWluX3ZhbHVlOgogICAgICAg
ICAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoKQogICAgICAgICAgICAgICAgcmV0dXJuIHYs
IE5vbmUKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIHJldHVy
biBOb25lLCBmIntuYW1lfSBtdXN0IGJlIGFuIGludGVnZXIgPj0ge21pbl92YWx1ZX0iCgogICAg
ICAgIGRlZiBhZGRfY2ZnKGNmZywga2V5LCBlZGl0KToKICAgICAgICAgICAgdiA9IGVkaXQuZWRp
dF90ZXh0LnN0cmlwKCkKICAgICAgICAgICAgaWYgdiAhPSAiIjoKICAgICAgICAgICAgICAgIGNm
Z1trZXldID0gdgoKICAgICAgICAjIC0tLSBVSSBFbGVtZW50cyBEZWNsYXJhdGlvbnMgLS0tCiAg
ICAgICAgZGlhbG9nX3N0YXR1cyA9IHVyd2lkLlRleHQoIiIsIGFsaWduPSJjZW50ZXIiKQoKICAg
ICAgICBjbGFzcyBFZGl0V2l0aEVudGVyKHVyd2lkLkVkaXQpOgogICAgICAgICAgICBkZWYga2V5
cHJlc3Moc2VsZiwgc2l6ZSwga2V5KToKICAgICAgICAgICAgICAgIGlmIGtleSA9PSAnZW50ZXIn
OgogICAgICAgICAgICAgICAgICAgIG9uX2NyZWF0ZSgpCiAgICAgICAgICAgICAgICAgICAgcmV0
dXJuIE5vbmUKICAgICAgICAgICAgICAgIHJldHVybiBzdXBlcigpLmtleXByZXNzKHNpemUsIGtl
eSkKCiAgICAgICAgdG9waWNfZWRpdCA9IEVkaXRXaXRoRW50ZXIoIlRvcGljIG5hbWU6ICIsICIi
KQogICAgICAgIHBhcnRpdGlvbnNfZWRpdCA9IEVkaXRXaXRoRW50ZXIoIlBhcnRpdGlvbnM6ICIs
ICIxIikKICAgICAgICByZl9lZGl0ID0gRWRpdFdpdGhFbnRlcigiUmVwbGljYXRpb24gZmFjdG9y
OiAiLCAiMSIpCgogICAgICAgIGNsZWFudXBfcG9saWN5X2VkaXQgPSBFZGl0V2l0aEVudGVyKCJj
bGVhbnVwLnBvbGljeSAoZGVsZXRlfGNvbXBhY3QpOiAiLCAiIikKICAgICAgICByZXRlbnRpb25f
bXNfZWRpdCA9IEVkaXRXaXRoRW50ZXIoInJldGVudGlvbi5tczogIiwgIiIpCiAgICAgICAgcmV0
ZW50aW9uX2J5dGVzX2VkaXQgPSBFZGl0V2l0aEVudGVyKCJyZXRlbnRpb24uYnl0ZXM6ICIsICIi
KQogICAgICAgIHNlZ21lbnRfYnl0ZXNfZWRpdCA9IEVkaXRXaXRoRW50ZXIoInNlZ21lbnQuYnl0
ZXM6ICIsICIiKQogICAgICAgIG1pbl9pc3JfZWRpdCA9IEVkaXRXaXRoRW50ZXIoIm1pbi5pbnN5
bmMucmVwbGljYXM6ICIsICIiKQogICAgICAgIGNvbXByZXNzaW9uX3R5cGVfZWRpdCA9IEVkaXRX
aXRoRW50ZXIoImNvbXByZXNzaW9uLnR5cGU6ICIsICIiKQogICAgICAgIG1heF9tc2dfYnl0ZXNf
ZWRpdCA9IEVkaXRXaXRoRW50ZXIoIm1heC5tZXNzYWdlLmJ5dGVzOiAiLCAiIikKCiAgICAgICAg
IyAtLS0gRXZlbnQgSGFuZGxlcnMgLS0tCgogICAgICAgIGRlZiBvbl9wcmVzZXRfY2hhbmdlKHJi
LCBzdGF0ZSwgdXNlcl9kYXRhKToKICAgICAgICAgICAgaWYgbm90IHN0YXRlOiByZXR1cm4gICMg
T25seSBoYW5kbGUgJ3NlbGVjdCcgZXZlbnQKCiAgICAgICAgICAgIHByZXNldF9uYW1lID0gdXNl
cl9kYXRhCiAgICAgICAgICAgIGRhdGEgPSBQUkVTRVRTLmdldChwcmVzZXRfbmFtZSwge30pCgog
ICAgICAgICAgICAjIFJlc2V0L1NldCBmaWVsZHMgYmFzZWQgb24gcHJlc2V0CiAgICAgICAgICAg
IGlmICJjbGVhbnVwLnBvbGljeSIgaW4gZGF0YTogY2xlYW51cF9wb2xpY3lfZWRpdC5zZXRfZWRp
dF90ZXh0KGRhdGFbImNsZWFudXAucG9saWN5Il0pCiAgICAgICAgICAgIGlmICJyZXRlbnRpb24u
bXMiIGluIGRhdGE6IHJldGVudGlvbl9tc19lZGl0LnNldF9lZGl0X3RleHQoZGF0YVsicmV0ZW50
aW9uLm1zIl0pCiAgICAgICAgICAgIGlmICJyZXBsaWNhdGlvbl9mYWN0b3IiIGluIGRhdGE6IHJm
X2VkaXQuc2V0X2VkaXRfdGV4dChkYXRhWyJyZXBsaWNhdGlvbl9mYWN0b3IiXSkKICAgICAgICAg
ICAgaWYgInNlZ21lbnQuYnl0ZXMiIGluIGRhdGE6IHNlZ21lbnRfYnl0ZXNfZWRpdC5zZXRfZWRp
dF90ZXh0KGRhdGFbInNlZ21lbnQuYnl0ZXMiXSkKICAgICAgICAgICAgaWYgIm1pbi5pbnN5bmMu
cmVwbGljYXMiIGluIGRhdGE6IG1pbl9pc3JfZWRpdC5zZXRfZWRpdF90ZXh0KGRhdGFbIm1pbi5p
bnN5bmMucmVwbGljYXMiXSkKCiAgICAgICAgZGVmIG9uX2NyZWF0ZShidG49Tm9uZSk6CiAgICAg
ICAgICAgICMgQ2xlYXIgcHJldmlvdXMgZXJyb3JzCiAgICAgICAgICAgIGRpYWxvZ19zdGF0dXMu
c2V0X3RleHQoIiIpCgogICAgICAgICAgICBuYW1lID0gdG9waWNfZWRpdC5lZGl0X3RleHQuc3Ry
aXAoKQogICAgICAgICAgICBpZiBub3QgbmFtZToKICAgICAgICAgICAgICAgIGRpYWxvZ19zdGF0
dXMuc2V0X3RleHQoKCJlcnJvciIsICJFcnJvcjogVG9waWMgbmFtZSBpcyByZXF1aXJlZCIpKQog
ICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGlmIG5hbWUuc3RhcnRzd2l0aCgiX18i
KToKICAgICAgICAgICAgICAgIGRpYWxvZ19zdGF0dXMuc2V0X3RleHQoKCJlcnJvciIsICJFcnJv
cjogQ3JlYXRpbmcgaW50ZXJuYWwgdG9waWNzIChfXyopIGlzIGZvcmJpZGRlbiIpKQogICAgICAg
ICAgICAgICAgcmV0dXJuCgogICAgICAgICAgICBwYXJ0aXRpb25zLCBlcnIgPSBwYXJzZV9pbnQo
IlBhcnRpdGlvbnMiLCBwYXJ0aXRpb25zX2VkaXQuZWRpdF90ZXh0LCAxKQogICAgICAgICAgICBp
ZiBlcnI6CiAgICAgICAgICAgICAgICBkaWFsb2dfc3RhdHVzLnNldF90ZXh0KCgiZXJyb3IiLCBm
IkVycm9yOiB7ZXJyfSIpKQogICAgICAgICAgICAgICAgcmV0dXJuCgogICAgICAgICAgICByZiwg
ZXJyID0gcGFyc2VfaW50KCJSZXBsaWNhdGlvbiBmYWN0b3IiLCByZl9lZGl0LmVkaXRfdGV4dCwg
MSkKICAgICAgICAgICAgaWYgZXJyOgogICAgICAgICAgICAgICAgZGlhbG9nX3N0YXR1cy5zZXRf
dGV4dCgoImVycm9yIiwgZiJFcnJvcjoge2Vycn0iKSkKICAgICAgICAgICAgICAgIHJldHVybgoK
ICAgICAgICAgICAgdG9waWNfY29uZmlncyA9IHt9CiAgICAgICAgICAgIGFkZF9jZmcodG9waWNf
Y29uZmlncywgImNsZWFudXAucG9saWN5IiwgY2xlYW51cF9wb2xpY3lfZWRpdCkKICAgICAgICAg
ICAgYWRkX2NmZyh0b3BpY19jb25maWdzLCAicmV0ZW50aW9uLm1zIiwgcmV0ZW50aW9uX21zX2Vk
aXQpCiAgICAgICAgICAgIGFkZF9jZmcodG9waWNfY29uZmlncywgInJldGVudGlvbi5ieXRlcyIs
IHJldGVudGlvbl9ieXRlc19lZGl0KQogICAgICAgICAgICBhZGRfY2ZnKHRvcGljX2NvbmZpZ3Ms
ICJzZWdtZW50LmJ5dGVzIiwgc2VnbWVudF9ieXRlc19lZGl0KQogICAgICAgICAgICBhZGRfY2Zn
KHRvcGljX2NvbmZpZ3MsICJtaW4uaW5zeW5jLnJlcGxpY2FzIiwgbWluX2lzcl9lZGl0KQogICAg
ICAgICAgICBhZGRfY2ZnKHRvcGljX2NvbmZpZ3MsICJjb21wcmVzc2lvbi50eXBlIiwgY29tcHJl
c3Npb25fdHlwZV9lZGl0KQogICAgICAgICAgICBhZGRfY2ZnKHRvcGljX2NvbmZpZ3MsICJtYXgu
bWVzc2FnZS5ieXRlcyIsIG1heF9tc2dfYnl0ZXNfZWRpdCkKCiAgICAgICAgICAgICMgLS0tIFNh
ZmV0eSBDaGVjazogSW5maW5pdGUgUmV0ZW50aW9uIC0tLQogICAgICAgICAgICByZXRfbXMgPSB0
b3BpY19jb25maWdzLmdldCgicmV0ZW50aW9uLm1zIiwgIiIpLnN0cmlwKCkKICAgICAgICAgICAg
cmV0X2J5dGVzID0gdG9waWNfY29uZmlncy5nZXQoInJldGVudGlvbi5ieXRlcyIsICIiKS5zdHJp
cCgpCgogICAgICAgICAgICBpZiByZXRfbXMgPT0gIi0xIjoKICAgICAgICAgICAgICAgICMg0JXR
gdC70Lgg0LLRgNC10LzRjyDRhdGA0LDQvdC10L3QuNGPINC+0YLQutC70Y7Rh9C10L3Qviwg0LzR
iyDQntCR0K/Ql9CQ0J3QqyDQuNC80LXRgtGMINC70LjQvNC40YIg0L/QviDRgNCw0LfQvNC10YDR
gwogICAgICAgICAgICAgICAgaWYgbm90IHJldF9ieXRlcyBvciByZXRfYnl0ZXMgPT0gIi0xIjoK
ICAgICAgICAgICAgICAgICAgICBkaWFsb2dfc3RhdHVzLnNldF90ZXh0KCgiZXJyb3IiLCAiRXJy
b3I6IHJldGVudGlvbi5tcz0tMSByZXF1aXJlcyBleHBsaWNpdCByZXRlbnRpb24uYnl0ZXMgPiAw
IikpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCgogICAgICAgICAgICB0cnk6CiAgICAgICAg
ICAgICAgICBpZiBub3Qgc2VsZi5hZG1pbl9jbGllbnQ6CiAgICAgICAgICAgICAgICAgICAgc2Vs
Zi5faW5pdF9hZG1pbl9jbGllbnQoKQogICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuYWRtaW5f
Y2xpZW50OgogICAgICAgICAgICAgICAgICAgIGRpYWxvZ19zdGF0dXMuc2V0X3RleHQoKCJlcnJv
ciIsICJFcnJvcjogQWRtaW4gY2xpZW50IGlzIG5vdCBpbml0aWFsaXplZCIpKQogICAgICAgICAg
ICAgICAgICAgIHJldHVybgoKICAgICAgICAgICAgICAgIG5ld190b3BpYyA9IE5ld1RvcGljKAog
ICAgICAgICAgICAgICAgICAgIG5hbWU9bmFtZSwKICAgICAgICAgICAgICAgICAgICBudW1fcGFy
dGl0aW9ucz1wYXJ0aXRpb25zLAogICAgICAgICAgICAgICAgICAgIHJlcGxpY2F0aW9uX2ZhY3Rv
cj1yZiwKICAgICAgICAgICAgICAgICAgICB0b3BpY19jb25maWdzPXRvcGljX2NvbmZpZ3Mgb3Ig
Tm9uZQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgc2VsZi5hZG1pbl9jbGllbnQu
Y3JlYXRlX3RvcGljcyhbbmV3X3RvcGljXSwgdmFsaWRhdGVfb25seT1GYWxzZSkKICAgICAgICAg
ICAgICAgIHNlbGYuX2Nsb3NlX2RpYWxvZygpCiAgICAgICAgICAgICAgICBzZWxmLl9mZXRjaF90
b3BpY3MoKQogICAgICAgICAgICAgICAgc2VsZi5fc2V0X3N0YXR1cyhmIlRvcGljIGNyZWF0ZWQ6
IHtuYW1lfSIpCiAgICAgICAgICAgIGV4Y2VwdCBUb3BpY0FscmVhZHlFeGlzdHNFcnJvcjoKICAg
ICAgICAgICAgICAgIGRpYWxvZ19zdGF0dXMuc2V0X3RleHQoKCJlcnJvciIsIGYiRXJyb3I6IFRv
cGljICd7bmFtZX0nIGFscmVhZHkgZXhpc3RzIikpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRp
b24gYXMgZToKICAgICAgICAgICAgICAgIGRpYWxvZ19zdGF0dXMuc2V0X3RleHQoKCJlcnJvciIs
IGYiRXJyb3IgY3JlYXRpbmcgdG9waWM6IHtlfSIpKQoKICAgICAgICBkZWYgb25fY2FuY2VsKGJ0
bj1Ob25lKToKICAgICAgICAgICAgc2VsZi5fY2xvc2VfZGlhbG9nKCkKCiAgICAgICAgIyAtLS0g
VUkgQXNzZW1ibHkgLS0tCgogICAgICAgICMgUHJlc2V0IFJhZGlvIEJ1dHRvbnMKICAgICAgICBw
cmVzZXRfZ3JvdXAgPSBbXQogICAgICAgIHByZXNldF9waWxlX2l0ZW1zID0gW3Vyd2lkLlRleHQo
IlNlbGVjdCBQcmVzZXQ6IildCiAgICAgICAgZm9yIHBuYW1lIGluIHByZXNldF9uYW1lczoKICAg
ICAgICAgICAgcmIgPSB1cndpZC5SYWRpb0J1dHRvbihwcmVzZXRfZ3JvdXAsIHBuYW1lLCBvbl9z
dGF0ZV9jaGFuZ2U9b25fcHJlc2V0X2NoYW5nZSwgdXNlcl9kYXRhPXBuYW1lKQogICAgICAgICAg
ICBwcmVzZXRfcGlsZV9pdGVtcy5hcHBlbmQocmIpCgogICAgICAgIHByZXNldF9ib3ggPSB1cndp
ZC5MaW5lQm94KHVyd2lkLlBpbGUocHJlc2V0X3BpbGVfaXRlbXMpKQoKICAgICAgICBjbGFzcyBD
cmVhdGVQaWxlKHVyd2lkLlBpbGUpOgogICAgICAgICAgICBkZWYga2V5cHJlc3Moc2VsZiwgc2l6
ZSwga2V5KToKICAgICAgICAgICAgICAgICMg0JTQu9GPINGE0L7RgNC8INCy0LLQvtC00LAg0YLQ
tdC60YHRgtCwINGD0LHQuNGA0LDQtdC8ICdxJyDQuCAnUScg0LjQtyDQutC70LDQstC40Ygg0LfQ
sNC60YDRi9GC0LjRjywKICAgICAgICAgICAgICAgICMg0YLQsNC6INC60LDQuiDQvtC90Lgg0L3R
g9C20L3RiyDQtNC70Y8g0LLQstC+0LTQsC4g0J7RgdGC0LDQstC70Y/QtdC8INGC0L7Qu9GM0LrQ
viAnZXNjJy4KICAgICAgICAgICAgICAgIGlmIGtleSA9PSAnZXNjJzoKICAgICAgICAgICAgICAg
ICAgICBvbl9jYW5jZWwoKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAg
ICAgICAgICByZXR1cm4gc3VwZXIoKS5rZXlwcmVzcyhzaXplLCBrZXkpCgoKICAgICAgICBwaWxl
ID0gQ3JlYXRlUGlsZShbCiAgICAgICAgICAgIHVyd2lkLlRleHQoIkNyZWF0ZSBUb3BpYyBDb25m
aWd1cmF0b3IiKSwKICAgICAgICAgICAgdXJ3aWQuRGl2aWRlcigpLAogICAgICAgICAgICBwcmVz
ZXRfYm94LAogICAgICAgICAgICB1cndpZC5EaXZpZGVyKCksCiAgICAgICAgICAgIHRvcGljX2Vk
aXQsCiAgICAgICAgICAgIHBhcnRpdGlvbnNfZWRpdCwKICAgICAgICAgICAgcmZfZWRpdCwKICAg
ICAgICAgICAgdXJ3aWQuRGl2aWRlcigpLAogICAgICAgICAgICB1cndpZC5UZXh0KCJBZHZhbmNl
ZCBDb25maWdzIChBdXRvLWZpbGxlZCBieSBwcmVzZXQpOiIpLAogICAgICAgICAgICBjbGVhbnVw
X3BvbGljeV9lZGl0LAogICAgICAgICAgICByZXRlbnRpb25fbXNfZWRpdCwKICAgICAgICAgICAg
cmV0ZW50aW9uX2J5dGVzX2VkaXQsCiAgICAgICAgICAgIHNlZ21lbnRfYnl0ZXNfZWRpdCwKICAg
ICAgICAgICAgbWluX2lzcl9lZGl0LAogICAgICAgICAgICBjb21wcmVzc2lvbl90eXBlX2VkaXQs
CiAgICAgICAgICAgIG1heF9tc2dfYnl0ZXNfZWRpdCwKICAgICAgICAgICAgdXJ3aWQuRGl2aWRl
cigpLAogICAgICAgICAgICBkaWFsb2dfc3RhdHVzLCAgIyBFcnJvciBtZXNzYWdlcyB3aWxsIGFw
cGVhciBoZXJlCiAgICAgICAgICAgIHVyd2lkLkRpdmlkZXIoKSwKICAgICAgICAgICAgdXJ3aWQu
QXR0ck1hcCh1cndpZC5CdXR0b24oIkNyZWF0ZSIsIG9uX3ByZXNzPW9uX2NyZWF0ZSksICJidG4i
LCBmb2N1c19tYXA9ImJ0bl9mb2N1cyIpLAogICAgICAgICAgICB1cndpZC5BdHRyTWFwKHVyd2lk
LkJ1dHRvbigiQ2FuY2VsIiwgb25fcHJlc3M9b25fY2FuY2VsKSwgImJ0biIsIGZvY3VzX21hcD0i
YnRuX2ZvY3VzIiksCiAgICAgICAgXSkKCiAgICAgICAgc2VsZi5fc2hvd19kaWFsb2cocGlsZSwg
IkNyZWF0ZSBUb3BpYyIpCgogICAgIyAtLS0tLSBVSSAtLS0tLQoKICAgIGRlZiBfc2V0X3N0YXR1
cyhzZWxmLCBleHRyYT0iIik6CiAgICAgICAgc3AgPSBzZWxmLmNvbm5lY3Rpb25fcGFyYW1zLmdl
dCgic2VjdXJpdHlfcHJvdG9jb2wiLCAiUExBSU5URVhUIikKICAgICAgICB0b3BpY19wYXJ0ID0g
ZiJUb3BpYzoge3NlbGYuY3VycmVudF90b3BpY30gfCAiIGlmIHNlbGYuY3VycmVudF90b3BpYyBl
bHNlICIiCiAgICAgICAgZm9jdXNfc2lkZSA9ICJUb3BpY3MiIGlmIHNlbGYuY29sdW1ucyBhbmQg
c2VsZi5jb2x1bW5zLmZvY3VzX3Bvc2l0aW9uID09IDAgZWxzZSAiTWVzc2FnZXMiCiAgICAgICAg
bXNnX2luZm8gPSBzZWxmLl9tZXNzYWdlX3Bvc2l0aW9uX3N0cmluZygpCiAgICAgICAgc3RhdHVz
ID0gKAogICAgICAgICAgICBmIntmb2N1c19zaWRlfSB8IFByb2ZpbGU6IHtzZWxmLnByb2ZpbGVf
bmFtZX0gfCB7dG9waWNfcGFydH17c3B9IHwge21zZ19pbmZvfSB8ICIKICAgICAgICAgICAgIk46
TmV3VG9waWMgRzpHcm91cHMgRW50ZXI6VmlldyBGMjpJbmZvIEYzOkFDTCBGNDpBQ0xNZW51IEY3
OkZpbHRlciBTOlNvcnQgTzpPZmZzZXRzIFA6UHJvZHVjZSBSOlJlZnJlc2ggUTpRdWl0IgogICAg
ICAgICkKICAgICAgICBpZiBleHRyYToKICAgICAgICAgICAgc3RhdHVzICs9IGYiIHwge2V4dHJh
fSIKICAgICAgICBzZWxmLnN0YXR1c190ZXh0LnNldF90ZXh0KHN0YXR1cykKCiAgICBkZWYgX3Vw
ZGF0ZV90b3BpY3NfdGl0bGUoc2VsZik6CiAgICAgICAgIiIiVXBkYXRlIHRvcGljcyBwYW5lbCB0
aXRsZSB3aXRoIGN1cnJlbnQgZmlsdGVyIiIiCiAgICAgICAgaWYgc2VsZi50b3BpY19maWx0ZXI6
CiAgICAgICAgICAgIHNlbGYudG9waWNzX2JveC5zZXRfdGl0bGUoZiJUb3BpY3M6ICp7c2VsZi50
b3BpY19maWx0ZXJ9KiIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi50b3BpY3NfYm94
LnNldF90aXRsZSgiVG9waWNzIikKCiAgICBkZWYgX2FwcGx5X21lc3NhZ2VfZmlsdGVycyhzZWxm
KToKICAgICAgICAiIiJBcHBseSBmaWx0ZXJzIHRvIG1lc3NhZ2VzIGFuZCB1cGRhdGUgZGlzcGxh
eSIiIgogICAgICAgIGlmIG5vdCBzZWxmLmFsbF9tZXNzYWdlczoKICAgICAgICAgICAgcmV0dXJu
CgogICAgICAgICMgRmlsdGVyIG1lc3NhZ2VzCiAgICAgICAgZmlsdGVyZWRfbWVzc2FnZXMgPSBb
XQogICAgICAgIGZvciBtc2dfaXRlbSwgbXNnX3JvdyBpbiBzZWxmLmFsbF9tZXNzYWdlczoKICAg
ICAgICAgICAgIyBDaGVjayBlYWNoIGZpbHRlcgogICAgICAgICAgICBtYXRjaCA9IFRydWUKCiAg
ICAgICAgICAgICMgS2V5IGZpbHRlcgogICAgICAgICAgICBpZiBzZWxmLm1zZ19maWx0ZXJzWyJr
ZXkiXToKICAgICAgICAgICAgICAgIGtleV9zdHIgPSAobXNnX3Jvdy5rZXkgb3IgIiIpLmxvd2Vy
KCkKICAgICAgICAgICAgICAgIGlmIHNlbGYubXNnX2ZpbHRlcnNbImtleSJdLmxvd2VyKCkgbm90
IGluIGtleV9zdHI6CiAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSBGYWxzZQoKICAgICAgICAg
ICAgIyBWYWx1ZSBmaWx0ZXIKICAgICAgICAgICAgaWYgbWF0Y2ggYW5kIHNlbGYubXNnX2ZpbHRl
cnNbInZhbHVlIl06CiAgICAgICAgICAgICAgICB2YWx1ZV9zdHIgPSAobXNnX3Jvdy5mdWxsX3Rl
eHQgb3IgIiIpLmxvd2VyKCkKICAgICAgICAgICAgICAgIGlmIHNlbGYubXNnX2ZpbHRlcnNbInZh
bHVlIl0ubG93ZXIoKSBub3QgaW4gdmFsdWVfc3RyOgogICAgICAgICAgICAgICAgICAgIG1hdGNo
ID0gRmFsc2UKCiAgICAgICAgICAgICMgUGFydGl0aW9uIGZpbHRlcgogICAgICAgICAgICBpZiBt
YXRjaCBhbmQgc2VsZi5tc2dfZmlsdGVyc1sicGFydGl0aW9uIl06CiAgICAgICAgICAgICAgICBw
YXJ0aXRpb25fc3RyID0gc3RyKG1zZ19yb3cucGFydGl0aW9uKQogICAgICAgICAgICAgICAgaWYg
c2VsZi5tc2dfZmlsdGVyc1sicGFydGl0aW9uIl0gbm90IGluIHBhcnRpdGlvbl9zdHI6CiAgICAg
ICAgICAgICAgICAgICAgbWF0Y2ggPSBGYWxzZQoKICAgICAgICAgICAgIyBPZmZzZXQgZmlsdGVy
CiAgICAgICAgICAgIGlmIG1hdGNoIGFuZCBzZWxmLm1zZ19maWx0ZXJzWyJvZmZzZXQiXToKICAg
ICAgICAgICAgICAgIG9mZnNldF9zdHIgPSBzdHIobXNnX3Jvdy5vZmZzZXQpCiAgICAgICAgICAg
ICAgICBpZiBzZWxmLm1zZ19maWx0ZXJzWyJvZmZzZXQiXSBub3QgaW4gb2Zmc2V0X3N0cjoKICAg
ICAgICAgICAgICAgICAgICBtYXRjaCA9IEZhbHNlCgogICAgICAgICAgICBpZiBtYXRjaDoKICAg
ICAgICAgICAgICAgIGZpbHRlcmVkX21lc3NhZ2VzLmFwcGVuZCgobXNnX2l0ZW0sIG1zZ19yb3cp
KQoKICAgICAgICAjIFJlYnVpbGQgd2Fsa2VyIHdpdGggZmlsdGVyZWQgbWVzc2FnZXMKICAgICAg
ICBzZWxmLm1zZ193YWxrZXIuY2xlYXIoKQoKICAgICAgICAjIEFkZCBoZWFkZXIKICAgICAgICBo
ZWFkZXJfbGluZSA9IGYieydUaW1lc3RhbXAnOjwyOH0geydUb3BpYyc6PDEzfSB7J09mZnNldCc6
PDEwfSB7J1NpemUnOjw4fSB7J0tleSc6PDEyfSBWYWx1ZSIKICAgICAgICBoZWFkZXJfd2lkZ2V0
ID0gdXJ3aWQuVGV4dChoZWFkZXJfbGluZSkKICAgICAgICBzZWxmLm1zZ193YWxrZXIuYXBwZW5k
KHVyd2lkLkF0dHJNYXAoaGVhZGVyX3dpZGdldCwgImhlYWRlciIpKQoKICAgICAgICAjIEFkZCBm
aWx0ZXJlZCBtZXNzYWdlcwogICAgICAgIGZvciBtc2dfaXRlbSwgbXNnX3JvdyBpbiBmaWx0ZXJl
ZF9tZXNzYWdlczoKICAgICAgICAgICAgc2VsZi5tc2dfd2Fsa2VyLmFwcGVuZChtc2dfaXRlbSkK
CiAgICAgICAgIyBGb3JtYXQgYW5kIHNvcnQKICAgICAgICBzZWxmLm1zZ19saXN0Ym94LmZvcm1h
dF9hbGxfbWVzc2FnZXMoKQoKICAgICAgICBpZiBzZWxmLnNvcnRfbW9kZSAhPSAidW5zb3J0ZWQi
OgogICAgICAgICAgICBzZWxmLl9zb3J0X21lc3NhZ2VzKCkKCiAgICAgICAgIyBVcGRhdGUgdGl0
bGUKICAgICAgICBzZWxmLl91cGRhdGVfbWVzc2FnZXNfdGl0bGUoKQoKICAgICAgICAjIFNldCBm
b2N1cwogICAgICAgIGlmIGxlbihzZWxmLm1zZ193YWxrZXIpID4gMToKICAgICAgICAgICAgc2Vs
Zi5tc2dfbGlzdGJveC5zZXRfZm9jdXMoMSkKCiAgICBkZWYgX2J1aWxkX3VpKHNlbGYpOgogICAg
ICAgIGZvb3RlciA9IHVyd2lkLkF0dHJNYXAoc2VsZi5zdGF0dXNfdGV4dCwgImZvb3RlciIpCiAg
ICAgICAgIyBDcmVhdGUgdG9waWNzIGJveCB3aXRoIGR5bmFtaWMgdGl0bGUKICAgICAgICBzZWxm
LnRvcGljc19ib3hfd2lkZ2V0ID0gdXJ3aWQuQXR0ck1hcChzZWxmLnRvcGljX2xpc3Rib3gsICJi
b2R5IikKICAgICAgICBzZWxmLnRvcGljc19ib3ggPSB1cndpZC5MaW5lQm94KAogICAgICAgICAg
ICBzZWxmLnRvcGljc19ib3hfd2lkZ2V0LAogICAgICAgICAgICB0aXRsZT0iVG9waWNzIiwKICAg
ICAgICApCiAgICAgICAgIyBDcmVhdGUgbWVzc2FnZXMgYm94IHdpdGggZHluYW1pYyB0aXRsZQog
ICAgICAgIHNlbGYubXNnc19ib3hfd2lkZ2V0ID0gdXJ3aWQuQXR0ck1hcChzZWxmLm1zZ19saXN0
Ym94LCAiYm9keSIpCiAgICAgICAgc2VsZi5tc2dzX2JveCA9IHVyd2lkLkxpbmVCb3goCiAgICAg
ICAgICAgIHNlbGYubXNnc19ib3hfd2lkZ2V0LAogICAgICAgICAgICB0aXRsZT0iTWVzc2FnZXMi
LAogICAgICAgICkKICAgICAgICBzZWxmLmNvbHVtbnMgPSB1cndpZC5Db2x1bW5zKAogICAgICAg
ICAgICBbCiAgICAgICAgICAgICAgICAoMjAsIHNlbGYudG9waWNzX2JveCksICAjIEZpeGVkIHdp
ZHRoIDIwIGZvciB0b3BpY3MKICAgICAgICAgICAgICAgICgid2VpZ2h0IiwgMSwgc2VsZi5tc2dz
X2JveCkgICMgTWVzc2FnZXMgdGFrZSByZW1haW5pbmcgc3BhY2UKICAgICAgICAgICAgXSwKICAg
ICAgICAgICAgZGl2aWRlY2hhcnM9MSwKICAgICAgICAgICAgZm9jdXNfY29sdW1uPTAsCiAgICAg
ICAgKQogICAgICAgIHNlbGYubWFpbl9mcmFtZSA9IHVyd2lkLkF0dHJNYXAodXJ3aWQuRnJhbWUo
c2VsZi5jb2x1bW5zLCBmb290ZXI9Zm9vdGVyKSwgImJvZHkiKQogICAgICAgIHNlbGYuX3NldF9z
dGF0dXMoKQoKICAgIGRlZiBfdXBkYXRlX21lc3NhZ2VzX3RpdGxlKHNlbGYpOgogICAgICAgICIi
IlVwZGF0ZSBtZXNzYWdlcyBwYW5lbCB0aXRsZSB3aXRoIGN1cnJlbnQgc29ydCBtb2RlIGFuZCBm
aWx0ZXJzIiIiCiAgICAgICAgdGl0bGVfcGFydHMgPSBbIk1lc3NhZ2VzIl0KCiAgICAgICAgIyBB
ZGQgc29ydCBpbmZvCiAgICAgICAgaWYgc2VsZi5zb3J0X21vZGUgIT0gInVuc29ydGVkIjoKICAg
ICAgICAgICAgZGlyZWN0aW9uID0gIuKGkSIgaWYgc2VsZi5zb3J0X2FzY2VuZGluZyBlbHNlICLi
hpMiCiAgICAgICAgICAgIHNvcnRfbmFtZXMgPSB7CiAgICAgICAgICAgICAgICAidGltZXN0YW1w
IjogIlRpbWUiLAogICAgICAgICAgICAgICAgInBhcnRpdGlvbiI6ICJQYXJ0IiwKICAgICAgICAg
ICAgICAgICJzaXplIjogIlNpemUiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGl0bGVfcGFy
dHMuYXBwZW5kKGYiW3tzb3J0X25hbWVzLmdldChzZWxmLnNvcnRfbW9kZSwgc2VsZi5zb3J0X21v
ZGUpfXtkaXJlY3Rpb259XSIpCgogICAgICAgICMgQWRkIGZpbHRlciBpbmZvCiAgICAgICAgYWN0
aXZlX2ZpbHRlcnMgPSBbXQogICAgICAgIGZvciBmaWVsZCwgbWFzayBpbiBzZWxmLm1zZ19maWx0
ZXJzLml0ZW1zKCk6CiAgICAgICAgICAgIGlmIG1hc2s6CiAgICAgICAgICAgICAgICBhY3RpdmVf
ZmlsdGVycy5hcHBlbmQoZiJ7ZmllbGR9Oip7bWFza30qIikKCiAgICAgICAgaWYgYWN0aXZlX2Zp
bHRlcnM6CiAgICAgICAgICAgIHRpdGxlX3BhcnRzLmFwcGVuZChmIkZpbHRlcjogeycsICcuam9p
bihhY3RpdmVfZmlsdGVycyl9IikKCiAgICAgICAgc2VsZi5tc2dzX2JveC5zZXRfdGl0bGUoIiAi
LmpvaW4odGl0bGVfcGFydHMpKQoKICAgIGRlZiBfc29ydF9tZXNzYWdlcyhzZWxmKToKICAgICAg
ICAiIiJTb3J0IG1lc3NhZ2VzIGJhc2VkIG9uIGN1cnJlbnQgc29ydCBtb2RlIGFuZCBkaXJlY3Rp
b24iIiIKICAgICAgICBpZiBub3Qgc2VsZi5tc2dfd2Fsa2VyIG9yIGxlbihzZWxmLm1zZ193YWxr
ZXIpIDw9IDE6CiAgICAgICAgICAgIHJldHVybgoKICAgICAgICAjIFNlcGFyYXRlIGhlYWRlciBm
cm9tIG1lc3NhZ2VzCiAgICAgICAgaGVhZGVyID0gTm9uZQogICAgICAgIG1lc3NhZ2VzID0gW10K
CiAgICAgICAgZm9yIGksIGl0ZW0gaW4gZW51bWVyYXRlKHNlbGYubXNnX3dhbGtlcik6CiAgICAg
ICAgICAgIGlmIGlzaW5zdGFuY2UoaXRlbSwgdXJ3aWQuQXR0ck1hcCk6CiAgICAgICAgICAgICAg
ICB3aWRnZXQgPSBpdGVtLm9yaWdpbmFsX3dpZGdldAogICAgICAgICAgICAgICAgaWYgaXNpbnN0
YW5jZSh3aWRnZXQsIE1zZ1Jvdyk6CiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZXMuYXBwZW5k
KChpLCBpdGVtLCB3aWRnZXQpKQogICAgICAgICAgICAgICAgZWxpZiBpID09IDA6CiAgICAgICAg
ICAgICAgICAgICAgaGVhZGVyID0gaXRlbQoKICAgICAgICBpZiBub3QgbWVzc2FnZXM6CiAgICAg
ICAgICAgIHJldHVybgoKICAgICAgICAjIFNvcnQgbWVzc2FnZXMgYmFzZWQgb24gbW9kZQogICAg
ICAgIGlmIHNlbGYuc29ydF9tb2RlID09ICJ0aW1lc3RhbXAiOgogICAgICAgICAgICBtZXNzYWdl
cy5zb3J0KGtleT1sYW1iZGEgeDogeFsyXS50aW1lc3RhbXAgaWYgeFsyXS50aW1lc3RhbXAgZWxz
ZSAwLCByZXZlcnNlPW5vdCBzZWxmLnNvcnRfYXNjZW5kaW5nKQogICAgICAgIGVsaWYgc2VsZi5z
b3J0X21vZGUgPT0gInBhcnRpdGlvbiI6CiAgICAgICAgICAgIG1lc3NhZ2VzLnNvcnQoa2V5PWxh
bWJkYSB4OiAoeFsyXS5wYXJ0aXRpb24sIHhbMl0ub2Zmc2V0KSwgcmV2ZXJzZT1ub3Qgc2VsZi5z
b3J0X2FzY2VuZGluZykKICAgICAgICBlbGlmIHNlbGYuc29ydF9tb2RlID09ICJzaXplIjoKICAg
ICAgICAgICAgbWVzc2FnZXMuc29ydChrZXk9bGFtYmRhIHg6IGxlbigoeFsyXS5mdWxsX3RleHQg
b3IgIiIpLmVuY29kZSgndXRmLTgnKSksIHJldmVyc2U9bm90IHNlbGYuc29ydF9hc2NlbmRpbmcp
CiAgICAgICAgIyAidW5zb3J0ZWQiIGtlZXBzIG9yaWdpbmFsIG9yZGVyIChwYXJ0aXRpb24sIG9m
ZnNldCkKICAgICAgICBlbGlmIHNlbGYuc29ydF9tb2RlID09ICJ1bnNvcnRlZCI6CiAgICAgICAg
ICAgIG1lc3NhZ2VzLnNvcnQoa2V5PWxhbWJkYSB4OiAoeFsyXS5wYXJ0aXRpb24sIHhbMl0ub2Zm
c2V0KSwgcmV2ZXJzZT1GYWxzZSkKCiAgICAgICAgIyBSZWJ1aWxkIHdhbGtlcgogICAgICAgIHNl
bGYubXNnX3dhbGtlci5jbGVhcigpCiAgICAgICAgaWYgaGVhZGVyOgogICAgICAgICAgICBzZWxm
Lm1zZ193YWxrZXIuYXBwZW5kKGhlYWRlcikKCiAgICAgICAgZm9yIF8sIGl0ZW0sIF8gaW4gbWVz
c2FnZXM6CiAgICAgICAgICAgIHNlbGYubXNnX3dhbGtlci5hcHBlbmQoaXRlbSkKCiAgICAgICAg
IyBTZXQgZm9jdXMgdG8gZmlyc3QgbWVzc2FnZSAoc2tpcCBoZWFkZXIpCiAgICAgICAgaWYgbGVu
KHNlbGYubXNnX3dhbGtlcikgPiAxOgogICAgICAgICAgICBzZWxmLm1zZ19saXN0Ym94LnNldF9m
b2N1cygxKQoKICAgIGRlZiBfc2hvd190b3BpY19hY2xzKHNlbGYsIHRvcGljKToKICAgICAgICAi
IiJEaXNwbGF5IEFDTHMgZm9yIGEgc3BlY2lmaWMgdG9waWMsIGluY2x1ZGluZyB3aWxkY2FyZCBt
YXRjaGVzIiIiCiAgICAgICAgaWYgbm90IHRvcGljOgogICAgICAgICAgICByZXR1cm4KCiAgICAg
ICAgdHJ5OgogICAgICAgICAgICBmcm9tIGthZmthLmFkbWluLmFjbF9yZXNvdXJjZSBpbXBvcnQg
KAogICAgICAgICAgICAgICAgQUNMRmlsdGVyLCBSZXNvdXJjZVBhdHRlcm4sIFJlc291cmNlVHlw
ZSwKICAgICAgICAgICAgICAgIEFDTE9wZXJhdGlvbiwgQUNMUGVybWlzc2lvblR5cGUsIEFDTFJl
c291cmNlUGF0dGVyblR5cGUKICAgICAgICAgICAgKQoKICAgICAgICAgICAgc2VsZi5jdXJyZW50
X2FjbF90b3BpYyA9IHRvcGljCgogICAgICAgICAgICBhbGxfbWF0Y2hpbmdfYWNscyA9IFtdCgog
ICAgICAgICAgICAjIDEuIEdldCBBQ0xzIHdpdGggTElURVJBTCBwYXR0ZXJuIGZvciBleGFjdCB0
b3BpYyBuYW1lCiAgICAgICAgICAgIGxpdGVyYWxfZmlsdGVyID0gQUNMRmlsdGVyKAogICAgICAg
ICAgICAgICAgcHJpbmNpcGFsPU5vbmUsCiAgICAgICAgICAgICAgICBob3N0PU5vbmUsCiAgICAg
ICAgICAgICAgICBvcGVyYXRpb249QUNMT3BlcmF0aW9uLkFOWSwKICAgICAgICAgICAgICAgIHBl
cm1pc3Npb25fdHlwZT1BQ0xQZXJtaXNzaW9uVHlwZS5BTlksCiAgICAgICAgICAgICAgICByZXNv
dXJjZV9wYXR0ZXJuPVJlc291cmNlUGF0dGVybigKICAgICAgICAgICAgICAgICAgICBSZXNvdXJj
ZVR5cGUuVE9QSUMsCiAgICAgICAgICAgICAgICAgICAgdG9waWMsCiAgICAgICAgICAgICAgICAg
ICAgQUNMUmVzb3VyY2VQYXR0ZXJuVHlwZS5MSVRFUkFMCiAgICAgICAgICAgICAgICApCiAgICAg
ICAgICAgICkKCiAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYuYWRtaW5fY2xpZW50LmRlc2NyaWJl
X2FjbHMobGl0ZXJhbF9maWx0ZXIpCiAgICAgICAgICAgIGxpdGVyYWxfYWNscyA9IHJlc3VsdFsw
XSBpZiBpc2luc3RhbmNlKHJlc3VsdCwgdHVwbGUpIGVsc2UgcmVzdWx0CiAgICAgICAgICAgIGxp
dGVyYWxfYWNscyA9IGxpdGVyYWxfYWNscyBpZiBpc2luc3RhbmNlKGxpdGVyYWxfYWNscywgbGlz
dCkgZWxzZSBbXQoKICAgICAgICAgICAgYWxsX21hdGNoaW5nX2FjbHMuZXh0ZW5kKGxpdGVyYWxf
YWNscykKCiAgICAgICAgICAgICMgMi4gR2V0IEFMTCB0b3BpYyBBQ0xzIHRvIGZpbmQgd2lsZGNh
cmQgbWF0Y2hlcwogICAgICAgICAgICBmcm9tIGthZmthLmFkbWluLmFjbF9yZXNvdXJjZSBpbXBv
cnQgUmVzb3VyY2VQYXR0ZXJuRmlsdGVyCgogICAgICAgICAgICBhbGxfdG9waWNzX2ZpbHRlciA9
IEFDTEZpbHRlcigKICAgICAgICAgICAgICAgIHByaW5jaXBhbD1Ob25lLAogICAgICAgICAgICAg
ICAgaG9zdD1Ob25lLAogICAgICAgICAgICAgICAgb3BlcmF0aW9uPUFDTE9wZXJhdGlvbi5BTlks
CiAgICAgICAgICAgICAgICBwZXJtaXNzaW9uX3R5cGU9QUNMUGVybWlzc2lvblR5cGUuQU5ZLAog
ICAgICAgICAgICAgICAgcmVzb3VyY2VfcGF0dGVybj1SZXNvdXJjZVBhdHRlcm5GaWx0ZXIoCiAg
ICAgICAgICAgICAgICAgICAgUmVzb3VyY2VUeXBlLlRPUElDLAogICAgICAgICAgICAgICAgICAg
IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgQUNMUmVzb3VyY2VQYXR0ZXJuVHlwZS5BTlkKICAg
ICAgICAgICAgICAgICkKICAgICAgICAgICAgKQoKICAgICAgICAgICAgcmVzdWx0ID0gc2VsZi5h
ZG1pbl9jbGllbnQuZGVzY3JpYmVfYWNscyhhbGxfdG9waWNzX2ZpbHRlcikKICAgICAgICAgICAg
YWxsX3RvcGljX2FjbHMgPSByZXN1bHRbMF0gaWYgaXNpbnN0YW5jZShyZXN1bHQsIHR1cGxlKSBl
bHNlIHJlc3VsdAogICAgICAgICAgICBhbGxfdG9waWNfYWNscyA9IGFsbF90b3BpY19hY2xzIGlm
IGlzaW5zdGFuY2UoYWxsX3RvcGljX2FjbHMsIGxpc3QpIGVsc2UgW10KCiAgICAgICAgICAgICMg
My4gRmlsdGVyIEFDTHMgdGhhdCBtYXRjaCB0aGlzIHRvcGljIGJ5IHdpbGRjYXJkCiAgICAgICAg
ICAgIHNlZW5fYWNscyA9IHNldCgpICAjIFRvIGF2b2lkIGR1cGxpY2F0ZXMKICAgICAgICAgICAg
Zm9yIGFjbCBpbiBsaXRlcmFsX2FjbHM6CiAgICAgICAgICAgICAgICBhY2xfaWQgPSBmIntnZXRh
dHRyKGFjbCwgJ3ByaW5jaXBhbCcsICcnKX1fe2dldGF0dHIoYWNsLCAnb3BlcmF0aW9uJywgJycp
fV97Z2V0YXR0cihhY2wsICdwZXJtaXNzaW9uX3R5cGUnLCAnJyl9X3tnZXRhdHRyKGFjbC5yZXNv
dXJjZV9wYXR0ZXJuLCAncmVzb3VyY2VfbmFtZScsICcnKX0iCiAgICAgICAgICAgICAgICBzZWVu
X2FjbHMuYWRkKGFjbF9pZCkKCiAgICAgICAgICAgIGZvciBhY2wgaW4gYWxsX3RvcGljX2FjbHM6
CiAgICAgICAgICAgICAgICBpZiBub3QgaGFzYXR0cihhY2wsICdyZXNvdXJjZV9wYXR0ZXJuJyk6
CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICAgICByZXNvdXJjZV9u
YW1lID0gYWNsLnJlc291cmNlX3BhdHRlcm4ucmVzb3VyY2VfbmFtZSBpZiBoYXNhdHRyKGFjbC5y
ZXNvdXJjZV9wYXR0ZXJuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmVzb3VyY2VfbmFtZScpIGVs
c2UgIiIKICAgICAgICAgICAgICAgIHBhdHRlcm5fdHlwZV9vYmogPSBnZXRhdHRyKGFjbC5yZXNv
dXJjZV9wYXR0ZXJuLCAncGF0dGVybl90eXBlJywgTm9uZSkKCiAgICAgICAgICAgICAgICAjIEdl
dCBwYXR0ZXJuIHR5cGUgYXMgc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBwYXR0ZXJuX3R5cGVf
b2JqIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGlmIGhhc2F0dHIocGF0dGVybl90
eXBlX29iaiwgJ25hbWUnKToKICAgICAgICAgICAgICAgICAgICAgICAgcGF0dGVybl90eXBlID0g
cGF0dGVybl90eXBlX29iai5uYW1lCiAgICAgICAgICAgICAgICAgICAgZWxpZiBoYXNhdHRyKHBh
dHRlcm5fdHlwZV9vYmosICd2YWx1ZScpOgogICAgICAgICAgICAgICAgICAgICAgICAjIFRyeSBu
dW1lcmljIHZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgIHBhdHRlcm5fdHlwZV9tYXAgPSB7
MDogIlVOS05PV04iLCAxOiAiQU5ZIiwgMjogIk1BVENIIiwgMzogIkxJVEVSQUwiLCA0OiAiUFJF
RklYRUQifQogICAgICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuX3R5cGUgPSBwYXR0ZXJuX3R5
cGVfbWFwLmdldChwYXR0ZXJuX3R5cGVfb2JqLnZhbHVlLCBzdHIocGF0dGVybl90eXBlX29iaikp
CiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcGF0dGVy
bl90eXBlID0gc3RyKHBhdHRlcm5fdHlwZV9vYmopCiAgICAgICAgICAgICAgICBlbHNlOgogICAg
ICAgICAgICAgICAgICAgIHBhdHRlcm5fdHlwZSA9ICJVTktOT1dOIgoKICAgICAgICAgICAgICAg
ICMgQ2hlY2sgaWYgdGhpcyBBQ0wgYXBwbGllcyB0byBvdXIgdG9waWMKICAgICAgICAgICAgICAg
IGFwcGxpZXMgPSBGYWxzZQoKICAgICAgICAgICAgICAgIGlmIHBhdHRlcm5fdHlwZSA9PSAiTElU
RVJBTCI6CiAgICAgICAgICAgICAgICAgICAgaWYgcmVzb3VyY2VfbmFtZSA9PSB0b3BpYzoKICAg
ICAgICAgICAgICAgICAgICAgICAgIyBBbHJlYWR5IGluY2x1ZGVkIGZyb20gbGl0ZXJhbF9maWx0
ZXIsIHNraXAgdG8gYXZvaWQgZHVwbGljYXRlcwogICAgICAgICAgICAgICAgICAgICAgICBhcHBs
aWVzID0gRmFsc2UKICAgICAgICAgICAgICAgICAgICBlbGlmIHJlc291cmNlX25hbWUgPT0gIioi
OgogICAgICAgICAgICAgICAgICAgICAgICAjIFdpbGRjYXJkIExJVEVSQUwgbWF0Y2hlcyBhbGwK
ICAgICAgICAgICAgICAgICAgICAgICAgYXBwbGllcyA9IFRydWUKICAgICAgICAgICAgICAgICAg
ICBlbGlmIHJlc291cmNlX25hbWUuZW5kc3dpdGgoIioiKSBhbmQgbGVuKHJlc291cmNlX25hbWUp
ID4gMToKICAgICAgICAgICAgICAgICAgICAgICAgIyBIYW5kbGUgTElURVJBTCB3aXRoICogc3Vm
Zml4IGFzIHByZWZpeCBwYXR0ZXJuCiAgICAgICAgICAgICAgICAgICAgICAgICMgZS5nLiwgIlRP
UCoiIHNob3VsZCBtYXRjaCAiVE9QSUMxIgogICAgICAgICAgICAgICAgICAgICAgICBwcmVmaXgg
PSByZXNvdXJjZV9uYW1lWzotMV0gICMgUmVtb3ZlIHRyYWlsaW5nICoKICAgICAgICAgICAgICAg
ICAgICAgICAgaWYgdG9waWMuc3RhcnRzd2l0aChwcmVmaXgpOgogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgYXBwbGllcyA9IFRydWUKICAgICAgICAgICAgICAgIGVsaWYgcGF0dGVybl90eXBl
ID09ICJQUkVGSVhFRCI6CiAgICAgICAgICAgICAgICAgICAgIyBDaGVjayBpZiB0b3BpYyBuYW1l
IHN0YXJ0cyB3aXRoIHRoZSBwcmVmaXgKICAgICAgICAgICAgICAgICAgICBpZiByZXNvdXJjZV9u
YW1lIGFuZCB0b3BpYy5zdGFydHN3aXRoKHJlc291cmNlX25hbWUpOgogICAgICAgICAgICAgICAg
ICAgICAgICBhcHBsaWVzID0gVHJ1ZQoKICAgICAgICAgICAgICAgIGlmIGFwcGxpZXM6CiAgICAg
ICAgICAgICAgICAgICAgIyBDaGVjayBmb3IgZHVwbGljYXRlcwogICAgICAgICAgICAgICAgICAg
IGFjbF9pZCA9IGYie2dldGF0dHIoYWNsLCAncHJpbmNpcGFsJywgJycpfV97Z2V0YXR0cihhY2ws
ICdvcGVyYXRpb24nLCAnJyl9X3tnZXRhdHRyKGFjbCwgJ3Blcm1pc3Npb25fdHlwZScsICcnKX1f
e3Jlc291cmNlX25hbWV9IgogICAgICAgICAgICAgICAgICAgIGlmIGFjbF9pZCBub3QgaW4gc2Vl
bl9hY2xzOgogICAgICAgICAgICAgICAgICAgICAgICBhbGxfbWF0Y2hpbmdfYWNscy5hcHBlbmQo
YWNsKQogICAgICAgICAgICAgICAgICAgICAgICBzZWVuX2FjbHMuYWRkKGFjbF9pZCkKCiAgICAg
ICAgICAgICMgU3RvcmUgYWxsIEFDTHMgZm9yIGZpbHRlcmluZwogICAgICAgICAgICBzZWxmLmFs
bF9hY2xzID0gYWxsX21hdGNoaW5nX2FjbHMKCiAgICAgICAgICAgICMgQXBwbHkgZmlsdGVycwog
ICAgICAgICAgICBmaWx0ZXJlZF9hY2xzID0gc2VsZi5fYXBwbHlfYWNsX2ZpbHRlcnMoYWxsX21h
dGNoaW5nX2FjbHMpCgogICAgICAgICAgICAjIERpc3BsYXkgZmlsdGVyZWQgQUNMcwogICAgICAg
ICAgICBzZWxmLl9kaXNwbGF5X2FjbF9kaWFsb2codG9waWMsIGZpbHRlcmVkX2FjbHMpCgogICAg
ICAgIGV4Y2VwdCBJbXBvcnRFcnJvciBhcyBlOgogICAgICAgICAgICAjIHRyYWNlYmFjay5wcmlu
dF9leGMoKQogICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKCJBQ0wgc3VwcG9ydCByZXF1aXJl
cyBrYWZrYS1weXRob24gQUNMIG1vZHVsZXMuLi46ICVzIiwgZSkKICAgICAgICAgICAgc2VsZi5f
c2hvd19tZXNzYWdlKGYiQUNMIHN1cHBvcnQgcmVxdWlyZXMga2Fma2EtcHl0aG9uIEFDTCBtb2R1
bGVzOiB7ZX0iKQogICAgICAgIGV4Y2VwdCBBdHRyaWJ1dGVFcnJvciBhcyBlOgogICAgICAgICAg
ICAjIHRyYWNlYmFjay5wcmludF9leGMoKQogICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKCJB
Q0xzIG5vdCBhdmFpbGFibGUgJXMgIEFDTHMgbWF5IG5vdCBiZSBlbmFibGVkIG9uIHRoaXMgS2Fm
a2EgY2x1c3RlciIsIGUpCiAgICAgICAgICAgIHNlbGYuX3Nob3dfbWVzc2FnZShmIkFDTHMgbm90
IGF2YWlsYWJsZToge2V9XG5cbkFDTHMgbWF5IG5vdCBiZSBlbmFibGVkIG9uIHRoaXMgS2Fma2Eg
Y2x1c3Rlci4iKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgIyB0
cmFjZWJhY2sucHJpbnRfZXhjKCkKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbigiRXJyb3Ig
bG9hZGluZyBBQ0xzOiAlcyIsIGUpCiAgICAgICAgICAgIHNlbGYuX3Nob3dfbWVzc2FnZShmIkVy
cm9yIGxvYWRpbmcgQUNMczoge2V9IikKCiAgICBkZWYgX2FwcGx5X2FjbF9maWx0ZXJzKHNlbGYs
IGFjbHMpOgogICAgICAgICIiIkFwcGx5IGZpbHRlcnMgdG8gQUNMIGxpc3QiIiIKICAgICAgICBp
ZiBub3QgYWNsczoKICAgICAgICAgICAgcmV0dXJuIFtdCgogICAgICAgIGZpbHRlcmVkID0gW10K
ICAgICAgICBmb3IgYWNsIGluIGFjbHM6CiAgICAgICAgICAgIG1hdGNoID0gVHJ1ZQoKICAgICAg
ICAgICAgIyBQcmluY2lwYWwgZmlsdGVyCiAgICAgICAgICAgIGlmIHNlbGYuYWNsX2ZpbHRlcnNb
InByaW5jaXBhbCJdOgogICAgICAgICAgICAgICAgcHJpbmNpcGFsID0gZ2V0YXR0cihhY2wsICdw
cmluY2lwYWwnLCAnJykgb3IgIiIKICAgICAgICAgICAgICAgIGlmIHNlbGYuYWNsX2ZpbHRlcnNb
InByaW5jaXBhbCJdLmxvd2VyKCkgbm90IGluIHByaW5jaXBhbC5sb3dlcigpOgogICAgICAgICAg
ICAgICAgICAgIG1hdGNoID0gRmFsc2UKCiAgICAgICAgICAgICMgSG9zdCBmaWx0ZXIKICAgICAg
ICAgICAgaWYgbWF0Y2ggYW5kIHNlbGYuYWNsX2ZpbHRlcnNbImhvc3QiXToKICAgICAgICAgICAg
ICAgIGhvc3QgPSBnZXRhdHRyKGFjbCwgJ2hvc3QnLCAnJykgb3IgIiIKICAgICAgICAgICAgICAg
IGlmIHNlbGYuYWNsX2ZpbHRlcnNbImhvc3QiXS5sb3dlcigpIG5vdCBpbiBob3N0Lmxvd2VyKCk6
CiAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSBGYWxzZQoKICAgICAgICAgICAgIyBPcGVyYXRp
b24gZmlsdGVyCiAgICAgICAgICAgIGlmIG1hdGNoIGFuZCBzZWxmLmFjbF9maWx0ZXJzWyJvcGVy
YXRpb24iXSAhPSAiQU5ZIjoKICAgICAgICAgICAgICAgIG9wZXJhdGlvbiA9IGFjbC5vcGVyYXRp
b24ubmFtZSBpZiBoYXNhdHRyKGFjbCwgJ29wZXJhdGlvbicpIGFuZCBoYXNhdHRyKGFjbC5vcGVy
YXRpb24sICduYW1lJykgZWxzZSAiIgogICAgICAgICAgICAgICAgaWYgb3BlcmF0aW9uICE9IHNl
bGYuYWNsX2ZpbHRlcnNbIm9wZXJhdGlvbiJdOgogICAgICAgICAgICAgICAgICAgIG1hdGNoID0g
RmFsc2UKCiAgICAgICAgICAgICMgUGVybWlzc2lvbiBmaWx0ZXIKICAgICAgICAgICAgaWYgbWF0
Y2ggYW5kIHNlbGYuYWNsX2ZpbHRlcnNbInBlcm1pc3Npb24iXSAhPSAiQU5ZIjoKICAgICAgICAg
ICAgICAgIHBlcm1pc3Npb24gPSBhY2wucGVybWlzc2lvbl90eXBlLm5hbWUgaWYgaGFzYXR0cihh
Y2wsICdwZXJtaXNzaW9uX3R5cGUnKSBhbmQgaGFzYXR0cigKICAgICAgICAgICAgICAgICAgICBh
Y2wucGVybWlzc2lvbl90eXBlLCAnbmFtZScpIGVsc2UgIiIKICAgICAgICAgICAgICAgIGlmIHBl
cm1pc3Npb24gIT0gc2VsZi5hY2xfZmlsdGVyc1sicGVybWlzc2lvbiJdOgogICAgICAgICAgICAg
ICAgICAgIG1hdGNoID0gRmFsc2UKCiAgICAgICAgICAgICMgUGF0dGVybiB0eXBlIGZpbHRlcgog
ICAgICAgICAgICBpZiBtYXRjaCBhbmQgc2VsZi5hY2xfZmlsdGVyc1sicGF0dGVybl90eXBlIl0g
IT0gIkFOWSI6CiAgICAgICAgICAgICAgICBwYXR0ZXJuX3R5cGUgPSAiIgogICAgICAgICAgICAg
ICAgaWYgaGFzYXR0cihhY2wsICdyZXNvdXJjZV9wYXR0ZXJuJykgYW5kIGhhc2F0dHIoYWNsLnJl
c291cmNlX3BhdHRlcm4sICdwYXR0ZXJuX3R5cGUnKToKICAgICAgICAgICAgICAgICAgICBwYXR0
ZXJuX3R5cGUgPSBhY2wucmVzb3VyY2VfcGF0dGVybi5wYXR0ZXJuX3R5cGUubmFtZSBpZiBoYXNh
dHRyKGFjbC5yZXNvdXJjZV9wYXR0ZXJuLnBhdHRlcm5fdHlwZSwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICduYW1lJykgZWxzZSAiIgogICAgICAgICAgICAgICAgaWYgcGF0dGVybl90eXBl
ICE9IHNlbGYuYWNsX2ZpbHRlcnNbInBhdHRlcm5fdHlwZSJdOgogICAgICAgICAgICAgICAgICAg
IG1hdGNoID0gRmFsc2UKCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgZmls
dGVyZWQuYXBwZW5kKGFjbCkKCiAgICAgICAgcmV0dXJuIGZpbHRlcmVkCgogICAgZGVmIF9kaXNw
bGF5X2FjbF9kaWFsb2coc2VsZiwgdG9waWMsIGFjbHMpOgogICAgICAgICIiIkRpc3BsYXkgQUNM
IGRpYWxvZyB3aXRoIGZpbHRlcmVkIHJlc3VsdHMiIiIKICAgICAgICBjb250ZW50X2xpbmVzID0g
W10KCiAgICAgICAgIyBBZGQgaW5mbyBhYm91dCBwYXR0ZXJuIG1hdGNoaW5nCiAgICAgICAgY29u
dGVudF9saW5lcy5hcHBlbmQoZiJTaG93aW5nIEFDTHMgdGhhdCBhcHBseSB0byB0b3BpYzoge3Rv
cGljfSIpCiAgICAgICAgY29udGVudF9saW5lcy5hcHBlbmQoIihpbmNsdWRlcyBMSVRFUkFMIG1h
dGNoLCBQUkVGSVhFRCBwYXR0ZXJucywgYW5kIHdpbGRjYXJkICcqJykiKQogICAgICAgIGNvbnRl
bnRfbGluZXMuYXBwZW5kKCIiKQoKICAgICAgICAjIFNob3cgYWN0aXZlIGZpbHRlcnMKICAgICAg
ICBhY3RpdmVfZmlsdGVycyA9IFtdCiAgICAgICAgaWYgc2VsZi5hY2xfZmlsdGVyc1sicHJpbmNp
cGFsIl06CiAgICAgICAgICAgIGFjdGl2ZV9maWx0ZXJzLmFwcGVuZChmIlByaW5jaXBhbDoqe3Nl
bGYuYWNsX2ZpbHRlcnNbJ3ByaW5jaXBhbCddfSoiKQogICAgICAgIGlmIHNlbGYuYWNsX2ZpbHRl
cnNbImhvc3QiXToKICAgICAgICAgICAgYWN0aXZlX2ZpbHRlcnMuYXBwZW5kKGYiSG9zdDoqe3Nl
bGYuYWNsX2ZpbHRlcnNbJ2hvc3QnXX0qIikKICAgICAgICBpZiBzZWxmLmFjbF9maWx0ZXJzWyJv
cGVyYXRpb24iXSAhPSAiQU5ZIjoKICAgICAgICAgICAgYWN0aXZlX2ZpbHRlcnMuYXBwZW5kKGYi
T3BlcmF0aW9uOntzZWxmLmFjbF9maWx0ZXJzWydvcGVyYXRpb24nXX0iKQogICAgICAgIGlmIHNl
bGYuYWNsX2ZpbHRlcnNbInBlcm1pc3Npb24iXSAhPSAiQU5ZIjoKICAgICAgICAgICAgYWN0aXZl
X2ZpbHRlcnMuYXBwZW5kKGYiUGVybWlzc2lvbjp7c2VsZi5hY2xfZmlsdGVyc1sncGVybWlzc2lv
biddfSIpCiAgICAgICAgaWYgc2VsZi5hY2xfZmlsdGVyc1sicGF0dGVybl90eXBlIl0gIT0gIkFO
WSI6CiAgICAgICAgICAgIGFjdGl2ZV9maWx0ZXJzLmFwcGVuZChmIlBhdHRlcm46e3NlbGYuYWNs
X2ZpbHRlcnNbJ3BhdHRlcm5fdHlwZSddfSIpCgogICAgICAgIGlmIGFjdGl2ZV9maWx0ZXJzOgog
ICAgICAgICAgICBjb250ZW50X2xpbmVzLmFwcGVuZChmIkFjdGl2ZSBmaWx0ZXJzOiB7JywgJy5q
b2luKGFjdGl2ZV9maWx0ZXJzKX0iKQogICAgICAgICAgICBjb250ZW50X2xpbmVzLmFwcGVuZCgi
IikKCiAgICAgICAgIyBEaXNwbGF5IEFDTHMKICAgICAgICBpZiBub3QgYWNscyBvciBsZW4oYWNs
cykgPT0gMDoKICAgICAgICAgICAgaWYgYWN0aXZlX2ZpbHRlcnM6CiAgICAgICAgICAgICAgICBj
b250ZW50X2xpbmVzLmFwcGVuZCgiTm8gQUNMcyBtYXRjaCBjdXJyZW50IGZpbHRlcnMiKQogICAg
ICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgY29udGVudF9saW5lcy5hcHBlbmQoIk5vIEFD
THMgY29uZmlndXJlZCBmb3IgdGhpcyB0b3BpYyIpCiAgICAgICAgICAgICAgICBjb250ZW50X2xp
bmVzLmFwcGVuZCgiIikKICAgICAgICAgICAgICAgIGNvbnRlbnRfbGluZXMuYXBwZW5kKCIoQUNM
cyBtYXkgYmUgZGlzYWJsZWQgb24gdGhpcyBjbHVzdGVyIG9yIG5vIHBlcm1pc3Npb25zIHNldCki
KQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGhlYWRlciA9IGYieydSZXNvdXJjZSc6PDIwfSB7
J1ByaW5jaXBhbCc6PDIwfSB7J0hvc3QnOjwxMn0geydPcGVyYXRpb24nOjwxNX0geydQZXJtJzo8
OH0geydQYXR0ZXJuJzo8MTB9IgogICAgICAgICAgICBjb250ZW50X2xpbmVzLmFwcGVuZChoZWFk
ZXIpCiAgICAgICAgICAgIGNvbnRlbnRfbGluZXMuYXBwZW5kKCItIiAqIDk1KQoKICAgICAgICAg
ICAgZm9yIGFjbCBpbiBhY2xzOgogICAgICAgICAgICAgICAgIyBTaG93IHJlc291cmNlIG5hbWUg
KHRvcGljIG5hbWUgb3IgcGF0dGVybikKICAgICAgICAgICAgICAgIHJlc291cmNlX25hbWUgPSBh
Y2wucmVzb3VyY2VfcGF0dGVybi5yZXNvdXJjZV9uYW1lIGlmIGhhc2F0dHIoYWNsLnJlc291cmNl
X3BhdHRlcm4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZXNvdXJjZV9uYW1lJykgZWxzZSAiTi9B
IgoKICAgICAgICAgICAgICAgIHByaW5jaXBhbCA9IGdldGF0dHIoYWNsLCAncHJpbmNpcGFsJywg
J04vQScpIG9yICJOL0EiCiAgICAgICAgICAgICAgICBob3N0ID0gZ2V0YXR0cihhY2wsICdob3N0
JywgJyonKSBvciAiKiIKICAgICAgICAgICAgICAgIG9wZXJhdGlvbiA9IGFjbC5vcGVyYXRpb24u
bmFtZSBpZiBoYXNhdHRyKGFjbCwgJ29wZXJhdGlvbicpIGFuZCBoYXNhdHRyKGFjbC5vcGVyYXRp
b24sICduYW1lJykgZWxzZSBzdHIoCiAgICAgICAgICAgICAgICAgICAgZ2V0YXR0cihhY2wsICdv
cGVyYXRpb24nLCAnTi9BJykpCiAgICAgICAgICAgICAgICBwZXJtaXNzaW9uID0gYWNsLnBlcm1p
c3Npb25fdHlwZS5uYW1lIGlmIGhhc2F0dHIoYWNsLCAncGVybWlzc2lvbl90eXBlJykgYW5kIGhh
c2F0dHIoCiAgICAgICAgICAgICAgICAgICAgYWNsLnBlcm1pc3Npb25fdHlwZSwgJ25hbWUnKSBl
bHNlIHN0cihnZXRhdHRyKGFjbCwgJ3Blcm1pc3Npb25fdHlwZScsICdOL0EnKSkKICAgICAgICAg
ICAgICAgIHBhdHRlcm5fdHlwZSA9ICJMaXRlcmFsIgogICAgICAgICAgICAgICAgaWYgaGFzYXR0
cihhY2wsICdyZXNvdXJjZV9wYXR0ZXJuJykgYW5kIGhhc2F0dHIoYWNsLnJlc291cmNlX3BhdHRl
cm4sICdwYXR0ZXJuX3R5cGUnKToKICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuX3R5cGUgPSBh
Y2wucmVzb3VyY2VfcGF0dGVybi5wYXR0ZXJuX3R5cGUubmFtZSBpZiBoYXNhdHRyKGFjbC5yZXNv
dXJjZV9wYXR0ZXJuLnBhdHRlcm5fdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdu
YW1lJykgZWxzZSBzdHIoCiAgICAgICAgICAgICAgICAgICAgICAgIGFjbC5yZXNvdXJjZV9wYXR0
ZXJuLnBhdHRlcm5fdHlwZSkKCiAgICAgICAgICAgICAgICBsaW5lID0gZiJ7cmVzb3VyY2VfbmFt
ZTo8MjB9IHtwcmluY2lwYWw6PDIwfSB7aG9zdDo8MTJ9IHtvcGVyYXRpb246PDE1fSB7cGVybWlz
c2lvbjo8OH0ge3BhdHRlcm5fdHlwZTo8MTB9IgogICAgICAgICAgICAgICAgY29udGVudF9saW5l
cy5hcHBlbmQobGluZSkKCiAgICAgICAgIyBDcmVhdGUgc2Nyb2xsYWJsZSB2aWV3CiAgICAgICAg
dmlld193YWxrZXIgPSB1cndpZC5TaW1wbGVGb2N1c0xpc3RXYWxrZXIoW1NlbGVjdGFibGVUZXh0
KGxuKSBmb3IgbG4gaW4gY29udGVudF9saW5lc10pCiAgICAgICAgdmlld19saXN0ID0gdXJ3aWQu
TGlzdEJveCh2aWV3X3dhbGtlcikKCiAgICAgICAgIyBGb290ZXIgd2l0aCBoZWxwCiAgICAgICAg
Zm9vdGVyX3RleHQgPSB1cndpZC5UZXh0KCIvIOKAkyBmaWx0ZXIgfCDihpHihpMgUGdVcC9QZ0Ru
L0hvbWUvRW5kIOKAkyBzY3JvbGwgfCBFc2Mg4oCTIGNsb3NlIiwgYWxpZ249ImNlbnRlciIpCiAg
ICAgICAgZm9vdGVyID0gdXJ3aWQuQXR0ck1hcChmb290ZXJfdGV4dCwgImZvb3RlciIpCgogICAg
ICAgICMgQ3JlYXRlIGN1c3RvbSBmcmFtZSB0aGF0IGhhbmRsZXMgIi8iIGtleQogICAgICAgIGNs
YXNzIEFDTEZyYW1lKHVyd2lkLkZyYW1lKToKICAgICAgICAgICAgZGVmIF9faW5pdF9fKGZyYW1l
X3NlbGYsIGJvZHksIGZvb3RlciwgcGFyZW50X2FwcCk6CiAgICAgICAgICAgICAgICBzdXBlcigp
Ll9faW5pdF9fKGJvZHksIGZvb3Rlcj1mb290ZXIpCiAgICAgICAgICAgICAgICBmcmFtZV9zZWxm
LnBhcmVudF9hcHAgPSBwYXJlbnRfYXBwCgogICAgICAgICAgICBkZWYga2V5cHJlc3MoZnJhbWVf
c2VsZiwgc2l6ZSwga2V5KToKICAgICAgICAgICAgICAgIGlmIGtleSA9PSAnLyc6CiAgICAgICAg
ICAgICAgICAgICAgZnJhbWVfc2VsZi5wYXJlbnRfYXBwLl9zaG93X2FjbF9maWx0ZXJfZGlhbG9n
KCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAgICAgcmV0dXJu
IHN1cGVyKCkua2V5cHJlc3Moc2l6ZSwga2V5KQoKICAgICAgICBmcmFtZSA9IEFDTEZyYW1lKHVy
d2lkLkF0dHJNYXAodmlld19saXN0LCAiZGlhbG9nX2JnIiksIGZvb3Rlciwgc2VsZikKCiAgICAg
ICAgdGl0bGUgPSBmIkFDTHMgZm9yIHRvcGljOiB7dG9waWN9IgogICAgICAgIGJveCA9IHVyd2lk
LkxpbmVCb3goZnJhbWUsIHRpdGxlPXRpdGxlKQoKICAgICAgICBzZWxmLmRpYWxvZ19vdmVybGF5
ID0gdXJ3aWQuT3ZlcmxheSgKICAgICAgICAgICAgdG9wX3c9dXJ3aWQuUGFkZGluZyhib3gsIGxl
ZnQ9MiwgcmlnaHQ9MiksCiAgICAgICAgICAgIGJvdHRvbV93PXNlbGYubWFpbl9mcmFtZSwKICAg
ICAgICAgICAgYWxpZ249ImNlbnRlciIsCiAgICAgICAgICAgIHdpZHRoPSgicmVsYXRpdmUiLCA5
MCksCiAgICAgICAgICAgIHZhbGlnbj0ibWlkZGxlIiwKICAgICAgICAgICAgaGVpZ2h0PSgicmVs
YXRpdmUiLCA4MCksCiAgICAgICAgICAgIG1pbl93aWR0aD04MCwKICAgICAgICAgICAgbWluX2hl
aWdodD0xNSwKICAgICAgICApCiAgICAgICAgc2VsZi5sb29wLndpZGdldCA9IHNlbGYuZGlhbG9n
X292ZXJsYXkKCiAgICBkZWYgX3Nob3dfYWNsX2ZpbHRlcl9kaWFsb2coc2VsZik6CiAgICAgICAg
IiIiU2hvdyBkaWFsb2cgdG8gZmlsdGVyIEFDTHMiIiIKCiAgICAgICAgZGVmIG9uX2FwcGx5KGJ0
bj1Ob25lKToKICAgICAgICAgICAgc2VsZi5hY2xfZmlsdGVyc1sicHJpbmNpcGFsIl0gPSBwcmlu
Y2lwYWxfZWRpdC5lZGl0X3RleHQuc3RyaXAoKQogICAgICAgICAgICBzZWxmLmFjbF9maWx0ZXJz
WyJob3N0Il0gPSBob3N0X2VkaXQuZWRpdF90ZXh0LnN0cmlwKCkKCiAgICAgICAgICAgICMgR2V0
IHNlbGVjdGVkIG9wZXJhdGlvbgogICAgICAgICAgICBmb3IgcmIgaW4gb3BlcmF0aW9uX2dyb3Vw
OgogICAgICAgICAgICAgICAgaWYgcmIuc3RhdGU6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5h
Y2xfZmlsdGVyc1sib3BlcmF0aW9uIl0gPSByYi5sYWJlbAogICAgICAgICAgICAgICAgICAgIGJy
ZWFrCgogICAgICAgICAgICAjIEdldCBzZWxlY3RlZCBwZXJtaXNzaW9uCiAgICAgICAgICAgIGZv
ciByYiBpbiBwZXJtaXNzaW9uX2dyb3VwOgogICAgICAgICAgICAgICAgaWYgcmIuc3RhdGU6CiAg
ICAgICAgICAgICAgICAgICAgc2VsZi5hY2xfZmlsdGVyc1sicGVybWlzc2lvbiJdID0gcmIubGFi
ZWwKICAgICAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAgICAgIyBHZXQgc2VsZWN0ZWQg
cGF0dGVybiB0eXBlCiAgICAgICAgICAgIGZvciByYiBpbiBwYXR0ZXJuX2dyb3VwOgogICAgICAg
ICAgICAgICAgaWYgcmIuc3RhdGU6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5hY2xfZmlsdGVy
c1sicGF0dGVybl90eXBlIl0gPSByYi5sYWJlbAogICAgICAgICAgICAgICAgICAgIGJyZWFrCgog
ICAgICAgICAgICBzZWxmLl9jbG9zZV9kaWFsb2coKQogICAgICAgICAgICAjIFJlZnJlc2ggQUNM
IGRpc3BsYXkgd2l0aCBmaWx0ZXJzCiAgICAgICAgICAgIGlmIHNlbGYuY3VycmVudF9hY2xfdG9w
aWM6CiAgICAgICAgICAgICAgICBzZWxmLl9zaG93X3RvcGljX2FjbHMoc2VsZi5jdXJyZW50X2Fj
bF90b3BpYykKCiAgICAgICAgZGVmIG9uX2NsZWFyKGJ0bik6CiAgICAgICAgICAgIHNlbGYuYWNs
X2ZpbHRlcnMgPSB7CiAgICAgICAgICAgICAgICAicHJpbmNpcGFsIjogIiIsCiAgICAgICAgICAg
ICAgICAiaG9zdCI6ICIiLAogICAgICAgICAgICAgICAgIm9wZXJhdGlvbiI6ICJBTlkiLAogICAg
ICAgICAgICAgICAgInBlcm1pc3Npb24iOiAiQU5ZIiwKICAgICAgICAgICAgICAgICJwYXR0ZXJu
X3R5cGUiOiAiQU5ZIgogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlbGYuX2Nsb3NlX2RpYWxv
ZygpCiAgICAgICAgICAgICMgUmVmcmVzaCBBQ0wgZGlzcGxheSB3aXRob3V0IGZpbHRlcnMKICAg
ICAgICAgICAgaWYgc2VsZi5jdXJyZW50X2FjbF90b3BpYzoKICAgICAgICAgICAgICAgIHNlbGYu
X3Nob3dfdG9waWNfYWNscyhzZWxmLmN1cnJlbnRfYWNsX3RvcGljKQoKICAgICAgICBkZWYgb25f
Y2FuY2VsKGJ0bj1Ob25lKToKICAgICAgICAgICAgc2VsZi5fY2xvc2VfZGlhbG9nKCkKICAgICAg
ICAgICAgIyBSZXR1cm4gdG8gQUNMIHZpZXcKICAgICAgICAgICAgaWYgc2VsZi5jdXJyZW50X2Fj
bF90b3BpYzoKICAgICAgICAgICAgICAgIHNlbGYuX3Nob3dfdG9waWNfYWNscyhzZWxmLmN1cnJl
bnRfYWNsX3RvcGljKQoKICAgICAgICAjIEN1c3RvbSBFZGl0IHRoYXQgYXBwbGllcyBvbiBFbnRl
cgogICAgICAgIGNsYXNzIEVkaXRXaXRoRW50ZXIodXJ3aWQuRWRpdCk6CiAgICAgICAgICAgIGRl
ZiBrZXlwcmVzcyhzZWxmLCBzaXplLCBrZXkpOgogICAgICAgICAgICAgICAgaWYga2V5ID09ICdl
bnRlcic6CiAgICAgICAgICAgICAgICAgICAgb25fYXBwbHkoKQogICAgICAgICAgICAgICAgICAg
IHJldHVybiBOb25lCiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIoKS5rZXlwcmVzcyhzaXpl
LCBrZXkpCgogICAgICAgICMgQ3VzdG9tIFJhZGlvQnV0dG9uIHRoYXQgYXBwbGllcyBvbiBFbnRl
cgogICAgICAgIGNsYXNzIFJhZGlvQnV0dG9uV2l0aEVudGVyKHVyd2lkLlJhZGlvQnV0dG9uKToK
ICAgICAgICAgICAgZGVmIGtleXByZXNzKHNlbGYsIHNpemUsIGtleSk6CiAgICAgICAgICAgICAg
ICBpZiBrZXkgPT0gJ2VudGVyJzoKICAgICAgICAgICAgICAgICAgICBvbl9hcHBseSgpCiAgICAg
ICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgICAgIHJldHVybiBzdXBlcigp
LmtleXByZXNzKHNpemUsIGtleSkKCiAgICAgICAgcHJpbmNpcGFsX2VkaXQgPSBFZGl0V2l0aEVu
dGVyKCJQcmluY2lwYWwgKHN1YnN0cmluZyk6ICIsIHNlbGYuYWNsX2ZpbHRlcnNbInByaW5jaXBh
bCJdKQogICAgICAgIGhvc3RfZWRpdCA9IEVkaXRXaXRoRW50ZXIoIkhvc3QgKHN1YnN0cmluZyk6
ICIsIHNlbGYuYWNsX2ZpbHRlcnNbImhvc3QiXSkKCiAgICAgICAgIyBSYWRpbyBidXR0b25zIGZv
ciBPcGVyYXRpb24KICAgICAgICBvcGVyYXRpb25fZ3JvdXAgPSBbXQogICAgICAgIG9wZXJhdGlv
bnMgPSBbIkFOWSIsICJSRUFEIiwgIldSSVRFIiwgIkNSRUFURSIsICJERUxFVEUiLCAiQUxURVIi
LCAiREVTQ1JJQkUiLCAiQ0xVU1RFUl9BQ1RJT04iLAogICAgICAgICAgICAgICAgICAgICAgIkRF
U0NSSUJFX0NPTkZJR1MiLCAiQUxURVJfQ09ORklHUyIsICJJREVNUE9URU5UX1dSSVRFIiwgIkFM
TCJdCiAgICAgICAgb3BlcmF0aW9uX2J1dHRvbnMgPSBbXQogICAgICAgIGZvciBvcCBpbiBvcGVy
YXRpb25zOgogICAgICAgICAgICByYiA9IFJhZGlvQnV0dG9uV2l0aEVudGVyKG9wZXJhdGlvbl9n
cm91cCwgb3AsIHN0YXRlPShzZWxmLmFjbF9maWx0ZXJzWyJvcGVyYXRpb24iXSA9PSBvcCkpCiAg
ICAgICAgICAgIG9wZXJhdGlvbl9idXR0b25zLmFwcGVuZChyYikKCiAgICAgICAgIyBSYWRpbyBi
dXR0b25zIGZvciBQZXJtaXNzaW9uCiAgICAgICAgcGVybWlzc2lvbl9ncm91cCA9IFtdCiAgICAg
ICAgcGVybWlzc2lvbnMgPSBbIkFOWSIsICJBTExPVyIsICJERU5ZIl0KICAgICAgICBwZXJtaXNz
aW9uX2J1dHRvbnMgPSBbXQogICAgICAgIGZvciBwZXJtIGluIHBlcm1pc3Npb25zOgogICAgICAg
ICAgICByYiA9IFJhZGlvQnV0dG9uV2l0aEVudGVyKHBlcm1pc3Npb25fZ3JvdXAsIHBlcm0sIHN0
YXRlPShzZWxmLmFjbF9maWx0ZXJzWyJwZXJtaXNzaW9uIl0gPT0gcGVybSkpCiAgICAgICAgICAg
IHBlcm1pc3Npb25fYnV0dG9ucy5hcHBlbmQocmIpCgogICAgICAgICMgUmFkaW8gYnV0dG9ucyBm
b3IgUGF0dGVybiBUeXBlCiAgICAgICAgcGF0dGVybl9ncm91cCA9IFtdCiAgICAgICAgcGF0dGVy
bnMgPSBbIkFOWSIsICJMSVRFUkFMIiwgIlBSRUZJWEVEIl0KICAgICAgICBwYXR0ZXJuX2J1dHRv
bnMgPSBbXQogICAgICAgIGZvciBwYXQgaW4gcGF0dGVybnM6CiAgICAgICAgICAgIHJiID0gUmFk
aW9CdXR0b25XaXRoRW50ZXIocGF0dGVybl9ncm91cCwgcGF0LCBzdGF0ZT0oc2VsZi5hY2xfZmls
dGVyc1sicGF0dGVybl90eXBlIl0gPT0gcGF0KSkKICAgICAgICAgICAgcGF0dGVybl9idXR0b25z
LmFwcGVuZChyYikKCiAgICAgICAgIyBDdXN0b20gQnV0dG9uIGZvciBDbGVhciBhbmQgQ2FuY2Vs
IChkb24ndCBhcHBseSBvbiBlbnRlcikKICAgICAgICBjbGFzcyBTcGVjaWFsQnV0dG9uKHVyd2lk
LkJ1dHRvbik6CiAgICAgICAgICAgIGRlZiBfX2luaXRfXyhzZWxmLCBsYWJlbCwgb25fcHJlc3Mp
OgogICAgICAgICAgICAgICAgc3VwZXIoKS5fX2luaXRfXyhsYWJlbCwgb25fcHJlc3MpCiAgICAg
ICAgICAgICAgICBzZWxmLmlzX3NwZWNpYWwgPSBUcnVlCgogICAgICAgICMgQnVpbGQgcGlsZSB3
aXRoIGNvbHVtbnMgZm9yIHJhZGlvIGJ1dHRvbnMKICAgICAgICBwaWxlX2NvbnRlbnQgPSBbCiAg
ICAgICAgICAgIHVyd2lkLlRleHQoIkZpbHRlciBBQ0xzOiIpLAogICAgICAgICAgICB1cndpZC5E
aXZpZGVyKCksCiAgICAgICAgICAgIHByaW5jaXBhbF9lZGl0LAogICAgICAgICAgICBob3N0X2Vk
aXQsCiAgICAgICAgICAgIHVyd2lkLkRpdmlkZXIoKSwKICAgICAgICAgICAgdXJ3aWQuVGV4dCgi
T3BlcmF0aW9uOiIpLAogICAgICAgICAgICB1cndpZC5Db2x1bW5zKFsKICAgICAgICAgICAgICAg
IHVyd2lkLlBpbGUob3BlcmF0aW9uX2J1dHRvbnNbOjZdKSwKICAgICAgICAgICAgICAgIHVyd2lk
LlBpbGUob3BlcmF0aW9uX2J1dHRvbnNbNjpdKQogICAgICAgICAgICBdKSwKICAgICAgICAgICAg
dXJ3aWQuRGl2aWRlcigpLAogICAgICAgICAgICB1cndpZC5UZXh0KCJQZXJtaXNzaW9uOiIpLAog
ICAgICAgICAgICB1cndpZC5QaWxlKHBlcm1pc3Npb25fYnV0dG9ucyksCiAgICAgICAgICAgIHVy
d2lkLkRpdmlkZXIoKSwKICAgICAgICAgICAgdXJ3aWQuVGV4dCgiUGF0dGVybiBUeXBlOiIpLAog
ICAgICAgICAgICB1cndpZC5QaWxlKHBhdHRlcm5fYnV0dG9ucyksCiAgICAgICAgICAgIHVyd2lk
LkRpdmlkZXIoKSwKICAgICAgICAgICAgdXJ3aWQuQXR0ck1hcCh1cndpZC5CdXR0b24oIkFwcGx5
Iiwgb25fcHJlc3M9b25fYXBwbHkpLCAiYnRuIiwgZm9jdXNfbWFwPSJidG5fZm9jdXMiKSwKICAg
ICAgICAgICAgdXJ3aWQuQXR0ck1hcChTcGVjaWFsQnV0dG9uKCJDbGVhciBBbGwiLCBvbl9wcmVz
cz1vbl9jbGVhciksICJidG4iLCBmb2N1c19tYXA9ImJ0bl9mb2N1cyIpLAogICAgICAgICAgICB1
cndpZC5BdHRyTWFwKFNwZWNpYWxCdXR0b24oIkNhbmNlbCIsIG9uX3ByZXNzPW9uX2NhbmNlbCks
ICJidG4iLCBmb2N1c19tYXA9ImJ0bl9mb2N1cyIpLAogICAgICAgIF0KCiAgICAgICAgIyBDdXN0
b20gUGlsZSB0aGF0IGhhbmRsZXMgRXNjIGFuZCBRCiAgICAgICAgY2xhc3MgRmlsdGVyUGlsZSh1
cndpZC5QaWxlKToKICAgICAgICAgICAgZGVmIGtleXByZXNzKHNlbGYsIHNpemUsIGtleSk6CiAg
ICAgICAgICAgICAgICBpZiBrZXkgaW4gKCdlc2MnLCAncScsICdRJyk6CiAgICAgICAgICAgICAg
ICAgICAgb25fY2FuY2VsKCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAg
ICAgICAgICAgcmV0dXJuIHN1cGVyKCkua2V5cHJlc3Moc2l6ZSwga2V5KQoKICAgICAgICBwaWxl
ID0gRmlsdGVyUGlsZShwaWxlX2NvbnRlbnQpCgogICAgICAgICMgQ3VzdG9tIGRpYWxvZyB3cmFw
cGVyIHRoYXQgaGFuZGxlcyBFc2MvUSBhdCBkaWFsb2cgbGV2ZWwKICAgICAgICBoZWFkZXIgPSB1
cndpZC5BdHRyTWFwKHVyd2lkLlRleHQoIiBGaWx0ZXIgQUNMcyAiLCBhbGlnbj0iY2VudGVyIiks
ICJkaWFsb2dfaGVhZGVyIikKICAgICAgICBjb250ZW50X2JveCA9IHVyd2lkLkZpbGxlcihwaWxl
LCB2YWxpZ249InRvcCIpCiAgICAgICAgZGlhbG9nID0gdXJ3aWQuQXR0ck1hcCgKICAgICAgICAg
ICAgdXJ3aWQuTGluZUJveCh1cndpZC5GcmFtZSh1cndpZC5QYWRkaW5nKGNvbnRlbnRfYm94LCBs
ZWZ0PTEsIHJpZ2h0PTEpLCBoZWFkZXI9aGVhZGVyKSksCiAgICAgICAgICAgICJkaWFsb2dfYmci
LAogICAgICAgICkKCiAgICAgICAgY2xhc3MgRGlhbG9nV3JhcHBlcih1cndpZC5XaWRnZXRXcmFw
KToKICAgICAgICAgICAgZGVmIF9faW5pdF9fKHNlbGYsIHdpZGdldCk6CiAgICAgICAgICAgICAg
ICBzdXBlcigpLl9faW5pdF9fKHdpZGdldCkKCiAgICAgICAgICAgIGRlZiBrZXlwcmVzcyhzZWxm
LCBzaXplLCBrZXkpOgogICAgICAgICAgICAgICAgaWYga2V5IGluICgnZXNjJywgJ3EnLCAnUScp
OgogICAgICAgICAgICAgICAgICAgIG9uX2NhbmNlbCgpCiAgICAgICAgICAgICAgICAgICAgcmV0
dXJuIE5vbmUKICAgICAgICAgICAgICAgIHJldHVybiBzdXBlcigpLmtleXByZXNzKHNpemUsIGtl
eSkKCiAgICAgICAgd3JhcHBlZF9kaWFsb2cgPSBEaWFsb2dXcmFwcGVyKGRpYWxvZykKCiAgICAg
ICAgc2VsZi5kaWFsb2dfb3ZlcmxheSA9IHVyd2lkLk92ZXJsYXkoCiAgICAgICAgICAgIHRvcF93
PXVyd2lkLlBhZGRpbmcod3JhcHBlZF9kaWFsb2csIGxlZnQ9MiwgcmlnaHQ9MiksCiAgICAgICAg
ICAgIGJvdHRvbV93PXNlbGYubWFpbl9mcmFtZSwKICAgICAgICAgICAgYWxpZ249ImNlbnRlciIs
CiAgICAgICAgICAgIHdpZHRoPSgicmVsYXRpdmUiLCA3MCksCiAgICAgICAgICAgIHZhbGlnbj0i
bWlkZGxlIiwKICAgICAgICAgICAgaGVpZ2h0PSgicmVsYXRpdmUiLCA4MCksCiAgICAgICAgICAg
IG1pbl93aWR0aD01MCwKICAgICAgICAgICAgbWluX2hlaWdodD0yMCwKICAgICAgICApCiAgICAg
ICAgc2VsZi5sb29wLndpZGdldCA9IHNlbGYuZGlhbG9nX292ZXJsYXkKCiAgICBkZWYgX3Nob3df
YWNsX3Jlc291cmNlX21lbnUoc2VsZik6CiAgICAgICAgIiIiU2hvdyBtZW51IHRvIHNlbGVjdCBB
Q0wgcmVzb3VyY2UgdHlwZSIiIgoKICAgICAgICAjIENsZWFyIHN0YWNrIHdoZW4gb3BlbmluZyBt
YWluIG1lbnUKICAgICAgICBzZWxmLmRpYWxvZ19zdGFjayA9IFtdCgogICAgICAgIGRlZiBvbl90
b3BpYyhidG4pOgogICAgICAgICAgICBzZWxmLl9jbG9zZV9kaWFsb2coKQogICAgICAgICAgICB0
ID0gc2VsZi5fZm9jdXNlZF90b3BpYygpCiAgICAgICAgICAgIGlmIHQgYW5kIG5vdCB0LnN0YXJ0
c3dpdGgoIkNvbm5lY3Rpb24gZXJyb3IiKSBhbmQgbm90IHQuc3RhcnRzd2l0aCgiTm8gdG9waWNz
Iik6CiAgICAgICAgICAgICAgICBzZWxmLl9zaG93X3RvcGljX2FjbHModCkKCiAgICAgICAgZGVm
IG9uX2FsbF90b3BpY3MoYnRuKToKICAgICAgICAgICAgc2VsZi5fY2xvc2VfZGlhbG9nKCkKICAg
ICAgICAgICAgc2VsZi5fc2hvd19hbGxfdG9waWNzX2FjbHMoKQoKICAgICAgICBkZWYgb25fZ3Jv
dXBzKGJ0bik6CiAgICAgICAgICAgICMgQWRkIGN1cnJlbnQgbWVudSB0byBzdGFjayBiZWZvcmUg
bW92aW5nIHRvIG5leHQgZGlhbG9nCiAgICAgICAgICAgIHNlbGYuZGlhbG9nX3N0YWNrLmFwcGVu
ZChzZWxmLl9zaG93X2FjbF9yZXNvdXJjZV9tZW51KQogICAgICAgICAgICBzZWxmLl9jbG9zZV9k
aWFsb2coKQogICAgICAgICAgICBzZWxmLl9zaG93X2dyb3Vwc19zZWxlY3Rpb24oKQoKICAgICAg
ICBkZWYgb25fY2x1c3RlcihidG4pOgogICAgICAgICAgICBzZWxmLl9jbG9zZV9kaWFsb2coKQog
ICAgICAgICAgICBzZWxmLl9zaG93X2NsdXN0ZXJfYWNscygpCgogICAgICAgIGRlZiBvbl90cmFu
c2FjdGlvbmFsKGJ0bik6CiAgICAgICAgICAgICMgQWRkIGN1cnJlbnQgbWVudSB0byBzdGFjawog
ICAgICAgICAgICBzZWxmLmRpYWxvZ19zdGFjay5hcHBlbmQoc2VsZi5fc2hvd19hY2xfcmVzb3Vy
Y2VfbWVudSkKICAgICAgICAgICAgc2VsZi5fY2xvc2VfZGlhbG9nKCkKICAgICAgICAgICAgc2Vs
Zi5fc2hvd190cmFuc2FjdGlvbmFsX3NlbGVjdGlvbigpCgogICAgICAgIGRlZiBvbl9wcmluY2lw
YWwoYnRuKToKICAgICAgICAgICAgIyBBZGQgY3VycmVudCBtZW51IHRvIHN0YWNrIGJlZm9yZSBt
b3ZpbmcgdG8gbmV4dCBkaWFsb2cKICAgICAgICAgICAgc2VsZi5kaWFsb2dfc3RhY2suYXBwZW5k
KHNlbGYuX3Nob3dfYWNsX3Jlc291cmNlX21lbnUpCiAgICAgICAgICAgIHNlbGYuX2Nsb3NlX2Rp
YWxvZygpCiAgICAgICAgICAgIHNlbGYuX3Nob3dfcHJpbmNpcGFsX3NlbGVjdGlvbigpCgogICAg
ICAgIGRlZiBvbl9jYW5jZWwoYnRuKToKICAgICAgICAgICAgc2VsZi5kaWFsb2dfc3RhY2sgPSBb
XSAgIyBDbGVhciBzdGFjawogICAgICAgICAgICBzZWxmLl9jbG9zZV9kaWFsb2coKQoKICAgICAg
ICBjdXJyZW50X3RvcGljID0gc2VsZi5fZm9jdXNlZF90b3BpYygpCiAgICAgICAgdG9waWNfbGFi
ZWwgPSBmIkN1cnJlbnQgVG9waWMgKHtjdXJyZW50X3RvcGljfSkiIGlmIGN1cnJlbnRfdG9waWMg
ZWxzZSAiQ3VycmVudCBUb3BpYyAobm9uZSBzZWxlY3RlZCkiCgogICAgICAgIHBpbGUgPSB1cndp
ZC5QaWxlKFsKICAgICAgICAgICAgdXJ3aWQuVGV4dCgiU2VsZWN0IHJlc291cmNlIHR5cGUgdG8g
dmlldyBBQ0xzOiIsIGFsaWduPSJjZW50ZXIiKSwKICAgICAgICAgICAgdXJ3aWQuRGl2aWRlcigp
LAogICAgICAgICAgICB1cndpZC5BdHRyTWFwKHVyd2lkLkJ1dHRvbihmIlsxXSB7dG9waWNfbGFi
ZWx9Iiwgb25fcHJlc3M9b25fdG9waWMpLCAiYnRuIiwgZm9jdXNfbWFwPSJidG5fZm9jdXMiKSwK
ICAgICAgICAgICAgdXJ3aWQuQXR0ck1hcCh1cndpZC5CdXR0b24oIlsyXSBBbGwgVG9waWNzIiwg
b25fcHJlc3M9b25fYWxsX3RvcGljcyksICJidG4iLCBmb2N1c19tYXA9ImJ0bl9mb2N1cyIpLAog
ICAgICAgICAgICB1cndpZC5BdHRyTWFwKHVyd2lkLkJ1dHRvbigiWzNdIENvbnN1bWVyIEdyb3Vw
cyIsIG9uX3ByZXNzPW9uX2dyb3VwcyksICJidG4iLCBmb2N1c19tYXA9ImJ0bl9mb2N1cyIpLAog
ICAgICAgICAgICB1cndpZC5BdHRyTWFwKHVyd2lkLkJ1dHRvbigiWzRdIENsdXN0ZXIiLCBvbl9w
cmVzcz1vbl9jbHVzdGVyKSwgImJ0biIsIGZvY3VzX21hcD0iYnRuX2ZvY3VzIiksCiAgICAgICAg
ICAgIHVyd2lkLkF0dHJNYXAodXJ3aWQuQnV0dG9uKCJbNV0gVHJhbnNhY3Rpb25hbCBJRHMiLCBv
bl9wcmVzcz1vbl90cmFuc2FjdGlvbmFsKSwgImJ0biIsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgZm9jdXNfbWFwPSJidG5fZm9jdXMiKSwKICAgICAgICAgICAgdXJ3aWQuQXR0ck1hcCh1cndp
ZC5CdXR0b24oIls2XSBCeSBQcmluY2lwYWwiLCBvbl9wcmVzcz1vbl9wcmluY2lwYWwpLCAiYnRu
IiwgZm9jdXNfbWFwPSJidG5fZm9jdXMiKSwKICAgICAgICAgICAgdXJ3aWQuRGl2aWRlcigpLAog
ICAgICAgICAgICB1cndpZC5BdHRyTWFwKHVyd2lkLkJ1dHRvbigiQ2FuY2VsIiwgb25fcHJlc3M9
b25fY2FuY2VsKSwgImJ0biIsIGZvY3VzX21hcD0iYnRuX2ZvY3VzIiksCiAgICAgICAgXSkKCiAg
ICAgICAgc2VsZi5fc2hvd19kaWFsb2cocGlsZSwgIlZpZXcgQUNMcyIpCgogICAgZGVmIF9zaG93
X2FsbF90b3BpY3NfYWNscyhzZWxmKToKICAgICAgICAiIiJTaG93IEFDTHMgZm9yIGFsbCB0b3Bp
Y3MiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGZyb20ga2Fma2EuYWRtaW4uYWNsX3Jlc291
cmNlIGltcG9ydCAoCiAgICAgICAgICAgICAgICBBQ0xGaWx0ZXIsIFJlc291cmNlUGF0dGVybiwg
UmVzb3VyY2VUeXBlLCBSZXNvdXJjZVBhdHRlcm5GaWx0ZXIsCiAgICAgICAgICAgICAgICBBQ0xP
cGVyYXRpb24sIEFDTFBlcm1pc3Npb25UeXBlLCBBQ0xSZXNvdXJjZVBhdHRlcm5UeXBlCiAgICAg
ICAgICAgICkKCiAgICAgICAgICAgICMgR2V0IEFMTCBBQ0xzIHdpdGhvdXQgcmVzb3VyY2UgcGF0
dGVybiBmaWx0ZXIKICAgICAgICAgICAgYWNsX2ZpbHRlciA9IEFDTEZpbHRlcigKICAgICAgICAg
ICAgICAgIHByaW5jaXBhbD1Ob25lLAogICAgICAgICAgICAgICAgaG9zdD1Ob25lLAogICAgICAg
ICAgICAgICAgb3BlcmF0aW9uPUFDTE9wZXJhdGlvbi5BTlksCiAgICAgICAgICAgICAgICBwZXJt
aXNzaW9uX3R5cGU9QUNMUGVybWlzc2lvblR5cGUuQU5ZLAogICAgICAgICAgICAgICAgcmVzb3Vy
Y2VfcGF0dGVybj1SZXNvdXJjZVBhdHRlcm5GaWx0ZXIoCiAgICAgICAgICAgICAgICAgICAgUmVz
b3VyY2VUeXBlLlRPUElDLAogICAgICAgICAgICAgICAgICAgIE5vbmUsICAjIE1hdGNoIGFueSBu
YW1lCiAgICAgICAgICAgICAgICAgICAgQUNMUmVzb3VyY2VQYXR0ZXJuVHlwZS5BTlkgICMgTWF0
Y2ggYW55IHBhdHRlcm4gdHlwZQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApCgogICAg
ICAgICAgICByZXN1bHQgPSBzZWxmLmFkbWluX2NsaWVudC5kZXNjcmliZV9hY2xzKGFjbF9maWx0
ZXIpCiAgICAgICAgICAgIGFjbHMgPSByZXN1bHRbMF0gaWYgaXNpbnN0YW5jZShyZXN1bHQsIHR1
cGxlKSBlbHNlIHJlc3VsdAogICAgICAgICAgICBhY2xzID0gYWNscyBpZiBpc2luc3RhbmNlKGFj
bHMsIGxpc3QpIGVsc2UgW10KCiAgICAgICAgICAgIGNvbnRlbnRfbGluZXMgPSBbXQoKICAgICAg
ICAgICAgaWYgbm90IGFjbHMgb3IgbGVuKGFjbHMpID09IDA6CiAgICAgICAgICAgICAgICBjb250
ZW50X2xpbmVzLmFwcGVuZCgiTm8gQUNMcyBjb25maWd1cmVkIGZvciB0b3BpY3MiKQogICAgICAg
ICAgICBlbHNlOgogICAgICAgICAgICAgICAgaGVhZGVyID0gZiJ7J1RvcGljJzo8MjB9IHsnUHJp
bmNpcGFsJzo8MjB9IHsnSG9zdCc6PDEyfSB7J09wZXJhdGlvbic6PDE1fSB7J1Blcm0nOjw4fSB7
J1BhdHRlcm4nOjwxMH0iCiAgICAgICAgICAgICAgICBjb250ZW50X2xpbmVzLmFwcGVuZChoZWFk
ZXIpCiAgICAgICAgICAgICAgICBjb250ZW50X2xpbmVzLmFwcGVuZCgiLSIgKiA5NSkKCiAgICAg
ICAgICAgICAgICBmb3IgYWNsIGluIGFjbHM6CiAgICAgICAgICAgICAgICAgICAgdG9waWNfbmFt
ZSA9IGFjbC5yZXNvdXJjZV9wYXR0ZXJuLnJlc291cmNlX25hbWUgaWYgaGFzYXR0cihhY2wucmVz
b3VyY2VfcGF0dGVybiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZXNvdXJjZV9uYW1lJykgZWxz
ZSAiTi9BIgogICAgICAgICAgICAgICAgICAgIHByaW5jaXBhbCA9IGdldGF0dHIoYWNsLCAncHJp
bmNpcGFsJywgJ04vQScpIG9yICJOL0EiCiAgICAgICAgICAgICAgICAgICAgaG9zdCA9IGdldGF0
dHIoYWNsLCAnaG9zdCcsICcqJykgb3IgIioiCiAgICAgICAgICAgICAgICAgICAgb3BlcmF0aW9u
ID0gYWNsLm9wZXJhdGlvbi5uYW1lIGlmIGhhc2F0dHIoYWNsLCAnb3BlcmF0aW9uJykgYW5kIGhh
c2F0dHIoYWNsLm9wZXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAn
bmFtZScpIGVsc2UgIk4vQSIKICAgICAgICAgICAgICAgICAgICBwZXJtaXNzaW9uID0gYWNsLnBl
cm1pc3Npb25fdHlwZS5uYW1lIGlmIGhhc2F0dHIoYWNsLCAncGVybWlzc2lvbl90eXBlJykgYW5k
IGhhc2F0dHIoCiAgICAgICAgICAgICAgICAgICAgICAgIGFjbC5wZXJtaXNzaW9uX3R5cGUsICdu
YW1lJykgZWxzZSAiTi9BIgogICAgICAgICAgICAgICAgICAgIHBhdHRlcm5fdHlwZSA9IGFjbC5y
ZXNvdXJjZV9wYXR0ZXJuLnBhdHRlcm5fdHlwZS5uYW1lIGlmIGhhc2F0dHIoYWNsLnJlc291cmNl
X3BhdHRlcm4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGF0dGVybl90eXBlJykgYW5k
IGhhc2F0dHIoCiAgICAgICAgICAgICAgICAgICAgICAgIGFjbC5yZXNvdXJjZV9wYXR0ZXJuLnBh
dHRlcm5fdHlwZSwgJ25hbWUnKSBlbHNlICJMaXRlcmFsIgoKICAgICAgICAgICAgICAgICAgICBs
aW5lID0gZiJ7dG9waWNfbmFtZTo8MjB9IHtwcmluY2lwYWw6PDIwfSB7aG9zdDo8MTJ9IHtvcGVy
YXRpb246PDE1fSB7cGVybWlzc2lvbjo8OH0ge3BhdHRlcm5fdHlwZTo8MTB9IgogICAgICAgICAg
ICAgICAgICAgIGNvbnRlbnRfbGluZXMuYXBwZW5kKGxpbmUpCgogICAgICAgICAgICBzZWxmLl9z
aG93X2dlbmVyaWNfYWNsX2RpYWxvZygiQUNMcyBmb3IgYWxsIFRvcGljcyIsIGNvbnRlbnRfbGlu
ZXMpCgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgIyB0cmFjZWJh
Y2sucHJpbnRfZXhjKCkKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbigiRXJyb3IgbG9hZGlu
ZyB0b3BpYyBBQ0xzOiAlcyIsIGUpCiAgICAgICAgICAgIHNlbGYuX3Nob3dfbWVzc2FnZShmIkVy
cm9yIGxvYWRpbmcgdG9waWMgQUNMczoge2V9IikKCiAgICBkZWYgX3Nob3dfZ3JvdXBzX3NlbGVj
dGlvbihzZWxmKToKICAgICAgICAiIiJTaG93IGRpYWxvZyB0byBzZWxlY3QgYSBjb25zdW1lciBn
cm91cCIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgZnJvbSBrYWZrYS5hZG1pbi5hY2xfcmVz
b3VyY2UgaW1wb3J0ICgKICAgICAgICAgICAgICAgIEFDTEZpbHRlciwgUmVzb3VyY2VQYXR0ZXJu
LCBSZXNvdXJjZVR5cGUsIFJlc291cmNlUGF0dGVybkZpbHRlciwKICAgICAgICAgICAgICAgIEFD
TE9wZXJhdGlvbiwgQUNMUGVybWlzc2lvblR5cGUsIEFDTFJlc291cmNlUGF0dGVyblR5cGUKICAg
ICAgICAgICAgKQoKICAgICAgICAgICAgIyBHZXQgYWxsIEFDTHMgZm9yIGdyb3VwcwogICAgICAg
ICAgICBhY2xfZmlsdGVyID0gQUNMRmlsdGVyKAogICAgICAgICAgICAgICAgcHJpbmNpcGFsPU5v
bmUsCiAgICAgICAgICAgICAgICBob3N0PU5vbmUsCiAgICAgICAgICAgICAgICBvcGVyYXRpb249
QUNMT3BlcmF0aW9uLkFOWSwKICAgICAgICAgICAgICAgIHBlcm1pc3Npb25fdHlwZT1BQ0xQZXJt
aXNzaW9uVHlwZS5BTlksCiAgICAgICAgICAgICAgICByZXNvdXJjZV9wYXR0ZXJuPVJlc291cmNl
UGF0dGVybkZpbHRlcigKICAgICAgICAgICAgICAgICAgICBSZXNvdXJjZVR5cGUuR1JPVVAsCiAg
ICAgICAgICAgICAgICAgICAgTm9uZSwKICAgICAgICAgICAgICAgICAgICBBQ0xSZXNvdXJjZVBh
dHRlcm5UeXBlLkFOWQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApCgogICAgICAgICAg
ICByZXN1bHQgPSBzZWxmLmFkbWluX2NsaWVudC5kZXNjcmliZV9hY2xzKGFjbF9maWx0ZXIpCiAg
ICAgICAgICAgIGFjbHMgPSByZXN1bHRbMF0gaWYgaXNpbnN0YW5jZShyZXN1bHQsIHR1cGxlKSBl
bHNlIHJlc3VsdAogICAgICAgICAgICBhY2xzID0gYWNscyBpZiBpc2luc3RhbmNlKGFjbHMsIGxp
c3QpIGVsc2UgW10KCiAgICAgICAgICAgIGdyb3VwX25hbWVzID0gc2V0KCkKICAgICAgICAgICAg
Zm9yIGFjbCBpbiBhY2xzOgogICAgICAgICAgICAgICAgaWYgaGFzYXR0cihhY2wsICdyZXNvdXJj
ZV9wYXR0ZXJuJykgYW5kIGhhc2F0dHIoYWNsLnJlc291cmNlX3BhdHRlcm4sICdyZXNvdXJjZV9u
YW1lJyk6CiAgICAgICAgICAgICAgICAgICAgZ3JvdXBfbmFtZXMuYWRkKGFjbC5yZXNvdXJjZV9w
YXR0ZXJuLnJlc291cmNlX25hbWUpCgogICAgICAgICAgICBncm91cF9uYW1lcyA9IHNvcnRlZChs
aXN0KGdyb3VwX25hbWVzKSkKCiAgICAgICAgICAgIGlmIG5vdCBncm91cF9uYW1lczoKICAgICAg
ICAgICAgICAgIHNlbGYuX3Nob3dfbWVzc2FnZSgiTm8gY29uc3VtZXIgZ3JvdXBzIHdpdGggQUNM
cyBmb3VuZCIpCiAgICAgICAgICAgICAgICByZXR1cm4KCiAgICAgICAgICAgIGRlZiBvbl9zZWxl
Y3QoYnV0dG9uLCBncm91cF9uYW1lKToKICAgICAgICAgICAgICAgICMgQWRkIGN1cnJlbnQgc2Vs
ZWN0aW9uIGRpYWxvZyB0byBzdGFjawogICAgICAgICAgICAgICAgc2VsZi5kaWFsb2dfc3RhY2su
YXBwZW5kKHNlbGYuX3Nob3dfZ3JvdXBzX3NlbGVjdGlvbikKICAgICAgICAgICAgICAgIHNlbGYu
X2Nsb3NlX2RpYWxvZygpCiAgICAgICAgICAgICAgICBzZWxmLl9zaG93X2dyb3VwX2FjbHMoZ3Jv
dXBfbmFtZSkKCiAgICAgICAgICAgIGRlZiBvbl9jYW5jZWwoYnRuKToKICAgICAgICAgICAgICAg
IHNlbGYuX2Nsb3NlX2RpYWxvZ19hbmRfcmV0dXJuKCkgICMgUmV0dXJuIHRvIHByZXZpb3VzIGRp
YWxvZwoKICAgICAgICAgICAgYnV0dG9ucyA9IFtdCiAgICAgICAgICAgIGZvciBncm91cCBpbiBn
cm91cF9uYW1lczoKICAgICAgICAgICAgICAgIGJ0biA9IHVyd2lkLkJ1dHRvbihncm91cCwgb25f
cHJlc3M9b25fc2VsZWN0LCB1c2VyX2RhdGE9Z3JvdXApCiAgICAgICAgICAgICAgICBidXR0b25z
LmFwcGVuZCh1cndpZC5BdHRyTWFwKGJ0biwgImJvZHkiLCBmb2N1c19tYXA9InJldmVyc2VkIikp
CgogICAgICAgICAgICBidXR0b25zLmFwcGVuZCh1cndpZC5EaXZpZGVyKCkpCiAgICAgICAgICAg
IGJ1dHRvbnMuYXBwZW5kKHVyd2lkLkF0dHJNYXAodXJ3aWQuQnV0dG9uKCJDYW5jZWwiLCBvbl9w
cmVzcz1vbl9jYW5jZWwpLCAiYnRuIiwgZm9jdXNfbWFwPSJidG5fZm9jdXMiKSkKCiAgICAgICAg
ICAgIHdhbGtlciA9IHVyd2lkLlNpbXBsZUZvY3VzTGlzdFdhbGtlcihidXR0b25zKQogICAgICAg
ICAgICBsaXN0Ym94ID0gdXJ3aWQuTGlzdEJveCh3YWxrZXIpCgogICAgICAgICAgICAjIEN1c3Rv
bSBMaXN0Qm94IHRoYXQgaGFuZGxlcyBFc2MKICAgICAgICAgICAgY2xhc3MgTGlzdEJveFdpdGhF
c2ModXJ3aWQuTGlzdEJveCk6CiAgICAgICAgICAgICAgICBkZWYgX19pbml0X18obGJfc2VsZiwg
d2Fsa2VyLCBwYXJlbnRfYXBwKToKICAgICAgICAgICAgICAgICAgICBzdXBlcigpLl9faW5pdF9f
KHdhbGtlcikKICAgICAgICAgICAgICAgICAgICBsYl9zZWxmLnBhcmVudF9hcHAgPSBwYXJlbnRf
YXBwCgogICAgICAgICAgICAgICAgZGVmIGtleXByZXNzKGxiX3NlbGYsIHNpemUsIGtleSk6CiAg
ICAgICAgICAgICAgICAgICAgaWYga2V5IGluICgnZXNjJywgJ3EnLCAnUScpOgogICAgICAgICAg
ICAgICAgICAgICAgICBsYl9zZWxmLnBhcmVudF9hcHAuX2Nsb3NlX2RpYWxvZ19hbmRfcmV0dXJu
KCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgICAgICAg
ICByZXR1cm4gc3VwZXIoKS5rZXlwcmVzcyhzaXplLCBrZXkpCgogICAgICAgICAgICBsaXN0Ym94
X3dpdGhfZXNjID0gTGlzdEJveFdpdGhFc2Mod2Fsa2VyLCBzZWxmKQoKICAgICAgICAgICAgYm94
ID0gdXJ3aWQuTGluZUJveCh1cndpZC5BdHRyTWFwKGxpc3Rib3hfd2l0aF9lc2MsICJkaWFsb2df
YmciKSwgdGl0bGU9IlNlbGVjdCBDb25zdW1lciBHcm91cCIpCgogICAgICAgICAgICBzZWxmLmRp
YWxvZ19vdmVybGF5ID0gdXJ3aWQuT3ZlcmxheSgKICAgICAgICAgICAgICAgIHRvcF93PXVyd2lk
LlBhZGRpbmcoYm94LCBsZWZ0PTIsIHJpZ2h0PTIpLAogICAgICAgICAgICAgICAgYm90dG9tX3c9
c2VsZi5tYWluX2ZyYW1lLAogICAgICAgICAgICAgICAgYWxpZ249ImNlbnRlciIsCiAgICAgICAg
ICAgICAgICB3aWR0aD0oInJlbGF0aXZlIiwgNjApLAogICAgICAgICAgICAgICAgdmFsaWduPSJt
aWRkbGUiLAogICAgICAgICAgICAgICAgaGVpZ2h0PSgicmVsYXRpdmUiLCA3MCksCiAgICAgICAg
ICAgICAgICBtaW5fd2lkdGg9NDAsCiAgICAgICAgICAgICAgICBtaW5faGVpZ2h0PTEwLAogICAg
ICAgICAgICApCiAgICAgICAgICAgIHNlbGYubG9vcC53aWRnZXQgPSBzZWxmLmRpYWxvZ19vdmVy
bGF5CgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmV4
Y2VwdGlvbigiRXJyb3IgbG9hZGluZyBjb25zdW1lciBncm91cHM6ICVzIiwgZSkKICAgICAgICAg
ICAgc2VsZi5fc2hvd19tZXNzYWdlKGYiRXJyb3IgbG9hZGluZyBjb25zdW1lciBncm91cHM6IHtl
fSIpCgogICAgZGVmIF9zaG93X2dyb3VwX2FjbHMoc2VsZiwgZ3JvdXBfbmFtZSk6CiAgICAgICAg
IiIiU2hvdyBBQ0xzIGZvciBhIHNwZWNpZmljIGNvbnN1bWVyIGdyb3VwIiIiCiAgICAgICAgdHJ5
OgogICAgICAgICAgICBmcm9tIGthZmthLmFkbWluLmFjbF9yZXNvdXJjZSBpbXBvcnQgKAogICAg
ICAgICAgICAgICAgQUNMRmlsdGVyLCBSZXNvdXJjZVBhdHRlcm4sIFJlc291cmNlVHlwZSwKICAg
ICAgICAgICAgICAgIEFDTE9wZXJhdGlvbiwgQUNMUGVybWlzc2lvblR5cGUsIEFDTFJlc291cmNl
UGF0dGVyblR5cGUKICAgICAgICAgICAgKQoKICAgICAgICAgICAgYWNsX2ZpbHRlciA9IEFDTEZp
bHRlcigKICAgICAgICAgICAgICAgIHByaW5jaXBhbD1Ob25lLAogICAgICAgICAgICAgICAgaG9z
dD1Ob25lLAogICAgICAgICAgICAgICAgb3BlcmF0aW9uPUFDTE9wZXJhdGlvbi5BTlksCiAgICAg
ICAgICAgICAgICBwZXJtaXNzaW9uX3R5cGU9QUNMUGVybWlzc2lvblR5cGUuQU5ZLAogICAgICAg
ICAgICAgICAgcmVzb3VyY2VfcGF0dGVybj1SZXNvdXJjZVBhdHRlcm4oCiAgICAgICAgICAgICAg
ICAgICAgUmVzb3VyY2VUeXBlLkdST1VQLAogICAgICAgICAgICAgICAgICAgIGdyb3VwX25hbWUs
CiAgICAgICAgICAgICAgICAgICAgQUNMUmVzb3VyY2VQYXR0ZXJuVHlwZS5MSVRFUkFMCiAgICAg
ICAgICAgICAgICApCiAgICAgICAgICAgICkKCiAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYuYWRt
aW5fY2xpZW50LmRlc2NyaWJlX2FjbHMoYWNsX2ZpbHRlcikKICAgICAgICAgICAgYWNscyA9IHJl
c3VsdFswXSBpZiBpc2luc3RhbmNlKHJlc3VsdCwgdHVwbGUpIGVsc2UgcmVzdWx0CiAgICAgICAg
ICAgIGFjbHMgPSBhY2xzIGlmIGlzaW5zdGFuY2UoYWNscywgbGlzdCkgZWxzZSBbXQoKICAgICAg
ICAgICAgY29udGVudF9saW5lcyA9IFtdCgogICAgICAgICAgICBpZiBub3QgYWNscyBvciBsZW4o
YWNscykgPT0gMDoKICAgICAgICAgICAgICAgIGNvbnRlbnRfbGluZXMuYXBwZW5kKCJObyBBQ0xz
IGNvbmZpZ3VyZWQgZm9yIHRoaXMgY29uc3VtZXIgZ3JvdXAiKQogICAgICAgICAgICBlbHNlOgog
ICAgICAgICAgICAgICAgaGVhZGVyID0gZiJ7J1ByaW5jaXBhbCc6PDI1fSB7J0hvc3QnOjwxNX0g
eydPcGVyYXRpb24nOjwxNX0geydQZXJtaXNzaW9uJzo8MTJ9IHsnUGF0dGVyblR5cGUnOjwxMn0i
CiAgICAgICAgICAgICAgICBjb250ZW50X2xpbmVzLmFwcGVuZChoZWFkZXIpCiAgICAgICAgICAg
ICAgICBjb250ZW50X2xpbmVzLmFwcGVuZCgiLSIgKiA3OSkKCiAgICAgICAgICAgICAgICBmb3Ig
YWNsIGluIGFjbHM6CiAgICAgICAgICAgICAgICAgICAgcHJpbmNpcGFsID0gZ2V0YXR0cihhY2ws
ICdwcmluY2lwYWwnLCAnTi9BJykgb3IgIk4vQSIKICAgICAgICAgICAgICAgICAgICBob3N0ID0g
Z2V0YXR0cihhY2wsICdob3N0JywgJyonKSBvciAiKiIKICAgICAgICAgICAgICAgICAgICBvcGVy
YXRpb24gPSBhY2wub3BlcmF0aW9uLm5hbWUgaWYgaGFzYXR0cihhY2wsICdvcGVyYXRpb24nKSBh
bmQgaGFzYXR0cihhY2wub3BlcmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICduYW1lJykgZWxzZSAiTi9BIgogICAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb24gPSBh
Y2wucGVybWlzc2lvbl90eXBlLm5hbWUgaWYgaGFzYXR0cihhY2wsICdwZXJtaXNzaW9uX3R5cGUn
KSBhbmQgaGFzYXR0cigKICAgICAgICAgICAgICAgICAgICAgICAgYWNsLnBlcm1pc3Npb25fdHlw
ZSwgJ25hbWUnKSBlbHNlICJOL0EiCiAgICAgICAgICAgICAgICAgICAgcGF0dGVybl90eXBlID0g
YWNsLnJlc291cmNlX3BhdHRlcm4ucGF0dGVybl90eXBlLm5hbWUgaWYgaGFzYXR0cihhY2wucmVz
b3VyY2VfcGF0dGVybiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwYXR0ZXJuX3R5cGUn
KSBhbmQgaGFzYXR0cigKICAgICAgICAgICAgICAgICAgICAgICAgYWNsLnJlc291cmNlX3BhdHRl
cm4ucGF0dGVybl90eXBlLCAnbmFtZScpIGVsc2UgIkxpdGVyYWwiCgogICAgICAgICAgICAgICAg
ICAgIGxpbmUgPSBmIntwcmluY2lwYWw6PDI1fSB7aG9zdDo8MTV9IHtvcGVyYXRpb246PDE1fSB7
cGVybWlzc2lvbjo8MTJ9IHtwYXR0ZXJuX3R5cGU6PDEyfSIKICAgICAgICAgICAgICAgICAgICBj
b250ZW50X2xpbmVzLmFwcGVuZChsaW5lKQoKICAgICAgICAgICAgc2VsZi5fc2hvd19nZW5lcmlj
X2FjbF9kaWFsb2dfd2l0aF9iYWNrKGYiQUNMcyBmb3IgR1JPVVA6IHtncm91cF9uYW1lfSIsIGNv
bnRlbnRfbGluZXMpCgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAg
IyB0cmFjZWJhY2sucHJpbnRfZXhjKCkKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbigiRXJy
b3IgbG9hZGluZyBncm91cCBBQ0xzOiAlcyIsIGUpCiAgICAgICAgICAgIHNlbGYuX3Nob3dfbWVz
c2FnZShmIkVycm9yIGxvYWRpbmcgZ3JvdXAgQUNMczoge2V9IikKCiAgICBkZWYgX3Nob3dfZ2Vu
ZXJpY19hY2xfZGlhbG9nX3dpdGhfYmFjayhzZWxmLCB0aXRsZSwgY29udGVudF9saW5lcyk6CiAg
ICAgICAgIiIiR2VuZXJpYyBkaWFsb2cgdG8gc2hvdyBBQ0wgY29udGVudCB3aXRoIGJhY2sgbmF2
aWdhdGlvbiIiIgogICAgICAgIHZpZXdfd2Fsa2VyID0gdXJ3aWQuU2ltcGxlRm9jdXNMaXN0V2Fs
a2VyKFtTZWxlY3RhYmxlVGV4dChsbikgZm9yIGxuIGluIGNvbnRlbnRfbGluZXNdKQogICAgICAg
IHZpZXdfbGlzdCA9IHVyd2lkLkxpc3RCb3godmlld193YWxrZXIpCgogICAgICAgIGZvb3Rlcl90
ZXh0ID0gdXJ3aWQuVGV4dCgi4oaR4oaTIFBnVXAvUGdEbi9Ib21lL0VuZCDigJMgc2Nyb2xsIHwg
RXNjIOKAkyBiYWNrIiwgYWxpZ249ImNlbnRlciIpCiAgICAgICAgZm9vdGVyID0gdXJ3aWQuQXR0
ck1hcChmb290ZXJfdGV4dCwgImZvb3RlciIpCgogICAgICAgICMgQ3VzdG9tIEZyYW1lIHRoYXQg
aGFuZGxlcyBFc2MgZm9yIGJhY2sgbmF2aWdhdGlvbgogICAgICAgIGNsYXNzIEZyYW1lV2l0aEJh
Y2sodXJ3aWQuRnJhbWUpOgogICAgICAgICAgICBkZWYgX19pbml0X18oZnJhbWVfc2VsZiwgYm9k
eSwgZm9vdGVyLCBwYXJlbnRfYXBwKToKICAgICAgICAgICAgICAgIHN1cGVyKCkuX19pbml0X18o
Ym9keSwgZm9vdGVyPWZvb3RlcikKICAgICAgICAgICAgICAgIGZyYW1lX3NlbGYucGFyZW50X2Fw
cCA9IHBhcmVudF9hcHAKCiAgICAgICAgICAgIGRlZiBrZXlwcmVzcyhmcmFtZV9zZWxmLCBzaXpl
LCBrZXkpOgogICAgICAgICAgICAgICAgaWYga2V5IGluICgnZXNjJywgJ3EnLCAnUScpOgogICAg
ICAgICAgICAgICAgICAgIGZyYW1lX3NlbGYucGFyZW50X2FwcC5fY2xvc2VfZGlhbG9nX2FuZF9y
ZXR1cm4oKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgICAgICBy
ZXR1cm4gc3VwZXIoKS5rZXlwcmVzcyhzaXplLCBrZXkpCgogICAgICAgIGZyYW1lID0gRnJhbWVX
aXRoQmFjayh1cndpZC5BdHRyTWFwKHZpZXdfbGlzdCwgImRpYWxvZ19iZyIpLCBmb290ZXIsIHNl
bGYpCgogICAgICAgIGJveCA9IHVyd2lkLkxpbmVCb3goZnJhbWUsIHRpdGxlPXRpdGxlKQoKICAg
ICAgICBzZWxmLmRpYWxvZ19vdmVybGF5ID0gdXJ3aWQuT3ZlcmxheSgKICAgICAgICAgICAgdG9w
X3c9dXJ3aWQuUGFkZGluZyhib3gsIGxlZnQ9MiwgcmlnaHQ9MiksCiAgICAgICAgICAgIGJvdHRv
bV93PXNlbGYubWFpbl9mcmFtZSwKICAgICAgICAgICAgYWxpZ249ImNlbnRlciIsCiAgICAgICAg
ICAgIHdpZHRoPSgicmVsYXRpdmUiLCA5NSksCiAgICAgICAgICAgIHZhbGlnbj0ibWlkZGxlIiwK
ICAgICAgICAgICAgaGVpZ2h0PSgicmVsYXRpdmUiLCA4MCksCiAgICAgICAgICAgIG1pbl93aWR0
aD04MCwKICAgICAgICAgICAgbWluX2hlaWdodD0xNSwKICAgICAgICApCiAgICAgICAgc2VsZi5s
b29wLndpZGdldCA9IHNlbGYuZGlhbG9nX292ZXJsYXkKCiAgICBkZWYgX3Nob3dfY2x1c3Rlcl9h
Y2xzKHNlbGYpOgogICAgICAgICIiIlNob3cgQUNMcyBmb3IgY2x1c3RlciIiIgogICAgICAgIHRy
eToKICAgICAgICAgICAgZnJvbSBrYWZrYS5hZG1pbi5hY2xfcmVzb3VyY2UgaW1wb3J0ICgKICAg
ICAgICAgICAgICAgIEFDTEZpbHRlciwgUmVzb3VyY2VQYXR0ZXJuLCBSZXNvdXJjZVR5cGUsCiAg
ICAgICAgICAgICAgICBBQ0xPcGVyYXRpb24sIEFDTFBlcm1pc3Npb25UeXBlLCBBQ0xSZXNvdXJj
ZVBhdHRlcm5UeXBlCiAgICAgICAgICAgICkKCiAgICAgICAgICAgIGFjbF9maWx0ZXIgPSBBQ0xG
aWx0ZXIoCiAgICAgICAgICAgICAgICBwcmluY2lwYWw9Tm9uZSwKICAgICAgICAgICAgICAgIGhv
c3Q9Tm9uZSwKICAgICAgICAgICAgICAgIG9wZXJhdGlvbj1BQ0xPcGVyYXRpb24uQU5ZLAogICAg
ICAgICAgICAgICAgcGVybWlzc2lvbl90eXBlPUFDTFBlcm1pc3Npb25UeXBlLkFOWSwKICAgICAg
ICAgICAgICAgIHJlc291cmNlX3BhdHRlcm49UmVzb3VyY2VQYXR0ZXJuKAogICAgICAgICAgICAg
ICAgICAgIFJlc291cmNlVHlwZS5DTFVTVEVSLAogICAgICAgICAgICAgICAgICAgICJrYWZrYS1j
bHVzdGVyIiwgICMgU3RhbmRhcmQgY2x1c3RlciBuYW1lCiAgICAgICAgICAgICAgICAgICAgQUNM
UmVzb3VyY2VQYXR0ZXJuVHlwZS5MSVRFUkFMCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAg
ICkKCiAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYuYWRtaW5fY2xpZW50LmRlc2NyaWJlX2FjbHMo
YWNsX2ZpbHRlcikKICAgICAgICAgICAgYWNscyA9IHJlc3VsdFswXSBpZiBpc2luc3RhbmNlKHJl
c3VsdCwgdHVwbGUpIGVsc2UgcmVzdWx0CiAgICAgICAgICAgIGFjbHMgPSBhY2xzIGlmIGlzaW5z
dGFuY2UoYWNscywgbGlzdCkgZWxzZSBbXQoKICAgICAgICAgICAgY29udGVudF9saW5lcyA9IFtd
CgogICAgICAgICAgICBpZiBub3QgYWNscyBvciBsZW4oYWNscykgPT0gMDoKICAgICAgICAgICAg
ICAgIGNvbnRlbnRfbGluZXMuYXBwZW5kKCJObyBBQ0xzIGNvbmZpZ3VyZWQgZm9yIGNsdXN0ZXIi
KQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaGVhZGVyID0gZiJ7J1ByaW5jaXBh
bCc6PDI1fSB7J0hvc3QnOjwxNX0geydPcGVyYXRpb24nOjwyMH0geydQZXJtaXNzaW9uJzo8MTJ9
IgogICAgICAgICAgICAgICAgY29udGVudF9saW5lcy5hcHBlbmQoaGVhZGVyKQogICAgICAgICAg
ICAgICAgY29udGVudF9saW5lcy5hcHBlbmQoIi0iICogNzIpCgogICAgICAgICAgICAgICAgZm9y
IGFjbCBpbiBhY2xzOgogICAgICAgICAgICAgICAgICAgIHByaW5jaXBhbCA9IGdldGF0dHIoYWNs
LCAncHJpbmNpcGFsJywgJ04vQScpIG9yICJOL0EiCiAgICAgICAgICAgICAgICAgICAgaG9zdCA9
IGdldGF0dHIoYWNsLCAnaG9zdCcsICcqJykgb3IgIioiCiAgICAgICAgICAgICAgICAgICAgb3Bl
cmF0aW9uID0gYWNsLm9wZXJhdGlvbi5uYW1lIGlmIGhhc2F0dHIoYWNsLCAnb3BlcmF0aW9uJykg
YW5kIGhhc2F0dHIoYWNsLm9wZXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAnbmFtZScpIGVsc2UgIk4vQSIKICAgICAgICAgICAgICAgICAgICBwZXJtaXNzaW9uID0g
YWNsLnBlcm1pc3Npb25fdHlwZS5uYW1lIGlmIGhhc2F0dHIoYWNsLCAncGVybWlzc2lvbl90eXBl
JykgYW5kIGhhc2F0dHIoCiAgICAgICAgICAgICAgICAgICAgICAgIGFjbC5wZXJtaXNzaW9uX3R5
cGUsICduYW1lJykgZWxzZSAiTi9BIgoKICAgICAgICAgICAgICAgICAgICBsaW5lID0gZiJ7cHJp
bmNpcGFsOjwyNX0ge2hvc3Q6PDE1fSB7b3BlcmF0aW9uOjwyMH0ge3Blcm1pc3Npb246PDEyfSIK
ICAgICAgICAgICAgICAgICAgICBjb250ZW50X2xpbmVzLmFwcGVuZChsaW5lKQoKICAgICAgICAg
ICAgc2VsZi5fc2hvd19nZW5lcmljX2FjbF9kaWFsb2coIkFDTHMgZm9yIENMVVNURVIiLCBjb250
ZW50X2xpbmVzKQoKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICMg
dHJhY2ViYWNrLnByaW50X2V4YygpCiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oIkVycm9y
IGxvYWRpbmcgY2x1c3RlciBBQ0xzOiAlcyIsIGUpCiAgICAgICAgICAgIHNlbGYuX3Nob3dfbWVz
c2FnZShmIkVycm9yIGxvYWRpbmcgY2x1c3RlciBBQ0xzOiB7ZX0iKQoKICAgIGRlZiBfc2hvd190
cmFuc2FjdGlvbmFsX3NlbGVjdGlvbihzZWxmKToKICAgICAgICAiIiJTaG93IGRpYWxvZyB0byBl
bnRlciB0cmFuc2FjdGlvbmFsIElEIiIiCgogICAgICAgIGRlZiBvbl92aWV3KGJ0bik6CiAgICAg
ICAgICAgIHR4bl9pZCA9IHR4bl9lZGl0LmVkaXRfdGV4dC5zdHJpcCgpCiAgICAgICAgICAgIGlm
IHR4bl9pZDoKICAgICAgICAgICAgICAgIHNlbGYuX2Nsb3NlX2RpYWxvZygpCiAgICAgICAgICAg
ICAgICBzZWxmLl9zaG93X3RyYW5zYWN0aW9uYWxfYWNscyh0eG5faWQpCiAgICAgICAgICAgIGVs
c2U6CiAgICAgICAgICAgICAgICBzZWxmLl9zaG93X21lc3NhZ2UoIlBsZWFzZSBlbnRlciBhIHRy
YW5zYWN0aW9uYWwgSUQiKQoKICAgICAgICBkZWYgb25fY2FuY2VsKGJ0bik6CiAgICAgICAgICAg
IHNlbGYuX2Nsb3NlX2RpYWxvZygpCgogICAgICAgIGNsYXNzIEVkaXRXaXRoRW50ZXIodXJ3aWQu
RWRpdCk6CiAgICAgICAgICAgIGRlZiBrZXlwcmVzcyhzZWxmLCBzaXplLCBrZXkpOgogICAgICAg
ICAgICAgICAgaWYga2V5ID09ICdlbnRlcic6CiAgICAgICAgICAgICAgICAgICAgb25fdmlldyhO
b25lKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgICAgICByZXR1
cm4gc3VwZXIoKS5rZXlwcmVzcyhzaXplLCBrZXkpCgogICAgICAgIHR4bl9lZGl0ID0gRWRpdFdp
dGhFbnRlcigiVHJhbnNhY3Rpb25hbCBJRDogIikKCiAgICAgICAgcGlsZSA9IHVyd2lkLlBpbGUo
WwogICAgICAgICAgICB1cndpZC5UZXh0KCJFbnRlciBUcmFuc2FjdGlvbmFsIElEOiIpLAogICAg
ICAgICAgICB1cndpZC5EaXZpZGVyKCksCiAgICAgICAgICAgIHR4bl9lZGl0LAogICAgICAgICAg
ICB1cndpZC5EaXZpZGVyKCksCiAgICAgICAgICAgIHVyd2lkLkF0dHJNYXAodXJ3aWQuQnV0dG9u
KCJWaWV3IEFDTHMiLCBvbl9wcmVzcz1vbl92aWV3KSwgImJ0biIsIGZvY3VzX21hcD0iYnRuX2Zv
Y3VzIiksCiAgICAgICAgICAgIHVyd2lkLkF0dHJNYXAodXJ3aWQuQnV0dG9uKCJDYW5jZWwiLCBv
bl9wcmVzcz1vbl9jYW5jZWwpLCAiYnRuIiwgZm9jdXNfbWFwPSJidG5fZm9jdXMiKSwKICAgICAg
ICBdKQoKICAgICAgICBzZWxmLl9zaG93X2RpYWxvZyhwaWxlLCAiVHJhbnNhY3Rpb25hbCBJRCIp
CgogICAgZGVmIF9zaG93X3RyYW5zYWN0aW9uYWxfYWNscyhzZWxmLCB0eG5faWQpOgogICAgICAg
ICIiIlNob3cgQUNMcyBmb3IgYSBzcGVjaWZpYyB0cmFuc2FjdGlvbmFsIElEIiIiCiAgICAgICAg
dHJ5OgogICAgICAgICAgICBmcm9tIGthZmthLmFkbWluLmFjbF9yZXNvdXJjZSBpbXBvcnQgKAog
ICAgICAgICAgICAgICAgQUNMRmlsdGVyLCBSZXNvdXJjZVBhdHRlcm4sIFJlc291cmNlVHlwZSwK
ICAgICAgICAgICAgICAgIEFDTE9wZXJhdGlvbiwgQUNMUGVybWlzc2lvblR5cGUsIEFDTFJlc291
cmNlUGF0dGVyblR5cGUKICAgICAgICAgICAgKQoKICAgICAgICAgICAgYWNsX2ZpbHRlciA9IEFD
TEZpbHRlcigKICAgICAgICAgICAgICAgIHByaW5jaXBhbD1Ob25lLAogICAgICAgICAgICAgICAg
aG9zdD1Ob25lLAogICAgICAgICAgICAgICAgb3BlcmF0aW9uPUFDTE9wZXJhdGlvbi5BTlksCiAg
ICAgICAgICAgICAgICBwZXJtaXNzaW9uX3R5cGU9QUNMUGVybWlzc2lvblR5cGUuQU5ZLAogICAg
ICAgICAgICAgICAgcmVzb3VyY2VfcGF0dGVybj1SZXNvdXJjZVBhdHRlcm4oCiAgICAgICAgICAg
ICAgICAgICAgUmVzb3VyY2VUeXBlLlRSQU5TQUNUSU9OQUxfSUQsCiAgICAgICAgICAgICAgICAg
ICAgdHhuX2lkLAogICAgICAgICAgICAgICAgICAgIEFDTFJlc291cmNlUGF0dGVyblR5cGUuTElU
RVJBTAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApCgogICAgICAgICAgICByZXN1bHQg
PSBzZWxmLmFkbWluX2NsaWVudC5kZXNjcmliZV9hY2xzKGFjbF9maWx0ZXIpCiAgICAgICAgICAg
IGFjbHMgPSByZXN1bHRbMF0gaWYgaXNpbnN0YW5jZShyZXN1bHQsIHR1cGxlKSBlbHNlIHJlc3Vs
dAogICAgICAgICAgICBhY2xzID0gYWNscyBpZiBpc2luc3RhbmNlKGFjbHMsIGxpc3QpIGVsc2Ug
W10KCiAgICAgICAgICAgIGNvbnRlbnRfbGluZXMgPSBbXQoKICAgICAgICAgICAgaWYgbm90IGFj
bHMgb3IgbGVuKGFjbHMpID09IDA6CiAgICAgICAgICAgICAgICBjb250ZW50X2xpbmVzLmFwcGVu
ZCgiTm8gQUNMcyBjb25maWd1cmVkIGZvciB0aGlzIHRyYW5zYWN0aW9uYWwgSUQiKQogICAgICAg
ICAgICBlbHNlOgogICAgICAgICAgICAgICAgaGVhZGVyID0gZiJ7J1ByaW5jaXBhbCc6PDI1fSB7
J0hvc3QnOjwxNX0geydPcGVyYXRpb24nOjwxNX0geydQZXJtaXNzaW9uJzo8MTJ9IHsnUGF0dGVy
blR5cGUnOjwxMn0iCiAgICAgICAgICAgICAgICBjb250ZW50X2xpbmVzLmFwcGVuZChoZWFkZXIp
CiAgICAgICAgICAgICAgICBjb250ZW50X2xpbmVzLmFwcGVuZCgiLSIgKiA3OSkKCiAgICAgICAg
ICAgICAgICBmb3IgYWNsIGluIGFjbHM6CiAgICAgICAgICAgICAgICAgICAgcHJpbmNpcGFsID0g
Z2V0YXR0cihhY2wsICdwcmluY2lwYWwnLCAnTi9BJykgb3IgIk4vQSIKICAgICAgICAgICAgICAg
ICAgICBob3N0ID0gZ2V0YXR0cihhY2wsICdob3N0JywgJyonKSBvciAiKiIKICAgICAgICAgICAg
ICAgICAgICBvcGVyYXRpb24gPSBhY2wub3BlcmF0aW9uLm5hbWUgaWYgaGFzYXR0cihhY2wsICdv
cGVyYXRpb24nKSBhbmQgaGFzYXR0cihhY2wub3BlcmF0aW9uLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICduYW1lJykgZWxzZSAiTi9BIgogICAgICAgICAgICAgICAgICAgIHBl
cm1pc3Npb24gPSBhY2wucGVybWlzc2lvbl90eXBlLm5hbWUgaWYgaGFzYXR0cihhY2wsICdwZXJt
aXNzaW9uX3R5cGUnKSBhbmQgaGFzYXR0cigKICAgICAgICAgICAgICAgICAgICAgICAgYWNsLnBl
cm1pc3Npb25fdHlwZSwgJ25hbWUnKSBlbHNlICJOL0EiCiAgICAgICAgICAgICAgICAgICAgcGF0
dGVybl90eXBlID0gYWNsLnJlc291cmNlX3BhdHRlcm4ucGF0dGVybl90eXBlLm5hbWUgaWYgaGFz
YXR0cihhY2wucmVzb3VyY2VfcGF0dGVybiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdw
YXR0ZXJuX3R5cGUnKSBhbmQgaGFzYXR0cigKICAgICAgICAgICAgICAgICAgICAgICAgYWNsLnJl
c291cmNlX3BhdHRlcm4ucGF0dGVybl90eXBlLCAnbmFtZScpIGVsc2UgIkxpdGVyYWwiCgogICAg
ICAgICAgICAgICAgICAgIGxpbmUgPSBmIntwcmluY2lwYWw6PDI1fSB7aG9zdDo8MTV9IHtvcGVy
YXRpb246PDE1fSB7cGVybWlzc2lvbjo8MTJ9IHtwYXR0ZXJuX3R5cGU6PDEyfSIKICAgICAgICAg
ICAgICAgICAgICBjb250ZW50X2xpbmVzLmFwcGVuZChsaW5lKQoKICAgICAgICAgICAgc2VsZi5f
c2hvd19nZW5lcmljX2FjbF9kaWFsb2coZiJBQ0xzIGZvciBUUkFOU0FDVElPTkFMX0lEOiB7dHhu
X2lkfSIsIGNvbnRlbnRfbGluZXMpCgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAg
ICAgICAgICAgIyB0cmFjZWJhY2sucHJpbnRfZXhjKCkKICAgICAgICAgICAgbG9nZ2VyLmV4Y2Vw
dGlvbigiRXJyb3IgbG9hZGluZyB0cmFuc2FjdGlvbmFsIEFDTHM6ICVzIiwgZSkKICAgICAgICAg
ICAgc2VsZi5fc2hvd19tZXNzYWdlKGYiRXJyb3IgbG9hZGluZyB0cmFuc2FjdGlvbmFsIEFDTHM6
IHtlfSIpCgogICAgZGVmIF9zaG93X3ByaW5jaXBhbF9zZWxlY3Rpb24oc2VsZik6CiAgICAgICAg
IiIiU2hvdyBkaWFsb2cgdG8gc2VsZWN0IGEgcHJpbmNpcGFsIGZyb20gYWxsIEFDTHMiIiIKICAg
ICAgICB0cnk6CiAgICAgICAgICAgIGZyb20ga2Fma2EuYWRtaW4uYWNsX3Jlc291cmNlIGltcG9y
dCAoCiAgICAgICAgICAgICAgICBBQ0xGaWx0ZXIsIFJlc291cmNlUGF0dGVybiwgUmVzb3VyY2VU
eXBlLCBSZXNvdXJjZVBhdHRlcm5GaWx0ZXIsCiAgICAgICAgICAgICAgICBBQ0xPcGVyYXRpb24s
IEFDTFBlcm1pc3Npb25UeXBlLCBBQ0xSZXNvdXJjZVBhdHRlcm5UeXBlCiAgICAgICAgICAgICkK
CiAgICAgICAgICAgIGFjbF9maWx0ZXIgPSBBQ0xGaWx0ZXIoCiAgICAgICAgICAgICAgICBwcmlu
Y2lwYWw9Tm9uZSwKICAgICAgICAgICAgICAgIGhvc3Q9Tm9uZSwKICAgICAgICAgICAgICAgIG9w
ZXJhdGlvbj1BQ0xPcGVyYXRpb24uQU5ZLAogICAgICAgICAgICAgICAgcGVybWlzc2lvbl90eXBl
PUFDTFBlcm1pc3Npb25UeXBlLkFOWSwKICAgICAgICAgICAgICAgIHJlc291cmNlX3BhdHRlcm49
UmVzb3VyY2VQYXR0ZXJuRmlsdGVyKAogICAgICAgICAgICAgICAgICAgIFJlc291cmNlVHlwZS5B
TlksCiAgICAgICAgICAgICAgICAgICAgTm9uZSwKICAgICAgICAgICAgICAgICAgICBBQ0xSZXNv
dXJjZVBhdHRlcm5UeXBlLkFOWQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApCgogICAg
ICAgICAgICByZXN1bHQgPSBzZWxmLmFkbWluX2NsaWVudC5kZXNjcmliZV9hY2xzKGFjbF9maWx0
ZXIpCiAgICAgICAgICAgIGFjbHMgPSByZXN1bHRbMF0gaWYgaXNpbnN0YW5jZShyZXN1bHQsIHR1
cGxlKSBlbHNlIHJlc3VsdAogICAgICAgICAgICBhY2xzID0gYWNscyBpZiBpc2luc3RhbmNlKGFj
bHMsIGxpc3QpIGVsc2UgW10KCiAgICAgICAgICAgIHByaW5jaXBhbHMgPSBzZXQoKQogICAgICAg
ICAgICBmb3IgYWNsIGluIGFjbHM6CiAgICAgICAgICAgICAgICBpZiBoYXNhdHRyKGFjbCwgJ3By
aW5jaXBhbCcpOgogICAgICAgICAgICAgICAgICAgIHByaW5jaXBhbHMuYWRkKGFjbC5wcmluY2lw
YWwpCgogICAgICAgICAgICBwcmluY2lwYWxzID0gc29ydGVkKGxpc3QocHJpbmNpcGFscykpCgog
ICAgICAgICAgICBpZiBub3QgcHJpbmNpcGFsczoKICAgICAgICAgICAgICAgIHNlbGYuX3Nob3df
bWVzc2FnZSgiTm8gcHJpbmNpcGFscyBmb3VuZCIpCiAgICAgICAgICAgICAgICByZXR1cm4KCiAg
ICAgICAgICAgIGRlZiBvbl9zZWxlY3QoYnV0dG9uLCBwcmluY2lwYWwpOgogICAgICAgICAgICAg
ICAgc2VsZi5kaWFsb2dfc3RhY2suYXBwZW5kKHNlbGYuX3Nob3dfcHJpbmNpcGFsX3NlbGVjdGlv
bikKICAgICAgICAgICAgICAgIHNlbGYuX2Nsb3NlX2RpYWxvZygpCiAgICAgICAgICAgICAgICBz
ZWxmLl9zaG93X3ByaW5jaXBhbF9hY2xzKHByaW5jaXBhbCkKCiAgICAgICAgICAgIGRlZiBvbl9j
YW5jZWwoYnRuKToKICAgICAgICAgICAgICAgIHNlbGYuX2Nsb3NlX2RpYWxvZ19hbmRfcmV0dXJu
KCkKCiAgICAgICAgICAgIGJ1dHRvbnMgPSBbXQogICAgICAgICAgICBmb3IgcHJpbmNpcGFsIGlu
IHByaW5jaXBhbHM6CiAgICAgICAgICAgICAgICBidG4gPSB1cndpZC5CdXR0b24ocHJpbmNpcGFs
LCBvbl9wcmVzcz1vbl9zZWxlY3QsIHVzZXJfZGF0YT1wcmluY2lwYWwpCiAgICAgICAgICAgICAg
ICBidXR0b25zLmFwcGVuZCh1cndpZC5BdHRyTWFwKGJ0biwgImJvZHkiLCBmb2N1c19tYXA9InJl
dmVyc2VkIikpCgogICAgICAgICAgICBidXR0b25zLmFwcGVuZCh1cndpZC5EaXZpZGVyKCkpCiAg
ICAgICAgICAgIGJ1dHRvbnMuYXBwZW5kKHVyd2lkLkF0dHJNYXAodXJ3aWQuQnV0dG9uKCJDYW5j
ZWwiLCBvbl9wcmVzcz1vbl9jYW5jZWwpLCAiYnRuIiwgZm9jdXNfbWFwPSJidG5fZm9jdXMiKSkK
CiAgICAgICAgICAgIHdhbGtlciA9IHVyd2lkLlNpbXBsZUZvY3VzTGlzdFdhbGtlcihidXR0b25z
KQoKICAgICAgICAgICAgY2xhc3MgTGlzdEJveFdpdGhFc2ModXJ3aWQuTGlzdEJveCk6CiAgICAg
ICAgICAgICAgICBkZWYgX19pbml0X18obGJfc2VsZiwgd2Fsa2VyLCBwYXJlbnRfYXBwKToKICAg
ICAgICAgICAgICAgICAgICBzdXBlcigpLl9faW5pdF9fKHdhbGtlcikKICAgICAgICAgICAgICAg
ICAgICBsYl9zZWxmLnBhcmVudF9hcHAgPSBwYXJlbnRfYXBwCgogICAgICAgICAgICAgICAgZGVm
IGtleXByZXNzKGxiX3NlbGYsIHNpemUsIGtleSk6CiAgICAgICAgICAgICAgICAgICAgaWYga2V5
IGluICgnZXNjJywgJ3EnLCAnUScpOgogICAgICAgICAgICAgICAgICAgICAgICBsYl9zZWxmLnBh
cmVudF9hcHAuX2Nsb3NlX2RpYWxvZ19hbmRfcmV0dXJuKCkKICAgICAgICAgICAgICAgICAgICAg
ICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIoKS5rZXlwcmVz
cyhzaXplLCBrZXkpCgogICAgICAgICAgICBsaXN0Ym94ID0gTGlzdEJveFdpdGhFc2Mod2Fsa2Vy
LCBzZWxmKQoKICAgICAgICAgICAgYm94ID0gdXJ3aWQuTGluZUJveCh1cndpZC5BdHRyTWFwKGxp
c3Rib3gsICJkaWFsb2dfYmciKSwgdGl0bGU9IlNlbGVjdCBQcmluY2lwYWwiKQoKICAgICAgICAg
ICAgc2VsZi5kaWFsb2dfb3ZlcmxheSA9IHVyd2lkLk92ZXJsYXkoCiAgICAgICAgICAgICAgICB0
b3Bfdz11cndpZC5QYWRkaW5nKGJveCwgbGVmdD0yLCByaWdodD0yKSwKICAgICAgICAgICAgICAg
IGJvdHRvbV93PXNlbGYubWFpbl9mcmFtZSwKICAgICAgICAgICAgICAgIGFsaWduPSJjZW50ZXIi
LAogICAgICAgICAgICAgICAgd2lkdGg9KCJyZWxhdGl2ZSIsIDYwKSwKICAgICAgICAgICAgICAg
IHZhbGlnbj0ibWlkZGxlIiwKICAgICAgICAgICAgICAgIGhlaWdodD0oInJlbGF0aXZlIiwgNzAp
LAogICAgICAgICAgICAgICAgbWluX3dpZHRoPTQwLAogICAgICAgICAgICAgICAgbWluX2hlaWdo
dD0xMCwKICAgICAgICAgICAgKQogICAgICAgICAgICBzZWxmLmxvb3Aud2lkZ2V0ID0gc2VsZi5k
aWFsb2dfb3ZlcmxheQoKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAg
ICMgdHJhY2ViYWNrLnByaW50X2V4YygpCiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oIkVy
cm9yIGxvYWRpbmcgcHJpbmNpcGFsczogJXMiLCBlKQogICAgICAgICAgICBzZWxmLl9zaG93X21l
c3NhZ2UoZiJFcnJvciBsb2FkaW5nIHByaW5jaXBhbHM6IHtlfSIpCgogICAgZGVmIF9zaG93X3By
aW5jaXBhbF9hY2xzKHNlbGYsIHByaW5jaXBhbCk6CiAgICAgICAgIiIiU2hvdyBhbGwgQUNMcyBm
b3IgYSBzcGVjaWZpYyBwcmluY2lwYWwgYWNyb3NzIGFsbCByZXNvdXJjZSB0eXBlcyIiIgogICAg
ICAgIHRyeToKICAgICAgICAgICAgZnJvbSBrYWZrYS5hZG1pbi5hY2xfcmVzb3VyY2UgaW1wb3J0
ICgKICAgICAgICAgICAgICAgIEFDTEZpbHRlciwgUmVzb3VyY2VQYXR0ZXJuLCBSZXNvdXJjZVR5
cGUsIFJlc291cmNlUGF0dGVybkZpbHRlciwKICAgICAgICAgICAgICAgIEFDTE9wZXJhdGlvbiwg
QUNMUGVybWlzc2lvblR5cGUsIEFDTFJlc291cmNlUGF0dGVyblR5cGUKICAgICAgICAgICAgKQoK
ICAgICAgICAgICAgYWNsX2ZpbHRlciA9IEFDTEZpbHRlcigKICAgICAgICAgICAgICAgIHByaW5j
aXBhbD1wcmluY2lwYWwsCiAgICAgICAgICAgICAgICBob3N0PU5vbmUsCiAgICAgICAgICAgICAg
ICBvcGVyYXRpb249QUNMT3BlcmF0aW9uLkFOWSwKICAgICAgICAgICAgICAgIHBlcm1pc3Npb25f
dHlwZT1BQ0xQZXJtaXNzaW9uVHlwZS5BTlksCiAgICAgICAgICAgICAgICByZXNvdXJjZV9wYXR0
ZXJuPVJlc291cmNlUGF0dGVybkZpbHRlcigKICAgICAgICAgICAgICAgICAgICBSZXNvdXJjZVR5
cGUuQU5ZLAogICAgICAgICAgICAgICAgICAgIE5vbmUsCiAgICAgICAgICAgICAgICAgICAgQUNM
UmVzb3VyY2VQYXR0ZXJuVHlwZS5BTlkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgKQoK
ICAgICAgICAgICAgcmVzdWx0ID0gc2VsZi5hZG1pbl9jbGllbnQuZGVzY3JpYmVfYWNscyhhY2xf
ZmlsdGVyKQogICAgICAgICAgICBhbGxfYWNscyA9IHJlc3VsdFswXSBpZiBpc2luc3RhbmNlKHJl
c3VsdCwgdHVwbGUpIGVsc2UgcmVzdWx0CiAgICAgICAgICAgIGFsbF9hY2xzID0gYWxsX2FjbHMg
aWYgaXNpbnN0YW5jZShhbGxfYWNscywgbGlzdCkgZWxzZSBbXQoKICAgICAgICAgICAgY29udGVu
dF9saW5lcyA9IFtdCgogICAgICAgICAgICBpZiBub3QgYWxsX2FjbHMgb3IgbGVuKGFsbF9hY2xz
KSA9PSAwOgogICAgICAgICAgICAgICAgY29udGVudF9saW5lcy5hcHBlbmQoZiJObyBBQ0xzIGNv
bmZpZ3VyZWQgZm9yIHByaW5jaXBhbDoge3ByaW5jaXBhbH0iKQogICAgICAgICAgICBlbHNlOgog
ICAgICAgICAgICAgICAgaGVhZGVyID0gZiJ7J1R5cGUnOjwxNX0geydSZXNvdXJjZSc6PDI1fSB7
J0hvc3QnOjwxMn0geydPcGVyYXRpb24nOjwxNX0geydQZXJtJzo8OH0geydQYXR0ZXJuJzo8MTB9
IgogICAgICAgICAgICAgICAgY29udGVudF9saW5lcy5hcHBlbmQoaGVhZGVyKQogICAgICAgICAg
ICAgICAgY29udGVudF9saW5lcy5hcHBlbmQoIi0iICogOTUpCgogICAgICAgICAgICAgICAgZm9y
IGFjbCBpbiBhbGxfYWNsczoKICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV90eXBlID0gYWNs
LnJlc291cmNlX3BhdHRlcm4ucmVzb3VyY2VfdHlwZS5uYW1lIGlmIGhhc2F0dHIoYWNsLnJlc291
cmNlX3BhdHRlcm4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZXNvdXJjZV90eXBl
JykgYW5kIGhhc2F0dHIoCiAgICAgICAgICAgICAgICAgICAgICAgIGFjbC5yZXNvdXJjZV9wYXR0
ZXJuLnJlc291cmNlX3R5cGUsICduYW1lJykgZWxzZSAiTi9BIgogICAgICAgICAgICAgICAgICAg
IHJlc291cmNlX25hbWUgPSBhY2wucmVzb3VyY2VfcGF0dGVybi5yZXNvdXJjZV9uYW1lIGlmIGhh
c2F0dHIoYWNsLnJlc291cmNlX3BhdHRlcm4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmVz
b3VyY2VfbmFtZScpIGVsc2UgIk4vQSIKICAgICAgICAgICAgICAgICAgICBob3N0ID0gZ2V0YXR0
cihhY2wsICdob3N0JywgJyonKSBvciAiKiIKICAgICAgICAgICAgICAgICAgICBvcGVyYXRpb24g
PSBhY2wub3BlcmF0aW9uLm5hbWUgaWYgaGFzYXR0cihhY2wsICdvcGVyYXRpb24nKSBhbmQgaGFz
YXR0cihhY2wub3BlcmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdu
YW1lJykgZWxzZSAiTi9BIgogICAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb24gPSBhY2wucGVy
bWlzc2lvbl90eXBlLm5hbWUgaWYgaGFzYXR0cihhY2wsICdwZXJtaXNzaW9uX3R5cGUnKSBhbmQg
aGFzYXR0cigKICAgICAgICAgICAgICAgICAgICAgICAgYWNsLnBlcm1pc3Npb25fdHlwZSwgJ25h
bWUnKSBlbHNlICJOL0EiCiAgICAgICAgICAgICAgICAgICAgcGF0dGVybl90eXBlID0gYWNsLnJl
c291cmNlX3BhdHRlcm4ucGF0dGVybl90eXBlLm5hbWUgaWYgaGFzYXR0cihhY2wucmVzb3VyY2Vf
cGF0dGVybiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwYXR0ZXJuX3R5cGUnKSBhbmQg
aGFzYXR0cigKICAgICAgICAgICAgICAgICAgICAgICAgYWNsLnJlc291cmNlX3BhdHRlcm4ucGF0
dGVybl90eXBlLCAnbmFtZScpIGVsc2UgIkxpdGVyYWwiCgogICAgICAgICAgICAgICAgICAgIGxp
bmUgPSBmIntyZXNvdXJjZV90eXBlOjwxNX0ge3Jlc291cmNlX25hbWU6PDI1fSB7aG9zdDo8MTJ9
IHtvcGVyYXRpb246PDE1fSB7cGVybWlzc2lvbjo8OH0ge3BhdHRlcm5fdHlwZTo8MTB9IgogICAg
ICAgICAgICAgICAgICAgIGNvbnRlbnRfbGluZXMuYXBwZW5kKGxpbmUpCgogICAgICAgICAgICBz
ZWxmLl9zaG93X2dlbmVyaWNfYWNsX2RpYWxvZ193aXRoX2JhY2soZiJBQ0xzIGZvciBQcmluY2lw
YWw6IHtwcmluY2lwYWx9IiwgY29udGVudF9saW5lcykKCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlv
biBhcyBlOgogICAgICAgICAgICAjIHRyYWNlYmFjay5wcmludF9leGMoKQogICAgICAgICAgICBs
b2dnZXIuZXhjZXB0aW9uKCJFcnJvciBsb2FkaW5nIHByaW5jaXBhbHMgQUNMczogJXMiLCBlKQog
ICAgICAgICAgICBzZWxmLl9zaG93X21lc3NhZ2UoZiJFcnJvciBsb2FkaW5nIHByaW5jaXBhbCBB
Q0xzOiB7ZX0iKQoKICAgIGRlZiBfc2hvd19nZW5lcmljX2FjbF9kaWFsb2coc2VsZiwgdGl0bGUs
IGNvbnRlbnRfbGluZXMpOgogICAgICAgICIiIkdlbmVyaWMgZGlhbG9nIHRvIHNob3cgQUNMIGNv
bnRlbnQiIiIKICAgICAgICB2aWV3X3dhbGtlciA9IHVyd2lkLlNpbXBsZUZvY3VzTGlzdFdhbGtl
cihbU2VsZWN0YWJsZVRleHQobG4pIGZvciBsbiBpbiBjb250ZW50X2xpbmVzXSkKICAgICAgICB2
aWV3X2xpc3QgPSB1cndpZC5MaXN0Qm94KHZpZXdfd2Fsa2VyKQoKICAgICAgICBmb290ZXJfdGV4
dCA9IHVyd2lkLlRleHQoIuKGkeKGkyBQZ1VwL1BnRG4vSG9tZS9FbmQg4oCTIHNjcm9sbCB8IEVz
YyDigJMgY2xvc2UiLCBhbGlnbj0iY2VudGVyIikKICAgICAgICBmb290ZXIgPSB1cndpZC5BdHRy
TWFwKGZvb3Rlcl90ZXh0LCAiZm9vdGVyIikKCiAgICAgICAgZnJhbWUgPSB1cndpZC5GcmFtZSgK
ICAgICAgICAgICAgdXJ3aWQuQXR0ck1hcCh2aWV3X2xpc3QsICJkaWFsb2dfYmciKSwKICAgICAg
ICAgICAgZm9vdGVyPWZvb3RlcgogICAgICAgICkKCiAgICAgICAgYm94ID0gdXJ3aWQuTGluZUJv
eChmcmFtZSwgdGl0bGU9dGl0bGUpCgogICAgICAgIHNlbGYuZGlhbG9nX292ZXJsYXkgPSB1cndp
ZC5PdmVybGF5KAogICAgICAgICAgICB0b3Bfdz11cndpZC5QYWRkaW5nKGJveCwgbGVmdD0yLCBy
aWdodD0yKSwKICAgICAgICAgICAgYm90dG9tX3c9c2VsZi5tYWluX2ZyYW1lLAogICAgICAgICAg
ICBhbGlnbj0iY2VudGVyIiwKICAgICAgICAgICAgd2lkdGg9KCJyZWxhdGl2ZSIsIDk1KSwKICAg
ICAgICAgICAgdmFsaWduPSJtaWRkbGUiLAogICAgICAgICAgICBoZWlnaHQ9KCJyZWxhdGl2ZSIs
IDgwKSwKICAgICAgICAgICAgbWluX3dpZHRoPTgwLAogICAgICAgICAgICBtaW5faGVpZ2h0PTE1
LAogICAgICAgICkKICAgICAgICBzZWxmLmxvb3Aud2lkZ2V0ID0gc2VsZi5kaWFsb2dfb3Zlcmxh
eQoKICAgIGRlZiBfc2hvd19zb3J0X2RpYWxvZyhzZWxmKToKICAgICAgICAiIiJTaG93IGRpYWxv
ZyB0byBjaG9vc2Ugc29ydCBtb2RlIGFuZCBkaXJlY3Rpb24iIiIKICAgICAgICAjIFJhZGlvIGJ1
dHRvbnMgZm9yIHNvcnQgbW9kZQogICAgICAgIHNvcnRfZ3JvdXAgPSBbXQogICAgICAgIHJiX3Vu
c29ydGVkID0gdXJ3aWQuUmFkaW9CdXR0b24oc29ydF9ncm91cCwgIlVuc29ydGVkIiwgc3RhdGU9
KHNlbGYuc29ydF9tb2RlID09ICJ1bnNvcnRlZCIpKQogICAgICAgIHJiX3RpbWVzdGFtcCA9IHVy
d2lkLlJhZGlvQnV0dG9uKHNvcnRfZ3JvdXAsICJUaW1lc3RhbXAiLCBzdGF0ZT0oc2VsZi5zb3J0
X21vZGUgPT0gInRpbWVzdGFtcCIpKQogICAgICAgIHJiX3BhcnRpdGlvbiA9IHVyd2lkLlJhZGlv
QnV0dG9uKHNvcnRfZ3JvdXAsICJQYXJ0aXRpb24iLCBzdGF0ZT0oc2VsZi5zb3J0X21vZGUgPT0g
InBhcnRpdGlvbiIpKQogICAgICAgIHJiX3NpemUgPSB1cndpZC5SYWRpb0J1dHRvbihzb3J0X2dy
b3VwLCAiU2l6ZSIsIHN0YXRlPShzZWxmLnNvcnRfbW9kZSA9PSAic2l6ZSIpKQoKICAgICAgICAj
IFJhZGlvIGJ1dHRvbnMgZm9yIGRpcmVjdGlvbgogICAgICAgIGRpcl9ncm91cCA9IFtdCiAgICAg
ICAgcmJfYXNjZW5kaW5nID0gdXJ3aWQuUmFkaW9CdXR0b24oZGlyX2dyb3VwLCAiQXNjZW5kaW5n
Iiwgc3RhdGU9c2VsZi5zb3J0X2FzY2VuZGluZykKICAgICAgICByYl9kZXNjZW5kaW5nID0gdXJ3
aWQuUmFkaW9CdXR0b24oZGlyX2dyb3VwLCAiRGVzY2VuZGluZyIsIHN0YXRlPW5vdCBzZWxmLnNv
cnRfYXNjZW5kaW5nKQoKICAgICAgICBkZWYgb25fYXBwbHkoYnRuKToKICAgICAgICAgICAgIyBE
ZXRlcm1pbmUgc2VsZWN0ZWQgc29ydCBtb2RlCiAgICAgICAgICAgIGlmIHJiX3Vuc29ydGVkLnN0
YXRlOgogICAgICAgICAgICAgICAgc2VsZi5zb3J0X21vZGUgPSAidW5zb3J0ZWQiCiAgICAgICAg
ICAgIGVsaWYgcmJfdGltZXN0YW1wLnN0YXRlOgogICAgICAgICAgICAgICAgc2VsZi5zb3J0X21v
ZGUgPSAidGltZXN0YW1wIgogICAgICAgICAgICBlbGlmIHJiX3BhcnRpdGlvbi5zdGF0ZToKICAg
ICAgICAgICAgICAgIHNlbGYuc29ydF9tb2RlID0gInBhcnRpdGlvbiIKICAgICAgICAgICAgZWxp
ZiByYl9zaXplLnN0YXRlOgogICAgICAgICAgICAgICAgc2VsZi5zb3J0X21vZGUgPSAic2l6ZSIK
CiAgICAgICAgICAgICMgRGV0ZXJtaW5lIGRpcmVjdGlvbgogICAgICAgICAgICBzZWxmLnNvcnRf
YXNjZW5kaW5nID0gcmJfYXNjZW5kaW5nLnN0YXRlCgogICAgICAgICAgICBzZWxmLl9jbG9zZV9k
aWFsb2coKQogICAgICAgICAgICBzZWxmLl9zb3J0X21lc3NhZ2VzKCkKICAgICAgICAgICAgc2Vs
Zi5fdXBkYXRlX21lc3NhZ2VzX3RpdGxlKCkKICAgICAgICAgICAgc2VsZi5fc2V0X3N0YXR1cygp
CgogICAgICAgIGRlZiBvbl9jYW5jZWwoYnRuKToKICAgICAgICAgICAgc2VsZi5fY2xvc2VfZGlh
bG9nKCkKCiAgICAgICAgcGlsZSA9IHVyd2lkLlBpbGUoCiAgICAgICAgICAgIFsKICAgICAgICAg
ICAgICAgIHVyd2lkLlRleHQoIlNvcnQgYnk6IiksCiAgICAgICAgICAgICAgICB1cndpZC5EaXZp
ZGVyKCksCiAgICAgICAgICAgICAgICByYl91bnNvcnRlZCwKICAgICAgICAgICAgICAgIHJiX3Rp
bWVzdGFtcCwKICAgICAgICAgICAgICAgIHJiX3BhcnRpdGlvbiwKICAgICAgICAgICAgICAgIHJi
X3NpemUsCiAgICAgICAgICAgICAgICB1cndpZC5EaXZpZGVyKCksCiAgICAgICAgICAgICAgICB1
cndpZC5UZXh0KCJEaXJlY3Rpb246IiksCiAgICAgICAgICAgICAgICB1cndpZC5EaXZpZGVyKCks
CiAgICAgICAgICAgICAgICByYl9hc2NlbmRpbmcsCiAgICAgICAgICAgICAgICByYl9kZXNjZW5k
aW5nLAogICAgICAgICAgICAgICAgdXJ3aWQuRGl2aWRlcigpLAogICAgICAgICAgICAgICAgdXJ3
aWQuQXR0ck1hcCh1cndpZC5CdXR0b24oIkFwcGx5Iiwgb25fcHJlc3M9b25fYXBwbHkpLCAiYnRu
IiwgZm9jdXNfbWFwPSJidG5fZm9jdXMiKSwKICAgICAgICAgICAgICAgIHVyd2lkLkF0dHJNYXAo
dXJ3aWQuQnV0dG9uKCJDYW5jZWwiLCBvbl9wcmVzcz1vbl9jYW5jZWwpLCAiYnRuIiwgZm9jdXNf
bWFwPSJidG5fZm9jdXMiKSwKICAgICAgICAgICAgXQogICAgICAgICkKICAgICAgICBzZWxmLl9z
aG93X2RpYWxvZyhwaWxlLCAiU29ydCBNZXNzYWdlcyIpCgogICAgIyAtLS0tLSBmb2N1cyBoZWxw
ZXJzIC0tLS0tCgogICAgZGVmIF9mb2N1c190b3BpY3Moc2VsZik6CiAgICAgICAgc2VsZi5jb2x1
bW5zLmZvY3VzX3Bvc2l0aW9uID0gMAogICAgICAgIHNlbGYuX3NldF9zdGF0dXMoKQoKICAgIGRl
ZiBfZm9jdXNfbWVzc2FnZXMoc2VsZik6CiAgICAgICAgc2VsZi5jb2x1bW5zLmZvY3VzX3Bvc2l0
aW9uID0gMQogICAgICAgIHNlbGYuX3NldF9zdGF0dXMoKQoKICAgICMgLS0tLS0gdG9waWMgbGlz
dCBoZWxwZXJzIC0tLS0tCgogICAgZGVmIF9mb2N1c2VkX3RvcGljKHNlbGYpOgogICAgICAgIGlm
IG5vdCBzZWxmLnRvcGljX3dhbGtlcjoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICB3
ID0gc2VsZi50b3BpY193YWxrZXJbc2VsZi50b3BpY19saXN0Ym94LmZvY3VzX3Bvc2l0aW9uXQog
ICAgICAgIGlmIGlzaW5zdGFuY2UodywgdXJ3aWQuQXR0ck1hcCk6CiAgICAgICAgICAgIHcgPSB3
Lm9yaWdpbmFsX3dpZGdldAogICAgICAgIGlmIGlzaW5zdGFuY2UodywgdXJ3aWQuVGV4dCk6CiAg
ICAgICAgICAgIHQgPSB3LnRleHQKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZSh0LCBieXRlcyk6
CiAgICAgICAgICAgICAgICB0ID0gdC5kZWNvZGUoInV0Zi04IiwgZXJyb3JzPSJyZXBsYWNlIikK
ICAgICAgICAgICAgdCA9ICh0IG9yICIiKS5zdHJpcCgpCiAgICAgICAgICAgIHJldHVybiB0IG9y
IE5vbmUKICAgICAgICByZXR1cm4gTm9uZQoKICAgICMgLS0tLS0gbWVzc2FnZSBsaXN0IGhlbHBl
cnMgLS0tLS0KCiAgICBkZWYgX2ZvY3VzZWRfbWVzc2FnZV9yb3coc2VsZik6CiAgICAgICAgaWYg
bm90IHNlbGYubXNnX3dhbGtlcjoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICB0cnk6
CiAgICAgICAgICAgIHcgPSBzZWxmLm1zZ193YWxrZXJbc2VsZi5tc2dfbGlzdGJveC5mb2N1c19w
b3NpdGlvbl0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICByZXR1cm4gTm9u
ZQogICAgICAgIGlmIGlzaW5zdGFuY2UodywgdXJ3aWQuQXR0ck1hcCk6CiAgICAgICAgICAgIHcg
PSB3Lm9yaWdpbmFsX3dpZGdldAogICAgICAgIHJldHVybiB3IGlmIGlzaW5zdGFuY2UodywgTXNn
Um93KSBlbHNlIE5vbmUKCiAgICBkZWYgX21lc3NhZ2VfcG9zaXRpb25fc3RyaW5nKHNlbGYpOgog
ICAgICAgIHRvdGFsID0gbGVuKHNlbGYubXNnX3dhbGtlcikKICAgICAgICBpZiB0b3RhbCA9PSAw
OgogICAgICAgICAgICByZXR1cm4gIk1zZzogMC8wIgogICAgICAgIHRyeToKICAgICAgICAgICAg
cG9zID0gc2VsZi5tc2dfbGlzdGJveC5mb2N1c19wb3NpdGlvbgogICAgICAgIGV4Y2VwdCBFeGNl
cHRpb246CiAgICAgICAgICAgIHJldHVybiBmIk1zZzogMC97dG90YWx9IgogICAgICAgIHJvdyA9
IHNlbGYuX2ZvY3VzZWRfbWVzc2FnZV9yb3coKQogICAgICAgIGlmIHJvdyBpcyBub3QgTm9uZToK
ICAgICAgICAgICAgcmV0dXJuIGYiTXNnOiB7cG9zKzF9L3t0b3RhbH0gKHB7cm93LnBhcnRpdGlv
bn1Ae3Jvdy5vZmZzZXR9KSIKICAgICAgICByZXR1cm4gZiJNc2c6IHtwb3MrMX0ve3RvdGFsfSIK
CiAgICBkZWYgX21heWJlX3VwZGF0ZV9mb290ZXJfb25fZm9jdXMoc2VsZik6CiAgICAgICAgaWYg
c2VsZi5jb2x1bW5zLmZvY3VzX3Bvc2l0aW9uICE9IDE6CiAgICAgICAgICAgIHJldHVybgogICAg
ICAgIHRyeToKICAgICAgICAgICAgcG9zID0gc2VsZi5tc2dfbGlzdGJveC5mb2N1c19wb3NpdGlv
bgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIHBvcyA9IE5vbmUKICAgICAg
ICBpZiBwb3MgIT0gc2VsZi5fbXNnX2ZvY3VzX3ByZXY6CiAgICAgICAgICAgIHNlbGYuX21zZ19m
b2N1c19wcmV2ID0gcG9zCiAgICAgICAgICAgIHNlbGYuX3NldF9zdGF0dXMoKQoKICAgICMgLS0t
LS0gdG9waWNzIGxvYWQgLS0tLS0KCiAgICBkZWYgX2ZldGNoX3RvcGljcyhzZWxmKToKICAgICAg
ICBzZWxmLnRvcGljX3dhbGtlci5jbGVhcigpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBu
b3Qgc2VsZi5hZG1pbl9jbGllbnQ6CiAgICAgICAgICAgICAgICBzZWxmLl9pbml0X2FkbWluX2Ns
aWVudCgpCiAgICAgICAgICAgIHRvcGljX25hbWVzID0gc2VsZi5hZG1pbl9jbGllbnQubGlzdF90
b3BpY3MoKQogICAgICAgICAgICAjIHRvcGljcyA9IHNvcnRlZChbdCBmb3IgdCBpbiB0b3BpY19u
YW1lcyBpZiBub3QgdC5zdGFydHN3aXRoKCJfXyIpXSkKICAgICAgICAgICAgdG9waWNzID0gc29y
dGVkKHRvcGljX25hbWVzKQoKICAgICAgICAgICAgIyBBcHBseSBmaWx0ZXIgaWYgc2V0CiAgICAg
ICAgICAgIGlmIHNlbGYudG9waWNfZmlsdGVyOgogICAgICAgICAgICAgICAgdG9waWNzID0gW3Qg
Zm9yIHQgaW4gdG9waWNzIGlmIHNlbGYudG9waWNfZmlsdGVyLmxvd2VyKCkgaW4gdC5sb3dlcigp
XQoKICAgICAgICAgICAgaWYgbm90IHRvcGljczoKICAgICAgICAgICAgICAgIGlmIHNlbGYudG9w
aWNfZmlsdGVyOgogICAgICAgICAgICAgICAgICAgIHNlbGYudG9waWNfd2Fsa2VyLmFwcGVuZChT
ZWxlY3RhYmxlVGV4dChmIk5vIHRvcGljcyBtYXRjaCBmaWx0ZXI6IHtzZWxmLnRvcGljX2ZpbHRl
cn0iKSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi50b3Bp
Y193YWxrZXIuYXBwZW5kKFNlbGVjdGFibGVUZXh0KCJObyB0b3BpY3MgZm91bmQuIFByZXNzIE4g
dG8gY3JlYXRlLiIpKQogICAgICAgICAgICAgICAgcmV0dXJuCgogICAgICAgICAgICBmb3IgdCBp
biB0b3BpY3M6CiAgICAgICAgICAgICAgICBzZWxmLnRvcGljX3dhbGtlci5hcHBlbmQodXJ3aWQu
QXR0ck1hcChTZWxlY3RhYmxlVGV4dCh0KSwgImJvZHkiLCBmb2N1c19tYXA9InJldmVyc2VkIikp
CiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLnRvcGljX3dh
bGtlci5hcHBlbmQoU2VsZWN0YWJsZVRleHQoZiJDb25uZWN0aW9uIGVycm9yOiB7ZX0iKSkKCiAg
ICAgICAgIyBVcGRhdGUgdG9waWNzIHRpdGxlCiAgICAgICAgc2VsZi5fdXBkYXRlX3RvcGljc190
aXRsZSgpCgogICAgZGVmIF9zaG93X2ZpbHRlcl9kaWFsb2coc2VsZik6CiAgICAgICAgIiIiU2hv
dyBkaWFsb2cgdG8gc2V0IHRvcGljIGZpbHRlciIiIgoKICAgICAgICBkZWYgb25fYXBwbHkoYnRu
PU5vbmUpOgogICAgICAgICAgICBuZXdfZmlsdGVyID0gZmlsdGVyX2VkaXQuZWRpdF90ZXh0LnN0
cmlwKCkKICAgICAgICAgICAgc2VsZi50b3BpY19maWx0ZXIgPSBuZXdfZmlsdGVyCiAgICAgICAg
ICAgIHNlbGYuX2Nsb3NlX2RpYWxvZygpCiAgICAgICAgICAgIHNlbGYuX2ZldGNoX3RvcGljcygp
CiAgICAgICAgICAgIHNlbGYuX3NldF9zdGF0dXMoZiJGaWx0ZXIgYXBwbGllZDogJ3tuZXdfZmls
dGVyfSciIGlmIG5ld19maWx0ZXIgZWxzZSAiRmlsdGVyIGNsZWFyZWQiKQoKICAgICAgICBkZWYg
b25fY2xlYXIoYnRuKToKICAgICAgICAgICAgc2VsZi50b3BpY19maWx0ZXIgPSAiIgogICAgICAg
ICAgICBzZWxmLl9jbG9zZV9kaWFsb2coKQogICAgICAgICAgICBzZWxmLl9mZXRjaF90b3BpY3Mo
KQogICAgICAgICAgICBzZWxmLl9zZXRfc3RhdHVzKCJGaWx0ZXIgY2xlYXJlZCIpCgogICAgICAg
IGRlZiBvbl9jYW5jZWwoYnRuKToKICAgICAgICAgICAgc2VsZi5fY2xvc2VfZGlhbG9nKCkKCiAg
ICAgICAgIyBDdXN0b20gRWRpdCB3aWRnZXQgdGhhdCBoYW5kbGVzIEVudGVyIGtleQogICAgICAg
IGNsYXNzIEVkaXRXaXRoRW50ZXIodXJ3aWQuRWRpdCk6CiAgICAgICAgICAgIGRlZiBrZXlwcmVz
cyhzZWxmLCBzaXplLCBrZXkpOgogICAgICAgICAgICAgICAgaWYga2V5ID09ICdlbnRlcic6CiAg
ICAgICAgICAgICAgICAgICAgb25fYXBwbHkoKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBO
b25lCiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIoKS5rZXlwcmVzcyhzaXplLCBrZXkpCgog
ICAgICAgIGZpbHRlcl9lZGl0ID0gRWRpdFdpdGhFbnRlcigiRmlsdGVyIChzdWJzdHJpbmcpOiAi
LCBzZWxmLnRvcGljX2ZpbHRlcikKCiAgICAgICAgcGlsZSA9IHVyd2lkLlBpbGUoCiAgICAgICAg
ICAgIFsKICAgICAgICAgICAgICAgIHVyd2lkLlRleHQoIkZpbHRlciB0b3BpY3MgYnkgc3Vic3Ry
aW5nOiIpLAogICAgICAgICAgICAgICAgdXJ3aWQuRGl2aWRlcigpLAogICAgICAgICAgICAgICAg
dXJ3aWQuVGV4dCgiKENhc2UtaW5zZW5zaXRpdmUsIHNlYXJjaGVzIGFueXdoZXJlIGluIHRvcGlj
IG5hbWUpIiksCiAgICAgICAgICAgICAgICB1cndpZC5EaXZpZGVyKCksCiAgICAgICAgICAgICAg
ICBmaWx0ZXJfZWRpdCwKICAgICAgICAgICAgICAgIHVyd2lkLkRpdmlkZXIoKSwKICAgICAgICAg
ICAgICAgIHVyd2lkLkF0dHJNYXAodXJ3aWQuQnV0dG9uKCJBcHBseSIsIG9uX3ByZXNzPW9uX2Fw
cGx5KSwgImJ0biIsIGZvY3VzX21hcD0iYnRuX2ZvY3VzIiksCiAgICAgICAgICAgICAgICB1cndp
ZC5BdHRyTWFwKHVyd2lkLkJ1dHRvbigiQ2xlYXIgRmlsdGVyIiwgb25fcHJlc3M9b25fY2xlYXIp
LCAiYnRuIiwgZm9jdXNfbWFwPSJidG5fZm9jdXMiKSwKICAgICAgICAgICAgICAgIHVyd2lkLkF0
dHJNYXAodXJ3aWQuQnV0dG9uKCJDYW5jZWwiLCBvbl9wcmVzcz1vbl9jYW5jZWwpLCAiYnRuIiwg
Zm9jdXNfbWFwPSJidG5fZm9jdXMiKSwKICAgICAgICAgICAgXQogICAgICAgICkKICAgICAgICBz
ZWxmLl9zaG93X2RpYWxvZyhwaWxlLCAiRmlsdGVyIFRvcGljcyIpCgogICAgIyAtLS0tLSBzbmFw
c2hvdCBsb2FkIChjb3JlKSAtLS0tLQoKICAgIGRlZiBfbG9hZF90b3BpY19zbmFwc2hvdChzZWxm
LCB0b3BpYyk6CiAgICAgICAgIiIiCiAgICAgICAgTG9hZCBhIHNuYXBzaG90IG9mIG1lc3NhZ2Vz
IGludG8gbXNnX3dhbGtlci4KICAgICAgICBTdHJhdGVneToKICAgICAgICAtIGNyZWF0ZSBjb25z
dW1lciwgYXNzaWduIHBhcnRpdGlvbnMsIGZpbmQgYmVnaW4vZW5kIG9mZnNldHMKICAgICAgICAt
IGNob29zZSBzdGFydCBvZmZzZXRzICh0YWlsIE4gcGVyIHBhcnRpdGlvbiBvciBmcm9tIGJlZ2lu
bmluZykKICAgICAgICAtIHBvbGwgdW50aWwgcmVhY2hlZCBlbmQgb2Zmc2V0cyBvciBtYXhfdG90
YWwgcmVhY2hlZAogICAgICAgICIiIgogICAgICAgIHNlbGYubXNnX3dhbGtlci5jbGVhcigpCiAg
ICAgICAgc2VsZi5hbGxfbWVzc2FnZXMgPSBbXSAgIyBDbGVhciBzdG9yZWQgbWVzc2FnZXMKICAg
ICAgICBzZWxmLl9zZXRfc3RhdHVzKCJMb2FkaW5nLi4uIikKICAgICAgICBjZmcgPSBzZWxmLl9n
ZXRfa2Fma2FfY29uZmlnKCkKICAgICAgICAjICJhc3NpZ24vc2VlayIgbW9kZSwgbm8gZ3JvdXAg
bmVlZGVkCiAgICAgICAgY2ZnLnVwZGF0ZSgKICAgICAgICAgICAgewogICAgICAgICAgICAgICAg
ImVuYWJsZV9hdXRvX2NvbW1pdCI6IEZhbHNlLAogICAgICAgICAgICAgICAgImF1dG9fb2Zmc2V0
X3Jlc2V0IjogImVhcmxpZXN0IiwKICAgICAgICAgICAgICAgICJjb25zdW1lcl90aW1lb3V0X21z
IjogMTAwMCwKICAgICAgICAgICAgICAgICMgInZhbHVlX2Rlc2VyaWFsaXplciI6IGxhbWJkYSBt
OiBtLmRlY29kZSgidXRmLTgiLCBlcnJvcnM9InJlcGxhY2UiKSBpZiBtIGVsc2UgTm9uZSwKICAg
ICAgICAgICAgICAgICMgImtleV9kZXNlcmlhbGl6ZXIiOiBsYW1iZGEgbTogbS5kZWNvZGUoInV0
Zi04IiwgZXJyb3JzPSJyZXBsYWNlIikgaWYgbSBlbHNlIE5vbmUsCiAgICAgICAgICAgIH0KICAg
ICAgICApCiAgICAgICAgY29uc3VtZXIgPSBLYWZrYUNvbnN1bWVyKCoqY2ZnKQogICAgICAgIHBh
cnRzID0gY29uc3VtZXIucGFydGl0aW9uc19mb3JfdG9waWModG9waWMpCiAgICAgICAgaWYgbm90
IHBhcnRzOgogICAgICAgICAgICBjb25zdW1lci5jbG9zZSgpCiAgICAgICAgICAgIHNlbGYubXNn
X3dhbGtlci5hcHBlbmQoU2VsZWN0YWJsZVRleHQoIihObyBwYXJ0aXRpb25zIC8gdG9waWMgbm90
IGZvdW5kKSIpKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgdHBzID0gW1RvcGljUGFydGl0
aW9uKHRvcGljLCBwKSBmb3IgcCBpbiBzb3J0ZWQocGFydHMpXQogICAgICAgIGNvbnN1bWVyLmFz
c2lnbih0cHMpCiAgICAgICAgYmVnaW4gPSBjb25zdW1lci5iZWdpbm5pbmdfb2Zmc2V0cyh0cHMp
ICAjIHt0cDogb2Zmc2V0fQogICAgICAgIGVuZCA9IGNvbnN1bWVyLmVuZF9vZmZzZXRzKHRwcykg
ICMge3RwOiBvZmZzZXR9CgogICAgICAgICMgcGljayBzdGFydCBvZmZzZXRzCiAgICAgICAgZm9y
IHRwIGluIHRwczoKICAgICAgICAgICAgYiA9IGJlZ2luLmdldCh0cCwgMCkKICAgICAgICAgICAg
ZSA9IGVuZC5nZXQodHAsIDApCiAgICAgICAgICAgIGlmIHNlbGYuc25hcHNob3RfbW9kZSA9PSAi
ZnJvbV9iZWdpbm5pbmciOgogICAgICAgICAgICAgICAgc3RhcnQgPSBiCiAgICAgICAgICAgIGVs
c2U6CiAgICAgICAgICAgICAgICAjIHRhaWw6IGxhc3QgTiBwZXIgcGFydGl0aW9uCiAgICAgICAg
ICAgICAgICBzdGFydCA9IG1heChiLCBlIC0gc2VsZi5zbmFwc2hvdF90YWlsX24pCiAgICAgICAg
ICAgIGNvbnN1bWVyLnNlZWsodHAsIHN0YXJ0KQoKICAgICAgICByb3dzID0gW10KICAgICAgICAj
IHN0b3AgY29uZGl0aW9uOiBhbGwgcGFydGl0aW9ucyByZWFjaGVkIGVuZCAocG9zaXRpb24gPj0g
ZW5kKQogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIGJhdGNoID0gY29uc3VtZXIucG9s
bCh0aW1lb3V0X21zPTUwMCwgbWF4X3JlY29yZHM9NTAwKQogICAgICAgICAgICBpZiBub3QgYmF0
Y2g6CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBmb3IgdHAsIG1zZ3MgaW4gYmF0
Y2guaXRlbXMoKToKICAgICAgICAgICAgICAgIGZvciBtIGluIG1zZ3M6CiAgICAgICAgICAgICAg
ICAgICAga2V5ID0gbS5rZXkgaWYgbS5rZXkgaXMgbm90IE5vbmUgZWxzZSBOb25lCiAgICAgICAg
ICAgICAgICAgICAgdmFsID0gbS52YWx1ZSBpZiBtLnZhbHVlIGlzIG5vdCBOb25lIGVsc2UgTm9u
ZQoKICAgICAgICAgICAgICAgICAgICBrZXlfdGV4dCA9IGtleS5kZWNvZGUoInV0Zi04IiwgZXJy
b3JzPSJyZXBsYWNlIikgaWYgaXNpbnN0YW5jZShrZXksIChieXRlcywgYnl0ZWFycmF5KSkgZWxz
ZSAiIgogICAgICAgICAgICAgICAgICAgIHZhbF90ZXh0ID0gdmFsLmRlY29kZSgidXRmLTgiLCBl
cnJvcnM9InJlcGxhY2UiKSBpZiBpc2luc3RhbmNlKHZhbCwgKGJ5dGVzLCBieXRlYXJyYXkpKSBl
bHNlICIiCgogICAgICAgICAgICAgICAgICAgIHJvd3MuYXBwZW5kKE1zZ1JvdygiIiwgdmFsX3Rl
eHQsIHRvcGljLCBtLnBhcnRpdGlvbiwgbS5vZmZzZXQsIGdldGF0dHIobSwgInRpbWVzdGFtcCIs
IE5vbmUpLCBrZXlfdGV4dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhd192YWx1
ZT12YWwsIHJhd19rZXk9a2V5KSkKCiAgICAgICAgICAgICAgICAgICAgIyBrZXkgPSBtLmtleSBp
ZiBtLmtleSBpcyBub3QgTm9uZSBlbHNlICIiCiAgICAgICAgICAgICAgICAgICAgIyB2YWwgPSBt
LnZhbHVlIGlmIG0udmFsdWUgaXMgbm90IE5vbmUgZWxzZSAiIgogICAgICAgICAgICAgICAgICAg
ICMgcm93cy5hcHBlbmQoTXNnUm93KCIiLCB2YWwsIHRvcGljLCBtLnBhcnRpdGlvbiwgbS5vZmZz
ZXQsIGdldGF0dHIobSwgInRpbWVzdGFtcCIsIE5vbmUpLCBrZXkpKQogICAgICAgICAgICAgICAg
ICAgIGlmIGxlbihyb3dzKSA+PSBzZWxmLnNuYXBzaG90X21heF90b3RhbDoKICAgICAgICAgICAg
ICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGlmIGxlbihyb3dzKSA+PSBzZWxmLnNu
YXBzaG90X21heF90b3RhbDoKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBp
ZiBsZW4ocm93cykgPj0gc2VsZi5zbmFwc2hvdF9tYXhfdG90YWw6CiAgICAgICAgICAgICAgICBi
cmVhawoKICAgICAgICAgICAgIyBjaGVjayBwcm9ncmVzczogaWYgZXZlcnkgdHAgaXMgYXQvYWZ0
ZXIgZW5kIG9mZnNldCAtPiBkb25lCiAgICAgICAgICAgIGRvbmUgPSBUcnVlCiAgICAgICAgICAg
IGZvciB0cCBpbiB0cHM6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAg
aWYgY29uc3VtZXIucG9zaXRpb24odHApIDwgZW5kLmdldCh0cCwgMCk6CiAgICAgICAgICAgICAg
ICAgICAgICAgIGRvbmUgPSBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAg
ICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICBkb25lID0g
RmFsc2UKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBpZiBkb25lOgogICAg
ICAgICAgICAgICAgYnJlYWsKCiAgICAgICAgY29uc3VtZXIuY2xvc2UoKQoKICAgICAgICAjIGRl
dGVybWluaXN0aWMgb3JkZXJpbmcgKG5vdCB0cnVlIHRpbWUgb3JkZXIsIGJ1dCBzdGFibGUpCiAg
ICAgICAgcm93cy5zb3J0KGtleT1sYW1iZGEgcjogKHIucGFydGl0aW9uLCByLm9mZnNldCkpCgog
ICAgICAgIGlmIG5vdCByb3dzOgogICAgICAgICAgICBzZWxmLm1zZ193YWxrZXIuYXBwZW5kKFNl
bGVjdGFibGVUZXh0KCIoTm8gbWVzc2FnZXMgaW4gc25hcHNob3QpIikpCiAgICAgICAgICAgIHJl
dHVybgoKICAgICAgICAjIEFkZCBoZWFkZXIgKG5vbi1zZWxlY3RhYmxlKQogICAgICAgIGhlYWRl
cl9saW5lID0gZiJ7J1RpbWVzdGFtcCc6PDI4fSB7J1RvcGljJzo8MTN9IHsnT2Zmc2V0Jzo8MTB9
IHsnU2l6ZSc6PDh9IHsnS2V5Jzo8MTJ9IFZhbHVlIgogICAgICAgIGhlYWRlcl93aWRnZXQgPSB1
cndpZC5UZXh0KGhlYWRlcl9saW5lKQogICAgICAgIHNlbGYubXNnX3dhbGtlci5hcHBlbmQodXJ3
aWQuQXR0ck1hcChoZWFkZXJfd2lkZ2V0LCAiaGVhZGVyIikpCgogICAgICAgICMgQWRkIG1lc3Nh
Z2VzIGFuZCBzdG9yZSB0aGVtIGZvciBmaWx0ZXJpbmcKICAgICAgICBmb3IgciBpbiByb3dzOgog
ICAgICAgICAgICByLnNldF90ZXh0KCIiKQogICAgICAgICAgICBtc2dfaXRlbSA9IHVyd2lkLkF0
dHJNYXAociwgImJvZHkiLCBmb2N1c19tYXA9InJldmVyc2VkIikKICAgICAgICAgICAgc2VsZi5t
c2dfd2Fsa2VyLmFwcGVuZChtc2dfaXRlbSkKICAgICAgICAgICAgc2VsZi5hbGxfbWVzc2FnZXMu
YXBwZW5kKChtc2dfaXRlbSwgcikpCgogICAgICAgICMgRm9yY2UgaW5pdGlhbCBmb3JtYXR0aW5n
IHdpdGggZGVmYXVsdCB3aWR0aAogICAgICAgIHNlbGYubXNnX2xpc3Rib3guZm9ybWF0X2FsbF9t
ZXNzYWdlcygpCgogICAgICAgICMgQXBwbHkgZmlsdGVycyBpZiBhbnkgYXJlIHNldAogICAgICAg
IGFueV9maWx0ZXJfc2V0ID0gYW55KG1hc2sgZm9yIG1hc2sgaW4gc2VsZi5tc2dfZmlsdGVycy52
YWx1ZXMoKSkKICAgICAgICBpZiBhbnlfZmlsdGVyX3NldDoKICAgICAgICAgICAgc2VsZi5fYXBw
bHlfbWVzc2FnZV9maWx0ZXJzKCkKICAgICAgICBlbGlmIHNlbGYuc29ydF9tb2RlICE9ICJ1bnNv
cnRlZCI6CiAgICAgICAgICAgIHNlbGYuX3NvcnRfbWVzc2FnZXMoKQoKICAgICAgICAjIFVwZGF0
ZSBtZXNzYWdlcyBwYW5lbCB0aXRsZQogICAgICAgIHNlbGYuX3VwZGF0ZV9tZXNzYWdlc190aXRs
ZSgpCgogICAgICAgICMgU2V0IGZvY3VzIHRvIGZpcnN0IG1lc3NhZ2UgKHNraXAgaGVhZGVyIGlm
IGV4aXN0cykKICAgICAgICBpZiBsZW4oc2VsZi5tc2dfd2Fsa2VyKSA+IDE6CiAgICAgICAgICAg
IHNlbGYubXNnX2xpc3Rib3guc2V0X2ZvY3VzKDEpCgogICAgZGVmIF9idWlsZF9tZXNzYWdlX3Zp
ZXdfbGluZXMoc2VsZiwgcm93LCBtb2RlKToKICAgICAgICBsaW5lcyA9IFtdCiAgICAgICAgZnJv
bSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKICAgICAgICBsaW5lcy5hcHBlbmQoZiJUb3BpYzog
e3Jvdy50b3BpY30iKQogICAgICAgIGxpbmVzLmFwcGVuZChmIlBhcnRpdGlvbjoge3Jvdy5wYXJ0
aXRpb259IikKICAgICAgICBsaW5lcy5hcHBlbmQoZiJPZmZzZXQ6IHtyb3cub2Zmc2V0fSIpCgog
ICAgICAgIGlmIHJvdy50aW1lc3RhbXA6CiAgICAgICAgICAgIGR0ID0gZGF0ZXRpbWUuZnJvbXRp
bWVzdGFtcChyb3cudGltZXN0YW1wIC8gMTAwMC4wKQogICAgICAgICAgICBsaW5lcy5hcHBlbmQo
ZiJUaW1lc3RhbXA6IHtkdC5pc29mb3JtYXQoc2VwPScgJywgdGltZXNwZWM9J21pbGxpc2Vjb25k
cycpfSIpCiAgICAgICAgbGluZXMuYXBwZW5kKCIiKQoKICAgICAgICBsaW5lcy5hcHBlbmQoIktl
eToiKQogICAgICAgIGlmIG1vZGUgPT0gImhleCI6CiAgICAgICAgICAgIGxpbmVzLmV4dGVuZChz
ZWxmLl9ieXRlc190b19oZXhfbGluZXMoZ2V0YXR0cihyb3csICJyYXdfa2V5IiwgTm9uZSkpKQog
ICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxpbmVzLmFwcGVuZChyb3cua2V5IG9yICIiKQogICAg
ICAgIGxpbmVzLmFwcGVuZCgiIikKCiAgICAgICAgbGluZXMuYXBwZW5kKGYiVmFsdWUgKHttb2Rl
fSwgRjQgdG9nZ2xlKToiKQogICAgICAgIGlmIG1vZGUgPT0gImhleCI6CiAgICAgICAgICAgIGxp
bmVzLmV4dGVuZChzZWxmLl9ieXRlc190b19oZXhfbGluZXMoZ2V0YXR0cihyb3csICJyYXdfdmFs
dWUiLCBOb25lKSkpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdmFsdWV0ZXh0ID0gcm93LmZ1
bGxfdGV4dCBvciAiIgogICAgICAgICAgICAjINC60LDQuiDQsdGL0LvQvjog0L/RgNC+0LHRg9C1
0LwgSlNPTiBwcmV0dHkgcHJpbnQsINC40L3QsNGH0LUgcGxhaW4KICAgICAgICAgICAgdHJ5Ogog
ICAgICAgICAgICAgICAgaW1wb3J0IGpzb24KICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9h
ZHModmFsdWV0ZXh0KQogICAgICAgICAgICAgICAgdmFsdWV0ZXh0ID0ganNvbi5kdW1wcyhvYmos
IGVuc3VyZV9hc2NpaT1GYWxzZSwgaW5kZW50PTIpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRp
b246CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIGxpbmVzLmV4dGVuZCh2YWx1ZXRl
eHQuc3BsaXRsaW5lcygpIGlmIHZhbHVldGV4dCBlbHNlIFsiIl0pCiAgICAgICAgcmV0dXJuIGxp
bmVzCgogICAgZGVmIF9zaG93X21lc3NhZ2VfZmlsdGVyX2RpYWxvZyhzZWxmKToKICAgICAgICAi
IiJTaG93IGRpYWxvZyB0byBzZXQgbWVzc2FnZSBmaWx0ZXJzIiIiCgogICAgICAgIGRlZiBvbl9h
cHBseShidG49Tm9uZSk6CiAgICAgICAgICAgIHNlbGYubXNnX2ZpbHRlcnNbImtleSJdID0ga2V5
X2VkaXQuZWRpdF90ZXh0LnN0cmlwKCkKICAgICAgICAgICAgc2VsZi5tc2dfZmlsdGVyc1sidmFs
dWUiXSA9IHZhbHVlX2VkaXQuZWRpdF90ZXh0LnN0cmlwKCkKICAgICAgICAgICAgc2VsZi5tc2df
ZmlsdGVyc1sicGFydGl0aW9uIl0gPSBwYXJ0aXRpb25fZWRpdC5lZGl0X3RleHQuc3RyaXAoKQog
ICAgICAgICAgICBzZWxmLm1zZ19maWx0ZXJzWyJvZmZzZXQiXSA9IG9mZnNldF9lZGl0LmVkaXRf
dGV4dC5zdHJpcCgpCiAgICAgICAgICAgIHNlbGYuX2Nsb3NlX2RpYWxvZygpCiAgICAgICAgICAg
IHNlbGYuX2FwcGx5X21lc3NhZ2VfZmlsdGVycygpCgogICAgICAgICAgICBhY3RpdmVfY291bnQg
PSBzdW0oMSBmb3IgbWFzayBpbiBzZWxmLm1zZ19maWx0ZXJzLnZhbHVlcygpIGlmIG1hc2spCiAg
ICAgICAgICAgIGlmIGFjdGl2ZV9jb3VudCA+IDA6CiAgICAgICAgICAgICAgICBzZWxmLl9zZXRf
c3RhdHVzKGYiRmlsdGVyIGFwcGxpZWQ6IHthY3RpdmVfY291bnR9IGZpZWxkKHMpIikKICAgICAg
ICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYuX3NldF9zdGF0dXMoIkFsbCBmaWx0ZXJz
IGNsZWFyZWQiKQoKICAgICAgICBkZWYgb25fY2xlYXIoYnRuKToKICAgICAgICAgICAgc2VsZi5t
c2dfZmlsdGVycyA9IHsia2V5IjogIiIsICJ2YWx1ZSI6ICIiLCAicGFydGl0aW9uIjogIiIsICJv
ZmZzZXQiOiAiIn0KICAgICAgICAgICAgc2VsZi5fY2xvc2VfZGlhbG9nKCkKICAgICAgICAgICAg
c2VsZi5fYXBwbHlfbWVzc2FnZV9maWx0ZXJzKCkKICAgICAgICAgICAgc2VsZi5fc2V0X3N0YXR1
cygiQWxsIGZpbHRlcnMgY2xlYXJlZCIpCgogICAgICAgIGRlZiBvbl9jYW5jZWwoYnRuKToKICAg
ICAgICAgICAgc2VsZi5fY2xvc2VfZGlhbG9nKCkKCiAgICAgICAgIyBDdXN0b20gRWRpdCB0aGF0
IHRyaWdnZXJzIEFwcGx5IG9uIEVudGVyCiAgICAgICAgY2xhc3MgRWRpdFdpdGhFbnRlcih1cndp
ZC5FZGl0KToKICAgICAgICAgICAgZGVmIGtleXByZXNzKHNlbGYsIHNpemUsIGtleSk6CiAgICAg
ICAgICAgICAgICBpZiBrZXkgPT0gJ2VudGVyJzoKICAgICAgICAgICAgICAgICAgICBvbl9hcHBs
eSgpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgICAgIHJldHVy
biBzdXBlcigpLmtleXByZXNzKHNpemUsIGtleSkKCiAgICAgICAgIyBIZWxwZXIgdG8gY3JlYXRl
IHN0eWxlZCByb3c6IFsgTGFiZWwgKGZpeGVkIHdpZHRoKSB8IEVkaXRGaWVsZCBdCiAgICAgICAg
ZGVmIGNyZWF0ZV9maWVsZF9yb3cobGFiZWxfdGV4dCwgdmFsdWUpOgogICAgICAgICAgICBlZGl0
X3cgPSBFZGl0V2l0aEVudGVyKCIiLCB2YWx1ZSkgICMgRWRpdCB3aXRob3V0IGNhcHRpb24KCiAg
ICAgICAgICAgICMgV3JhcCBFZGl0IGluIEF0dHJNYXAgdG8gY29sb3JpemUgdGhlIGlucHV0IGFy
ZWEKICAgICAgICAgICAgZWRpdF9zdHlsZWQgPSB1cndpZC5BdHRyTWFwKGVkaXRfdywgImVkaXRf
ZmllbGQiLCBmb2N1c19tYXA9ImVkaXRfZm9jdXMiKQoKICAgICAgICAgICAgIyBSZXR1cm4gQ29s
dW1ucwogICAgICAgICAgICByZXR1cm4gdXJ3aWQuQ29sdW1ucyhbCiAgICAgICAgICAgICAgICAo
J2ZpeGVkJywgMTIsIHVyd2lkLlRleHQobGFiZWxfdGV4dCkpLCAgIyBGaXhlZCB3aWR0aCBsYWJl
bAogICAgICAgICAgICAgICAgZWRpdF9zdHlsZWQKICAgICAgICAgICAgXSwgZGl2aWRlY2hhcnM9
MSksIGVkaXRfdwoKICAgICAgICAjIENyZWF0ZSByb3dzIGFuZCBjYXB0dXJlIGVkaXQgd2lkZ2V0
cyB0byByZWFkIHZhbHVlcyBsYXRlcgogICAgICAgIHJvd19rZXksIGtleV9lZGl0ID0gY3JlYXRl
X2ZpZWxkX3JvdygiS2V5OiIsIHNlbGYubXNnX2ZpbHRlcnNbImtleSJdKQogICAgICAgIHJvd192
YWwsIHZhbHVlX2VkaXQgPSBjcmVhdGVfZmllbGRfcm93KCJWYWx1ZToiLCBzZWxmLm1zZ19maWx0
ZXJzWyJ2YWx1ZSJdKQogICAgICAgIHJvd19wYXJ0LCBwYXJ0aXRpb25fZWRpdCA9IGNyZWF0ZV9m
aWVsZF9yb3coIlBhcnRpdGlvbjoiLCBzZWxmLm1zZ19maWx0ZXJzWyJwYXJ0aXRpb24iXSkKICAg
ICAgICByb3dfb2ZmLCBvZmZzZXRfZWRpdCA9IGNyZWF0ZV9maWVsZF9yb3coIk9mZnNldDoiLCBz
ZWxmLm1zZ19maWx0ZXJzWyJvZmZzZXQiXSkKCiAgICAgICAgcGlsZSA9IHVyd2lkLlBpbGUoCiAg
ICAgICAgICAgIFsKICAgICAgICAgICAgICAgIHVyd2lkLlRleHQoIkZpbHRlciBtZXNzYWdlcyBi
eSBmaWVsZHM6IiksCiAgICAgICAgICAgICAgICB1cndpZC5EaXZpZGVyKCksCiAgICAgICAgICAg
ICAgICB1cndpZC5UZXh0KCIoQ2FzZS1pbnNlbnNpdGl2ZSBzdWJzdHJpbmcgc2VhcmNoKSIpLAog
ICAgICAgICAgICAgICAgdXJ3aWQuRGl2aWRlcigpLAogICAgICAgICAgICAgICAgcm93X2tleSwK
ICAgICAgICAgICAgICAgIHJvd192YWwsCiAgICAgICAgICAgICAgICByb3dfcGFydCwKICAgICAg
ICAgICAgICAgIHJvd19vZmYsCiAgICAgICAgICAgICAgICB1cndpZC5EaXZpZGVyKCksCiAgICAg
ICAgICAgICAgICB1cndpZC5BdHRyTWFwKHVyd2lkLkJ1dHRvbigiQXBwbHkiLCBvbl9wcmVzcz1v
bl9hcHBseSksICJidG4iLCBmb2N1c19tYXA9ImJ0bl9mb2N1cyIpLAogICAgICAgICAgICAgICAg
dXJ3aWQuQXR0ck1hcCh1cndpZC5CdXR0b24oIkNsZWFyIEFsbCIsIG9uX3ByZXNzPW9uX2NsZWFy
KSwgImJ0biIsIGZvY3VzX21hcD0iYnRuX2ZvY3VzIiksCiAgICAgICAgICAgICAgICB1cndpZC5B
dHRyTWFwKHVyd2lkLkJ1dHRvbigiQ2FuY2VsIiwgb25fcHJlc3M9b25fY2FuY2VsKSwgImJ0biIs
IGZvY3VzX21hcD0iYnRuX2ZvY3VzIiksCiAgICAgICAgICAgIF0KICAgICAgICApCiAgICAgICAg
c2VsZi5fc2hvd19kaWFsb2cocGlsZSwgIkZpbHRlciBNZXNzYWdlcyIpCgogICAgIyAtLS0tLSBt
ZXNzYWdlIGZ1bGwtdmlldyAtLS0tLQogICAgZGVmIF9vcGVuX21lc3NhZ2VfdmlldyhzZWxmLCBy
b3c6IE1zZ1Jvdyk6CgogICAgICAgIGlmIHJvdyBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4K
CiAgICAgICAgIyDQpNGD0L3QutGG0LjRjyDQtNC70Y8g0L/RgNC+0LLQtdGA0LrQuCDQvdCw0LvQ
uNGH0LjRjyDQvdC10L/QtdGH0LDRgtC90YvRhSDRgdC40LzQstC+0LvQvtCyCiAgICAgICAgZGVm
IGhhc19ub25fcHJpbnRhYmxlKHRleHQpOgogICAgICAgICAgICBpZiBub3QgdGV4dDoKICAgICAg
ICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBmb3IgY2ggaW4gdGV4dDoKICAgICAg
ICAgICAgICAgICMgaXNwcmludGFibGUoKSDQstC+0LfQstGA0LDRidCw0LXRgiBGYWxzZSDQtNC7
0Y8gXG4sIFxyLCBcdCwg0L/QvtGN0YLQvtC80YMg0LjRhSDQvdGD0LbQvdC+INC40YHQutC70Y7R
h9C40YLRjCDRj9Cy0L3QvgogICAgICAgICAgICAgICAgaWYgbm90IGNoLmlzcHJpbnRhYmxlKCkg
YW5kIGNoIG5vdCBpbiAoJ1xuJywgJ1xyJywgJ1x0Jyk6CiAgICAgICAgICAgICAgICAgICAgcmV0
dXJuIFRydWUKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgICMg0J7Qv9GA0LXQtNC1
0LvRj9C10Lwg0YDQtdC20LjQvCDQv9C+INGD0LzQvtC70YfQsNC90LjRjjog0LXRgdC70Lgg0LXR
gdGC0Ywg0LHQuNC90LDRgNC90YvQtSDQtNCw0L3QvdGL0LUgLT4gaGV4LCDQuNC90LDRh9C1IC0+
IHRleHQKICAgICAgICBtb2RlID0gInRleHQiCiAgICAgICAgaWYgaGFzX25vbl9wcmludGFibGUo
cm93LmtleSkgb3IgaGFzX25vbl9wcmludGFibGUocm93LmZ1bGxfdGV4dCk6CiAgICAgICAgICAg
IG1vZGUgPSAiaGV4IgoKICAgICAgICB2aWV3X3dhbGtlciA9IHVyd2lkLlNpbXBsZUZvY3VzTGlz
dFdhbGtlcihbXSkKICAgICAgICBib3ggPSBOb25lICAjINCx0YPQtNC10YIg0YPRgdGC0LDQvdC+
0LLQu9C10L0g0L3QuNC20LUKCiAgICAgICAgZGVmIGJ1aWxkX2xpbmVzKCk6CiAgICAgICAgICAg
IGxpbmVzID0gW10KCiAgICAgICAgICAgIGxpbmVzLmFwcGVuZChmIiAgICAgICAgVG9waWM6IHty
b3cudG9waWN9IikKCiAgICAgICAgICAgIGlmIHJvdy50aW1lc3RhbXA6CiAgICAgICAgICAgICAg
ICBsaW5lcy5hcHBlbmQoZiIgICAgVGltZXN0YW1wOiB7cm93LnRpbWVzdGFtcH0gbXMiKQoKICAg
ICAgICAgICAgICAgIGZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lCiAgICAgICAgICAgICAg
ICBkdCA9IGRhdGV0aW1lLmZyb210aW1lc3RhbXAocm93LnRpbWVzdGFtcCAvIDEwMDAuMCkKICAg
ICAgICAgICAgICAgIGR0X2xvY2FsID0gZHQuYXN0aW1lem9uZSgpCiAgICAgICAgICAgICAgICBp
c29fZGF0ZXRpbWUgPSBkdF9sb2NhbC5pc29mb3JtYXQoKQogICAgICAgICAgICAgICAgbGluZXMu
YXBwZW5kKGYiICAgICBEYXRlVGltZToge2lzb19kYXRldGltZX0iKQoKICAgICAgICAgICAgICAg
IG5vdyA9IGRhdGV0aW1lLm5vdygpCiAgICAgICAgICAgICAgICBkZWx0YSA9IG5vdyAtIGR0CiAg
ICAgICAgICAgICAgICBzZWNvbmRzID0gaW50KGRlbHRhLnRvdGFsX3NlY29uZHMoKSkKCiAgICAg
ICAgICAgICAgICBpZiBzZWNvbmRzIDwgNjA6CiAgICAgICAgICAgICAgICAgICAgdGltZV9hZ28g
PSBmIntzZWNvbmRzfSBzZWNvbmR7J3MnIGlmIHNlY29uZHMgIT0gMSBlbHNlICcnfSBhZ28iCiAg
ICAgICAgICAgICAgICBlbGlmIHNlY29uZHMgPCAzNjAwOgogICAgICAgICAgICAgICAgICAgIG1p
bnV0ZXMgPSBzZWNvbmRzIC8vIDYwCiAgICAgICAgICAgICAgICAgICAgdGltZV9hZ28gPSBmIntt
aW51dGVzfSBtaW51dGV7J3MnIGlmIG1pbnV0ZXMgIT0gMSBlbHNlICcnfSBhZ28iCiAgICAgICAg
ICAgICAgICBlbGlmIHNlY29uZHMgPCA4NjQwMDoKICAgICAgICAgICAgICAgICAgICBob3VycyA9
IHNlY29uZHMgLy8gMzYwMAogICAgICAgICAgICAgICAgICAgIHRpbWVfYWdvID0gZiJ7aG91cnN9
IGhvdXJ7J3MnIGlmIGhvdXJzICE9IDEgZWxzZSAnJ30gYWdvIgogICAgICAgICAgICAgICAgZWxz
ZToKICAgICAgICAgICAgICAgICAgICBkYXlzID0gc2Vjb25kcyAvLyA4NjQwMAogICAgICAgICAg
ICAgICAgICAgIHRpbWVfYWdvID0gZiJ7ZGF5c30gZGF5eydzJyBpZiBkYXlzICE9IDEgZWxzZSAn
J30gYWdvIgoKICAgICAgICAgICAgICAgIGxpbmVzLmFwcGVuZChmIiAgICBQdWJsaXNoZWQ6IHt0
aW1lX2Fnb30iKQoKICAgICAgICAgICAgbGluZXMuYXBwZW5kKGYiICAgICAgIE9mZnNldDoge3Jv
dy5vZmZzZXR9IikKICAgICAgICAgICAgbGluZXMuYXBwZW5kKGYiICAgIFBhcnRpdGlvbjoge3Jv
dy5wYXJ0aXRpb259IikKCiAgICAgICAgICAgIGlmIHJvdy5mdWxsX3RleHQgaXMgbm90IE5vbmU6
CiAgICAgICAgICAgICAgICBzaXplX2J5dGVzID0gbGVuKHJvdy5mdWxsX3RleHQuZW5jb2RlKCJ1
dGYtOCIsIGVycm9ycz0icmVwbGFjZSIpKQogICAgICAgICAgICAgICAgaWYgc2l6ZV9ieXRlcyA8
IDEwMjQ6CiAgICAgICAgICAgICAgICAgICAgc2l6ZV9zdHIgPSBmIntzaXplX2J5dGVzfSBCIgog
ICAgICAgICAgICAgICAgZWxpZiBzaXplX2J5dGVzIDwgMTAyNCAqIDEwMjQ6CiAgICAgICAgICAg
ICAgICAgICAgc2l6ZV9zdHIgPSBmIntzaXplX2J5dGVzIC8gMTAyNDouMWZ9IEtCIgogICAgICAg
ICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBzaXplX3N0ciA9IGYie3NpemVfYnl0
ZXMgLyAoMTAyNCAqIDEwMjQpOi4xZn0gTUIiCiAgICAgICAgICAgICAgICBsaW5lcy5hcHBlbmQo
ZiIgICAgICAgICBTaXplOiB7c2l6ZV9zdHJ9IikKCiAgICAgICAgICAgIGtleV92YWx1ZSA9IHJv
dy5rZXkgaWYgcm93LmtleSBlbHNlICIiCiAgICAgICAgICAgICMgbGluZXMuYXBwZW5kKGYiICAg
ICAgICAgIEtleToge2tleV92YWx1ZX0iKQogICAgICAgICAgICBsaW5lcy5hcHBlbmQoZiIgICAg
ICAgICAgS2V5OiAoe21vZGV9LCBGNCB0b2dnbGUgYWZmZWN0cyBWYWx1ZSBvbmx5KSIpCiAgICAg
ICAgICAgIGlmIG1vZGUgPT0gImhleCI6CiAgICAgICAgICAgICAgICBsaW5lcy5leHRlbmQoc2Vs
Zi5fYnl0ZXNfdG9faGV4X2xpbmVzKGdldGF0dHIocm93LCAicmF3X2tleSIsIE5vbmUpKSkKICAg
ICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxpbmVzLmFwcGVuZChmIiB7cm93LmtleSBv
ciAnJ30iKQoKICAgICAgICAgICAgbGluZXMuYXBwZW5kKCIiKQoKICAgICAgICAgICAgbGluZXMu
YXBwZW5kKGYiICAgICAgICBWYWx1ZTogKHttb2RlfSwgRjQgdG9nZ2xlKSIpCiAgICAgICAgICAg
IGlmIG1vZGUgPT0gImhleCI6CiAgICAgICAgICAgICAgICByYXdfdmFsID0gZ2V0YXR0cihyb3cs
ICJyYXdfdmFsdWUiLCBOb25lKQogICAgICAgICAgICAgICAgaWYgcmF3X3ZhbCBpcyBOb25lOgog
ICAgICAgICAgICAgICAgICAgICMgZmFsbGJhY2s6INC/0L7QutCw0LbQtdC8IGhleCDQvtGCINGC
0LXQutGB0YLQsCAo0YXRg9C20LUsINC90L4g0LvRg9GH0YjQtSDRh9C10Lwg0L3QuNGH0LXQs9C+
KQogICAgICAgICAgICAgICAgICAgIHJhd192YWwgPSByb3cuZnVsbF90ZXh0IGlmIHJvdy5mdWxs
X3RleHQgaXMgbm90IE5vbmUgZWxzZSAiIgogICAgICAgICAgICAgICAgICAgIGxpbmVzLmFwcGVu
ZCgiIDxubyByYXcgYnl0ZXMgc3RvcmVkOyBzaG93aW5nIGhleCBvZiBkZWNvZGVkIHRleHQ+IikK
ICAgICAgICAgICAgICAgIGxpbmVzLmV4dGVuZChzZWxmLl9ieXRlc190b19oZXhfbGluZXMocmF3
X3ZhbCkpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsaW5lcy5leHRlbmQoc2Vs
Zi5fc2FmZV92YWx1ZV90ZXh0X2xpbmVzKHJvdykpCgogICAgICAgICAgICByZXR1cm4gbGluZXMK
CiAgICAgICAgZGVmIHJlYnVpbGQoKToKICAgICAgICAgICAgbm9ubG9jYWwgYm94CiAgICAgICAg
ICAgIGxpbmVzID0gYnVpbGRfbGluZXMoKQogICAgICAgICAgICB2aWV3X3dhbGtlcls6XSA9IFtT
ZWxlY3RhYmxlVGV4dChsbikgZm9yIGxuIGluIGxpbmVzXQogICAgICAgICAgICBpZiBib3ggaXMg
bm90IE5vbmU6CiAgICAgICAgICAgICAgICBib3guc2V0X3RpdGxlKGYiTWVzc2FnZSBwe3Jvdy5w
YXJ0aXRpb259QHtyb3cub2Zmc2V0fSB8IEY0OlRvZ2dsZSBoZXggfCBTOlNhdmUgfCBFc2M6Q2xv
c2UiKQoKICAgICAgICBjbGFzcyBNc2dWaWV3TGlzdEJveCh1cndpZC5MaXN0Qm94KToKICAgICAg
ICAgICAgZGVmIGtleXByZXNzKGxiX3NlbGYsIHNpemUsIGtleSk6CiAgICAgICAgICAgICAgICBu
b25sb2NhbCBtb2RlCiAgICAgICAgICAgICAgICBpZiBrZXkgPT0gImY0IjoKICAgICAgICAgICAg
ICAgICAgICBtb2RlID0gImhleCIgaWYgbW9kZSA9PSAidGV4dCIgZWxzZSAidGV4dCIKICAgICAg
ICAgICAgICAgICAgICByZWJ1aWxkKCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQog
ICAgICAgICAgICAgICAgaWYga2V5IGluICgicyIsICJTIik6CiAgICAgICAgICAgICAgICAgICAg
c2VsZi5fc2hvd19zYXZlX2RpYWxvZyhyb3cpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5v
bmUKICAgICAgICAgICAgICAgIGlmIGtleSBpbiAoImVzYyIsICJxIiwgIlEiKToKICAgICAgICAg
ICAgICAgICAgICBzZWxmLl9jbG9zZV9kaWFsb2coKQogICAgICAgICAgICAgICAgICAgIHJldHVy
biBOb25lCiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIoKS5rZXlwcmVzcyhzaXplLCBrZXkp
CgogICAgICAgIHZpZXdfbGlzdCA9IE1zZ1ZpZXdMaXN0Qm94KHZpZXdfd2Fsa2VyKQogICAgICAg
IGJveCA9IHVyd2lkLkxpbmVCb3godXJ3aWQuQXR0ck1hcCh2aWV3X2xpc3QsICJkaWFsb2dfYmci
KSwgdGl0bGU9IiIpCiAgICAgICAgc2VsZi5kaWFsb2dfb3ZlcmxheSA9IHVyd2lkLk92ZXJsYXko
CiAgICAgICAgICAgIHRvcF93PXVyd2lkLlBhZGRpbmcoYm94LCBsZWZ0PTIsIHJpZ2h0PTIpLAog
ICAgICAgICAgICBib3R0b21fdz1zZWxmLm1haW5fZnJhbWUsCiAgICAgICAgICAgIGFsaWduPSJj
ZW50ZXIiLAogICAgICAgICAgICB3aWR0aD0oInJlbGF0aXZlIiwgOTApLAogICAgICAgICAgICB2
YWxpZ249Im1pZGRsZSIsCiAgICAgICAgICAgIGhlaWdodD0oInJlbGF0aXZlIiwgOTApLAogICAg
ICAgICAgICBtaW5fd2lkdGg9NDAsCiAgICAgICAgICAgIG1pbl9oZWlnaHQ9MTAsCiAgICAgICAg
KQogICAgICAgIHNlbGYubG9vcC53aWRnZXQgPSBzZWxmLmRpYWxvZ19vdmVybGF5CiAgICAgICAg
cmVidWlsZCgpCgogICAgZGVmIF9ieXRlc190b19oZXhfbGluZXMoc2VsZiwgZGF0YSwgd2lkdGg9
MTYpOgogICAgICAgIGlmIGRhdGEgaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIFsiIDxudWxs
PiJdCgogICAgICAgIGlmIGlzaW5zdGFuY2UoZGF0YSwgc3RyKToKICAgICAgICAgICAgZGF0YSA9
IGRhdGEuZW5jb2RlKCJ1dGYtOCIsIGVycm9ycz0icmVwbGFjZSIpCiAgICAgICAgZWxpZiBub3Qg
aXNpbnN0YW5jZShkYXRhLCAoYnl0ZXMsIGJ5dGVhcnJheSkpOgogICAgICAgICAgICBkYXRhID0g
c3RyKGRhdGEpLmVuY29kZSgidXRmLTgiLCBlcnJvcnM9InJlcGxhY2UiKQoKICAgICAgICBvdXQg
PSBbXQogICAgICAgIGZvciBvZmYgaW4gcmFuZ2UoMCwgbGVuKGRhdGEpLCB3aWR0aCk6CiAgICAg
ICAgICAgIGNodW5rID0gZGF0YVtvZmY6b2ZmICsgd2lkdGhdCiAgICAgICAgICAgIGhleF9wYXJ0
ID0gIiAiLmpvaW4oZiJ7YjowMnh9IiBmb3IgYiBpbiBjaHVuaykKICAgICAgICAgICAgYXNjaWlf
cGFydCA9ICIiLmpvaW4oY2hyKGIpIGlmIDMyIDw9IGIgPCAxMjcgZWxzZSAiLiIgZm9yIGIgaW4g
Y2h1bmspCiAgICAgICAgICAgIG91dC5hcHBlbmQoZiIge29mZjowOHh9ICB7aGV4X3BhcnQ6PHt3
aWR0aCAqIDN9fSB8e2FzY2lpX3BhcnR9fCIpCiAgICAgICAgcmV0dXJuIG91dAoKICAgIGRlZiBf
c2FmZV92YWx1ZV90ZXh0X2xpbmVzKHNlbGYsIHJvdyk6CiAgICAgICAgdmFsdWVfdGV4dCA9IHJv
dy5mdWxsX3RleHQgaWYgcm93LmZ1bGxfdGV4dCBlbHNlICIiCiAgICAgICAgdHJ5OgogICAgICAg
ICAgICBpbXBvcnQganNvbgogICAgICAgICAgICBqc29uX29iaiA9IGpzb24ubG9hZHModmFsdWVf
dGV4dCkKICAgICAgICAgICAgcHJldHR5X2pzb24gPSBqc29uLmR1bXBzKGpzb25fb2JqLCBpbmRl
bnQ9MiwgZW5zdXJlX2FzY2lpPUZhbHNlKQogICAgICAgICAgICByZXR1cm4gW2YiIHtsaW5lfSIg
Zm9yIGxpbmUgaW4gcHJldHR5X2pzb24uc3BsaXRsaW5lcygpXQogICAgICAgIGV4Y2VwdCBFeGNl
cHRpb246CiAgICAgICAgICAgIHJldHVybiBbZiIge2xpbmV9IiBmb3IgbGluZSBpbiB2YWx1ZV90
ZXh0LnNwbGl0bGluZXMoKV0KCiAgICAjIC0tLS0tIHRvcGljIGluZm8gdmlldyAtLS0tLQoKICAg
IGRlZiBfc2hvd190b3BpY19pbmZvKHNlbGYsIHRvcGljKToKICAgICAgICAiIiJEaXNwbGF5IHRv
cGljIGluZm9ybWF0aW9uOiBwYXJ0aXRpb25zLCByZXBsaWNhcywgcmVjb3JkcywgY29uc3VtZXIg
Z3JvdXBzLCBjb25maWciIiIKICAgICAgICBpZiBub3QgdG9waWM6CiAgICAgICAgICAgIHJldHVy
bgoKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgR2V0IHRvcGljIG1ldGFkYXRhCiAgICAgICAg
ICAgIG1ldGFkYXRhID0gc2VsZi5hZG1pbl9jbGllbnQuZGVzY3JpYmVfdG9waWNzKFt0b3BpY10p
CiAgICAgICAgICAgIHRvcGljX2luZm8gPSBtZXRhZGF0YVswXSBpZiBtZXRhZGF0YSBlbHNlIE5v
bmUKCiAgICAgICAgICAgIG51bV9wYXJ0aXRpb25zID0gbGVuKHRvcGljX2luZm9bJ3BhcnRpdGlv
bnMnXSkgaWYgdG9waWNfaW5mbyBhbmQgJ3BhcnRpdGlvbnMnIGluIHRvcGljX2luZm8gZWxzZSAw
CiAgICAgICAgICAgIG51bV9yZXBsaWNhcyA9IGxlbih0b3BpY19pbmZvWydwYXJ0aXRpb25zJ11b
MF1bJ3JlcGxpY2FzJ10pIGlmIHRvcGljX2luZm8gYW5kIHRvcGljX2luZm8uZ2V0KAogICAgICAg
ICAgICAgICAgJ3BhcnRpdGlvbnMnKSBlbHNlIDAKCiAgICAgICAgICAgICMgR2V0IHJlY29yZCBj
b3VudAogICAgICAgICAgICBjZmcgPSBzZWxmLl9nZXRfa2Fma2FfY29uZmlnKCkKICAgICAgICAg
ICAgY2ZnLnVwZGF0ZSh7CiAgICAgICAgICAgICAgICAiZW5hYmxlX2F1dG9fY29tbWl0IjogRmFs
c2UsCiAgICAgICAgICAgICAgICAiY29uc3VtZXJfdGltZW91dF9tcyI6IDEwMDAsCiAgICAgICAg
ICAgIH0pCiAgICAgICAgICAgIGNvbnN1bWVyID0gS2Fma2FDb25zdW1lcigqKmNmZykKICAgICAg
ICAgICAgcGFydHMgPSBjb25zdW1lci5wYXJ0aXRpb25zX2Zvcl90b3BpYyh0b3BpYykKICAgICAg
ICAgICAgbnVtX3JlY29yZHMgPSAwCiAgICAgICAgICAgIGlmIHBhcnRzOgogICAgICAgICAgICAg
ICAgdHBzID0gW1RvcGljUGFydGl0aW9uKHRvcGljLCBwKSBmb3IgcCBpbiBwYXJ0c10KICAgICAg
ICAgICAgICAgIGJlZ2luID0gY29uc3VtZXIuYmVnaW5uaW5nX29mZnNldHModHBzKQogICAgICAg
ICAgICAgICAgZW5kID0gY29uc3VtZXIuZW5kX29mZnNldHModHBzKQogICAgICAgICAgICAgICAg
bnVtX3JlY29yZHMgPSBzdW0oZW5kLmdldCh0cCwgMCkgLSBiZWdpbi5nZXQodHAsIDApIGZvciB0
cCBpbiB0cHMpCiAgICAgICAgICAgIGNvbnN1bWVyLmNsb3NlKCkKCiAgICAgICAgICAgICMgR2V0
IGNvbnN1bWVyIGdyb3VwcwogICAgICAgICAgICBhbGxfZ3JvdXBzID0gc2VsZi5hZG1pbl9jbGll
bnQubGlzdF9jb25zdW1lcl9ncm91cHMoKQogICAgICAgICAgICBjb25zdW1lcl9ncm91cHMgPSBb
XQoKICAgICAgICAgICAgZm9yIGdyb3VwX3R1cGxlIGluIGFsbF9ncm91cHM6CiAgICAgICAgICAg
ICAgICBncm91cF9pZCA9IGdyb3VwX3R1cGxlWzBdIGlmIGlzaW5zdGFuY2UoZ3JvdXBfdHVwbGUs
IHR1cGxlKSBlbHNlIGdyb3VwX3R1cGxlCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAg
ICAgICAgICAgb2Zmc2V0cyA9IHNlbGYuYWRtaW5fY2xpZW50Lmxpc3RfY29uc3VtZXJfZ3JvdXBf
b2Zmc2V0cyhncm91cF9pZCkKICAgICAgICAgICAgICAgICAgICBmb3IgdHAgaW4gb2Zmc2V0cy5r
ZXlzKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRwLnRvcGljID09IHRvcGljOgogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgY29uc3VtZXJfZ3JvdXBzLmFwcGVuZCh7CiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnOiBncm91cF9pZCwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAnc3RhdGUnOiAnRW1wdHknLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICdwYXJ0aXRpb25zJzogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAnbWVtYmVycyc6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xhZyc6IDAK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBicmVhawogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAg
ICAgICBwYXNzCgogICAgICAgICAgICAjIEdldCB0b3BpYyBjb25maWd1cmF0aW9uCiAgICAgICAg
ICAgIHRvcGljX2NvbmZpZyA9IHt9CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGNv
bmZpZ19yZXNvdXJjZSA9IENvbmZpZ1Jlc291cmNlKENvbmZpZ1Jlc291cmNlVHlwZS5UT1BJQywg
dG9waWMpCiAgICAgICAgICAgICAgICBjb25maWdzX3Jlc3BvbnNlID0gc2VsZi5hZG1pbl9jbGll
bnQuZGVzY3JpYmVfY29uZmlncyhbY29uZmlnX3Jlc291cmNlXSkKCiAgICAgICAgICAgICAgICAj
IFJlc3BvbnNlIHN0cnVjdHVyZTogY29uZmlnc19yZXNwb25zZVswXS5yZXNvdXJjZXNbMF0gPSAo
ZXJyb3JfY29kZSwgZXJyb3JfbWVzc2FnZSwgcmVzb3VyY2VfdHlwZSwgcmVzb3VyY2VfbmFtZSwg
Y29uZmlnX2VudHJpZXMpCiAgICAgICAgICAgICAgICAjIGNvbmZpZ19lbnRyaWVzIGlzIGEgbGlz
dCBvZiB0dXBsZXM6IChuYW1lLCB2YWx1ZSwgcmVhZF9vbmx5LCBjb25maWdfc291cmNlLCBpc19z
ZW5zaXRpdmUsIHN5bm9ueW1zKQogICAgICAgICAgICAgICAgaWYgY29uZmlnc19yZXNwb25zZSBh
bmQgaGFzYXR0cihjb25maWdzX3Jlc3BvbnNlWzBdLCAncmVzb3VyY2VzJyk6CiAgICAgICAgICAg
ICAgICAgICAgaWYgbGVuKGNvbmZpZ3NfcmVzcG9uc2VbMF0ucmVzb3VyY2VzKSA+IDA6CiAgICAg
ICAgICAgICAgICAgICAgICAgIHJlc291cmNlX3R1cGxlID0gY29uZmlnc19yZXNwb25zZVswXS5y
ZXNvdXJjZXNbMF0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXNvdXJj
ZV90dXBsZSwgdHVwbGUpIGFuZCBsZW4ocmVzb3VyY2VfdHVwbGUpID49IDU6CiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBjb25maWdfZW50cmllcyA9IHJlc291cmNlX3R1cGxlWzRdICAjIDV0
aCBlbGVtZW50IGlzIHRoZSBsaXN0IG9mIGNvbmZpZyBlbnRyaWVzCgogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgZm9yIGVudHJ5IGluIGNvbmZpZ19lbnRyaWVzOgogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoZW50cnksIHR1cGxlKSBhbmQgbGVuKGVudHJ5
KSA+PSAyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWdfbmFtZSA9
IGVudHJ5WzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ192YWx1
ZSA9IGVudHJ5WzFdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcGljX2Nv
bmZpZ1tjb25maWdfbmFtZV0gPSBjb25maWdfdmFsdWUKICAgICAgICAgICAgZXhjZXB0IEV4Y2Vw
dGlvbiBhcyBlX2NvbmZpZzoKICAgICAgICAgICAgICAgIHRyYWNlYmFjay5wcmludF9leGMoKQoK
ICAgICAgICAgICAgIyBCdWlsZCBkaXNwbGF5IGNvbnRlbnQKICAgICAgICAgICAgY29udGVudF9s
aW5lcyA9IFtdCiAgICAgICAgICAgIGNvbnRlbnRfbGluZXMuYXBwZW5kKGYiIHt0b3BpY30iKQog
ICAgICAgICAgICBjb250ZW50X2xpbmVzLmFwcGVuZChmIiB7bnVtX3BhcnRpdGlvbnN9IHBhcnRp
dGlvbnMsIHtudW1fcmVwbGljYXN9IHJlcGxpY2FzIikKICAgICAgICAgICAgY29udGVudF9saW5l
cy5hcHBlbmQoZiIge251bV9yZWNvcmRzfSByZWNvcmRzLCB7bGVuKGNvbnN1bWVyX2dyb3Vwcyl9
IGNvbnN1bWVyIGdyb3VwcyIpCiAgICAgICAgICAgIGNvbnRlbnRfbGluZXMuYXBwZW5kKCIiKQoK
ICAgICAgICAgICAgaWYgY29uc3VtZXJfZ3JvdXBzOgogICAgICAgICAgICAgICAgY29udGVudF9s
aW5lcy5hcHBlbmQoIiAgICBsaXN0IG9mIGNvbnN1bWVyIG1lbWJlcnMiKQogICAgICAgICAgICAg
ICAgY29udGVudF9saW5lcy5hcHBlbmQoIiIpCiAgICAgICAgICAgICAgICBjb250ZW50X2xpbmVz
LmFwcGVuZChmIiAgICAgIHsnTmFtZSc6PDQ1fSB7J1N0YXRlJzo8MjB9IHsnUGFydGl0aW9ucyc6
PDEyfSB7J01lbWJlcnMnOjwxMn0geydMYWcnOjwxMH0iKQogICAgICAgICAgICAgICAgZm9yIGNn
IGluIGNvbnN1bWVyX2dyb3VwczoKICAgICAgICAgICAgICAgICAgICBjb250ZW50X2xpbmVzLmFw
cGVuZCgKICAgICAgICAgICAgICAgICAgICAgICAgZiIgICAgICB7Y2dbJ25hbWUnXTo8NDV9IHtj
Z1snc3RhdGUnXTo8MjB9IHtjZ1sncGFydGl0aW9ucyddOjwxMn0ge2NnWydtZW1iZXJzJ106PDEy
fSB7Y2dbJ2xhZyddOjwxMH0iKQogICAgICAgICAgICAgICAgY29udGVudF9saW5lcy5hcHBlbmQo
IiIpCgogICAgICAgICAgICBpZiB0b3BpY19jb25maWc6CiAgICAgICAgICAgICAgICBjb250ZW50
X2xpbmVzLmFwcGVuZChmIiAgICAgICAgICAgICAgICAgICAgICAgIHsnVG9waWMgY29uZmlndXJh
dGlvbic6PDI1fSB7J1ZhbHVlJzo8NTB9IikKICAgICAgICAgICAgICAgIGZvciBrZXkgaW4gc29y
dGVkKHRvcGljX2NvbmZpZy5rZXlzKCkpOgogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gc3Ry
KHRvcGljX2NvbmZpZ1trZXldKSBpZiB0b3BpY19jb25maWdba2V5XSBpcyBub3QgTm9uZSBlbHNl
ICIiCiAgICAgICAgICAgICAgICAgICAgY29udGVudF9saW5lcy5hcHBlbmQoZiIgICAgICAgICAg
ICAgICAgICAgICAgICB7a2V5Oj4yNX0gICAge3ZhbHVlOjw1MH0iKQogICAgICAgICAgICBlbHNl
OgogICAgICAgICAgICAgICAgY29udGVudF9saW5lcy5hcHBlbmQoIiAgICBUb3BpYyBjb25maWd1
cmF0aW9uOiB1bmFibGUgdG8gcmV0cmlldmUiKQoKICAgICAgICAgICAgIyBDcmVhdGUgc2Nyb2xs
YWJsZSB2aWV3CiAgICAgICAgICAgIHZpZXdfd2Fsa2VyID0gdXJ3aWQuU2ltcGxlRm9jdXNMaXN0
V2Fsa2VyKFtTZWxlY3RhYmxlVGV4dChsbikgZm9yIGxuIGluIGNvbnRlbnRfbGluZXNdKQogICAg
ICAgICAgICB2aWV3X2xpc3QgPSB1cndpZC5MaXN0Qm94KHZpZXdfd2Fsa2VyKQogICAgICAgICAg
ICB0aXRsZSA9IGYiVG9waWMgSW5mb3JtYXRpb246IHt0b3BpY30gKEVzYyB0byBjbG9zZSkiCiAg
ICAgICAgICAgIGJveCA9IHVyd2lkLkxpbmVCb3godXJ3aWQuQXR0ck1hcCh2aWV3X2xpc3QsICJk
aWFsb2dfYmciKSwgdGl0bGU9dGl0bGUpCgogICAgICAgICAgICBzZWxmLmRpYWxvZ19vdmVybGF5
ID0gdXJ3aWQuT3ZlcmxheSgKICAgICAgICAgICAgICAgIHRvcF93PXVyd2lkLlBhZGRpbmcoYm94
LCBsZWZ0PTIsIHJpZ2h0PTIpLAogICAgICAgICAgICAgICAgYm90dG9tX3c9c2VsZi5tYWluX2Zy
YW1lLAogICAgICAgICAgICAgICAgYWxpZ249ImNlbnRlciIsCiAgICAgICAgICAgICAgICB3aWR0
aD0oInJlbGF0aXZlIiwgOTUpLAogICAgICAgICAgICAgICAgdmFsaWduPSJtaWRkbGUiLAogICAg
ICAgICAgICAgICAgaGVpZ2h0PSgicmVsYXRpdmUiLCA5MCksCiAgICAgICAgICAgICAgICBtaW5f
d2lkdGg9ODAsCiAgICAgICAgICAgICAgICBtaW5faGVpZ2h0PTIwLAogICAgICAgICAgICApCiAg
ICAgICAgICAgIHNlbGYubG9vcC53aWRnZXQgPSBzZWxmLmRpYWxvZ19vdmVybGF5CgogICAgICAg
IGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgIyB0cmFjZWJhY2sucHJpbnRfZXhj
KCkKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbigiRXJyb3IgbG9hZGluZyB0b3BpYyBpbmZv
OiAlcyIsIGUpCiAgICAgICAgICAgIHNlbGYuX3Nob3dfbWVzc2FnZShmIkVycm9yIGxvYWRpbmcg
dG9waWMgaW5mbzoge2V9IikKCiAgICAjIC0tLS0tIGRpYWxvZ3MvYWN0aW9ucyAtLS0tLQoKICAg
IGRlZiBfc2hvd19kaWFsb2coc2VsZiwgY29udGVudCwgdGl0bGUpOgogICAgICAgIGhlYWRlciA9
IHVyd2lkLkF0dHJNYXAodXJ3aWQuVGV4dChmIiB7dGl0bGV9ICIsIGFsaWduPSJjZW50ZXIiKSwg
ImRpYWxvZ19oZWFkZXIiKQogICAgICAgIGNvbnRlbnRfYm94ID0gdXJ3aWQuRmlsbGVyKGNvbnRl
bnQsIHZhbGlnbj0idG9wIikKICAgICAgICBkaWFsb2cgPSB1cndpZC5BdHRyTWFwKAogICAgICAg
ICAgICB1cndpZC5MaW5lQm94KHVyd2lkLkZyYW1lKHVyd2lkLlBhZGRpbmcoY29udGVudF9ib3gs
IGxlZnQ9MSwgcmlnaHQ9MSksIGhlYWRlcj1oZWFkZXIpKSwKICAgICAgICAgICAgImRpYWxvZ19i
ZyIsCiAgICAgICAgKQogICAgICAgIHNlbGYuZGlhbG9nX292ZXJsYXkgPSB1cndpZC5PdmVybGF5
KAogICAgICAgICAgICB0b3Bfdz11cndpZC5QYWRkaW5nKGRpYWxvZywgbGVmdD0yLCByaWdodD0y
KSwKICAgICAgICAgICAgYm90dG9tX3c9c2VsZi5tYWluX2ZyYW1lLAogICAgICAgICAgICBhbGln
bj0iY2VudGVyIiwKICAgICAgICAgICAgd2lkdGg9KCJyZWxhdGl2ZSIsIDcwKSwKICAgICAgICAg
ICAgdmFsaWduPSJtaWRkbGUiLAogICAgICAgICAgICBoZWlnaHQ9KCJyZWxhdGl2ZSIsIDYwKSwK
ICAgICAgICAgICAgbWluX3dpZHRoPTUwLAogICAgICAgICAgICBtaW5faGVpZ2h0PTEyLAogICAg
ICAgICkKICAgICAgICBzZWxmLmxvb3Aud2lkZ2V0ID0gc2VsZi5kaWFsb2dfb3ZlcmxheQoKICAg
IGRlZiBfY2xvc2VfZGlhbG9nKHNlbGYpOgogICAgICAgIGlmIHNlbGYuZGlhbG9nX292ZXJsYXkg
aXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYubG9vcC53aWRnZXQgPSBzZWxmLm1haW5fZnJh
bWUKICAgICAgICAgICAgc2VsZi5kaWFsb2dfb3ZlcmxheSA9IE5vbmUKICAgICAgICAgICAgc2Vs
Zi5fc2V0X3N0YXR1cygpCgogICAgZGVmIF9jbG9zZV9kaWFsb2dfYW5kX3JldHVybihzZWxmKToK
ICAgICAgICAiIiJDbG9zZSBjdXJyZW50IGRpYWxvZyBhbmQgc2hvdyBwcmV2aW91cyBvbmUgZnJv
bSBzdGFjayIiIgogICAgICAgIGlmIHNlbGYuZGlhbG9nX292ZXJsYXkgaXMgbm90IE5vbmU6CiAg
ICAgICAgICAgIHNlbGYubG9vcC53aWRnZXQgPSBzZWxmLm1haW5fZnJhbWUKICAgICAgICAgICAg
c2VsZi5kaWFsb2dfb3ZlcmxheSA9IE5vbmUKCiAgICAgICAgICAgICMgUG9wIGFuZCBleGVjdXRl
IHByZXZpb3VzIGRpYWxvZyBmcm9tIHN0YWNrCiAgICAgICAgICAgIGlmIHNlbGYuZGlhbG9nX3N0
YWNrOgogICAgICAgICAgICAgICAgcHJldmlvdXNfZGlhbG9nID0gc2VsZi5kaWFsb2dfc3RhY2su
cG9wKCkKICAgICAgICAgICAgICAgIHByZXZpb3VzX2RpYWxvZygpICAjIENhbGwgdGhlIGZ1bmN0
aW9uIHRvIHJlY3JlYXRlIHByZXZpb3VzIGRpYWxvZwogICAgICAgICAgICBlbHNlOgogICAgICAg
ICAgICAgICAgc2VsZi5fc2V0X3N0YXR1cygpCgogICAgZGVmIF9zaG93X21lc3NhZ2Uoc2VsZiwg
bWVzc2FnZSk6CiAgICAgICAgZGVmIG9uX29rKGJ0bik6CiAgICAgICAgICAgIHNlbGYuX2Nsb3Nl
X2RpYWxvZygpCgogICAgICAgIHBpbGUgPSB1cndpZC5QaWxlKAogICAgICAgICAgICBbCiAgICAg
ICAgICAgICAgICB1cndpZC5UZXh0KG1lc3NhZ2UpLAogICAgICAgICAgICAgICAgdXJ3aWQuRGl2
aWRlcigpLAogICAgICAgICAgICAgICAgdXJ3aWQuQXR0ck1hcCh1cndpZC5CdXR0b24oIk9LIiwg
b25fcHJlc3M9b25fb2spLCAiYnRuIiwgZm9jdXNfbWFwPSJidG5fZm9jdXMiKSwKICAgICAgICAg
ICAgXQogICAgICAgICkKICAgICAgICBzZWxmLl9zaG93X2RpYWxvZyhwaWxlLCAiTWVzc2FnZSIp
CgogICAgZGVmIF9zaG93X29mZnNldHNfZGlhbG9nKHNlbGYpOgogICAgICAgICMgY29udHJvbHMg
c25hcHNob3QgbW9kZSwgbm90IGxpdmUgc2VlawogICAgICAgIG1vZGVfZWRpdCA9IHVyd2lkLkVk
aXQoIk1vZGUgKHRhaWx8YmVnaW4pOiAiLCAidGFpbCIgaWYgc2VsZi5zbmFwc2hvdF9tb2RlID09
ICJ0YWlsIiBlbHNlICJiZWdpbiIpCiAgICAgICAgdGFpbF9lZGl0ID0gdXJ3aWQuRWRpdCgiVGFp
bCBOIHBlciBwYXJ0aXRpb246ICIsIHN0cihzZWxmLnNuYXBzaG90X3RhaWxfbikpCiAgICAgICAg
bWF4X2VkaXQgPSB1cndpZC5FZGl0KCJNYXggdG90YWwgbWVzc2FnZXM6ICIsIHN0cihzZWxmLnNu
YXBzaG90X21heF90b3RhbCkpCgogICAgICAgIGRlZiBvbl9hcHBseShidG4pOgogICAgICAgICAg
ICBtID0gbW9kZV9lZGl0LmVkaXRfdGV4dC5zdHJpcCgpLmxvd2VyKCkKICAgICAgICAgICAgc2Vs
Zi5zbmFwc2hvdF9tb2RlID0gImZyb21fYmVnaW5uaW5nIiBpZiBtIGluICgiYmVnaW4iLCAiYiIs
ICJmcm9tX2JlZ2lubmluZyIpIGVsc2UgInRhaWwiCiAgICAgICAgICAgIHRyeToKICAgICAgICAg
ICAgICAgIHNlbGYuc25hcHNob3RfdGFpbF9uID0gbWF4KDEsIGludCh0YWlsX2VkaXQuZWRpdF90
ZXh0LnN0cmlwKCkpKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAg
ICAgcGFzcwogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzZWxmLnNuYXBzaG90X21h
eF90b3RhbCA9IG1heCgxMDAsIGludChtYXhfZWRpdC5lZGl0X3RleHQuc3RyaXAoKSkpCiAgICAg
ICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAg
IHNlbGYuX2Nsb3NlX2RpYWxvZygpCiAgICAgICAgICAgIGlmIHNlbGYuY3VycmVudF90b3BpYzoK
ICAgICAgICAgICAgICAgIHNlbGYuX2xvYWRfdG9waWNfc25hcHNob3Qoc2VsZi5jdXJyZW50X3Rv
cGljKQogICAgICAgICAgICAgICAgc2VsZi5fZm9jdXNfbWVzc2FnZXMoKQoKICAgICAgICBkZWYg
b25fY2FuY2VsKGJ0bik6CiAgICAgICAgICAgIHNlbGYuX2Nsb3NlX2RpYWxvZygpCgogICAgICAg
IHBpbGUgPSB1cndpZC5QaWxlKAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgICB1cndpZC5U
ZXh0KCJTbmFwc2hvdCAvIG9mZnNldHMgc2V0dGluZ3MiKSwKICAgICAgICAgICAgICAgIHVyd2lk
LkRpdmlkZXIoKSwKICAgICAgICAgICAgICAgIG1vZGVfZWRpdCwKICAgICAgICAgICAgICAgIHRh
aWxfZWRpdCwKICAgICAgICAgICAgICAgIG1heF9lZGl0LAogICAgICAgICAgICAgICAgdXJ3aWQu
RGl2aWRlcigpLAogICAgICAgICAgICAgICAgdXJ3aWQuQXR0ck1hcCh1cndpZC5CdXR0b24oIkFw
cGx5Iiwgb25fcHJlc3M9b25fYXBwbHkpLCAiYnRuIiwgZm9jdXNfbWFwPSJidG5fZm9jdXMiKSwK
ICAgICAgICAgICAgICAgIHVyd2lkLkF0dHJNYXAodXJ3aWQuQnV0dG9uKCJDYW5jZWwiLCBvbl9w
cmVzcz1vbl9jYW5jZWwpLCAiYnRuIiwgZm9jdXNfbWFwPSJidG5fZm9jdXMiKSwKICAgICAgICAg
ICAgXQogICAgICAgICkKICAgICAgICBzZWxmLl9zaG93X2RpYWxvZyhwaWxlLCAiT2Zmc2V0cyIp
CgogICAgZGVmIF9zaG93X3Byb2R1Y2VfZGlhbG9nKHNlbGYpOgogICAgICAgIGlmIG5vdCBzZWxm
LmN1cnJlbnRfdG9waWM6CiAgICAgICAgICAgIHNlbGYuX3Nob3dfbWVzc2FnZSgiTm8gdG9waWMg
c2VsZWN0ZWQiKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgdG9waWMgPSBzZWxmLmN1cnJl
bnRfdG9waWMKCiAgICAgICAgIyBEaXNhbGxvdyBwcm9kdWNpbmcgdG8gaW50ZXJuYWwgdG9waWNz
CiAgICAgICAgaWYgdG9waWMuc3RhcnRzd2l0aCgiX18iKToKICAgICAgICAgICAgc2VsZi5fc2hv
d19tZXNzYWdlKGYiUHJvZHVjaW5nIHRvIGludGVybmFsIHRvcGljcyBpcyBmb3JiaWRkZW46IHt0
b3BpY30iKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAga2V5X2VkaXQgPSB1cndpZC5FZGl0
KCJLZXkgKG9wdGlvbmFsKTogIikKICAgICAgICB2YWxfZWRpdCA9IHVyd2lkLkVkaXQoIlZhbHVl
OlxuIiwgbXVsdGlsaW5lPVRydWUpCiAgICAgICAgdmFsX2JveCA9IHVyd2lkLkxpbmVCb3godXJ3
aWQuRmlsbGVyKHZhbF9lZGl0LCB2YWxpZ249InRvcCIpLCB0aXRsZT0iTWVzc2FnZSBib2R5IikK
CiAgICAgICAgZGVmIG9uX3NlbmQoYnRuKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAg
ICAgcHJvZHVjZXIgPSBLYWZrYVByb2R1Y2VyKAogICAgICAgICAgICAgICAgICAgICoqc2VsZi5f
Z2V0X2thZmthX2NvbmZpZygpLAogICAgICAgICAgICAgICAgICAgIGtleV9zZXJpYWxpemVyPWxh
bWJkYSBzOiBzLmVuY29kZSgidXRmLTgiKSBpZiBzIGlzIG5vdCBOb25lIGVsc2UgTm9uZSwKICAg
ICAgICAgICAgICAgICAgICB2YWx1ZV9zZXJpYWxpemVyPWxhbWJkYSBzOiBzLmVuY29kZSgidXRm
LTgiKSBpZiBzIGlzIG5vdCBOb25lIGVsc2UgTm9uZSwKICAgICAgICAgICAgICAgICkKICAgICAg
ICAgICAgICAgIGtleSA9IGtleV9lZGl0LmVkaXRfdGV4dAogICAgICAgICAgICAgICAga2V5ID0g
a2V5IGlmIGtleSAhPSAiIiBlbHNlIE5vbmUKICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsX2Vk
aXQuZWRpdF90ZXh0CiAgICAgICAgICAgICAgICBwcm9kdWNlci5zZW5kKHRvcGljLCBrZXk9a2V5
LCB2YWx1ZT12YWx1ZSkKICAgICAgICAgICAgICAgIHByb2R1Y2VyLmZsdXNoKDUpCiAgICAgICAg
ICAgICAgICBwcm9kdWNlci5jbG9zZSgpCiAgICAgICAgICAgICAgICBzZWxmLl9jbG9zZV9kaWFs
b2coKQogICAgICAgICAgICAgICAgIyDQvtCx0L3QvtCy0LvRj9C10Lwgc25hcHNob3Qg0Lgg0L7R
gdGC0LDRkdC80YHRjyDQsiBNZXNzYWdlcwogICAgICAgICAgICAgICAgc2VsZi5fbG9hZF90b3Bp
Y19zbmFwc2hvdCh0b3BpYykKICAgICAgICAgICAgICAgIHNlbGYuX2ZvY3VzX21lc3NhZ2VzKCkK
ICAgICAgICAgICAgICAgIHNlbGYuX3Nob3dfbWVzc2FnZSgiTWVzc2FnZSBzZW50IikKICAgICAg
ICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgc2VsZi5fc2hvd19t
ZXNzYWdlKGYiRXJyb3Igc2VuZGluZzoge2V9IikKCiAgICAgICAgZGVmIG9uX2NhbmNlbChidG4p
OgogICAgICAgICAgICBzZWxmLl9jbG9zZV9kaWFsb2coKQoKICAgICAgICBwaWxlID0gdXJ3aWQu
UGlsZSgKICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgdXJ3aWQuVGV4dChmIlByb2R1Y2Ug
dG86IHt0b3BpY30iKSwKICAgICAgICAgICAgICAgIHVyd2lkLkRpdmlkZXIoKSwKICAgICAgICAg
ICAgICAgIGtleV9lZGl0LAogICAgICAgICAgICAgICAgdXJ3aWQuRGl2aWRlcigpLAogICAgICAg
ICAgICAgICAgdmFsX2JveCwKICAgICAgICAgICAgICAgIHVyd2lkLkRpdmlkZXIoKSwKICAgICAg
ICAgICAgICAgIHVyd2lkLkF0dHJNYXAodXJ3aWQuQnV0dG9uKCJTZW5kIiwgb25fcHJlc3M9b25f
c2VuZCksICJidG4iLCBmb2N1c19tYXA9ImJ0bl9mb2N1cyIpLAogICAgICAgICAgICAgICAgdXJ3
aWQuQXR0ck1hcCh1cndpZC5CdXR0b24oIkNhbmNlbCIsIG9uX3ByZXNzPW9uX2NhbmNlbCksICJi
dG4iLCBmb2N1c19tYXA9ImJ0bl9mb2N1cyIpLAogICAgICAgICAgICBdCiAgICAgICAgKQogICAg
ICAgIHNlbGYuX3Nob3dfZGlhbG9nKHBpbGUsICJQcm9kdWNlIG1lc3NhZ2UiKQoKICAgICMgLS0t
LS0gaW5wdXQgLS0tLS0KCiAgICBkZWYgX2hhbmRsZV9pbnB1dChzZWxmLCBrZXkpOgogICAgICAg
ICMgTGV0IGxpc3Rib3hlcyBkbyB0aGVpciBuYXRpdmUgbmF2aWdhdGlvbjsgd2Ugb25seSBpbnRl
cmNlcHQgY29tbWFuZHMuCiAgICAgICAgaWYga2V5IGluICgicSIsICJRIik6CiAgICAgICAgICAg
IHJhaXNlIHVyd2lkLkV4aXRNYWluTG9vcCgpCgogICAgICAgIGlmIGtleSBpbiAoJ24nLCAnTicp
OgogICAgICAgICAgICBpZiBzZWxmLmNvbHVtbnMuZm9jdXNfcG9zaXRpb24gPT0gMDogICMg0LIg
0YHQv9C40YHQutC1INGC0L7Qv9C40LrQvtCyCiAgICAgICAgICAgICAgICBzZWxmLl9zaG93X2Ny
ZWF0ZV90b3BpY19kaWFsb2coKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgaWYga2V5IGlu
ICgnZycsICdHJyk6CiAgICAgICAgICAgIGlmIHNlbGYuY29sdW1ucy5mb2N1c19wb3NpdGlvbiA9
PSAwOiAgIyDQsiDRgdC/0LjRgdC60LUg0YLQvtC/0LjQutC+0LIKICAgICAgICAgICAgICAgIHNl
bGYuX3Nob3dfY29uc3VtZXJfZ3JvdXBzX21vbml0b3IoKQogICAgICAgICAgICByZXR1cm4KCiAg
ICAgICAgaWYga2V5ID09ICJlc2MiOgogICAgICAgICAgICBpZiBzZWxmLmRpYWxvZ19vdmVybGF5
IGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgc2VsZi5fY2xvc2VfZGlhbG9nKCkKICAgICAg
ICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJhaXNlIHVyd2lkLkV4aXRNYWluTG9vcCgpCiAg
ICAgICAgICAgIHJldHVybgoKICAgICAgICAjIEYyIC0gc2hvdyB0b3BpYyBpbmZvCiAgICAgICAg
aWYga2V5ID09ICJmMiI6CiAgICAgICAgICAgIGlmIHNlbGYuY29sdW1ucy5mb2N1c19wb3NpdGlv
biA9PSAwOgogICAgICAgICAgICAgICAgdCA9IHNlbGYuX2ZvY3VzZWRfdG9waWMoKQogICAgICAg
ICAgICAgICAgaWYgdCBhbmQgbm90IHQuc3RhcnRzd2l0aCgiQ29ubmVjdGlvbiBlcnJvciIpIGFu
ZCBub3QgdC5zdGFydHN3aXRoKCJObyB0b3BpY3MiKToKICAgICAgICAgICAgICAgICAgICBzZWxm
Ll9zaG93X3RvcGljX2luZm8odCkKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgICMgRjMgLSBz
aG93IHRvcGljIEFDTHMKICAgICAgICBpZiBrZXkgPT0gImYzIjoKICAgICAgICAgICAgaWYgc2Vs
Zi5jb2x1bW5zLmZvY3VzX3Bvc2l0aW9uID09IDA6CiAgICAgICAgICAgICAgICB0ID0gc2VsZi5f
Zm9jdXNlZF90b3BpYygpCiAgICAgICAgICAgICAgICBpZiB0IGFuZCBub3QgdC5zdGFydHN3aXRo
KCJDb25uZWN0aW9uIGVycm9yIikgYW5kIG5vdCB0LnN0YXJ0c3dpdGgoIk5vIHRvcGljcyIpOgog
ICAgICAgICAgICAgICAgICAgIHNlbGYuX3Nob3dfdG9waWNfYWNscyh0KQogICAgICAgICAgICBy
ZXR1cm4KCiAgICAgICAgIyBGNCAtIHNob3cgQUNMIHJlc291cmNlIG1lbnUKICAgICAgICBpZiBr
ZXkgPT0gImY0IjoKICAgICAgICAgICAgaWYgc2VsZi5jb2x1bW5zLmZvY3VzX3Bvc2l0aW9uID09
IDA6CiAgICAgICAgICAgICAgICBzZWxmLl9zaG93X2FjbF9yZXNvdXJjZV9tZW51KCkKICAgICAg
ICAgICAgcmV0dXJuCgogICAgICAgICMgRjcgLSBzaG93IGZpbHRlciBkaWFsb2cgKGNvbnRleHQt
YXdhcmUpCiAgICAgICAgaWYga2V5ID09ICJmNyI6CiAgICAgICAgICAgIGlmIHNlbGYuY29sdW1u
cy5mb2N1c19wb3NpdGlvbiA9PSAwOgogICAgICAgICAgICAgICAgIyBGaWx0ZXIgdG9waWNzCiAg
ICAgICAgICAgICAgICBzZWxmLl9zaG93X2ZpbHRlcl9kaWFsb2coKQogICAgICAgICAgICBlbGlm
IHNlbGYuY29sdW1ucy5mb2N1c19wb3NpdGlvbiA9PSAxIGFuZCBsZW4oc2VsZi5tc2dfd2Fsa2Vy
KSA+IDE6CiAgICAgICAgICAgICAgICAjIEZpbHRlciBtZXNzYWdlcwogICAgICAgICAgICAgICAg
c2VsZi5fc2hvd19tZXNzYWdlX2ZpbHRlcl9kaWFsb2coKQogICAgICAgICAgICByZXR1cm4KCiAg
ICAgICAgaWYga2V5ID09ICdmOCc6CiAgICAgICAgICAgIHQgPSBzZWxmLl9mb2N1c2VkX3RvcGlj
KCkKICAgICAgICAgICAgaWYgdCBhbmQgbm90IHQuc3RhcnRzd2l0aCgiQ29ubmVjdGlvbiBlcnJv
ciIpIGFuZCBub3QgdC5zdGFydHN3aXRoKCJObyB0b3BpY3MiKToKICAgICAgICAgICAgICAgIGlm
IHNlbGYuY29sdW1ucy5mb2N1c19wb3NpdGlvbiA9PSAwOgogICAgICAgICAgICAgICAgICAgIHNl
bGYuX3Nob3dfZGVsZXRlX3RvcGljX2NvbmZpcm0odCkKICAgICAgICAgICAgcmV0dXJuCgogICAg
ICAgICMgUyAtIHNob3cgc29ydCBkaWFsb2cKICAgICAgICBpZiBrZXkgaW4gKCJzIiwgIlMiKToK
ICAgICAgICAgICAgaWYgc2VsZi5jb2x1bW5zLmZvY3VzX3Bvc2l0aW9uID09IDEgYW5kIGxlbihz
ZWxmLm1zZ193YWxrZXIpID4gMToKICAgICAgICAgICAgICAgIHNlbGYuX3Nob3dfc29ydF9kaWFs
b2coKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgIyBmb2N1cy1hd2FyZSBhY3Rpb25zCiAg
ICAgICAgaWYga2V5IGluICgiZW50ZXIiLCAicmlnaHQiKToKICAgICAgICAgICAgaWYgc2VsZi5j
b2x1bW5zLmZvY3VzX3Bvc2l0aW9uID09IDA6CiAgICAgICAgICAgICAgICB0ID0gc2VsZi5fZm9j
dXNlZF90b3BpYygpCiAgICAgICAgICAgICAgICBpZiB0IGFuZCBub3QgdC5zdGFydHN3aXRoKCJD
b25uZWN0aW9uIGVycm9yIikgYW5kIG5vdCB0LnN0YXJ0c3dpdGgoIk5vIHRvcGljcyIpOgogICAg
ICAgICAgICAgICAgICAgIHNlbGYuY3VycmVudF90b3BpYyA9IHQKICAgICAgICAgICAgICAgICAg
ICBzZWxmLl9zZXRfc3RhdHVzKCJMb2FkaW5nLi4uIikKICAgICAgICAgICAgICAgICAgICBzZWxm
Ll9sb2FkX3RvcGljX3NuYXBzaG90KHQpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fZm9jdXNf
bWVzc2FnZXMoKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBzZWxm
Ll9mb2N1c19tZXNzYWdlcygpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByb3cg
PSBzZWxmLl9mb2N1c2VkX21lc3NhZ2Vfcm93KCkKICAgICAgICAgICAgICAgIGlmIHJvdzoKICAg
ICAgICAgICAgICAgICAgICBzZWxmLl9vcGVuX21lc3NhZ2Vfdmlldyhyb3cpCiAgICAgICAgICAg
IHJldHVybgoKICAgICAgICBpZiBrZXkgPT0gImxlZnQiOgogICAgICAgICAgICBzZWxmLl9mb2N1
c190b3BpY3MoKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgaWYga2V5IGluICgiciIsICJS
Iik6CiAgICAgICAgICAgIHNlbGYuX2ZldGNoX3RvcGljcygpCiAgICAgICAgICAgIHNlbGYuX3Nl
dF9zdGF0dXMoIlRvcGljcyByZWZyZXNoZWQiKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAg
aWYga2V5IGluICgibyIsICJPIik6CiAgICAgICAgICAgIHNlbGYuX3Nob3dfb2Zmc2V0c19kaWFs
b2coKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgaWYga2V5IGluICgicCIsICJQIik6CiAg
ICAgICAgICAgIHNlbGYuX3Nob3dfcHJvZHVjZV9kaWFsb2coKQogICAgICAgICAgICByZXR1cm4K
CiAgICAgICAgIyB1cGRhdGUgZm9vdGVyIHdoZW4gc2Nyb2xsaW5nIG1lc3NhZ2VzCiAgICAgICAg
c2VsZi5fbWF5YmVfdXBkYXRlX2Zvb3Rlcl9vbl9mb2N1cygpCgogICAgZGVmIHJ1bihzZWxmKToK
ICAgICAgICBwYWxldHRlID0gWwogICAgICAgICAgICAoImJvZHkiLCAid2hpdGUiLCAiZGFyayBi
bHVlIiksCiAgICAgICAgICAgICgiZm9vdGVyIiwgIndoaXRlIiwgImRhcmsgYmx1ZSIpLAogICAg
ICAgICAgICAoInJldmVyc2VkIiwgImJsYWNrIiwgImxpZ2h0IGN5YW4iKSwKICAgICAgICAgICAg
KCJoZWFkZXIiLCAid2hpdGUsYm9sZCIsICJkYXJrIGJsdWUiKSwgICMgQWRkIHRoaXMgbGluZQog
ICAgICAgICAgICAoImRpYWxvZ19iZyIsICJibGFjayIsICJsaWdodCBncmF5IiksCiAgICAgICAg
ICAgICgiZGlhbG9nX2hlYWRlciIsICJibGFjayxib2xkIiwgImxpZ2h0IGdyYXkiKSwKICAgICAg
ICAgICAgKCJidG4iLCAiYmxhY2siLCAibGlnaHQgZ3JheSIpLAogICAgICAgICAgICAoImJ0bl9m
b2N1cyIsICJibGFjayIsICJsaWdodCBjeWFuIiksCiAgICAgICAgICAgICMgKCJlcnJvciIsICJ3
aGl0ZSIsICJkYXJrIHJlZCIpLAogICAgICAgICAgICAoImVycm9yIiwgImxpZ2h0IHJlZCIsICJi
bGFjayIpLAogICAgICAgICAgICAoImVycm9yX2ZvY3VzIiwgImJsYWNrIiwgImxpZ2h0IGN5YW4i
KSwKICAgICAgICAgICAgKCJlZGl0X2ZvY3VzIiwgImJsYWNrIiwgImxpZ2h0IGN5YW4iKSwKICAg
ICAgICAgICAgKCJlZGl0X2ZpZWxkIiwgImJsYWNrIiwgImRhcmsgY3lhbiIpLAogICAgICAgIF0K
CiAgICAgICAgc2VsZi5sb29wID0gdXJ3aWQuTWFpbkxvb3Aoc2VsZi5tYWluX2ZyYW1lLCBwYWxl
dHRlPXBhbGV0dGUsIHVuaGFuZGxlZF9pbnB1dD1zZWxmLl9oYW5kbGVfaW5wdXQpCgogICAgICAg
ICMgcmVmcmVzaCBmb290ZXIgd2hlbiBtZXNzYWdlcyBjaGFuZ2UgZm9jdXMgYnkgbW91c2Uvc2Ny
b2xsIGtleXMKICAgICAgICBkZWYgX2lkbGUoX2xvb3AsIF9kYXRhKToKICAgICAgICAgICAgc2Vs
Zi5fbWF5YmVfdXBkYXRlX2Zvb3Rlcl9vbl9mb2N1cygpCiAgICAgICAgICAgIHNlbGYubG9vcC5z
ZXRfYWxhcm1faW4oMC4yLCBsYW1iZGEgbCwgZDogX2lkbGUobCwgZCkpCgogICAgICAgIHRyeToK
ICAgICAgICAgICAgc2VsZi5sb29wLnJ1bigpCiAgICAgICAgZmluYWxseToKICAgICAgICAgICAg
aWYgc2VsZi5hZG1pbl9jbGllbnQ6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAg
ICAgICAgc2VsZi5hZG1pbl9jbGllbnQuY2xvc2UoKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4
Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICBwYXNzCgoKZGVmIHBhcnNlX2FyZ3MoKToKICAg
IHBhcnNlciA9IGFyZ3BhcnNlLkFyZ3VtZW50UGFyc2VyKGRlc2NyaXB0aW9uPSJLYWZrYSBUb3Bp
YyBWaWV3ZXIgVFVJIikKCiAgICAjIC0tLSBDb25maWcgbG9hZGluZyBvcHRpb25zIC0tLQogICAg
cGFyc2VyLmFkZF9hcmd1bWVudCgiLWMiLCAiLS1jb25maWciLCBkZWZhdWx0PSJjb25maWcuanNv
biIsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlbHA9IlBhdGggdG8gcGxhaW4gdGV4dCBjb25m
aWcgZmlsZSAoZGVmYXVsdDogY29uZmlnLmpzb24pIikKICAgIHBhcnNlci5hZGRfYXJndW1lbnQo
Ii1lIiwgIi0tZW5jcnlwdGVkLWNvbmZpZyIsIGhlbHA9IlBhdGggdG8gZW5jcnlwdGVkIGNvbmZp
ZyBmaWxlIikKCiAgICAjIEhhc2hpQ29ycCBWYXVsdCBvcHRpb25zCiAgICBwYXJzZXIuYWRkX2Fy
Z3VtZW50KCItLXZhdWx0LXVybCIsIGhlbHA9Ikhhc2hpQ29ycCBWYXVsdCBVUkwgKGUuZy4sIGh0
dHA6Ly92YXVsdC5leGFtcGxlLmNvbTo4MjAwKSIpCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCIt
LXZhdWx0LXBhdGgiLCBoZWxwPSJQYXRoIHRvIHNlY3JldCBpbiBWYXVsdCAoZS5nLiwgc2VjcmV0
L2RhdGEva2Fma2Etdmlld2VyKSIpCgogICAgIyAtLS0gU3RhbmRhcmQgb3B0aW9ucyAtLS0KICAg
IHBhcnNlci5hZGRfYXJndW1lbnQoIi0tYm9vdHN0cmFwLXNlcnZlcnMiLCBoZWxwPSJLYWZrYSBi
b290c3RyYXAgc2VydmVycyIpCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCItLXByb2ZpbGUiLCBo
ZWxwPSJQcm9maWxlIG5hbWUgZnJvbSBjb25maWciKQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgi
LS1zZWN1cml0eS1wcm90b2NvbCIsIGNob2ljZXM9WyJQTEFJTlRFWFQiLCAiU1NMIiwgIlNBU0xf
UExBSU5URVhUIiwgIlNBU0xfU1NMIl0sCiAgICAgICAgICAgICAgICAgICAgICAgIGhlbHA9IlNl
Y3VyaXR5IHByb3RvY29sIikKCiAgICAjIFNTTCBvcHRpb25zCiAgICBwYXJzZXIuYWRkX2FyZ3Vt
ZW50KCItLXNzbC1jYS1maWxlIiwgaGVscD0iUGF0aCB0byBDQSBjZXJ0aWZpY2F0ZSBmaWxlIChQ
RU0pIikKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoIi0tc3NsLWNlcnQtZmlsZSIsIGhlbHA9IlBh
dGggdG8gY2xpZW50IGNlcnRpZmljYXRlIGZpbGUgKFBFTSkiKQogICAgcGFyc2VyLmFkZF9hcmd1
bWVudCgiLS1zc2wta2V5LWZpbGUiLCBoZWxwPSJQYXRoIHRvIGNsaWVudCBwcml2YXRlIGtleSBm
aWxlIChQRU0pIikKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoIi0tc3NsLXBhc3N3b3JkIiwgaGVs
cD0iUGFzc3dvcmQgZm9yIGVuY3J5cHRlZCBTU0wga2V5IGZpbGUiKQogICAgcGFyc2VyLmFkZF9h
cmd1bWVudCgiLS1zc2wtY2hlY2staG9zdG5hbWUiLCB0eXBlPWxhbWJkYSB4OiB4Lmxvd2VyKCkg
aW4gKCJ0cnVlIiwgIjEiLCAieWVzIiksCiAgICAgICAgICAgICAgICAgICAgICAgIGhlbHA9IkVu
YWJsZSBTU0wgaG9zdG5hbWUgdmVyaWZpY2F0aW9uICh0cnVlL2ZhbHNlKSIpCgogICAgIyBTQVNM
IG9wdGlvbnMKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoIi0tc2FzbC1tZWNoYW5pc20iLCBjaG9p
Y2VzPVsiUExBSU4iLCAiU0NSQU0tU0hBLTI1NiIsICJTQ1JBTS1TSEEtNTEyIl0sCiAgICAgICAg
ICAgICAgICAgICAgICAgIGhlbHA9IlNBU0wgbWVjaGFuaXNtIikKICAgIHBhcnNlci5hZGRfYXJn
dW1lbnQoIi0tc2FzbC11c2VybmFtZSIsIGhlbHA9IlNBU0wgdXNlcm5hbWUiKQogICAgcGFyc2Vy
LmFkZF9hcmd1bWVudCgiLS1zYXNsLXBhc3N3b3JkIiwgaGVscD0iU0FTTCBwYXNzd29yZCIpCgog
ICAgcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1sb2ctbGV2ZWwiLCBkZWZhdWx0PW9zLmdldGVudigi
S0FGS0FfVklFV0VSX0xPR19MRVZFTCIsICJJTkZPIiksCiAgICAgICAgICAgICAgICAgICAgICAg
IGhlbHA9IkxvZyBsZXZlbDogREVCVUcvSU5GTy9XQVJOSU5HL0VSUk9SIikKICAgIHBhcnNlci5h
ZGRfYXJndW1lbnQoIi0tbG9nLWZpbGUiLCBkZWZhdWx0PSJrYWZrYV92aWV3ZXIubG9nIiwKICAg
ICAgICAgICAgICAgICAgICAgICAgaGVscD0iTG9nIGZpbGUgcGF0aCAob3B0aW9uYWwpIikKCiAg
ICAjIFNTTCBvcHRpb25zIChhbGlhc2VzIGZvciBtVExTKQogICAgcGFyc2VyLmFkZF9hcmd1bWVu
dCgiLS1tdGxzLWNhLWZpbGUiLCBkZXN0PSJzc2xjYWZpbGUiLCBoZWxwPSJtVExTOiBDQSBjZXJ0
aWZpY2F0ZSBmaWxlIChQRU0pIikKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoIi0tbXRscy1jZXJ0
LWZpbGUiLCBkZXN0PSJzc2xjZXJ0ZmlsZSIsIGhlbHA9Im1UTFM6IGNsaWVudCBjZXJ0aWZpY2F0
ZSAoUEVNKSIpCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCItLW10bHMta2V5LWZpbGUiLCBkZXN0
PSJzc2xrZXlmaWxlIiwgaGVscD0ibVRMUzogY2xpZW50IHByaXZhdGUga2V5IChQRU0pIikKICAg
IHBhcnNlci5hZGRfYXJndW1lbnQoIi0tbXRscy1rZXktcGFzc3dvcmQiLCBkZXN0PSJzc2xwYXNz
d29yZCIsIGhlbHA9Im1UTFM6IHBhc3N3b3JkIGZvciBlbmNyeXB0ZWQga2V5IGZpbGUiKQoKICAg
IHJldHVybiBwYXJzZXIucGFyc2VfYXJncygpCgoKZGVmIG1haW4oKToKICAgIGFyZ3MgPSBwYXJz
ZV9hcmdzKCkKCiAgICBzZXR1cF9sb2dnaW5nKGFyZ3MubG9nX2xldmVsLCBhcmdzLmxvZ19maWxl
KQogICAgTE9HLmluZm8oIlN0YXJ0aW5nIGthZmthX3ZpZXdlciAlcyIsIF9fdmVyc2lvbl9fKQoK
ICAgIHBhcmFtcywgcHJvZmlsZV9uYW1lID0gQ29uZmlnTWFuYWdlci5nZXRfY29ubmVjdGlvbl9w
YXJhbXMoY2xpX2FyZ3M9YXJncykKICAgIGVycm9ycyA9IENvbmZpZ01hbmFnZXIudmFsaWRhdGVf
cGFyYW1zKHBhcmFtcykKICAgIGlmIGVycm9yczoKICAgICAgICAjIHByaW50KCJDb25maWd1cmF0
aW9uIGVycm9yczoiLCBmaWxlPXN5cy5zdGRlcnIpCiAgICAgICAgTE9HLmVycm9yKCJDb25maWd1
cmF0aW9uIGVycm9yczpcbi0gJXMiLCAiXG4tICIuam9pbihlcnJvcnMpKQogICAgICAgIGZvciBl
cnIgaW4gZXJyb3JzOgogICAgICAgICAgICBwcmludChmIiAtIHtlcnJ9IiwgZmlsZT1zeXMuc3Rk
ZXJyKQogICAgICAgICAgICAjIExPRy5leGNlcHRpb24oIkZhdGFsIGVycm9yOiAlcyIsIGUpCiAg
ICAgICAgc3lzLmV4aXQoMSkKCiAgICB0cnk6CiAgICAgICAgYXBwID0gS2Fma2FWaWV3ZXJBcHAo
cGFyYW1zLCBwcm9maWxlX25hbWUpCiAgICAgICAgYXBwLnJ1bigpCiAgICBleGNlcHQgS2V5Ym9h
cmRJbnRlcnJ1cHQ6CiAgICAgICAgcGFzcwogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAg
ICAgIHByaW50KGYiRmF0YWwgZXJyb3I6IHtlfSIsIGZpbGU9c3lzLnN0ZGVycikKICAgICAgICB0
cmFjZWJhY2sucHJpbnRfZXhjKCkKICAgICAgICBzeXMuZXhpdCgxKQoKCmlmIF9fbmFtZV9fID09
ICJfX21haW5fXyI6CiAgICBtYWluKCkK
