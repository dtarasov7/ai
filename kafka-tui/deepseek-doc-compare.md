# 📋 **Описание текущего функционала Kafka Viewer v1.8.0**

## 📊 **Основные возможности**

### **1. Подключение к Kafka**
- Поддержка множественных профилей подключения (JSON конфигурация)
- Загрузка конфигурации из:
  - Обычного JSON файла
  - Зашифрованного файла (Fernet)
  - HashiCorp Vault
- Переопределение через переменные окружения
- Поддержка всех security протоколов:
  - PLAINTEXT, SSL, SASL_PLAINTEXT, SASL_SSL
  - SASL механизмы: PLAIN, SCRAM-SHA-256, SCRAM-SHA-512
  - mTLS (SSL с клиентскими сертификатами)

### **2. Управление топиками**
- **Просмотр списка топиков** с фильтрацией по подстроке (F7)
- **Создание топиков** (N) с предустановленными шаблонами:
  - Temporary Debug (24h, delete)
  - Short Lived (7 days, delete)
  - Compacted KV (Keys+Values)
  - High Durability (3 replicas)
  - Manual (Custom)
- **Удаление топиков** (F8) с подтверждением
- **Просмотр информации о топике** (F2):
  - Количество партиций и реплик
  - Количество сообщений
  - Consumer groups, подписанные на топик
  - Конфигурация топика

### **3. Просмотр сообщений**
- **Загрузка снимка (snapshot) сообщений** из топика
- Две стратегии загрузки:
  - `tail` - последние N сообщений (по умолчанию 500) из каждой партиции
  - `from_beginning` - все сообщения с начала
- **Сортировка сообщений** (S) по:
  - Timestamp (время)
  - Partition (партиция)
  - Size (размер)
  - Unsorted (не сортировано)
- **Фильтрация сообщений** (F7) по:
  - Key (ключ)
  - Value (значение)
  - Partition (партиция)
  - Offset (смещение)
- **Просмотр деталей сообщения** (Enter):
  - Hex/Text режим просмотра (F4 переключение)
  - Сохранение в файл (S):
    - JSON dump со всей метаинформацией
    - Raw binary (бинарный формат)
- **Отправка сообщений** (P) в топик

### **4. Управление Consumer Groups**
- **Мониторинг всех групп** (G) с агрегированными метриками:
  - Состояние группы
  - Количество топиков
  - Total Lag (суммарное отставание)
  - Max Lag (максимальное отставание с указанием топика)
- **Детальный просмотр группы**:
  - Lag по каждой партиции
  - Текущие смещения
  - End offsets
- **Сброс смещений** (Reset offsets):
  - Для всех топиков группы (F9)
  - Для конкретного топика (F10)
  - Стратегии сброса:
    - To Latest (перейти к последним)
    - To Earliest (перейти к самым ранним)
    - By Duration (относительное время, например "1h ago")
    - Specific DateTime (конкретная дата/время)
  - Предварительный просмотр изменений (dry run)

### **5. Управление ACL (Access Control Lists)**
- **Просмотр ACL для топика** (F3):
  - Все ACL, применяемые к топику (включая wildcard и prefix patterns)
  - Фильтрация (/):
    - Principal (субъект)
    - Host (хост)
    - Operation (операция)
    - Permission (разрешение)
    - Pattern Type (тип паттерна)
- **Меню ACL ресурсов** (F4):
  - Current Topic (текущий топик)
  - All Topics (все топики)
  - Consumer Groups (группы потребителей)
  - Cluster (кластер)
  - Transactional IDs (транзакционные ID)
  - By Principal (по субъекту)

### **6. Интерфейс пользователя**
- **Двухпанельный TUI интерфейс** (urwid):
  - Левая панель: список топиков
  - Правая панель: сообщения выбранного топика
- **Статус бар** с информацией:
  - Профиль подключения
  - Текущий топик
  - Security protocol
  - Позиция в списке сообщений
  - Горячие клавиши
- **Динамическая перерисовка** сообщений под ширину окна
- **Поддержка цветов** и подсветки синтаксиса
- **Диалоговые окна** для всех операций

### **7. Прочие функции**
- **Логирование** в файл с ротацией
- **Обновление списка топиков** (R)
- **Настройка параметров снимка** (O):
  - Режим загрузки (tail/begin)
  - Количество сообщений на партицию
  - Максимальное общее количество сообщений

---

## ⚖️ **Сравнение с нативными CLI утилитами Kafka**

### **📦 `kafka-topics.sh`**
| Функция | Kafka Viewer | kafka-topics.sh | Преимущество Viewer |
|---------|-------------|-----------------|-------------------|
| Просмотр топиков | ✅ Двухпанельный TUI | ✅ Текстовый вывод | **Интерактивный интерфейс** |
| Создание топиков | ✅ С шаблонами | ✅ Базовое | **Предустановленные шаблоны, валидация** |
| Удаление топиков | ✅ С подтверждением | ✅ Без подтверждения | **Безопасность, подтверждение** |
| Конфигурация | ✅ GUI настройки | ✅ CLI параметры | **Визуальное конфигурирование** |
| Фильтрация | ✅ Реалтайм | ❌ Нет | **Интерактивная фильтрация** |

### **📨 `kafka-console-consumer.sh`**
| Функция | Kafka Viewer | kafka-console-consumer | Преимущество Viewer |
|---------|-------------|------------------------|-------------------|
| Просмотр сообщений | ✅ Snapshot + фильтры | ✅ Потоковый | **Исторические данные, поиск** |
| Форматирование | ✅ Автоподгонка под ширину | ❌ Базовое | **Адаптивный интерфейс** |
| Поиск/фильтрация | ✅ Многопольевая | ❌ Нет | **Мощный поиск по ключам и значениям** |
| Hex просмотр | ✅ С переключением | ❌ Нет | **Двойной режим просмотра** |
| Сохранение | ✅ JSON/Raw | ✅ Только текст | **Богатые форматы экспорта** |

### **📤 `kafka-console-producer.sh`**
| Функция | Kafka Viewer | kafka-console-producer | Преимущество Viewer |
|---------|-------------|------------------------|-------------------|
| Отправка сообщений | ✅ Мультилайн | ✅ Однострочный | **Многострочный редактор** |
| Предпросмотр | ✅ В контексте | ❌ Нет | **Интеграция с просмотром** |
| Безопасность | ✅ Проверка системных топиков | ❌ Нет | **Защита от ошибок** |

### **👥 `kafka-consumer-groups.sh`**
| Функция | Kafka Viewer | kafka-consumer-groups | Преимущество Viewer |
|---------|-------------|------------------------|-------------------|
| Список групп | ✅ С метриками | ✅ Базовый список | **Агрегированные метрики** |
| Lag анализ | ✅ По партициям | ✅ Общий lag | **Детализированный анализ** |
| Reset offsets | ✅ Dry run + стратегии | ✅ Базовый reset | **Безопасность, предпросмотр** |
| Визуализация | ✅ Табличный вывод | ❌ Текстовый | **Удобное восприятие** |

### **🔐 `kafka-acls.sh`**
| Функция | Kafka Viewer | kafka-acls.sh | Преимущество Viewer |
|---------|-------------|---------------|-------------------|
| Просмотр ACL | ✅ С фильтрацией | ✅ Без фильтров | **Мощная фильтрация** |
| Поиск | ✅ По всем ресурсам | ❌ Ограниченный | **Универсальный поиск** |
| Wildcard matching | ✅ Автоматический | ❌ Ручной | **Автоматическое определение прав** |
| Навигация | ✅ Иерархическая | ❌ Плоская | **Логическая группировка** |

### **⚙️ `kafka-configs.sh`**
| Функция | Kafka Viewer | kafka-configs.sh | Преимущество Viewer |
|---------|-------------|------------------|-------------------|
| Конфигурация топиков | ✅ В info-диалоге | ✅ Отдельные команды | **Интегрировано в просмотр топика** |
| Читаемость | ✅ Форматированный | ❌ Сырой вывод | **Удобное чтение** |

---

## 🎯 **Уникальные возможности Kafka Viewer**

### **1. Интегрированная среда**
- **Единый интерфейс** для всех операций
- **Контекстные действия** (действия зависят от выбранного элемента)
- **Сохранение состояния** между операциями

### **2. Безопасность**
- **Защита от случайных действий** (подтверждения удалений)
- **Валидация операций** (проверка системных топиков)
- **Dry-run режим** для опасных операций

### **3. Производительность**
- **Snapshot-подход** вместо потокового потребления
- **Лимитированная загрузка** (предотвращение перегрузки)
- **Кэширование результатов**

### **4. Удобство использования**
- **Горячие клавиши** для быстрых операций
- **Адаптивный интерфейс** под размер терминала
- **Пошаговые диалоги** для сложных операций

### **5. Аналитика**
- **Агрегация метрик** потребительских групп
- **Сравнение смещений** (current vs end)
- **Выявление проблем** (high lag, under-replicated)

---

## 📈 **Что делает Kafka Viewer лучше CLI?**

### **Для разработчиков:**
- **Быстрый дебаг** - просмотр сообщений без написания скриптов
- **Интерактивный поиск** - найти нужное сообщение за секунды
- **Тестирование** - отправить сообщение и сразу увидеть результат

### **Для DevOps:**
- **Мониторинг** - единый взгляд на состояние кластера
- **Диагностика** - быстрая идентификация проблем (lag, ACL)
- **Операции** - безопасное выполнение административных задач

### **Для администраторов:**
- **Безопасность** - контроль над опасными операциями
- **Аудит** - просмотр кто и к чему имеет доступ
- **Управление** - комплексное управление ресурсами Kafka

### **Для всех:**
- **Не требует запоминания команд** - интуитивный интерфейс
- **Снижает вероятность ошибок** - валидация и подтверждения
- **Экономит время** - несколько операций в одном инструменте

---

## 🔄 **Что пока лучше делать через CLI:**

### **1. Скриптование и автоматизация:**
```bash
# Пакетные операции
for topic in $(kafka-topics --list); do
  kafka-configs --alter --topic $topic --add-config retention.ms=86400000
done
```

### **2. Высокопроизводительные операции:**
```bash
# Потоковая обработка миллионов сообщений
kafka-console-consumer --topic logs --from-beginning | grep ERROR
```

### **3. Интеграция в CI/CD пайплайны:**
```bash
# Проверка в деплойментах
kafka-consumer-groups --describe --group my-service | grep LAG
```

### **4. Специфичные форматы вывода:**
```bash
# Машинно-читаемый вывод для парсинга
kafka-topics --list --exclude-internal --command-config admin.properties
```

---

## 🏆 **Заключение**

**Kafka Viewer** - это **мощный интерактивный инструмент** для **повседневной работы** с Kafka, который **дополняет**, а не заменяет нативные CLI утилиты.

### **Используйте Kafka Viewer для:**
- **Интерактивного исследования** кластера
- **Быстрой диагностики** проблем
- **Безопасного выполнения** административных задач
- **Удобного мониторинга** потребителей и ACL

### **Используйте нативные CLI для:**
- **Автоматизации** и скриптования
- **Высокопроизводительных** операций
- **Интеграции** в пайплайны
- **Специфичных** форматов вывода

**Идеальный workflow:** Использовать Kafka Viewer для исследования и отладки, а CLI - для автоматизации и интеграции в скрипты.
