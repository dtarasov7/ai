Хорошая проверка! Давайте посмотрим на совместимость с указанными версиями:

**Grafana 10** и **Prometheus 2.31** - это достаточно актуальные версии, но есть нюансы:

## Потенциальные проблемы с версиями:

### 1. Оператор `unless`
- Поддерживается в Prometheus 2.31 ✅
- Но синтаксис, который я использовал, может работать не во всех случаях

### 2. Функция `label_replace` с переменными
- В старых версиях могут быть проблемы с подстановкой `$srv` в `label_replace`

## Более совместимый вариант для ваших версий:## Основные отличия для ваших версий:

1. **Prometheus 2.31** - не все современные функции могут работать корректно
2. **Grafana 10** - поддерживает большинство современных возможностей, но лучше использовать проверенный синтаксис

## Рекомендуемый запрос для ваших версий:

```promql
node_systemd_unit_state{name=~"$srv"} 
unless on(name) 
label_replace(uptime, "name", "$1", "service", "(.*)")
```

Этот запрос:
- Берет все сервисы из systemd, которые попадают под фильтр `$srv`
- Исключает те, для которых есть метрика `uptime` (сопоставляя по имени сервиса)
- Использует только проверенные функции, которые точно работают в Prometheus 2.31

Если этот запрос не сработает, попробуйте еще более простой вариант:

```promql
max by (name) (node_systemd_unit_state{name=~"$srv"})
unless on(name)
max by (service) (label_replace(uptime, "name", "$1", "service", "(.*)"))
```
