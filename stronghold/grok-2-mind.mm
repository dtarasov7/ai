```markmap
# Варианты инжектирования секретов в Deckhouse из Vault

## С использованием secrets-store-integration
### Описание
- Модуль Deckhouse для интеграции с хранилищами секретов (например, HashiCorp Vault)
- Позволяет монтировать секреты как volumes в поды Kubernetes
- Поддерживает автоматическую ротацию секретов
- Источник: Deckhouse документация (deckhouse.ru/modules/secrets-store-integration)

### Без pod-reloader
#### Вариант 1: Прямое монтирование через CSI Provider
- Использует Vault CSI Provider для монтирования секретов как файлов в под
- Секреты загружаются при старте пода и не требуют перезагрузки для обновлений (если настроена ротация)
- Преимущества: Минимальное вмешательство, поддержка эфемерных секретов
- Недостатки: Требует настройки Vault policies и roles
- Пример: Настройка SecretProviderClass с Vault провайдером

#### Вариант 2: Синхронизация в Kubernetes Secrets
- secrets-store-integration синхронизирует секреты из Vault в native Kubernetes Secrets
- Затем секреты инжектируются в поды как env variables или volumes
- Преимущества: Простота для legacy приложений
- Недостатки: Секреты хранятся в etcd, потенциальная уязвимость

### С pod-reloader
#### Вариант 1: Монтирование с автоматической перезагрузкой
- secrets-store-integration монтирует секреты
- Pod-reloader мониторит изменения в секретах и перезапускает поды
- Полезно для приложений, не поддерживающих hot-reload конфигурации
- Преимущества: Автоматическое обновление без ручного вмешательства
- Недостатки: Downtime во время перезапуска

#### Вариант 2: Синхронизация с релоадом
- Синхронизация в Kubernetes Secrets
- Pod-reloader отслеживает изменения в Secrets и рестартует поды
- Пример: Интеграция с Deckhouse Stronghold для усиленной безопасности (хотя фокус на Vault)

## Без использования secrets-store-integration
### Описание
- Прямые методы интеграции Vault с Kubernetes без Deckhouse-специфичного модуля
- Используют native Vault инструменты или сторонние операторы
- Источники: Habr статьи, Vault документация (habr.com, hashicorp.com)

### Без pod-reloader
#### Вариант 1: Vault Agent Injector (Sidecar)
- Vault Agent как sidecar контейнер в поде
- Инжектирует секреты в основной контейнер через shared volume или env
- Преимущества: Динамическая ротация, аутентификация через Kubernetes SA
- Недостатки: Дополнительный overhead от sidecar

#### Вариант 2: External Secrets Operator
- Оператор синхронизирует секреты из Vault в Kubernetes Secrets
- Не зависит от Deckhouse модулей
- Преимущества: Гибкость, поддержка множества провайдеров (включая Vault)
- Недостатки: Требует установки оператора

#### Вариант 3: Vault CSI Driver
- Монтирует секреты напрямую как volumes без sidecar
- Секреты доступны как файлы в поде
- Преимущества: Низкий overhead, подходит для stateless приложений

### С pod-reloader
#### Вариант 1: Sidecar с релоадом
- Vault Agent sidecar инжектирует секреты
- Pod-reloader мониторит изменения (например, через annotations) и рестартует поды
- Полезно для legacy приложений, требующих рестарта

#### Вариант 2: External Secrets с релоадом
- External Secrets Operator синхронизирует секреты
- Pod-reloader отслеживает Kubernetes Secrets и инициирует rolling updates
- Преимущества: Автоматизация обновлений без downtime (если rolling)

#### Вариант 3: CSI с релоадом
- CSI монтирует секреты
- Pod-reloader реагирует на изменения в mounted volumes (если настроено) и рестартует поды
- Недостатки: CSI обновления могут не триггерить релоад автоматически, требуется кастомная настройка

## Общие соображения
### Преимущества инжекции
- Безопасность: Секреты не хранятся в Git или etcd надолго
- Ротация: Автоматическое обновление ключей/токенов

### Недостатки
- Сложность настройки
- Overhead от sidecars или операторов

### Рекомендации
- Для Deckhouse: Предпочтительно использовать secrets-store-integration для seamless интеграции
- Поддержка: Рассмотреть Deckhouse Stronghold как альтернативу Vault (deckhouse.ru/products/stronghold)
- Источники: Deckhouse FAQ, Habr статьи (2023-2025)
```
