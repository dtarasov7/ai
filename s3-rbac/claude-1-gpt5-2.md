Ниже приведён полный текст требований к подсистеме RBAC S3‑совместимого объектного хранилища на уровне функциональности эталонной версии 17.2.7, без включения более поздних возможностей.[1][2][3][4]
Требования сформулированы так, чтобы обеспечивать сопоставимую модель доступа (ACL + bucket policy + роли/STS) и обязательную мультитенантность за счёт placement и разделения данных по пулам.[5][1]

## Субъекты и аутентификация
- Система должна поддерживать аутентификацию S3‑запросов по схеме AWS Signature (долгоживущая пара access key / secret key), применимую ко всем защищённым операциям.[6][1]
- Система должна рассматривать неаутентифицированные запросы как запросы анонимного субъекта и применять к ним те же механизмы авторизации (ACL/policy), что и к аутентифицированным.[1][6]
- Система должна поддерживать сущности: пользователь (долгоживущие ключи), роль (для делегирования) и сессия (временные ключи), причём итоговые права вычисляются как результат проверки политик/ACL с учётом типа субъекта.[3][4][1]
- (Опционально, если требуется совместимость с текущей инфраструктурой) Система должна поддерживать выпуск/использование S3‑ключей через внешний сервис идентификации (Keystone‑совместимая схема), чтобы клиенты получали AWS‑style ключи для S3 API.[6][1]

## Политики доступа (ACL и bucket policy)
- Система должна поддерживать S3‑совместимые ACL для бакетов и объектов с правами READ, WRITE, READ_ACP, WRITE_ACP, FULL_CONTROL и корректной раздельной семантикой для bucket и object.[1][6]
- Система должна поддерживать canned ACL и применение ACL при операциях создания/изменения бакета и объекта.[6][1]
- Система должна поддерживать bucket policy (JSON‑документы политик бакета) и управление ими стандартными S3‑операциями PutBucketPolicy / GetBucketPolicy / DeleteBucketPolicy.[2][1]
- Язык bucket policy должен соответствовать подмножеству S3‑политик эталонного уровня и включать как минимум: Version=2012-10-17, Statement, Effect (Allow/Deny), Principal, Action, Resource, Condition.[1]
- Поддерживаемые действия (Action) в bucket policy должны включать как минимум набор, необходимый для: операций с бакетом (Create/Delete/List/Versions/ListMultipartUploads), операций с объектами (Get/Put/Delete/Versioned Get/Delete), операций с ACL (Get/Put для bucket/object ACL), операций multipart (ListParts/Abort), а также включение/проверку версионирования бакета (Get/PutBucketVersioning).[1]
- Поддерживаемые ключи условий (Condition keys) для bucket policy должны быть ограничены перечнем: aws:CurrentTime, aws:EpochTime, aws:PrincipalType, aws:Referer, aws:SecureTransport, aws:SourceIp, aws:UserAgent, aws:username.[2][1]
- String interpolation в bucket policy не требуется и не должна считаться обязательной функциональностью (политики с интерполяцией должны отклоняться либо обрабатываться как неподдерживаемые).[2][1]

## Роли и временный доступ (STS)
- Система должна поддерживать сущность «роль», включающую trust policy (кто может принять роль) и permission policy (какие действия разрешены после принятия роли).[3][1]
- Система должна реализовать STS‑операции AssumeRole и AssumeRoleWithWebIdentity с выдачей временных учётных данных (temporary credentials) для доступа к S3.[4][1]
- В AssumeRole должны поддерживаться параметры RoleArn, RoleSessionName, DurationSeconds и опциональная ограничивающая Policy, применяемая для сужения прав сессии.[4][1]
- Длительность STS‑сессии должна поддерживать значение по умолчанию 3600 секунд и ограничение максимальной длительности на уровне роли (max session duration).[3][4][1]
- Для AssumeRoleWithWebIdentity должна поддерживаться модель федеративного входа через OIDC/OAuth2‑совместимого провайдера, с созданием “shadow”‑идентичности в отдельном namespace для привязки прав.[4][1]
- Подсистема STS должна иметь конфигурационные параметры включения/выключения и использовать настраиваемый ключ/секрет для защиты (подпись/шифрование) данных STS‑сессий.[4][1]
- Поддержка расширений, появившихся позже целевого уровня (например, session tags/ABAC для STS), не должна требоваться.[7]

## Мультитенантность через placement и пулы + администрирование
- Система должна поддерживать мультитенантность через сущность tenant, обеспечивая логическое разделение пользователей и бакетов по tenant и возможность одинаковых имён в разных tenant без конфликтов.[8][1]
- Система должна поддерживать обращение к бакетам в формате tenant:bucket (path‑style), чтобы клиент мог явно адресовать бакет конкретного tenant.[8][1]
- Система должна поддерживать placement‑цели (placement targets) и фиксировать выбранную placement‑цель для бакета при создании бакета (последующее изменение placement‑цели для существующего бакета не допускается).[5][1]
- Каждая placement‑цель должна сопоставляться с раздельными пулами хранения как минимум для: индексных данных бакета (index pool), данных объектов (data pool, в т.ч. по storage class), служебных данных/метаданных незавершённых multipart‑загрузок (data extra pool), чтобы обеспечивать мультитенантность и изоляцию за счёт разделения по пулам.[5][1]
- Система должна позволять ограничивать доступность placement‑целей для пользователя/tenant через механизм тегов placement‑целей (tags) и разрешённых тегов у пользователя/tenant (placement_tags), запрещая создание бакета в placement‑целях без пересечения тегов.[5][1]
- Система должна поддерживать выбор placement‑цели при создании бакета через S3 LocationConstraint в формате “<region_api_name>:<placement-id>”.[5][1]
- Система должна предоставлять административные операции управления ролями/политиками/placement‑параметрами через административный API и/или CLI, а также разграничивать административные полномочия отдельными правами (capabilities) так, чтобы управление ролями и управление placement можно было делегировать независимо.[1]
- Не требуется (и не должно навязываться как обязательное) наличие “аккаунтной” модели более поздних поколений (самообслуживание аккаунтов/иерархий аккаунтов), если она отсутствовала на целевом уровне.[9]

Если нужен этот же текст в «закупочном» формате (R-001… с критериями приёмки и проверками через конкретные S3/STS вызовы) — укажите предпочитаемый шаблон, и текст будет преобразован без изменения смысла.

[1](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/154680809/30227eab-a7e2-4f17-b992-0e71358844ee/claude-1.md)
[2](https://docs.ceph.com/en/quincy/radosgw/bucketpolicy/)
[3](https://docs.ceph.com/en/quincy/radosgw/role/)
[4](https://docs.ceph.com/en/quincy/radosgw/STS/)
[5](https://docs.ceph.com/en/latest/radosgw/placement/)
[6](https://docs.ceph.com/en/latest/radosgw/s3/authentication/)
[7](https://docs.ceph.com/en/reef/radosgw/session-tags/)
[8](https://docs.ceph.com/en/squid/radosgw/multitenancy/)
[9](https://ceph.io/en/news/blog/2024/v19-2-0-squid-released/)
