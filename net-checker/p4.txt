Необходимо написать роль на ansible. Имя роли connectivity.Все переменные должны начинаться с префикса connectivity_

Цель роли - проверить сетевую связанность между хостами. Связанность проверяется либо 
по icmp (ping) либо по tcp (nc). Режим определяется переменной.
Ping выполняется 3 раза (досточно , чтобы прошел хотя бы один из трех пингов). Количество ping можно поменять через переменную.
При выполнении nc необходимо установить таймаут 15 сек. Длительность таймаута можно поменять через переменную.
Порт для TCP определяется переменной.
Для выполнения проверки, на хосты, с которых проверяется доступность загружается скрипт на bash, который формируется из темплейта. 
В процессе формирования в скрипте прописывается список хостов к которым проверяется связанность. 
Хосты к которым проверяется связанность - это члены группы из инвентаря. Имя группы задается через переменную. 
Должна быть возмость указать не группу, а имя конкретного сервера.

Результат выполнения скрипта - метрики в формате Prometheus.
Учитывая, что на одном сервер может одновременно работать несколько независимых проверок, надо чтобы для разных проверок различались 
имена скриптов, имена создаваемых файлов с метриками и в самих метриках присутствовала метка, по которой можно было различать метрики 
разных проверок.

Возможны два варианта работы скрипта (опеределяется переменой).
1-ый вариант (переменная connectivity_distrubuted = true)
Требуется,чтобы на серверах, где запускается скрипт был установлен node-exporter c модулем textfile_collector.
Наличие node-exporter проверяется по наличию на сервере определенной директории (задается через переменную). 
Если директории нет, то роль останавливается по ошибке.
Если node-exporter установлен, то на сервере создается пользователь sys_connectivity и в его домашнюю директорию загружается скрипт.
В crontab пользователя устанавливается запуск скрипт через установленое кол-во минут (определяется переменной).
Результат работы скрипта помещается в каталог для textfile_collector. На этот файл ставиться owner sys_node_exporter. Чтобы это можно было 
сделать от имени пользователя sys_connectivity, в  /etc/sudoers.d создается файл, разрешающий пользователю sys_connectivity 
выполнять sudo chown sys_node_exporter *
В роли должен быть код, который при использовании тега never удалял скрипт, созданый скриптом файл, crontab для этого скрипта и, 
если больше нет других проверок, также удалял пользователя и правила sudoers.
При формировании файла надо обязательно учитывать, что для множества метрик с одним и тем же именем должен быть 
всего один блок строк # HELP # TYPE .

2-ой вариант (переменная connectivity_distrubuted = false)
Скрипт загружается на сервер, выполняется, а результат выполнения скрипта запоминается на ansible хосте и сохраняется в 
файл с префиксом - именем целевого сервера. Заголовок с # HELP и # TYPE в файле не сохраняется. Только метрики.
В некоторых редакциях Linux запрещен запуск скрипта из /tmp, поэтому скрипт коипруется и запускается из /root/tmp .
После выполнения скрипт лмбо удаляется , либо остается на сервере - это определеяется переменной.

В метриках должны быть метки описывающие 
- сервер источник - сервер с которого проверяется доступность ( имя и IP) 
- сервер приемник - сервер к которму проверяется доступность ( имя и IP) 
- режим
- порт для TCP
Так же должны быть метки:
- env : содержимое переменной connectivity_env
- new_is : содержимое переменной connectivity_is
- new_instance : имя сервера источника
- new_job : содержимое переменной connectivity_job

