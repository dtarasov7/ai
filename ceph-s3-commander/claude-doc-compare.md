# S3 Commander - Описание функционала

## Текущий функционал

### Архитектура и интерфейс
- **Двухпанельный файловый менеджер** в стиле Midnight Commander
- **TUI интерфейс** на базе urwid с поддержкой:
  - Прокрутки (ScrollBar)
  - Диалоговых окон
  - Прогресс-баров
  - Цветовых схем
  - Горячих клавиш (F1-F12, Ctrl, Alt)

### Поддержка источников данных
1. **Локальная файловая система** (FS)
2. **S3-совместимые хранилища** (Ceph, MinIO и др.)
3. **Множественные endpoint'ы** с переключением между ними

### Безопасность и конфигурация
- **3 режима хранения конфигурации**:
  1. Plaintext JSON файл
  2. Зашифрованный файл (Fernet/PBKDF2, AES-128)
  3. HashiCorp Vault (Userpass auth)
- Проверка доступности endpoint'ов перед подключением
- Поддержка custom CA сертификатов

### Операции с файлами

#### Навигация и просмотр
- Навигация по директориям (FS и S3 префиксам)
- **Сортировка** (F2): по имени, расширению, размеру, времени, без сортировки
- **Реверсивная сортировка** (порядок возрастания/убывания)
- **Фильтрация** (клавиша `/`): glob-паттерны для быстрого поиска
  - Отдельные фильтры для bucket-листа и объектов
  - Сохранение фильтра при навигации
- **Просмотр файлов** (F3):
  - Текстовые файлы (UTF-8)
  - Бинарные файлы (HEX-дамп)
  - S3 версии файлов
- **Quick View режим** (Ctrl+V): предпросмотр в неактивной панели
- **Детальная информация** (F4):
  - FS: права, владелец, timestamps, inode
  - S3 Bucket: регион, versioning, encryption, lifecycle, CORS, ACL, квоты
  - S3 Object: размер, MIME, storage class, metadata, tags, ACL, версии, presigned URL

#### Копирование и перемещение (F5/F6)
- **Поддержка всех направлений**:
  - FS → FS (shutil)
  - FS → S3 (upload)
  - S3 → FS (download)
  - S3 → S3 (server-side copy)
- **Интеллектуальная обработка конфликтов**:
  - Диалог перезаписи с информацией о размере/дате
  - Режимы: Overwrite, Skip, All, Skip All
  - **Version All** (для S3): создание новой версии вместо перезаписи
- **Копирование конкретных версий** S3 объектов
- **Прогресс-бар** с отображением:
  - Текущего файла
  - Количества успешных/неудачных операций
  - Скорости передачи данных
  - Процента выполнения
- **Многопоточность**: операции в фоновом потоке с обновлением UI
- Поддержка директорий и рекурсивного копирования

#### Выделение и выбор
- **Insert/Space**: выделение отдельных файлов
- **+ (плюс)**: выделение по glob-паттерну
- **- (минус)**: снятие выделения по паттерну
- **\* (звездочка)**: инверсия выделения

#### Удаление (F8)
- Удаление файлов и директорий
- Удаление S3 объектов
- Удаление bucket'ов (с предварительной очисткой)
- Диалог подтверждения с детальной информацией
- Прогресс-бар для массовых операций

#### Создание (F7)
- Создание директорий (FS)
- Создание bucket'ов (S3)

### S3 Versioning

#### Управление версиями
- **Включение/выключение versioning** (F11) на уровне bucket'а
- **Индикация версионирования**:
  - Маркер `[V]` или `[S]` (Enabled/Suspended) в списке bucket'ов
  - Счетчик версий `[N]` рядом с файлом в списке объектов
- **Просмотр версий**: диалоговое окно со списком всех версий файла:
  - Version ID, размер, дата модификации
  - Пометка `[LATEST]` для текущей версии
- **Операции с версиями**:
  - Просмотр (F3)
  - Копирование конкретной версии (F5)
  - Перемещение версии (F6)
  - Удаление конкретной версии (F8)
- **Очистка старых версий** (F9): удаление всех версий кроме последней

### Производительность

#### Оптимизация загрузки
- **Lazy loading** для S3 объектов:
  - Постраничная загрузка (1000 объектов/запрос)
  - Инкрементальное отображение результатов
  - Фоновая загрузка в отдельном потоке
- **LRU кэширование**:
  - Кэш списков объектов (1000 элементов)
  - Кэш информации о bucket'ах (10 элементов)
  - Кэш статусов versioning
- **Быстрый подсчет** объектов и размера без загрузки метаданных
- **Автоматическое отключение сортировки** при >1000 объектах

#### Обработка версий
- **Два режима загрузки**:
  1. Быстрый (list_objects_v2): без версий
  2. Полный (list_object_versions): с подсчетом версий
- Агрегация версий по ключам на лету
- Отображение только файлов с множественными версиями

### Bookmarks (закладки)
- **Сохранение позиций** (Ctrl+B):
  - FS: путь к директории
  - S3: endpoint + bucket + prefix
- **Быстрый переход** (Alt+B)
- **Управление**: просмотр, выбор, удаление закладок
- Хранение в JSON файле (bookmarks.json)

### Дополнительные возможности
- **Подсчет размера** директорий/bucket'ов (F3 на папке)
- **Seed-файл** для bucket'ов (s3_buckets.txt): добавление скрытых bucket'ов
- **Информация о владельце** bucket'а (если есть права)
- **Восстановление фокуса** после операций
- **Обработка владельцев** S3 объектов
- **Поддержка Windows** (heartbeat для обновления UI)

---

## Сравнение с CLI утилитами

### vs s3cmd

| Функционал | S3 Commander | s3cmd |
|-----------|--------------|-------|
| **Интерфейс** | TUI (двухпанельный) | CLI (команды) |
| **Навигация** | Визуальная, интерактивная | Команды `ls`, `cd` (псевдо) |
| **Versioning** | ✅ Полная поддержка с UI | ✅ Команды `setversioning`, `list-versions` |
| **Копирование** | Drag-and-drop стиль | Команды `put`, `get`, `cp` |
| **Множественные endpoint'ы** | ✅ Переключение в runtime | ⚠️ Через разные конфиги |
| **Прогресс** | Графический прогресс-бар | Текстовый прогресс |
| **Фильтрация** | Интерактивная (glob) | `--include`, `--exclude` |
| **Конфликты** | Диалоги с выбором | Флаги `--force`, `--skip-existing` |
| **Безопасность** | Fernet + Vault | Plaintext конфиг |
| **Версии объектов** | Выбор версии из списка | Указание `--version-id` |
| **Batch операции** | Выделение + F5/F8 | Синхронизация `sync` |
| **Metadata** | Просмотр в диалоге | Команды `info`, `ls -l` |
| **Server-side copy** | ✅ S3→S3 | ✅ `cp s3://... s3://...` |

**Преимущества S3 Commander**:
- Удобная визуальная навигация
- Интерактивная работа с версиями
- Защита от ошибок (диалоги подтверждения)
- Множественные endpoint'ы без пересоздания конфига
- Secure storage (Vault, encryption)

**Преимущества s3cmd**:
- Автоматизация (скрипты)
- Синхронизация директорий (`sync`)
- Управление ACL и политиками
- Website hosting конфигурация
- CloudFront integration

---

### vs AWS CLI v1

| Функционал | S3 Commander | AWS CLI v1 |
|-----------|--------------|------------|
| **Интерфейс** | TUI | CLI |
| **Навигация** | Двухпанельный MC-стиль | Команды `aws s3 ls` |
| **Versioning** | ✅ UI для управления | ✅ `put-bucket-versioning` |
| **Копирование** | Интерактивное | `aws s3 cp`, `sync` |
| **Множественные профили** | Endpoint'ы в одном конфиге | `--profile` |
| **Прогресс** | Графический | Опция `--progress` |
| **Фильтрация** | Glob паттерны | `--exclude`, `--include` |
| **Конфликты** | Диалоги | Флаги (нет интерактива) |
| **Безопасность** | Fernet + Vault | IAM credentials |
| **Batch операции** | Выделение элементов | `--recursive` |
| **Metadata** | Детальный просмотр (F4) | `aws s3api head-object` |
| **Presigned URLs** | Автогенерация в info | `aws s3 presign` |
| **Server-side copy** | ✅ | ✅ `aws s3 cp s3://... s3://...` |
| **Lifecycle** | Просмотр правил | ✅ Полное управление |
| **Encryption** | Просмотр статуса | ✅ Управление KMS |

**Преимущества S3 Commander**:
- Визуальная работа (проще для операторов)
- Нет необходимости запоминать синтаксис команд
- Безопасное хранение credentials (Vault)
- Интерактивное разрешение конфликтов
- Работа с версиями "из коробки"

**Преимущества AWS CLI**:
- Полный набор AWS API операций
- Глубокое управление IAM, KMS, CloudWatch
- Интеграция в CI/CD
- Работа с AWS-специфичными фичами (S3 Select, Glacier, etc.)
- JSON output для парсинга

---

## Итоговое позиционирование

**S3 Commander** — это специализированный TUI файловый менеджер, который:

### Идеален для:
- Интерактивной работы с S3-совместимыми хранилищами (Ceph, MinIO)
- Операторов, которым нужен визуальный интерфейс
- Управления версиями объектов (просмотр, копирование версий)
- Работы с множественными endpoint'ами
- Безопасного хранения credentials (Vault, шифрование)
- Миграции данных между разными S3 системами

### Не заменяет CLI для:
- Автоматизации и скриптинга
- Сложных AWS-специфичных операций (IAM, Lambda, etc.)
- Массовой синхронизации (хотя batch операции поддерживаются)
- CI/CD пайплайнов
- Управления lifecycle policies и сложными ACL

**Вывод**: S3 Commander дополняет CLI утилиты, предоставляя удобный визуальный интерфейс для повседневных операций с S3, особенно сильно выделяясь в работе с версионированием и множественными endpoint'ами.
