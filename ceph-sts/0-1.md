Чтобы включить password grant (ROPC) в Keycloak v25 через Admin Console, нужно разрешить для клиента “Direct Access Grants” (это именно переключатель, который позволяет `grant_type=password`).[1][2]

## Шаги в Admin Console (Keycloak v25)

1) Откройте Admin Console и выберите realm `test`.[3]
2) Перейдите в **Clients** → выберите client **ceph-s3** (или создайте новый).[3]
3) Откройте вкладку **Settings** (в некоторых темах UI это может быть “Client details”).[3]
4) В блоке **Capability config** включите:
- **Client authentication** = ON (получится confidential client; для теста так безопаснее и предсказуемее).[4]
- **Direct access grants** = ON (это и есть разрешение password grant).[2][1]

5) Нажмите **Save**.[3]

### (Опционально, но полезно для теста) Client secret
Если вы включили **Client authentication**, то перейдите на вкладку **Credentials** и скопируйте **Client secret** (он понадобится, если будете получать токен по password grant как confidential client — `client_secret` добавляется в запрос к token endpoint).[5][6]

## Быстрый тест password grant

Token endpoint для realm:  
`https://<keycloak>/realms/test/protocol/openid-connect/token`[7]

### Public client (без client secret)
(Если Client authentication = OFF)

```bash
curl -s "https://keycloak/realms/test/protocol/openid-connect/token" \
  -H 'content-type: application/x-www-form-urlencoded' \
  -d 'grant_type=password' \
  -d 'client_id=ceph-s3' \
  -d 'username=user1' \
  -d 'password=Passw0rd!'
```

### Confidential client (с client secret)
(Если Client authentication = ON)

```bash
curl -s "https://keycloak/realms/test/protocol/openid-connect/token" \
  -H 'content-type: application/x-www-form-urlencoded' \
  -d 'grant_type=password' \
  -d 'client_id=ceph-s3' \
  -d 'client_secret=<CLIENT_SECRET>' \
  -d 'username=user1' \
  -d 'password=Passw0rd!'
```

Если видите ошибку `Client not allowed for direct access grants`, значит переключатель **Direct access grants** не включён (или изменения не применились на все инстансы в HA).[8][5]

[1](https://www.keycloak.org/docs/25.0.6/securing_apps/index.html)
[2](https://www.keycloak.org/securing-apps/oidc-layers)
[3](https://www.keycloak.org/docs/latest/server_admin/index.html)
[4](https://docs.gitops.weaveworks.org/docs/guides/configuring-oidc-with-keycloak/)
[5](https://github.com/marcospereirampj/python-keycloak/issues/240)
[6](https://developer.konghq.com/how-to/configure-oidc-with-password-grant/)
[7](https://stackoverflow.com/questions/77883850/keycloak-direct-grant-by-password-or-otp)
[8](https://github.com/keycloak/keycloak/discussions/22472)
[9](https://www.keycloak.org/2024/06/keycloak-2500-released)
[10](https://stackoverflow.com/questions/67533682/keycloak-direct-access-grant-not-valid-at-keycloak-userinfo-endpoint)
[11](https://github.com/keycloak/keycloak/issues/37237)
[12](https://github.com/keycloak/keycloak/issues/30543)
[13](https://stackoverflow.com/questions/63523622/direct-access-grant-with-keycloak-using-external-identity-provider-idp)
[14](https://www.keycloak.org/docs/latest/upgrading/index.html)
[15](https://www.youtube.com/watch?v=WGcgiegv0W0)
[16](https://docs.nginx.com/nginx-instance-manager/admin-guide/authentication/oidc/keycloak-setup/)
[17](https://www.keycloak.org/securing-apps/client-registration-cli)
[18](https://www.keycloak.org/docs/latest/server_development/index.html)
[19](https://dev.to/nsrinivasan/keycloak-client-credentials-keeping-access-safe-4eo4)
[20](https://www.clever.cloud/developers/doc/addons/keycloak/)
[21](https://www.keycloak.org/docs/latest/authorization_services/index.html)
