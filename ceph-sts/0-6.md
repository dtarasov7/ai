Ниже минимальный пример на Python3, который **обновляет access token Keycloak** через `refresh_token` (grant_type=`refresh_token`) на token endpoint realm’а, и корректно обрабатывает ситуацию, когда refresh token истёк (тогда надо заново логиниться по паролю). Сам запрос выглядит как POST на `/realms/<realm>/protocol/openid-connect/token` с параметрами `client_id`, `grant_type=refresh_token`, `refresh_token` (и `client_secret`, если клиент confidential).[1][2]

```python
#!/usr/bin/env python3
import requests

KEYCLOAK = "https://keycloak"
REALM = "test"
CLIENT_ID = "ceph-s3"
CLIENT_SECRET = ""  # если confidential client -> укажите secret, иначе оставьте пустым

TOKEN_URL = f"{KEYCLOAK}/realms/{REALM}/protocol/openid-connect/token"

def refresh_access_token(refresh_token: str) -> dict:
    data = {
        "grant_type": "refresh_token",
        "client_id": CLIENT_ID,
        "refresh_token": refresh_token,
    }
    if CLIENT_SECRET:
        data["client_secret"] = CLIENT_SECRET  # для confidential client часто требуется [web:189]

    r = requests.post(
        TOKEN_URL,
        headers={"content-type": "application/x-www-form-urlencoded"},
        data=data,
        timeout=15,
    )
    r.raise_for_status()
    return r.json()

if __name__ == "__main__":
    old_refresh = "<PASTE_REFRESH_TOKEN_HERE>"
    try:
        new_tokens = refresh_access_token(old_refresh)
        print("access_token:", new_tokens["access_token"][:40] + "...")
        print("expires_in:", new_tokens.get("expires_in"))
        # Keycloak может вернуть новый refresh_token — используйте его дальше. [web:189]
        print("refresh_token:", new_tokens.get("refresh_token", "<not returned>")[:40] + "...")
    except requests.HTTPError as e:
        # Если refresh token истёк/невалидный, Keycloak вернёт HTTP 400 -> нужно перелогиниться. [web:189]
        print("Refresh failed:", e.response.status_code, e.response.text)
```

Если нужен полный пример “login по паролю → сохранить refresh_token → периодически refresh → всегда иметь валидный access_token”, скажите: client `ceph-s3` у вас public или confidential (есть client secret)?[1]

[1](https://stackoverflow.com/questions/51386337/refresh-access-token-via-refresh-token-in-keycloak)
[2](https://www.keycloak.org/docs/25.0.6/securing_apps/index.html)
[3](https://www.keycloak.org/securing-apps/token-exchange)
[4](https://stackoverflow.com/questions/70419790/keycloak-admin-rest-api-create-new-access-token-with-refresh-token-without-rec)
[5](https://python-keycloak.readthedocs.io/en/latest/reference/keycloak/keycloak_openid/index.html)
[6](https://forum.dataspace.copernicus.eu/t/how-do-we-use-the-refresh-token-value-in-the-response-to-a-keycloak-token-request/331)
[7](https://developer.konghq.com/plugins/openid-connect/examples/refresh-token/)
[8](https://huongdanjava.com/get-access-token-using-refresh-token-with-keycloak.html)
[9](https://github.com/marcospereirampj/python-keycloak/blob/master/src/keycloak/keycloak_openid.py)
[10](https://blog.elest.io/keycloak-token-management-expiration-revocation-and-renewal/)
[11](https://stackoverflow.com/questions/52040265/how-to-specify-refresh-tokens-lifespan-in-keycloak)
[12](https://docs.h2o.ai/mlops/v0.65.1/py-client/py-client-examples/keycloak-authentication-methods)
[13](https://www.youtube.com/watch?v=MeXzVS4QZ4Q)
[14](https://www.reddit.com/r/KeyCloak/comments/uhpvvp/whenhow_to_correctly_refresh_an_access_token/)
[15](https://stackoverflow.com/questions/66130404/keycloak-refresh-external-idp-token)
[16](https://github.com/keycloak/keycloak/issues/35429)
[17](https://pypi.org/project/python-keycloak/)
[18](https://docs.redhat.com/en/documentation/red_hat_build_of_keycloak/22.0/html/securing_applications_and_services_guide/oidc)
[19](https://github.com/keycloak/keycloak/discussions/15938)
[20](https://gitlab.lcsb.uni.lu/keycloak-projects/keycloak-python-client/-/blob/master/README.md)
