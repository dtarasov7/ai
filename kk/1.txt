KC_URL="http://localhost:8080"
ADMIN_REALM="master"
ADMIN_USER="admin"
ADMIN_PASS="admin"
TARGET_REALM="test"

# Получаем токен
TOKEN=$(curl -s \
  -d "client_id=admin-cli" \
  -d "username=$ADMIN_USER" \
  -d "password=$ADMIN_PASS" \
  -d "grant_type=password" \
  "$KC_URL/realms/$ADMIN_REALM/protocol/openid-connect/token" \
  | jq -r '.access_token')

# Получаем пользователей
curl -s \
  -H "Authorization: Bearer $TOKEN" \
  "$KC_URL/admin/realms/$TARGET_REALM/users?max=1000" | jq .
CLIENT_ID="my-admin-client"
CLIENT_SECRET="your-client-secret"

TOKEN=$(curl -s \
  -d "client_id=$CLIENT_ID" \
  -d "client_secret=$CLIENT_SECRET" \
  -d "grant_type=client_credentials" \
  "$KC_URL/realms/test/protocol/openid-connect/token" \
  | jq -r '.access_token')

jq 'map(select(.federationLink == null))'
